<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldoraigne Tennis Club - Social Day</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <svg style="position:absolute; height:0; width:0;">
      <defs>
        <filter id="recolor-to-primary-blue">
            <feFlood flood-color="#0A0A57" result="flood" />
            <feComposite in="flood" in2="SourceAlpha" operator="in" />
        </filter>
      </defs>
    </svg>

    <header>
        <img src="source/mzansi-court-q-logo.png" alt="Club Logo" id="header-logo">
        <div class="header-buttons">
            <div id="weather-display"></div>
            <!-- Gate Controls -->
            <div class="gate-controls">
                <button id="pedestrian-gate-btn" class="gate-btn" title="Open Pedestrian Gate">
                    <i class="mdi mdi-gate"></i>
                    <span>Pedestrian</span>
                </button>
                <button id="parking-gate-btn" class="gate-btn" title="Open Parking Lot Gate">
                    <i class="mdi mdi-garage-open"></i>
                    <span>Parking</span>
                </button>
            </div>
        </div>
    </header>
    <div id="mobile-menu-bar" class="mobile-menu-bar">
        <button class="mobile-menu-btn" id="mobile-junior-club-btn" title="Junior Club">
            <i class="mdi mdi-account-child"></i>
        </button>
        <button class="mobile-menu-btn" id="mobile-history-btn" title="Game History">
            <i class="mdi mdi-history"></i>
        </button>
        <button class="mobile-menu-btn" id="mobile-notify-btn" title="Force Announcement">
            <i class="mdi mdi-bullhorn"></i>
        </button>
        <button class="mobile-menu-btn" id="mobile-settings-btn" title="Admin Settings">
            <i class="mdi mdi-cog"></i>
        </button>
    </div>

    <div class="header-pull-tab" id="header-pull-tab"></div>
    <div id="time-overlay">
        <div id="left-spacer"></div>
        <h1 id="header-clock" class="header-title">Social Day Manager</h1>
        <div id="right-spacer"></div>
        <div id="announcement-container"></div>
    </div>

    <main class="container">
        <div id="info-bar" class="info-bar hidden">
            <p id="info-bar-text">Dynamic message goes here.</p>
        </div>

        <div class="content-columns">
            <section class="player-column">
                <div id="availablePlayersSection">
                    <div class="card-header">
                        <h3>Available Players</h3>
                        <div class="header-controls">
                            <button id="junior-club-btn" class="settings-btn" title="Junior Club">
                                👪
                            </button>
                            <button id="historyBtn" class="settings-btn" title="Game History">
                                📜
                            </button>
                            <button id="players-toggle-btn" class="settings-btn summary-toggle-btn" data-card-type="players" title="Toggle Details">
                                <i class="mdi mdi-chevron-up"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="player-list-controls">
                            <button id="checkInBtn" class="action-btn">Check In</button>
                            <button id="checkOutBtn" class="action-btn">Check Out</button>
                        </div>
                        <div id="game-mode-container">
                            <h4>Mode</h4>
                            <div class="mode-selector">
                                <button id="mode-doubles" class="mode-btn active">Doubles</button>
                                <button id="mode-singles" class="mode-btn">Singles</button>
                            </div>
                        </div>

                        <div class="player-list-header">
                            <h4>Players</h4>
                            <div class="player-list-sub-headers">
                                <span class="header-sex">SEX</span>
                                <span class="header-time">TIME</span>
                            </div>
                        </div>

                        <ul id="availablePlayersList">
                        </ul>
                    </div>
                </div>
            </section>

            <section id="courtsSection">
                <div id="court-grid" class="court-grid">
                </div>
            </section>
        </div>
    </main>

    <div id="checkout-thanks-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <img src="source/mzansi-court-q-logo.png" alt="Eldoraigne Tennis Club" class="checkout-thanks-logo">
            <div class="checkout-thanks-content">
                <h3 id="checkout-thanks-title">Thanks for joining us!</h3>

                <div id="checkout-player-stats" class="checkout-stats-container hidden">
                    <h4>Here's how you did today:</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Your Rank</span>
                            <strong id="stat-rank">#1</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Win %</span>
                            <strong id="stat-win-percentage">100%</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Time Today</span>
                            <strong id="stat-time-today">00h00m</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Games Played</span>
                            <strong id="stat-games-played">0</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Games Won</span>
                            <strong id="stat-games-won">0</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Time</span>
                            <strong id="stat-total-time">00h00m</strong>
                        </div>
                    </div>
                    <div class="match-highlights">
                        <p id="best-match-highlight"><strong>Best Match:</strong> N/A</p>
                        <p id="worst-match-highlight"><strong>Toughest Match:</strong> N/A</p>
                    </div>
                </div>

                <p id="checkout-thanks-message">We hope you had a great day on the courts. Please join us for our next social day.</p>
                <p><strong>Just a friendly reminder to please settle your tuck shop account before you leave.</strong></p>
            </div>
            <div class="modal-actions">
                <button id="checkout-thanks-back-btn" class="action-btn neutral">Back</button>
                <button id="checkout-thanks-confirm-btn" class="action-btn confirm">Confirm</button>
            </div>
        </div>
    </div>

    <div id="checkout-thanks-no-stats-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <img src="source/mzansi-court-q-logo.png" alt="Eldoraigne Tennis Club" class="checkout-thanks-logo">
            <div class="checkout-thanks-content">
                <h3 id="checkout-thanks-no-stats-title">Thanks for joining us!</h3>

                <p id="checkout-thanks-no-stats-message">We hope you had a great day on the courts. Please join us for our next social day.</p>
                <p><strong>Just a friendly reminder to please settle your tuck shop account before you leave.</strong></p>
            </div>
            <div class="modal-actions">
                <button id="checkout-thanks-no-stats-back-btn" class="action-btn neutral">Back</button>
                <button id="checkout-thanks-no-stats-confirm-btn" class="action-btn confirm">Confirm</button>
            </div>
        </div>
    </div>

    <div id="leaderboard-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Rules & Leaderboard</h3>
            </div>
            <div class="rules-container">
                <div class="rules-content-scrollable"> <h4>How The App Works:</h4>
                    <ul>
                        <li>The player at the top of the "Available Players" list selects a team from the 7 succeeding players and selects an available court to start a game.</li>
                        <li>After your match, you must end the game on the app to be placed back in the queue.</li>
                        <li>Court modes (Doubles, Singles, Rookie) are automatically assigned based on the number of checked-in players, with Doubles being the preferred format.</li>
                        <li>To ensure fair play, the app will allow for a mixed doubles match if there are not enough players of the same gender in the next 7 available players.</li>
                        <li>To ensure continuous play, if a player is called twice and does not respond, they will be moved outside the available players list and will be eligible for selection after the next match starts.</li>
                        <li>For a bit of fun, players are ranked based on their win percentage (games won vs. games played).</li>
                        <li>Lekker speel!!</li>
                    </ul>
                </div> <div class="leaderboard-prompt">
                    <p>Do you want your results to be included in the Player Statistics Leaderboard?</p>
                </div>
            </div>
            <div class="modal-actions" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
                <button id="leaderboard-back-btn" class="action-btn neutral">Back</button>
                <button id="leaderboard-btn-no" class="action-btn cancel" style="grid-column: 2 / 3;">No Thanks</button>
                <button id="leaderboard-btn-yes" class="action-btn confirm" style="grid-column: 3 / 4;">Yes Please</button>
            </div>
            <div class="modal-footer" style="text-align: center; margin-top: 1rem;">
                <button id="disclaimer-btn" class="link-button">View Disclaimer</button>
            </div>
        </div>
    </div>

    <div id="disclaimer-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Disclaimer</h3>
            </div>
            <p>Eldoraigne Tennis Club and the City of Tshwane Municipality cannot be held responsible for any injury, theft of personal items, or damage to or theft of motor vehicles.</p>
            <p><strong>Use at own risk:</strong> All City parks and facilities are used at your own risk.</p>
            <p><strong>Rules must be followed:</strong> All rules must be obeyed, and any reasonable request by an official on duty must be complied with.</p>
            <p><strong>Misbehavior consequences:</strong> Misbehavior can result in offenders being barred from facilities.</p>
            <div class="modal-actions">
                <button id="disclaimer-close-btn" class="action-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="admin-settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Admin Settings</h3>
                <div class="modal-header-icons">
                    <button id="manage-events-btn" class="admin-icon-btn" title="Manage Events">
                        📅
                    </button>
                    <button id="suggestion-settings-btn" class="admin-icon-btn" title="Suggestion Settings">
                        <i class="mdi mdi-racquetball"></i>
                    </button>
                    <button id="checklist-btn" class="admin-icon-btn" title="Admin Checklist">
                        <i class="mdi mdi-check-circle-outline"></i>
                    </button>
                    <button id="power-score-btn" class="admin-icon-btn" title="Power Score Stats">📈</button>
                    <button id="custom-announcement-btn" class="admin-icon-btn" title="Custom Announcements">💬</button>
                    <button id="edit-styles-btn" class="admin-icon-btn" title="Edit Styles">
                        <i class="mdi mdi-format-font"></i>
                    </button>
                    <button id="ball-management-btn" class="admin-icon-btn" title="Ball Management">
                        🥎
                    </button>
                    <button id="select-sound-btn" class="admin-icon-btn" title="Select Alert Sound">🔔</button>
                    <button id="reset-app-btn" class="admin-icon-btn" title="Reset Application Data">
                        <i class="mdi mdi-refresh"></i>
                    </button>
                    <button id="undo-history-btn" class="settings-action-btn">
                        <i class="mdi mdi-history"></i>
                        <span>Undo History</span>
                    </button>
                </div>
            </div>

            <div class="admin-settings-grid-2col">
                <div class="admin-settings-panel">
                    <h4>Select Member on Duty</h4>
                    <ul id="committee-member-list" class="modal-action-list scrollable">
                    </ul>
                </div>
                <div class="admin-settings-panel">
                    <h4>Court Settings</h4>
                    <ul id="court-availability-list" class="court-availability-list">
                    </ul>
                </div>
            </div>
            <div class="modal-actions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem; padding-top: 0.5rem;">
                <button id="view-reorder-log-btn" class="action-btn" style="background-color: #6c757d;">View Reorder Log</button>
                <button id="reorder-players-btn" class="action-btn" style="background-color: var(--primary-blue);">Reorder Players</button>
            </div>
            <div class="modal-actions" style="display: flex; justify-content: center; margin-top: 1rem; padding-top: 0;">
                <button id="admin-close-btn" style="flex-grow: 0; min-width: 150px;">Close</button>
            </div>
        </div>
    </div>

    <div id="suggestion-settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Suggestion Settings</h3>
            </div>
            <p style="text-align: center; color: var(--neutral-color); margin-bottom: 1.5rem;">Adjust the parameters for the balanced game suggestion.</p>

            <div class="suggestion-settings-container">
                <div class="setting-item power-score-toggle-container">
                    <label for="power-score-only-toggle">Power Score Only Balancing</label>
                    <label class="switch">
                        <input type="checkbox" id="power-score-only-toggle">
                        <span class="slider"></span>
                    </label>
                </div>

                 <div class="setting-item least-playtime-toggle-container">
                    <label for="least-playtime-toggle">Prioritize Least Playtime</label>
                    <label class="switch">
                        <input type="checkbox" id="least-playtime-toggle">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-item female-ratio-container">
                    <div class="slider-labels">
                        <span>All Female</span>
                        <span>Mixed</span>
                    </div>
                    <input type="range" id="female-ratio-slider" min="0" max="100" step="10">
                    <span id="female-ratio-display" class="slider-percentage">50% All Female</span>
                </div>

                <div class="setting-item male-ratio-container">
                    <div class="slider-labels">
                        <span>All Male</span>
                        <span>Mixed</span>
                    </div>
                    <input type="range" id="male-ratio-slider" min="0" max="100" step="10">
                    <span id="male-ratio-display" class="slider-percentage">70% All Male</span>
                </div>

                <div class="setting-item top-player-container">
                    <div class="slider-labels">
                        <span>Standard Balance</span>
                        <span>Top Player H2H</span>
                    </div>
                    <input type="range" id="top-player-slider" min="0" max="100" step="5">
                    <span id="top-player-display" class="slider-percentage">35% Top Player H2H</span>

                </div>

                <div class="setting-item frequent-opponent-container">
                    <div class="slider-labels">
                        <span>Standard Balance</span>
                        <span>Frequent Opponent</span>
                    </div>
                    <input type="range" id="frequent-opponent-slider" min="0" max="100" step="5">
                    <span id="frequent-opponent-display" class="slider-percentage">35% Frequent Opponent</span>

                </div>

                <div class="setting-item weak-player-container">
                    <div class="slider-labels">
                        <span>Standard Balance</span>
                        <span>Weak Player Group</span>
                    </div>
                    <input type="range" id="weak-player-slider" min="0" max="100" step="5">
                    <span id="weak-player-display" class="slider-percentage">35% Weak Player Group</span>

                </div>
                 </div> <div class="modal-actions">
                <button id="suggestion-settings-close-btn" class="action-btn">Done</button>
            </div>
        </div>
    </div>

    <div id="checklist-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Admin Checklist</h3>
                <div class="modal-header-icons">
                     <button id="checklist-history-btn" class="admin-icon-btn" title="Checklist History">
                        <i class="mdi mdi-history"></i>
                    </button>
                </div>
            </div>
            <p style="text-align: center; color: var(--neutral-color); margin-bottom: 1.5rem;">Daily setup and closing tasks.</p>

            <div id="checklist-content" class="checklist-container">
                </div>

            <div class="modal-actions">
                <button id="checklist-close-btn" class="action-btn">Done</button>
            </div>
        </div>
    </div>

    <div id="checklist-history-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3 id="checklist-history-title">Checklist History</h3>
            </div>

            <div id="checklist-history-list-view">
                <p style="text-align: center; color: var(--neutral-color); margin-bottom: 1rem;">Select a date to view the checklist status for that day.</p>
                <ul id="checklist-history-list" class="modal-action-list scrollable" style="max-height: 60vh;">
                    </ul>
            </div>

            <div id="checklist-history-detail-view" class="hidden">
                 <p style="text-align: center; color: var(--neutral-color); margin-bottom: 1.5rem;">Checklist status as recorded on <strong id="checklist-detail-date"></strong>.</p>
                 <div id="checklist-history-detail" class="checklist-container read-only">
                    </div>
            </div>

            <div class="modal-actions">
                 <button id="checklist-history-back-btn" class="action-btn neutral hidden" style="flex-grow: 0; width: 150px;">Back to Dates</button>
                 <button id="checklist-history-close-btn" class="action-btn cancel" style="flex-grow: 0; width: 150px;">Close</button>
            </div>
        </div>
    </div>

    <div id="sound-selection-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Alert Sound</h3>
                <div class="modal-header-icons">
                    <button id="mute-btn" class="admin-icon-btn" title="Mute All Sounds">
                        <i class="mdi mdi-volume-high"></i>
                    </button>
                    <button id="minimize-notifications-btn" class="admin-icon-btn" title="Minimize Notifications">
                        <i class="mdi mdi-arrow-expand-vertical"></i>
                    </button>
                    <button id="no-speech-btn" class="admin-icon-btn" title="Turn Off Speech">
                        <i class="mdi mdi-microphone-message"></i>
                    </button>
                </div>
            </div>
            <p style="text-align: center; color: var(--neutral-color);">Choose the sound to play for notifications.</p>

            <ul class="modal-action-list" style="border-top: 1px solid var(--border-color); margin-top: 1rem; padding-top: 1rem;">
                <li class="court-availability-item">
                    <label for="auto-minimize-toggle">Auto-Minimize Alerts</label>
                    <label class="switch">
                        <input type="checkbox" id="auto-minimize-toggle">
                        <span class="slider"></span>
                    </label>
                </li>
            </ul>

            <div id="sound-selection-list" class="sound-selection-list scrollable">
            </div>

            <div class="modal-actions">
                <button id="sound-cancel-btn" class="action-btn">Cancel</button>
                <button id="sound-confirm-btn" class="action-btn" disabled>Confirm Selection</button>
            </div>
        </div>
    </div>

    <div id="reorder-log-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3>Queue Reorder History</h3>
            </div>
            <p>Log of all administrative changes to the player queue.</p>
            <div id="reorder-history-list" class="history-list scrollable" style="max-height: 400px; padding: 0;">
            </div>
            <div class="modal-actions">
                <button id="reorder-log-back-btn" class="action-btn" style="background-color: #6c757d;">Back to Settings</button>
            </div>
        </div>
    </div>

    <div id="reorder-players-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Reorder Available Players</h3>
            </div>
            <p>Use the arrows to change the player queue order. The player at the top is first in line.</p>
            <ul id="reorder-players-list" class="modal-action-list scrollable">
            </ul>
            <div class="modal-actions">
                <button id="reorder-cancel-btn" class="action-btn" style="background-color: #6c757d;">Back to Settings</button>
                <button id="reorder-save-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="choose-teams-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Choose Teams</h3>
            </div>
            <p>Select 2 players for Team 1.<br>The rest will be Team 2.</p>
            <div id="modal-player-list" class="modal-player-list"></div>
            <div class="modal-actions">
                <button id="modal-cancel-btn">Cancel</button>
                <button id="modal-confirm-teams-btn">Confirm Teams</button>
            </div>
        </div>
    </div>

    <div id="cancel-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Confirm Action</h3>
            </div>
            <p>Are you sure?</p>
            <div class="modal-actions">
                <button id="modal-btn-no" class="action-btn">Go Back</button>
                <button id="modal-btn-yes-confirm" class="action-btn">Yes</button>
            </div>
        </div>
    </div>

    <div id="guest-name-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Add New Player</h3>
            </div>
            <div class="score-input-area" style="flex-direction: column; align-items: stretch;">
                <label for="guest-name-input">First Name:</label>
                <input type="text" id="guest-name-input" readonly placeholder="Tap to enter name">
            </div>
            <div class="score-input-area" style="flex-direction: column; align-items: stretch; margin-top: 1rem;">
                <label for="guest-surname-input">Surname:</label>
                <input type="text" id="guest-surname-input" readonly placeholder="Tap to enter surname">
            </div>

            <div class="gender-selector">
                <label>Gender:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="guest-gender" value="M"> M
                    </label>
                    <label>
                        <input type="radio" name="guest-gender" value="F"> F
                    </label>
                </div>
            </div>

            <div class="age-type-selector" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                <label>Player Type:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="age-type" value="Junior"> Junior
                    </label>
                    <label>
                        <input type="radio" name="age-type" value="Student"> Student
                    </label>
                    <label>
                        <input type="radio" name="age-type" value="Adult" checked> Adult
                    </label>
                    <label>
                        <input type="radio" name="age-type" value="Senior"> Senior
                    </label>
                </div>
            </div>
            <div class="player-type-selector">
                <label>Guest Type:</label> <div class="radio-group">
                    <label>
                        <input type="radio" name="player-type" value="guest" checked> Guest
                    </label>
                    <label>
                        <input type="radio" name="player-type" value="member"> Member
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button id="guest-cancel-btn">Cancel</button>
                <button id="guest-confirm-btn" disabled>Confirm Player</button>
            </div>
        </div>
    </div>

    <div id="check-in-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Check In Player</h3>
            </div>
            <p>Select a member, choose a returning or new guest,.</p>
            <div class="list-container">
                <div id="check-in-abc-index" class="abc-index"></div>
                <ul id="check-in-list" class="modal-action-list scrollable"></ul>
            </div>
            <div id="check-in-actions" class="modal-actions">
                <button id="check-in-cancel-btn">Close</button>
                <button id="returning-guest-btn" class="action-btn neutral">Guest</button>
                <button id="add-new-player-btn" class="action-btn">New Guest</button>
            </div>
        </div>
    </div>

    <div id="returning-guest-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Check In Returning Guest</h3>
            </div>
            <p>Select the '+' next to the guest to check them in.</p>
            <div class="list-container">
                <div id="returning-guest-abc-index" class="abc-index"></div>
                <ul id="returning-guest-list" class="modal-action-list scrollable"></ul>
            </div>
            <div class="modal-actions">
                <button id="returning-guest-cancel-btn">Back</button>
            </div>
        </div>
    </div>

    <div id="check-out-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Check Out Player</h3>
            </div>
            <p>Select the 'X' next to the player to check out.</p>
            <div class="list-container">
                <div id="check-out-abc-index" class="abc-index"></div>
                <ul id="check-out-list" class="modal-action-list scrollable"></ul>
            </div>
            <div class="modal-actions">
                <button id="check-out-cancel-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="court-mode-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3 id="court-mode-title">Set Court Mode</h3>
            </div>
            <p style="color: var(--neutral-color); margin-bottom: 1rem;">Select the intended purpose for this court.</p>
            <ul id="court-mode-list" class="modal-action-list scrollable">
            </ul>
            <div class="modal-actions">
                <button id="court-mode-close-btn" class="action-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <div id="end-game-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Enter Game Results</h3>
            </div>
            <p id="end-game-timestamp" style="font-size: 0.9rem; color: #6c757d; text-align: center; margin-top: -0.5rem; margin-bottom: 0.5rem;"></p>

            <div class="result-section">
                <h4>1. Select Winning Team</h4>
                <div id="end-game-teams">
                </div>
            </div>

            <div class="result-section hidden" id="score-section">
                <h4>2. Enter Final Score</h4>
                <div class="score-input-area">
                    <div class="score-input-wrapper winning">
                        <label for="winning-score">Winning Score</label>
                        <input type="number" id="winning-score" readonly>
                    </div>
                    <div class="score-input-wrapper losing">
                        <label for="losing-score">Losing Score</label>
                        <input type="number" id="losing-score" readonly>
                    </div>
                </div>
            </div>

            <div class="result-section hidden" id="tie-breaker-area">
                <h4>3. Enter Tie-Break Score</h4>
                   <div class="score-input-area">
                    <div class="score-input-wrapper winning">
                        <label for="winner-tiebreak">Winner's Points</label>
                        <input type="number" id="winner-tiebreak" readonly>
                    </div>
                    <div class="score-input-wrapper losing">
                        <label for="loser-tiebreak">Loser's Points</label>
                        <input type="number" id="loser-tiebreak" readonly>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="end-game-cancel-btn">Cancel</button>
                <button id="end-game-skip-btn" class="action-btn neutral">Skip Scores</button>
                <button id="end-game-confirm-btn" disabled>Confirm</button>
            </div>
        </div>
    </div>

    <div id="history-page" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3>Game History</h3>
            </div>
            <div id="history-list" class="history-list scrollable">
            </div>
            <div id="team-history-list" class="history-list scrollable" style="display: none;">
                </div>
            <div class="modal-actions">
                <button id="history-close-btn">Close</button>
                <button id="manual-entry-btn" class="action-btn neutral">Add Result</button>
                <button id="history-toggle-teams-btn" class="action-btn">Team Stats</button>
                <button id="history-toggle-view" class="action-btn">Player Stats</button>
            </div>
        </div>
    </div>

    <div id="custom-keypad-modal" class="modal-overlay hidden">
        <div class="keypad-content">
            <div id="keypad-display"></div>
            <div class="keypad-grid">
                <button class="keypad-btn" data-key="1">1</button>
                <button class="keypad-btn" data-key="2">2</button>
                <button class="keypad-btn" data-key="3">3</button>
                <button class="keypad-btn action" data-key="backspace">⌫</button>

                <button class="keypad-btn" data-key="4">4</button>
                <button class="keypad-btn" data-key="5">5</button>
                <button class="keypad-btn" data-key="6">6</button>
                <button class="keypad-btn action secondary" data-key="clear">C</button>

                <button class="keypad-btn" data-key="7">7</button>
                <button class="keypad-btn" data-key="8">8</button>
                <button class="keypad-btn" data-key="9">9</button>
                <button class="keypad-btn" data-key="0">0</button>

                <button class="keypad-btn wide-half cancel hidden" id="keypad-cancel-btn">Cancel</button>
                <button id="keypad-confirm-btn" class="keypad-btn wide-full confirm">Done</button>
            </div>
        </div>
    </div>

    <div id="court-mode-keypad-modal" class="modal-overlay hidden">
        <div class="keypad-content">
            <div id="court-mode-keypad-display"></div>
            <div class="keypad-grid">
                <button class="keypad-btn" data-key="1">1</button>
                <button class="keypad-btn" data-key="2">2</button>
                <button class="keypad-btn" data-key="3">3</button>
                <button class="keypad-btn action" data-key="backspace">⌫</button>

                <button class="keypad-btn" data-key="4">4</button>
                <button class="keypad-btn" data-key="5">5</button>
                <button class="keypad-btn" data-key="6">6</button>
                <button class="keypad-btn action secondary" data-key="clear">C</button>

                <button class="keypad-btn" data-key="7">7</button>
                <button class="keypad-btn" data-key="8">8</button>
                <button class="keypad-btn" data-key="9">9</button>
                <button class="keypad-btn" data-key="0">0</button>

                <button class="keypad-btn wide-half cancel" id="court-mode-keypad-cancel-btn">Cancel</button>
                <button id="court-mode-keypad-confirm-btn" class="keypad-btn wide-half confirm">Done</button>
            </div>
        </div>
    </div>

    <div id="custom-alpha-keypad-modal" class="modal-overlay hidden">
        <div class="keypad-content">
            <div id="alpha-keypad-display"></div>
            <div class="keypad-grid" id="alpha-keypad-grid">
            </div>
        </div>
    </div>

    <div id="global-keyboard-modal" class="global-keyboard-overlay hidden">
        <div class="keyboard-content">
            <textarea id="global-keyboard-display" rows="2" spellcheck="false"></textarea>
            <div id="emoji-search-container" class="hidden">
                <input type="text" id="emoji-search-input" placeholder="Search emoji..." />
            </div>
            <div id="global-keyboard-grid" class="keyboard-grid">
                </div>
        </div>
    </div>

    <div id="manage-court-players-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Manage On-Court Players</h3>
            </div>
            <p id="manage-court-players-instructions">Select a court with an active game.</p>

            <ul id="court-list-for-management" class="modal-action-list scrollable">
            </ul>

            <ul id="remove-players-list" class="modal-action-list scrollable hidden">
            </ul>

            <ul id="add-players-list" class="modal-action-list scrollable hidden">
            </ul>

            <div class="modal-actions">
                <button id="manage-players-back-btn" class="action-btn hidden" style="background-color: #6c757d;">Back</button>
                <button id="manage-players-add-btn" class="action-btn hidden" style="background-color: var(--confirm-color);">Add Player</button>
                <button id="manage-players-confirm-btn" class="action-btn hidden">Confirm</button>
                <button id="manage-players-close-btn" class="action-btn" style="background-color: #dc3545;">Close</button>
            </div>
        </div>
    </div>

    <div id="current-weather-modal" class="modal-overlay hidden">
        <div class="modal-content weather-modal">
            <div class="modal-header-with-actions">
                <h3>Current Weather</h3>
                <span id="cw-time">8:00 AM</span>
            </div>
            <div class="weather-main">
                <div class="weather-temp-icon">
                    <span id="cw-icon" class="weather-icon-large"></span>
                    <span id="cw-temp" class="weather-temp-large">15°</span>
                </div>
                <div class="weather-feels-like">
                    <p>RealFeel® <span id="cw-realfeel">13°</span></p>
                    <p>RealFeel Shade™ <span id="cw-realfeel-shade">13°</span></p>
                </div>
            </div>
            <p id="cw-description" class="weather-description">Cloudy</p>
            <div class="weather-grid">
                <div class="weather-item">
                    <span>Wind</span>
                    <strong id="cw-wind">WSW 15 km/h</strong>
                </div>
                <div class="weather-item">
                    <span>Wind Gusts</span>
                    <strong id="cw-wind-gusts">39 km/h</strong>
                </div>
                <div class="weather-item">
                    <span>Air Quality</span>
                    <strong id="cw-air-quality" class="aqi-poor">Poor</strong>
                </div>
            </div>
            <div class="modal-actions">
                <button id="cw-close-btn">Close</button>
                <button id="cw-more-details-btn" class="action-btn">More Details</button>
            </div>
        </div>
    </div>

    <!-- Swap Player Modal -->
    <div id="swap-player-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Swap Player with Another Court</h3>
            <p id="swap-player-instructions">Select a player from Court X to swap with:</p>
            
            <div id="swap-source-player" class="swap-player-display">
                <!-- Source player will be shown here -->
            </div>
            
            <ul id="swap-target-list" class="modal-action-list scrollable">
                <!-- Target players from other courts will be listed here -->
            </ul>
            
            <div class="modal-actions">
                <button id="swap-player-back-btn" class="action-btn cancel">Back</button>
            </div>
        </div>
    </div>

    <!-- Swap Confirmation Modal -->
    <div id="swap-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Confirm Player Swap</h3>
            <div id="swap-confirm-details" class="swap-confirmation-display">
                <!-- Swap details will be shown here -->
            </div>
            <div class="modal-actions">
                <button id="swap-confirm-back-btn" class="action-btn neutral">Back</button>
                <button id="swap-confirm-execute-btn" class="action-btn confirm">Confirm Swap</button>
            </div>
        </div>
    </div>

    <div id="undo-history-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Undo History</h3>
            <p>Recent actions from this session. Select an action to undo (requires PIN).</p>
            
            <ul id="undo-history-list" class="modal-action-list scrollable">
                <!-- Undo history items will be listed here -->
            </ul>
            
            <div class="modal-actions">
                <button id="undo-history-close-btn" class="action-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <div id="detailed-weather-modal" class="modal-overlay hidden">
        <div class="modal-content weather-modal wide">
            <div class="modal-header-with-actions">
                <h3>Detailed Weather</h3>
            </div>
            <div id="detailed-weather-content">
                <div class="weather-section">
                    <h4>Detailed Current Weather</h4>
                    <div class="weather-grid">
                        <div class="weather-item"><span>Max UV Index</span><strong id="dw-uv">0.4 (Low)</strong></div>
                        <div class="weather-item"><span>Dew Point</span><strong id="dw-dewpoint">12°</strong></div>
                        <div class="weather-item"><span>Humidity</span><strong id="dw-humidity">81%</strong></div>
                        <div class="weather-item"><span>Pressure</span><strong id="dw-pressure">↑ 1015 mb</strong></div>
                        <div class="weather-item"><span>Cloud Cover</span><strong id="dw-cloud-cover">95%</strong></div>
                        <div class="weather-item"><span>Visibility</span><strong id="dw-visibility">16 km</strong></div>
                    </div>
                </div>
                <div class="weather-section">
                    <div class="weather-tabs">
                        <button class="tab active" data-view="day">Day</button>
                        <button class="tab" data-view="morning">Morning</button>
                        <button class="tab" data-view="afternoon">Afternoon</button>
                    </div>
                    <div class="weather-main-forecast">
                        <div class="weather-temp-icon">
                            <span id="forecast-icon" class="weather-icon-large"></span>
                            <span id="forecast-temp" class="weather-temp-large">25°</span>
                        </div>
                        <div class="weather-feels-like">
                            <p>RealFeel® <span id="forecast-realfeel">27°</span></p>
                            <p>RealFeel Shade™ <span id="forecast-realfeel-shade">23°</span></p>
                        </div>
                    </div>
                    <p id="forecast-description" class="weather-description">A thunderstorm this morning; otherwise, clouds and sun</p>
                    <div id="forecast-grid" class="weather-grid">
                        </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="dw-close-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="sign-out-member-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Member Signing Out</h3>
            </div>
            <p id="sign-out-member-prompt" style="color: var(--neutral-color);">Please select the member responsible for this ball sign-out.</p>
            <div class="list-container">
                <div id="sign-out-member-abc-index" class="abc-index"></div>
                <ul id="sign-out-member-list" class="modal-action-list scrollable">
                </ul>
            </div>
            <div class="modal-actions">
                <button id="sign-out-member-cancel-btn" class="action-btn" style="background-color: var(--cancel-color);">Cancel</button>
                <button id="sign-out-member-confirm-btn" class="action-btn" disabled>Confirm Member</button>
            </div>
        </div>
    </div>
    <div id="ball-management-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Ball Management</h3>
                <div class="modal-header-icons">
                    <button id="ball-history-btn" class="admin-icon-btn" title="Ball Transaction History">
                        <i class="mdi mdi-history"></i>
                    </button>
                </div>
            </div>
            <div class="ball-management-grid">

                <div class="admin-settings-panel">
                    <h4>Stock (Cans)</h4>
                    <div class="stock-display-area">
                        <span id="ball-stock-count" class="stock-number">0</span>
                        <span class="stock-label">Cans in Stock</span>
                    </div>
                    <div class="stock-update-area">
                        <button id="add-stock-btn" class="action-btn" data-action="open-stock-keypad" style="background-color: var(--primary-blue);">Add Stock</button>
                        <button id="return-stock-btn" class="action-btn" data-action="open-return-keypad" style="background-color: var(--neutral-color);">Return Cans</button>
                    </div>
                </div>

                <div class="admin-settings-panel">
                    <h4>Sign Out (Cans)</h4>
                    <p style="font-size: 0.9em; color: var(--neutral-color); margin-top: 0.5rem; margin-bottom: 1rem;">
                        Category for ball usage.
                    </p>
                    <div id="sign-out-options" class="sign-out-options scrollable">
                        <button class="action-btn sign-out-btn" data-category="ClubChamps">Club Champs</button>
                        <button class="action-btn sign-out-btn" data-category="League">League</button>
                        <button class="action-btn sign-out-btn" data-category="Social">Social</button>
                        <button class="action-btn sign-out-btn" data-category="Sale" style="background-color: var(--cancel-color);">Sales</button>
                    </div>
                </div>

                <div class="admin-settings-panel">
                    <h4>Used Balls (Singles)</h4>
                    <div class="stock-display-area">
                        <span id="used-ball-stock-count" class="stock-number used">0</span>
                        <span class="stock-label">Used Balls in Stock</span>
                    </div>
                    <div class="stock-update-area">
                        <button id="return-used-balls-btn" class="action-btn" style="background-color: var(--inactive-color); border-color: var(--inactive-color);">Return Used Balls</button>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="ball-management-close-btn" class="action-btn">Done</button>
            </div>
        </div>
    </div>

    <div id="ball-history-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3>Ball Transaction History</h3>
            </div>
            <p>A log of all ball stock additions, returns, and sign-outs.</p>
            <div id="ball-history-list" class="history-list scrollable">
                </div>
            <div class="modal-actions">
                <button id="ball-history-close-btn" class="action-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="ball-sale-type-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Stock Type for Sale</h3>
            </div>
            <p style="text-align: center; color: var(--neutral-color);">Is the customer purchasing a can of new balls or a single old ball?</p>

            <div class="modal-actions modal-grid-2x2" style="margin-top: 1rem;">
                <button id="sale-type-cans-btn" class="action-btn confirm" data-stock-type="cans">New Balls (Cans)</button>
                <button id="sale-type-singles-btn" class="action-btn neutral" data-stock-type="singles">Old Balls (Singles)</button>
                <button id="sale-type-cancel-btn" class="action-btn cancel" style="grid-column: 1 / 3;">Cancel Sale</button>
            </div>
        </div>
    </div>

    <div id="purchaser-selection-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Purchaser</h3>
            </div>
            <p id="purchaser-selection-prompt" style="color: var(--neutral-color);">Identify the member or guest purchasing the ball(s).</p>

            <div class="list-container">
                <div id="purchaser-member-abc-index" class="abc-index"></div>
                <ul id="purchaser-member-list" class="modal-action-list scrollable"></ul>
            </div>

            <div class="modal-actions" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
                <button id="purchaser-cancel-btn" class="action-btn cancel">Cancel</button>
                <button id="purchaser-returning-guest-btn" class="action-btn neutral">Returning Guest</button>
                <button id="purchaser-new-guest-btn" class="action-btn confirm">New Guest</button>
            </div>
        </div>
    </div>

    <div id="ball-history-detail-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions" style="margin-bottom: 0.5rem;"> <h3>Transaction Details</h3>
            </div>
            <div id="ball-detail-content" class="scrollable" style="flex-grow: 1; overflow-y: auto; padding-right: 0.5rem; margin-bottom: 1rem;"> <div class="checkout-stats-container" style="padding: 0.75rem 1rem; margin-bottom: 0.75rem;"> <h4 style="margin-bottom: 0.5rem; color: var(--primary-blue);">Summary</h4>
                    <div class="stats-grid" style="grid-template-columns: 1fr 1fr; gap: 0.5rem 1rem;"> <div class="stat-item">
                            <span class="stat-label">Stock Type</span>
                            <strong id="detail-stock-type">Cans</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Category</span>
                            <strong id="detail-category">Sale</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Date & Time</span>
                            <strong id="detail-datetime" style="font-size: 1.1em;">2025/10/21, 14:00</strong> </div>
                        <div class="stat-item">
                            <span class="stat-label">Quantity</span>
                            <strong id="detail-count" style="color: var(--cancel-color);">-3</strong>
                        </div>
                    </div>
                </div>

                <div class="checkout-stats-container" style="padding: 0.75rem 1rem; margin-bottom: 0.75rem;"> <h4 style="margin-bottom: 0.5rem; color: var(--primary-blue);">Roles</h4>
                    <div class="stats-grid" style="grid-template-columns: 1fr; gap: 0.25rem;"> <div class="stat-item" style="align-items: flex-start; text-align: left;">
                            <span class="stat-label" id="detail-committee-label">Committee Member (Sign Out)</span>
                            <strong id="detail-committee-member">Franco da Silva</strong>
                        </div>
                        <div class="stat-item" style="align-items: flex-start; text-align: left;">
                            <span class="stat-label">Purchaser / Recipient</span>
                            <strong id="detail-purchaser">Andre Pienaar</strong>
                        </div>
                    </div>
                </div>

                <div class="checkout-stats-container" style="padding: 0.75rem 1rem;"> <h4 style="margin-bottom: 0.5rem; color: var(--primary-blue);">Stock Levels</h4>
                    <div class="stats-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="stat-item">
                            <span class="stat-label">Before</span>
                            <strong id="detail-stock-before">18</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Change</span>
                            <strong id="detail-stock-change" style="color: var(--cancel-color);">-3</strong>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">After</span>
                            <strong id="detail-stock-after">15</strong>
                        </div>
                    </div>
                </div>
            </div> <div class="modal-actions" style="margin-top: 0;"> <button id="ball-detail-close-btn" class="action-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="edit-styles-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Edit Display Styles</h3>
            </div>
            <div class="style-settings-panel">
                <h4>Font Size</h4>
                <div class="font-size-selector" id="font-size-selector">
                    <button data-size="0.8">-20%</button>
                    <button data-size="0.9">-10%</button>
                    <button data-size="1.0" class="active">Default</button>
                    <button data-size="1.1">+10%</button>
                    <button data-size="1.2">+20%</button>
                </div>
            </div>
            <div class="style-settings-panel">
                <h4>Display Size</h4>
                <div class="display-size-selector" id="display-size-selector">
                    <button data-size="0.9">Small</button>
                    <button data-size="1.0" class="active">Default</button>
                    <button data-size="1.1">Large</button>
                </div>
            </div>
            <div class="modal-actions">
                <button id="edit-styles-close-btn" class="action-btn">Done</button>
            </div>
        </div>
    </div>

    <div id="junior-club-modal" class="modal-overlay hidden">
        <div class="modal-content full-height">
            <div class="modal-header-with-actions">
                <h3>Junior Club Check In</h3>
                <div class="modal-header-icons">
                    <button id="junior-club-roster-btn" class="admin-icon-btn" title="View Full Roster">
                        <i class="mdi mdi-format-list-bulleted"></i>
                    </button>
                    <button id="junior-club-history-btn" class="admin-icon-btn" title="View History & Payment">
                        $
                    </button>
                </div>
            </div>
            <div class="list-container">
                <div id="junior-club-abc-index" class="abc-index"></div>
                <ul id="junior-club-list" class="modal-action-list scrollable"></ul>
            </div>
            <div class="modal-actions modal-grid-2x2">
                <button id="junior-club-close-btn" class="action-btn cancel">Close</button>
                <button id="new-parent-btn" class="action-btn confirm">New Parent</button>
            </div>
        </div>
    </div>

    <div id="new-parent-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>New Parent Registration</h3>
            </div>

            <div id="parent-collapsed-display" class="collapsed-area hidden"></div>

            <div id="parent-fields">
                <div class="score-input-area" style="flex-direction: column; align-items: stretch;">
                    <label for="parent-name-input">Parent First Name:</label>
                    <input type="text" id="parent-name-input" readonly placeholder="Tap to enter name" style="width: 100%;">
                </div>
                <div class="score-input-area" style="flex-direction: column; align-items: stretch; margin-top: 1rem;">
                    <label for="parent-surname-input">Parent Surname:</label>
                    <input type="text" id="parent-surname-input" readonly placeholder="Tap to enter surname" style="width: 100%;">
                </div>
                <div class="score-input-area" style="flex-direction: column; align-items: stretch; margin-top: 1rem;">
                    <label for="parent-email-input">Email Address (Mandatory):</label>
                    <input type="email" id="parent-email-input" readonly placeholder="Tap to enter email" style="width: 100%;">
                </div>
                <div class="score-input-area" style="flex-direction: column; align-items: stretch; margin-top: 1rem;">
                    <label for="parent-phone-input">Phone Number (Mandatory):</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="parent-country-code" style="width: 120px; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 5px; background: white;">
                            <option value="+27" selected>🇿🇦 +27</option>
                            <option value="+1">🇺🇸 +1</option>
                            <option value="+44">🇬🇧 +44</option>
                            <option value="+61">🇦🇺 +61</option>
                            <option value="+91">🇮🇳 +91</option>
                            <option value="+86">🇨🇳 +86</option>
                            <option value="+81">🇯🇵 +81</option>
                            <option value="+49">🇩🇪 +49</option>
                            <option value="+33">🇫🇷 +33</option>
                            <option value="+39">🇮🇹 +39</option>
                            <option value="+34">🇪🇸 +34</option>
                            <option value="+55">🇧🇷 +55</option>
                            <option value="+52">🇲🇽 +52</option>
                            <option value="+7">🇷🇺 +7</option>
                            <option value="+82">🇰🇷 +82</option>
                        </select>
                        <input type="tel" id="parent-phone-input" readonly placeholder="Tap to enter number" style="flex: 1;">
                    </div>
                </div>
            </div>


            <div id="children-container-wrapper">
                <h4 style="margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">Children Details</h4>
                <div id="children-container" style="max-height: 40vh; overflow-y: auto;">
                    </div>
            </div>

            <div class="modal-actions modal-grid-2x2">
                <button id="add-child-btn" class="action-btn confirm">
                    Add Child
                </button>
                <button id="remove-child-btn-main" class="action-btn remove-child-bordered-btn">
                    Remove Child
                </button>
                <button id="new-parent-cancel-btn" class="action-btn cancel">Close</button>
                <button id="new-parent-confirm-btn" class="action-btn confirm" disabled>Confirm</button>
            </div>
            </div>
    </div>

    <div id="child-selection-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Attending Children</h3>
            </div>
            <p id="child-selection-prompt">Please select the children who are present today.</p>
            <ul id="attending-children-list" class="modal-action-list scrollable">
                </ul>
            <div class="modal-actions">
                <button id="child-selection-back-btn" class="action-btn neutral">Back</button>
                <button id="child-selection-confirm-btn" class="action-btn" disabled>Check In (0 Children)</button>
            </div>
        </div>
    </div>

    <div id="remove-child-selection-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3 id="remove-child-selection-title">Remove Registered Children</h3>
            </div>
            <p id="remove-child-selection-prompt">Please select the children you wish to remove from this parent's profile.</p>
            <ul id="children-for-removal-list" class="modal-action-list scrollable">
                </ul>
            <div class="modal-actions">
                <button id="remove-child-selection-back-btn" class="action-btn neutral">Back</button>
                <button id="remove-child-selection-confirm-btn" class="action-btn cancel" disabled>Remove Selected (0 Children)</button>
            </div>
        </div>
    </div>

    <div id="junior-club-stats-modal" class="modal-overlay hidden">
        <div class="modal-content wide full-height">
            <div class="modal-header-with-actions">
                <h3>Junior Club Payment History</h3>
            </div>
            <div class="list-container">
                <div id="junior-club-history-abc-index" class="abc-index"></div>
                <ul id="junior-club-history-list" class="history-list scrollable" style="padding: 0;">
                    </ul>
            </div>
            <div class="modal-actions">
                <button id="junior-club-stats-back-btn" class="action-btn neutral">Back to Check In</button>
                <button id="junior-club-stats-details-btn" class="action-btn" disabled>View Details</button>
            </div>
        </div>
    </div>

    <div id="junior-club-detail-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3 id="detail-parent-name">Parent Name</h3>
            </div>
            <p id="detail-date" style="font-size: 0.9em; color: var(--neutral-color); margin-bottom: 1rem;"></p>

            <h4 style="margin-bottom: 0.5rem;">Attended Children:</h4>
            <ul id="detail-children-list" class="modal-action-list">
                </ul>

            <div class="modal-actions" style="margin-top: 1.5rem;">
                <button id="detail-close-btn" class="action-btn cancel">Close</button>
                <button id="detail-toggle-paid-btn" class="action-btn">Mark as Paid</button>
            </div>
        </div>
    </div>

    <div id="junior-club-roster-modal" class="modal-overlay hidden">
        <div class="modal-content wide full-height">

            <div class="modal-header-with-actions">
                <h3>Junior Club Roster</h3>
            </div>
            <div class="list-container">
                <div id="junior-club-roster-abc-index" class="abc-index"></div>
                <ul id="junior-club-roster-list" class="modal-action-list scrollable"></ul>
            </div>

            <div class="modal-actions">
                <button id="roster-close-btn" class="action-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <div id="roster-detail-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3 id="roster-detail-title"></h3>
            </div>
            <div id="roster-detail-content" style="max-height: 40vh; overflow-y: auto;">
                </div>
            <div class="modal-actions">
                <button
                    id="roster-detail-close-btn"
                    class="action-btn cancel"
                >Close</button>
            </div>
        </div>
    </div>

    <div id="manual-entry-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Select Checked In Players</h3>
            </div>
            <p>Select 2 (Singles) or 4 (Doubles) players who participated in the match.</p>
            <div id="manual-selected-players" class="manual-selected-container"></div>
            <div class="list-container">
                <div id="manual-player-abc-index" class="abc-index"></div>
                <ul id="manual-player-list" class="modal-action-list scrollable"></ul>
            </div>
            <div class="modal-actions" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
                <button id="manual-entry-cancel-btn" class="action-btn cancel">Close</button>
                <button id="add-outside-player-btn" class="action-btn neutral">Checked Out</button>
                <button id="manual-add-guest-btn" class="action-btn confirm" style="grid-column: 1 / 2;">New Guest</button>
                <button id="manual-entry-confirm-btn" class="action-btn confirm" disabled style="grid-column: 2 / 4;">Confirm</button>
            </div>
        </div>
    </div>

    <div id="outside-player-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header-with-actions">
                    <h3>Select Checked Out Players</h3>
                </div>
                <p>Select a player who has already checked out or is a returning guest.</p>
                <div id="outside-selected-players" class="manual-selected-container"></div>
                <div class="list-container">
                    <div id="outside-player-abc-index" class="abc-index"></div>
                    <ul id="outside-player-list" class="modal-action-list scrollable"></ul>
                </div>
                <div class="modal-actions">
                    <button id="outside-player-back-btn" class="action-btn cancel">Back</button>
                    <button id="outside-player-confirm-btn" class="action-btn" disabled>Confirm</button>
                </div>
            </div>
        </div>
    <div id="temp-duty-handover-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>Temporary Duty Handover</h3>
            </div>
            <p id="temp-duty-handover-prompt" style="text-align: center; color: var(--neutral-color); margin-bottom: 1.5rem;">
                Who is going to take over from <strong><span id="temp-duty-current-member">Member Name</span></strong>?<br>
                Please inform them before heading to court.
            </p>
            <div class="admin-settings-panel" style="max-height: 400px;">
                <ul id="temp-duty-handover-list" class="modal-action-list scrollable">
                </ul>
            </div>
            <div class="modal-actions">
                <button id="temp-duty-cancel-btn" class="action-btn cancel">Cancel</button>
                <button id="temp-duty-confirm-btn" class="action-btn confirm" disabled>Confirm Handover</button>
            </div>
        </div>
    </div>

    <div id="cooldown-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header-with-actions">
                    <h3>Cooldown Period Active</h3>
                </div>
                <p style="text-align: center; font-size: 1.1em; margin: 1.5rem 0;">
                    You cannot resume yet. Please wait for the cooldown to end.
                    <br><br>
                    Time remaining:
                    <strong id="cooldown-timer" style="font-size: 1.5em; color: var(--primary-blue);">10:00</strong>
                </p>
                <div class="modal-actions">
                    <button id="cooldown-close-btn" class="action-btn">Close</button>
                </div>
            </div>
        </div>

    <div id="comparison-modal" class="modal-overlay hidden">
            <div class="modal-content wide">
                <div class="modal-header-with-actions">
                    <h3 id="comparison-title">Head-to-Head</h3>
                </div>

                <div class="game-history-filter-container" id="comparison-filter-container">
                    </div>

                <div id="comparison-content" class="comparison-content">
                    </div>

                <div class="modal-actions">
                    <button id="comparison-close-btn" class="action-btn cancel">Close</button>
                </div>
            </div>
        </div>

    <div id="custom-announcement-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3>Custom Announcements</h3>
            </div>
            <p>Create scrolling messages for the header. Check the box to also announce them with Text-to-Speech (TTS).</p>

            <div class="announcement-controls">
                <label>TTS Interval:</label>
                <div class="interval-adjuster">
                    <button id="tts-interval-decrease">-</button>
                    <span id="tts-interval-display">30 min</span>
                    <button id="tts-interval-increase">+</button>
                </div>
            </div>
            <ul id="announcement-list" class="modal-action-list scrollable">
                </ul>
            <div class="modal-actions">
                <button id="announcement-cancel-btn" class="action-btn cancel">Close</button>
                <button id="announcement-save-btn" class="action-btn confirm">Save</button>
            </div>
        </div>
    </div>

    <div id="power-score-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                <h3>Player Power Score Stats</h3>
            </div>
            <p>This list shows the calculated scores used for the game suggestion feature.</p>
            <div id="power-score-list" class="history-list scrollable">
            </div>
            <div class="modal-actions">
                <button id="power-score-close-btn" class="action-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <div id="event-list-modal" class="modal-overlay hidden">
        <div class="modal-content wide full-height">
            <div class="modal-header-with-actions">
                <h3>Manage Club Events</h3>
            </div>
            <p>View, edit, or create new events. Use the toggle to control screensaver visibility.</p>
            <ul id="event-list" class="modal-action-list scrollable">
                </ul>
            <div class="modal-actions">
                <button id="close-event-list-btn" class="action-btn cancel">Close</button>
                <button id="create-new-event-btn" class="action-btn confirm">Create New Event</button>
            </div>
        </div>
    </div>

    <div id="event-create-edit-modal" class="modal-overlay hidden">
        <div class="modal-content wide">
            <div class="modal-header-with-actions">
                 <h3 id="event-modal-title">Create New Event</h3>
            </div>
            <div class="event-form-grid scrollable"> <div class="form-group">
                    <label for="event-type">Event Type:</label>
                    <select id="event-type">
                        <option value="Social" selected>Social</option>
                        <option value="Club Champs">Club Champs</option>
                        <option value="League">League</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="event-heading">Heading:</label>
                    <input type="text" id="event-heading" readonly placeholder="Tap to enter heading">
                </div>

                <div class="form-group">
                    <label for="event-date">Event Date:</label>
                    <input type="date" id="event-date">
                 </div>
                <div class="form-group">
                    <label for="event-rsvp-date">RSVP Date:</label>
                    <input type="date" id="event-rsvp-date">
                </div>

                <div class="form-group">
                    <label for="event-start-time">Start Time:</label>
                    <input type="time" id="event-start-time"> </div>

                <div class="form-group span-two">
                    <label for="event-body1">Body Text 1:</label>
                    <textarea id="event-body1" class="event-body-input" readonly placeholder="Tap to enter details..."></textarea>
                </div>
                <div class="form-group span-two">
                    <label for="event-body2">Body Text 2:</label>
                    <textarea id="event-body2" class="event-body-input" readonly placeholder="Tap to enter more details..."></textarea>
                </div>

                <div class="form-group">
                    <label for="event-cost-adult">Adult Cost (R): <span class="slider-value">R0</span></label>
                    <input type="range" id="event-cost-adult" min="0" max="500" step="10" value="0">
                </div>
                <div class="form-group">
                    <label for="event-cost-child">Child Cost (R): <span class="slider-value">R0</span></label>
                    <input type="range" id="event-cost-child" min="0" max="250" step="5" value="0">
                </div>

                <div class="form-group checkbox-group">
                    <label for="event-volunteers">Volunteers Needed?</label>
                    <input type="checkbox" id="event-volunteers">
                </div>

                <div class="form-group span-two">
                    <label for="event-participation-discount">Participation Discount (R): <span class="slider-value">R0</span></label>
                    <input type="range" id="event-participation-discount" min="0" max="100" step="5" value="0">
                </div>

                <div class="form-group">
                    <label for="event-phone">Phone Number:</label>
                    <input type="text" id="event-phone" readonly placeholder="Tap for phone number">
                </div>
                
                <div class="form-group">
                    <label for="event-email">Email Address:</label>
                    <input type="text" id="event-email" readonly placeholder="Tap for email address">
                </div>
                
                <div class="form-group span-two">
                    <label for="event-website">Website URL:</label>
                    <input type="text" id="event-website" readonly placeholder="Tap for website URL">
                </div>

                <div class="form-group span-two radio-group-container">
                    <label>Open To:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="event-open-to" value="Full Members"> Full</label>
                        <label><input type="radio" name="event-open-to" value="Social Members"> Social</label>
                        <label><input type="radio" name="event-open-to" value="All Members" checked> All</label>
                    </div>
                    <div class="checkbox-group separate-checkbox">
                        <label for="event-open-guests">Invited Guests?</label>
                        <input type="checkbox" id="event-open-guests">
                    </div>
                </div>


                <div class="form-group">
                    <label for="event-image1">Image 1:</label>
                    <select id="event-image1">
                        <option value="None">None</option>
                        <option value="Trophy.jpg">Trophy</option>
                        <option value="Potjiekos.jpg">Potjiekos</option>
                        <option value="Tennis.jpg">Tennis</option>
                        <option value="Braai.jpg">Braai</option>
                        <option value="Rugby.jpg">Rugby</option>
                        <option value="F1.jpg">Formula 1</option>
                        <option value="ClubChamps.jpg">Club Champs</option>
                        </select>
                </div>
                <div class="form-group">
                    <label for="event-image2">Image 2:</label>
                    <select id="event-image2">
                        <option value="None">None</option>
                        <option value="Trophy.jpg">Trophy</option>
                        <option value="Potjiekos.jpg">Potjiekos</option>
                        <option value="Tennis.jpg">Tennis</option>
                        <option value="Braai.jpg">Braai</option>
                        <option value="Rugby.jpg">Rugby</option>
                        <option value="F1.jpg">Formula 1</option>
                        <option value="ClubChamps.jpg">Club Champs</option>
                        </select>
                </div>

                <div class="form-group span-two" id="interested-players-section" style="display: none;">
                    <h4>Interested Players</h4>
                    <ul id="interested-players-list" class="modal-action-list scrollable">
                        </ul>
                </div>
            </div> <div class="modal-actions">
                <button id="cancel-event-edit-btn" class="action-btn cancel">Cancel</button>
                <button id="save-event-btn" class="action-btn confirm">Save Event</button>
            </div>
        </div>
    </div>

    <div id="screensaver-overlay" class="hidden">
        <div id="screensaver-content">
            </div>
    </div>

    <!-- Undo Toast Notification -->
    <div id="undo-toast" class="undo-toast hidden">
        <div class="undo-toast-content">
            <span id="undo-toast-message">Action completed</span>
            <div class="undo-toast-actions">
                <button id="undo-toast-btn" class="undo-btn">Undo</button>
                <button id="undo-toast-dismiss" class="undo-dismiss">×</button>
            </div>
        </div>
        <div id="undo-toast-timer" class="undo-toast-timer"></div>
    </div>

    <div id="light-settings-court-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3 id="light-settings-court-title">Edit Light Settings for Court X</h3>
            </div>
            <p style="color: var(--neutral-color); margin-bottom: 1.5rem;">Configure global and court-specific Shelly settings.</p>

            <div class="event-form-grid scrollable" style="grid-template-columns: 1fr; gap: 1rem; flex-grow: 1; min-height: 0; padding-right: 0.5rem; margin-bottom: 1rem;">

                <div class="form-group" style="border-bottom: 2px solid var(--primary-blue); padding-bottom: 1rem; margin-bottom: 1rem;">
                    <label style="font-weight: bold; color: var(--primary-blue); font-size: 1rem;">Global Settings (Shared)</label>
                    <div style="margin-top: 0.5rem;">
                         <label for="light-setting-base-url">Shelly Base URL (Cloud/Local):</label>
                         <input type="text" id="light-setting-base-url" class="long-press-paste" readonly placeholder="e.g., https://shelly-...cloud or http://IP...">
                    </div>
                     <div style="margin-top: 0.5rem;">
                        <label for="light-setting-auth-key">Shelly Cloud Auth Key:</label>
                        <input type="text" id="light-setting-auth-key" class="long-press-paste" readonly placeholder="Paste Shelly Cloud Auth Key here">
                    </div>
                </div>
                <label style="font-weight: bold; color: var(--primary-blue); font-size: 1rem; margin-top: -0.5rem;">Court Specific Settings</label>
                <div class="form-group">
                    <label for="light-setting-label">Display Label:</label>
                    <input type="text" id="light-setting-label" class="long-press-paste" readonly placeholder="e.g., Court A Lights">
                </div>
                <div class="form-group">
                    <label for="light-setting-cloud-id">Shelly Cloud Device ID:</label>
                    <input type="text" id="light-setting-cloud-id" class="long-press-paste" readonly placeholder="Enter Cloud ID (for remote control)">
                </div>
                 <div class="form-group">
                    <label for="light-setting-local-ip">Shelly Local IP Address:</label>
                    <input type="text" id="light-setting-local-ip" class="long-press-paste" readonly placeholder="Enter Local IP (e.g., 192.168...)">
                </div>
                <div class="form-group" style="flex-direction: row; justify-content: space-between; align-items: center; border-top: 1px dashed var(--border-color); padding-top: 1rem; margin-top: 0.5rem;">
                    <label for="light-setting-managed" style="margin-bottom: 0;">Managed by App?</label>
                    <label class="switch">
                        <input type="checkbox" id="light-setting-managed">
                        <span class="slider"></span>
                    </label>
                </div>
                 </div> <div class="modal-actions" style="margin-top: 0; padding-top: 0.5rem;"> <button id="light-settings-court-cancel-btn" class="action-btn cancel">Cancel</button>
                <button id="light-settings-court-save-btn" class="action-btn confirm">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Pedestrian Gate Settings Modal -->
    <div id="pedestrian-gate-settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>🚶 Pedestrian Gate Settings</h3>
            </div>
            <p style="color: var(--neutral-color); margin-bottom: 1.5rem;">Configure Shelly device for pedestrian gate (1-second pulse).</p>
            
            <div class="event-form-grid scrollable" style="grid-template-columns: 1fr; gap: 1rem; flex-grow: 1; min-height: 0; padding-right: 0.5rem; margin-bottom: 1rem;">
                
                <div class="form-group" style="flex-direction: row; justify-content: space-between; align-items: center;">
                    <label for="pedestrian-gate-managed" style="margin-bottom: 0;">Enable Control</label>
                    <label class="switch">
                        <input type="checkbox" id="pedestrian-gate-managed">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="pedestrian-gate-cloud-id">Cloud Device ID:</label>
                    <input type="text" id="pedestrian-gate-cloud-id" class="long-press-paste" readonly placeholder="Shelly device ID for cloud API">
                </div>
                
                <div class="form-group">
                    <label for="pedestrian-gate-local-ip">Local IP Address:</label>
                    <input type="text" id="pedestrian-gate-local-ip" class="long-press-paste" readonly placeholder="e.g., 192.168.1.101">
                </div>
                
                <div style="background: #f0f8ff; border-left: 4px solid var(--primary-blue); padding: 1rem; border-radius: 4px;">
                    <p style="margin: 0; font-size: 0.9em; color: var(--text-color);">
                        <strong>ℹ️ Note:</strong> This sends a 1-second pulse signal. Perfect for maglock controllers. Uses the same cloud/local fallback as court lights.
                    </p>
                </div>
            </div>
            
            <div class="modal-actions" style="margin-top: 0; padding-top: 0.5rem;">
                <button id="pedestrian-gate-settings-cancel-btn" class="action-btn cancel">Cancel</button>
                <button id="pedestrian-gate-settings-save-btn" class="action-btn confirm">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Parking Gate Settings Modal -->
    <div id="parking-gate-settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header-with-actions">
                <h3>🚗 Parking Lot Gate Settings</h3>
            </div>
            <p style="color: var(--neutral-color); margin-bottom: 1.5rem;">Configure Shelly device for parking lot gate (1-second pulse).</p>
            
            <div class="event-form-grid scrollable" style="grid-template-columns: 1fr; gap: 1rem; flex-grow: 1; min-height: 0; padding-right: 0.5rem; margin-bottom: 1rem;">
                
                <div class="form-group" style="flex-direction: row; justify-content: space-between; align-items: center;">
                    <label for="parking-gate-managed" style="margin-bottom: 0;">Enable Control</label>
                    <label class="switch">
                        <input type="checkbox" id="parking-gate-managed">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="parking-gate-cloud-id">Cloud Device ID:</label>
                    <input type="text" id="parking-gate-cloud-id" class="long-press-paste" readonly placeholder="Shelly device ID for cloud API">
                </div>
                
                <div class="form-group">
                    <label for="parking-gate-local-ip">Local IP Address:</label>
                    <input type="text" id="parking-gate-local-ip" class="long-press-paste" readonly placeholder="e.g., 192.168.1.102">
                </div>
                
                <div style="background: #f0f8ff; border-left: 4px solid var(--primary-blue); padding: 1rem; border-radius: 4px;">
                    <p style="margin: 0; font-size: 0.9em; color: var(--text-color);">
                        <strong>ℹ️ Note:</strong> This sends a 1-second pulse signal. Perfect for gate motor controllers. Uses the same cloud/local fallback as court lights.
                    </p>
                </div>
            </div>
            
            <div class="modal-actions" style="margin-top: 0; padding-top: 0.5rem;">
                <button id="parking-gate-settings-cancel-btn" class="action-btn cancel">Cancel</button>
                <button id="parking-gate-settings-save-btn" class="action-btn confirm">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            alert(`!!! JavaScript Error !!!\nMessage: ${message}\nSource: ${source}\nLine: ${lineno}\nError: ${error}`);
            // You could also try sending this to a console inside the pkg context if possible,
            // but alert is the most direct way to see if *any* JS error happens early.
            console.error("!!! JavaScript Error !!!", { message, source, lineno, colno, error });
        };
        console.log("Error handler attached."); // Verify this runs
    </script>

    <script src="api.js"></script>
    <script src="script.js"></script>
</body>
</html>
