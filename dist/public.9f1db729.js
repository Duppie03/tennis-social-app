console.log("--- script.js started ---"),document.addEventListener("DOMContentLoaded",()=>{let e,t=[];function a(e){if(!e)return"";let a=t.find(t=>t.name===e)||l.availablePlayers.find(t=>t.name===e)||l.courts.flatMap(e=>e.players).find(t=>t.name===e),n=e.split(" "),s=n.length>1?n.slice(1).join(" "):"";return a&&a.phoneticName&&s?`${a.phoneticName} ${s}`:a&&a.phoneticName?a.phoneticName:e}let n=["B","C","D","A","E"],l={undoHistory:{actions:[],maxHistory:10},juniorClub:{parents:[],activeChildren:[],history:[],statsFilter:{parent:"all",paid:"all"},rosterFilter:{sortKey:"name",sortOrder:"asc",type:"all"},checkInFilter:{displayMode:"parent"},registrationFlow:{parentCollapsed:!1,childrenExpanded:!1}},events:[],uiSettings:{fontSizeMultiplier:1,displaySizeMultiplier:1},detailedWeatherView:"day",weatherData:null,pongAnimationOffset:0,clubMembers:[...t].sort((e,t)=>e.name.localeCompare(t.name)),availablePlayers:[],courts:[{id:"A",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"B",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"C",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"D",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"E",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"}],courtSettings:{visibleCourts:["A","B","C","D","E"],autoAssignModes:!0,showGameModeSelector:!1},matchSettings:{matchMode:"1set",fastPlayGames:4,autoMatchModes:!0},mobileControls:{isSummaryExpanded:!0,isPlayersExpanded:!0},selection:{gameMode:"doubles",players:[],courtId:null},historySort:{key:"endTime",order:"desc"},gameHistoryFilter:{timeFrame:"Total",gameType:"all"},guestHistory:[],gameHistory:[],reorderHistory:[],historyViewMode:"games",statsFilter:{gender:"all",teamGender:"all",sortKey:"totalDurationMs",sortOrder:"desc"},comparison:{active:!1,type:null,items:[],timeFrame:"Total",opponents:new Set},announcements:[],customAnnouncementState:{scheduler:null,nextAnnouncementTime:0,currentIndex:0,isPaused:!1,ttsIntervalMins:30},powerScoreSort:{key:"finalScore",order:"desc"},suggestionSettings:{femaleRatioPercent:50,maleRatioPercent:70,prioritizeLeastPlaytime:!0,powerScoreOnly:!1,topPlayerPercent:35,frequentOpponentPercent:35,weakPlayerPercent:35,weakPlayerThreshold:-.1},currentSuggestionType:null,currentSuggestionOutcome:null,adminChecklist:{arrival:[{id:"arrUnlockTuckshop",text:"Unlock Tuckshop & Setup POS",checked:!1},{id:"arrUnlockCloakrooms",text:"Unlock Cloakrooms",checked:!1},{id:"arrMainTv",text:"Main TV: On & Sport Channel",checked:!1},{id:"arrTuckshopTv",text:"Tuckshop TV: On & Music Videos",checked:!1},{id:"arrAmpAux",text:"Amp: Aux Analog",checked:!1},{id:"arrAmpOptical",text:"Amp: Optical/Main TV",checked:!1},{id:"arrOpenCurtains",text:"Open Curtains & Sliding Door",checked:!1},{id:"arrPutCushions",text:"Put Out Bench Cushions",checked:!1},{id:"arrSignOutBalls",text:"Sign Out Social Balls (via Ball Mgmt)",checked:!1},{id:"arrEmptyDishwasher",text:"Empty Dishwasher & Check Dishes",checked:!1},{id:"arrCheckFridge",text:"Check Fridge for Expired Products",checked:!1},{id:"arrEmptyBins",text:"Empty Full Bins & Replace Liners",checked:!1},{id:"arrManStation",text:"Man Duty Station (Busy Times)",checked:!1},{id:"arrAssistApp",text:"Assist Members with App",checked:!1},{id:"arrRemindAccounts",text:"Remind Members re: Tuck Shop Accounts",checked:!1}],departure:[{id:"depReturnBalls",text:"Return Social Balls & Sign In (via Ball Mgmt)",checked:!1},{id:"depCheckOutApp",text:"Ensure All Players Checked Out on App",checked:!1},{id:"depLoadDishes",text:"Load/Wash Dishes",checked:!1},{id:"depReturnCushions",text:"Return Bench Cushions",checked:!1},{id:"depTurnOffTvAmp",text:"Turn Off TVs & Amp",checked:!1},{id:"depWipeBar",text:"Wipe Down Bar Counter",checked:!1},{id:"depEmptyIceBucket",text:"Empty & Wash Ice Bucket",checked:!1},{id:"depWipeKitchen",text:"Wipe Down Kitchen Counter",checked:!1},{id:"depTrashOut",text:"Take Inside Trash to Outside Bins",checked:!1},{id:"depLockBarStore",text:"Lock Bar & Storeroom",checked:!1},{id:"depCloseCurtains",text:"Close Sliding Door & Curtains",checked:!1},{id:"depLockClubhouseAlarm",text:"Lock Clubhouse & Set Alarm",checked:!1},{id:"depLockCloakrooms",text:"Lock Cloakrooms",checked:!1},{id:"depLockGates",text:"Check & Lock Pedestrian Gates",checked:!1}]},checklistHistory:[],selectedChecklistHistoryDate:null,onDuty:"None",selectedAlertSound:"Alert1.mp3",notificationControls:{isMuted:!1,isMinimized:!1,isTTSDisabled:!1,autoMinimize:!0},currentQuoteIndex:0,currentAlertCount:0,tennisQuotes:["You only live once, but you get to serve twice.","Tennis is a perfect combination of violent action taking place in an atmosphere of total tranquility.","The serve is the only shot you have 100% control over.","Losing is not my enemy, fear of losing is my enemy.","My motto is: I'm alive, so I have to live it.","Tennis uses the language of life. Advantage, service, fault, break, love.","It's one-on-one out there, man. There ain't no hiding.","The fifth set is not about tennis, it's about nerves.","What is the single most important quality in a tennis champion? I would have to say desire.","Success is a journey, not a destination.","If you can keep your head when all about you are losing theirs, it's just possible you haven't grasped the situation.","I fear no one, but I respect everyone.","Tennis is mostly mental. You win or lose the match before you even go out there.","A champion is afraid of losing. Everyone else is afraid of winning.","The difference between involvement and commitment is like ham and eggs. The chicken is involved; the pig is committed.","You've got to get to the stage in life where going for it is more important than winning or losing.","I'm not the best, but I'm capable of beating the best on any given day.","When you do something best in life, you don't really want to give that up.","The mark of a great champion is to be able to win when you are not playing your best.","Every point is a new opportunity.","Just go out there and do what you have to do.","Tennis is a game of inches. And sometimes, those inches are in your head.","It’s not whether you get knocked down, it’s whether you get up.","Hard work beats talent when talent doesn't work hard.","Don't practice until you get it right. Practice until you can't get it wrong.","Play each point like your life depends on it.","Champions keep playing until they get it right.","I never look back, I look forward.","The harder the battle, the sweeter the victory.","You are never a loser until you quit trying.","To be a great champion you must believe you are the best. If you are not, pretend you are.","The pain you feel today will be the strength you feel tomorrow.","If it doesn’t challenge you, it won’t change you.","Victory is sweetest when you’ve known defeat.","What seems hard now will one day be your warm-up.","I've failed over and over and over again in my life. And that is why I succeed.","Tennis is life.","Keep calm and play tennis.","Tennis: the only place where love means nothing.","I play each point as if it were the last point of the match.","Never give up on a dream just because of the time it will take to accomplish it.","It's not the will to win that matters—everyone has that. It's the will to prepare to win that matters.","Pressure is a privilege.","One point at a time.","Control the controllables.","Tennis requires agility, mental and physical.","My backhand is my weapon.","A perfect volley is a work of art.","There's no place like the court.","Tennis is a dance between two players."],adminCourtManagement:{mode:"card1_select_court",courtId:null,currentCourtPlayers:[],removedPlayers:[],addedPlayers:[]},lightSettings:{shellyBaseUrl:"https://shelly-180-eu.shelly.cloud/v2/devices/api/set/switch",shellyAuthKey:"MzEyNDRhdWlk4A2C89A1B41C12C193A1BF0978CB3C8D7891CD751D3C578EDA094C05D1DB4E618708AE34BCD86240",courts:{A:{id:"A",label:"Court A Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.0.15",shellyCloudId:"YOUR_COURT_A_CLOUD_ID",toggleAfter:0},B:{id:"B",label:"Court B Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.0.147",shellyCloudId:"YOUR_COURT_B_CLOUD_ID",toggleAfter:0},C:{id:"C",label:"Court C Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.0.130",shellyCloudId:"YOUR_COURT_C_CLOUD_ID",toggleAfter:0},D:{id:"D",label:"Court D Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.0.179",shellyCloudId:"YOUR_COURT_D_CLOUD_ID",toggleAfter:0},E:{id:"E",label:"Court E Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.88.74",shellyCloudId:"2cbcbb2fb26c"}},general:{clubhouse:{id:"clubhouse",label:"Clubhouse Lights",isManaged:!0,isActive:!1,shellyDeviceId:"192.168.0.100",shellyCloudId:"YOUR_CLUBHOUSE_CLOUD_ID"}}},gateSettings:{pedestrian:{label:"Pedestrian Gate",shellyCloudId:"https://shelly-180-eu.shelly.cloud/v2/devices/api/set/switch",shellyDeviceId:"",isManaged:!1,toggleAfter:1},parking:{label:"Parking Lot Gate",shellyCloudId:"https://shelly-180-eu.shelly.cloud/v2/devices/api/set/switch",shellyDeviceId:"",isManaged:!1,toggleAfter:1}},manualEntry:{players:[]},ballManagement:{stock:0,usedStock:0,history:[],historyFilter:"all",tempSale:{stockType:null,memberSignOut:null,purchaserName:null}}},s=null,i=null,r=null,o=!1,d=null,c=!1,m=null,u=null,g=!1,p=null,y=document.querySelector("header"),h=document.getElementById("time-overlay"),v=document.getElementById("header-pull-tab"),f=0,b=!1,E=0,L=null,k=0,C=null,S="initial_check",I=[],w=!1,$=!1,D=null,M=null,B=null,T=0,x=!0,A=document.getElementById("screensaver-overlay"),P=document.getElementById("screensaver-content"),N=document.getElementById("leaderboard-confirm-modal"),O=document.getElementById("disclaimer-modal"),H=document.getElementById("current-weather-modal"),q=document.getElementById("detailed-weather-modal"),F=document.getElementById("junior-club-modal"),j=document.getElementById("junior-club-list"),_=document.getElementById("junior-club-close-btn"),G=document.getElementById("new-parent-btn"),R=document.getElementById("new-parent-modal"),z=document.getElementById("new-parent-cancel-btn"),W=document.getElementById("new-parent-confirm-btn"),U=document.getElementById("parent-name-input"),V=document.getElementById("parent-surname-input"),J=document.getElementById("children-container"),K=document.getElementById("add-child-btn"),Y=document.getElementById("parent-phone-input");Y.addEventListener("input",function(e){let t=e.target.value;t.startsWith("0")&&(e.target.value=t.substring(1))});let Z=document.getElementById("parent-email-input"),Q=document.getElementById("remove-child-selection-modal"),X=document.getElementById("children-for-removal-list"),ee=document.getElementById("remove-child-selection-back-btn"),et=document.getElementById("remove-child-selection-confirm-btn"),ea=document.getElementById("child-selection-modal"),en=document.getElementById("child-selection-confirm-btn"),el=document.getElementById("child-selection-back-btn"),es=document.getElementById("attending-children-list"),ei=document.getElementById("junior-club-history-btn"),er=document.getElementById("junior-club-stats-modal"),eo=document.getElementById("junior-club-history-list"),ed=document.getElementById("junior-club-stats-back-btn"),ec=document.getElementById("junior-club-stats-details-btn"),em=document.getElementById("junior-club-detail-modal"),eu=document.getElementById("detail-close-btn"),eg=document.getElementById("detail-toggle-paid-btn"),ep=document.getElementById("junior-club-btn"),ey=document.getElementById("junior-club-name-filter-group");document.getElementById("remove-child-btn-main");let eh=document.getElementById("junior-club-roster-btn"),ev=document.getElementById("junior-club-roster-modal"),ef=document.getElementById("junior-club-roster-list"),eb=document.getElementById("roster-close-btn"),eE=document.getElementById("roster-type-filter-group");document.getElementById("roster-gender-filter-group");let eL=document.getElementById("temp-duty-handover-modal"),ek=document.getElementById("temp-duty-handover-list"),eC=document.getElementById("temp-duty-current-member"),eS=document.getElementById("temp-duty-cancel-btn"),eI=document.getElementById("temp-duty-confirm-btn"),ew=document.getElementById("manual-entry-modal"),e$=document.getElementById("manual-player-list"),eD=document.getElementById("manual-entry-confirm-btn"),eM=document.getElementById("manual-entry-cancel-btn"),eB=document.getElementById("add-outside-player-btn"),eT=document.getElementById("outside-player-modal"),ex=document.getElementById("outside-player-list"),eA=document.getElementById("outside-player-back-btn"),eP=document.getElementById("manual-selected-players"),eN=document.getElementById("outside-selected-players"),eO=document.getElementById("outside-player-confirm-btn"),eH=document.getElementById("roster-detail-modal"),eq=document.getElementById("roster-detail-title"),eF=document.getElementById("roster-detail-content"),ej=document.getElementById("roster-detail-close-btn"),e_=document.getElementById("header-clock"),eG=document.getElementById("availablePlayersSection"),eR=document.getElementById("availablePlayersList"),ez=document.getElementById("court-grid"),eW=document.getElementById("info-bar"),eU=document.getElementById("info-bar-text"),eV=document.getElementById("mode-doubles"),eJ=document.getElementById("mode-singles"),eK=document.getElementById("choose-teams-modal"),eY=document.getElementById("modal-player-list"),eZ=document.getElementById("modal-confirm-teams-btn"),eQ=document.getElementById("modal-cancel-btn"),eX=document.getElementById("cancel-confirm-modal"),e0=document.getElementById("modal-btn-yes-confirm"),e1=document.getElementById("modal-btn-no"),e2=document.getElementById("check-in-modal"),e3=document.getElementById("check-in-list"),e5=document.getElementById("check-in-cancel-btn"),e8=document.getElementById("checkInBtn"),e4=document.getElementById("check-out-modal"),e7=document.getElementById("check-out-list"),e6=document.getElementById("checkOutBtn"),e9=document.getElementById("check-out-cancel-btn"),te=document.getElementById("historyBtn"),tt=document.getElementById("history-page"),ta=document.getElementById("history-list"),tn=document.getElementById("history-toggle-view"),tl=document.getElementById("history-close-btn"),ts=document.getElementById("end-game-modal"),ti=document.getElementById("end-game-teams"),tr=document.getElementById("end-game-confirm-btn"),to=document.getElementById("end-game-cancel-btn"),td=document.getElementById("tie-breaker-area"),tc=document.getElementById("score-section"),tm=document.getElementById("winning-score"),tu=document.getElementById("losing-score"),tg=document.getElementById("winner-tiebreak"),tp=document.getElementById("loser-tiebreak"),ty=document.getElementById("end-game-timestamp"),th=document.getElementById("edit-styles-btn"),tv=document.getElementById("edit-styles-modal"),tf=document.getElementById("edit-styles-close-btn");document.getElementById("font-size-slider");let tb=document.getElementById("custom-keypad-modal"),tE=document.getElementById("keypad-display"),tL=tb.querySelectorAll(".keypad-btn"),tk=document.getElementById("keypad-confirm-btn"),tC=document.getElementById("keypad-cancel-btn"),tS=null,tI={};document.getElementById("add-guest-btn");let tw=document.getElementById("guest-name-modal"),t$=document.getElementById("guest-name-input"),tD=document.getElementById("guest-surname-input"),tM=document.querySelectorAll('input[name="guest-gender"]'),tB=document.getElementById("guest-confirm-btn"),tT=document.getElementById("guest-cancel-btn"),tx=document.getElementById("custom-alpha-keypad-modal"),tA=document.getElementById("alpha-keypad-display"),tP=document.getElementById("alpha-keypad-grid"),tN=null,tO=document.getElementById("global-keyboard-modal"),tH=document.getElementById("global-keyboard-display"),tq=document.getElementById("global-keyboard-grid"),tF=document.getElementById("emoji-search-input"),tj=document.getElementById("emoji-search-container"),t_=null,tG={currentPage:"LetterPad",case:"lower",longPressTimer:null},tR={LetterPad:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["SHIFT","z","x","c","v","b","n","m","BACK"],["?123","GLOBE","SPACE",", / \uD83D\uDE00","ENTER"]],SymbolsP1:[["[","]","{","}","#","%","^","*","+","="],["_","\\","|","~","<",">","€","£","¥","•"],["ABC",".",",","?","!","'",'"',"BACK"],["1234","GLOBE","SPACE","!@#","ENTER"]],SymbolsP2:[["`","´","¨","ç","ñ","æ","œ","ß","÷","¿"],["@","$","&","/","(",")","“","”","…","®"],["ABC",".",",","?","!","'",'"',"BACK"],["?123","GLOBE","SPACE","!@#","ENTER"]],NumberPad:[["PERCENT","1","2","3","+"],["SPACE","4","5","6","-"],["BACK","7","8","9","*"],["ABC","COMMA","?123","0","=","DOT","ENTER"]]},tz=["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83D\uDE02","\uD83E\uDD23","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE42","\uD83D\uDE09","\uD83D\uDE0C","\uD83D\uDE0D","\uD83D\uDE18","\uD83D\uDE17","\uD83D\uDE19","\uD83D\uDE1A","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1C","\uD83E\uDD2A","\uD83D\uDE1D","\uD83E\uDD17","\uD83E\uDD28","\uD83D\uDE10","\uD83D\uDE11","\uD83D\uDE36","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE44","\uD83D\uDE2C","\uD83E\uDD25","\uD83E\uDD27","\uD83D\uDE29","\uD83D\uDE2B","\uD83D\uDE24","\uD83D\uDE21","\uD83D\uDE20","\uD83E\uDD2C","\uD83D\uDE37","\uD83E\uDD12","\uD83E\uDD15","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD2F","\uD83E\uDD73","\uD83D\uDE0E","\uD83E\uDD13","\uD83E\uDDD0","\uD83D\uDE15","\uD83D\uDE1F","\uD83D\uDE41","\uD83D\uDE2E","\uD83D\uDE2F","\uD83D\uDE32","\uD83D\uDE33","\uD83E\uDD7A","\uD83D\uDE26","\uD83D\uDE27","\uD83D\uDE28","\uD83D\uDE30","\uD83D\uDE25","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE31","\uD83D\uDE16","\uD83D\uDE29","\uD83D\uDE2B","\uD83D\uDE34","\uD83E\uDD24","\uD83D\uDE2A"],tW=document.getElementById("admin-settings-modal"),tU=document.getElementById("committee-member-list"),tV=document.getElementById("court-availability-list"),tJ=document.getElementById("admin-close-btn"),tK=document.getElementById("reorder-players-modal"),tY=document.getElementById("reorder-players-list"),tZ=document.getElementById("reorder-players-btn"),tQ=document.getElementById("reorder-save-btn"),tX=document.getElementById("reorder-cancel-btn"),t0=document.getElementById("reorder-log-modal"),t1=document.getElementById("reorder-history-list"),t2=document.getElementById("view-reorder-log-btn");document.getElementById("reorder-log-close-btn");let t3=document.getElementById("reorder-log-back-btn"),t5=[],t8=document.getElementById("select-sound-btn"),t4=document.getElementById("sound-selection-modal"),t7=document.getElementById("sound-selection-list"),t6=document.getElementById("sound-confirm-btn"),t9=document.getElementById("sound-cancel-btn"),ae=Array.from({length:17},(e,t)=>`Alert${t+1}.mp3`),at="",aa=document.getElementById("mute-btn"),an=document.getElementById("minimize-notifications-btn"),al=document.getElementById("no-speech-btn"),as=document.getElementById("court-mode-keypad-modal"),ai=document.getElementById("court-mode-keypad-display"),ar=as.querySelectorAll(".keypad-btn"),ao=document.getElementById("court-mode-keypad-confirm-btn"),ad=document.getElementById("court-mode-keypad-cancel-btn"),ac=null;document.getElementById("manage-court-players-btn");let am=document.getElementById("manage-court-players-modal"),au=document.getElementById("court-list-for-management"),ag=document.getElementById("remove-players-list"),ap=document.getElementById("add-players-list"),ay=document.getElementById("manage-players-close-btn"),ah=document.getElementById("manage-players-back-btn"),av=document.getElementById("manage-players-add-btn"),af=document.getElementById("manage-players-confirm-btn"),ab=am.querySelector(".modal-actions"),aE=document.getElementById("custom-announcement-modal"),aL=document.getElementById("announcement-list"),ak=document.getElementById("announcement-save-btn"),aC=document.getElementById("announcement-cancel-btn"),aS=document.getElementById("custom-announcement-btn"),aI=document.getElementById("ball-management-btn"),aw=document.getElementById("ball-management-modal"),a$=document.getElementById("ball-management-close-btn"),aD=document.getElementById("ball-stock-count"),aM=document.getElementById("used-ball-stock-count"),aB=document.getElementById("add-stock-btn"),aT=document.getElementById("sign-out-options"),ax=document.getElementById("sign-out-member-modal"),aA=document.getElementById("sign-out-member-list"),aP=document.getElementById("sign-out-member-confirm-btn"),aN=document.getElementById("sign-out-member-cancel-btn"),aO=document.getElementById("return-stock-btn"),aH=document.getElementById("return-used-balls-btn"),aq=document.getElementById("ball-history-btn"),aF=document.getElementById("ball-history-modal"),aj=document.getElementById("ball-history-detail-modal");document.getElementById("ball-detail-content");let a_=document.getElementById("detail-stock-type"),aG=document.getElementById("detail-category"),aR=document.getElementById("detail-datetime"),az=document.getElementById("detail-count"),aW=document.getElementById("detail-committee-member"),aU=document.getElementById("detail-purchaser"),aV=document.getElementById("detail-stock-before"),aJ=document.getElementById("detail-stock-change"),aK=document.getElementById("detail-stock-after"),aY=document.getElementById("ball-detail-close-btn"),aZ=document.getElementById("ball-sale-type-modal"),aQ=document.getElementById("sale-type-cans-btn"),aX=document.getElementById("sale-type-singles-btn"),a0=document.getElementById("sale-type-cancel-btn"),a1=document.getElementById("purchaser-selection-modal"),a2=document.getElementById("purchaser-member-list"),a3=document.getElementById("purchaser-selection-prompt"),a5=document.getElementById("ball-history-list"),a8=document.getElementById("ball-history-close-btn");document.getElementById("sign-out-member-prompt");let a4=document.getElementById("cooldown-modal"),a7=document.getElementById("cooldown-timer"),a6=document.getElementById("cooldown-close-btn"),a9=document.getElementById("comparison-modal"),ne=document.getElementById("comparison-title"),nt=document.getElementById("comparison-content"),na=document.getElementById("comparison-filter-container"),nn=document.getElementById("comparison-close-btn"),nl=document.getElementById("power-score-modal"),ns=document.getElementById("power-score-list"),ni=document.getElementById("power-score-btn"),nr=document.getElementById("power-score-close-btn"),no=document.getElementById("suggestion-settings-btn"),nd=document.getElementById("suggestion-settings-modal"),nc=document.getElementById("suggestion-settings-close-btn"),nm=document.getElementById("female-ratio-slider"),nu=document.getElementById("female-ratio-display"),ng=document.getElementById("male-ratio-slider"),np=document.getElementById("male-ratio-display"),ny=document.getElementById("least-playtime-toggle"),nh=document.getElementById("power-score-only-toggle"),nv=document.getElementById("top-player-slider"),nf=document.getElementById("top-player-display"),nb=document.getElementById("frequent-opponent-slider"),nE=document.getElementById("frequent-opponent-display"),nL=document.getElementById("weak-player-slider"),nk=document.getElementById("weak-player-display"),nC=document.querySelector(".top-player-container"),nS=document.querySelector(".frequent-opponent-container"),nI=document.querySelector(".weak-player-container"),nw=document.getElementById("checklist-btn"),n$=document.getElementById("checklist-modal");document.getElementById("checklist-list");let nD=document.getElementById("checklist-close-btn"),nM=document.getElementById("checklist-content"),nB=document.getElementById("checklist-history-btn"),nT=document.getElementById("checklist-history-modal"),nx=document.getElementById("checklist-history-list-view"),nA=document.getElementById("checklist-history-detail-view"),nP=document.getElementById("checklist-history-list"),nN=document.getElementById("checklist-history-detail"),nO=document.getElementById("checklist-history-title"),nH=document.getElementById("checklist-detail-date"),nq=document.getElementById("checklist-history-back-btn"),nF=document.getElementById("checklist-history-close-btn"),nj=document.querySelector(".least-playtime-toggle-container"),n_=document.querySelector(".female-ratio-container"),nG=document.querySelector(".male-ratio-container");function nR(){window.innerWidth>900||(y.classList.add("header-hidden"),h.classList.add("header-hidden"),clearTimeout(p))}function nz(){window.innerWidth>900||(clearTimeout(p),p=setTimeout(nR,3e3))}function nW(){window.innerWidth>900||(y.classList.remove("header-hidden"),h.classList.remove("header-hidden"),nz())}let nU=!1,nV=0,nJ=!1;v&&v.addEventListener("click",nW),y&&(y.addEventListener("mouseenter",()=>{clearTimeout(p),y.classList.remove("header-hidden")}),y.addEventListener("mouseleave",nz)),h&&(h.addEventListener("mouseenter",()=>{clearTimeout(p),y.classList.remove("header-hidden")}),h.addEventListener("mouseleave",nz));let nK=document.getElementById("courtsSection");if(nK){let e,t,a=!1;nK.addEventListener("mousedown",n=>{a=!0,nK.style.cursor="grabbing",e=n.pageX-nK.offsetLeft,t=nK.scrollLeft}),nK.addEventListener("mouseleave",()=>{a=!1,nK.style.cursor="grab"}),nK.addEventListener("mouseup",()=>{a=!1,nK.style.cursor="grab"}),nK.addEventListener("mousemove",n=>{if(!a)return;n.preventDefault();let l=(n.pageX-nK.offsetLeft-e)*2;nK.scrollLeft=t-l}),nK.addEventListener("touchstart",n=>{a=!0,e=n.touches[0].pageX-nK.offsetLeft,t=nK.scrollLeft},{passive:!0}),nK.addEventListener("touchend",()=>{a=!1}),nK.addEventListener("touchmove",n=>{if(!a)return;let l=(n.touches[0].pageX-nK.offsetLeft-e)*2;nK.scrollLeft=t-l},{passive:!0})}function nY(e){if(window.innerWidth>900)return;document.querySelectorAll(".mobile-menu-btn").forEach(e=>{e.classList.remove("active")});let t=document.getElementById(e);t&&t.classList.add("active")}let nZ=document.getElementById("courtsSection");if(nZ){let e;setTimeout(nQ,200),nZ.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(nQ,150)})}function nQ(){let e=document.getElementById("courtsSection");if(!e)return;if(window.innerWidth>=900)return void e.querySelectorAll(".summary-card, .court-card").forEach(e=>e.classList.remove("is-active-card"));let t=e.getBoundingClientRect(),a=t.left+t.width/2,n=null,l=1/0,s=e.querySelectorAll(".summary-card, .court-card");s.forEach(e=>{let t=e.getBoundingClientRect(),s=Math.abs(a-(t.left+t.width/2));s<l&&(l=s,n=e)}),n&&(s.forEach(e=>e.classList.remove("is-active-card")),n.classList.add("is-active-card"))}function nX(){if(l.availablePlayers.length<2)return;let e=l.availablePlayers;if("None"!==l.onDuty){let t=e.findIndex(e=>!e.isPaused);if(-1!==t&&e[t].name===l.onDuty){let a=e.findIndex((e,a)=>a>t&&!e.isPaused&&e.name!==l.onDuty);-1!==a&&([e[t],e[a]]=[e[a],e[t]])}}let t=e.find(e=>!e.isPaused);if(!t)return;let a=e.indexOf(t);if(e.length-1-a>=7){let n=e.slice(a+1).filter(e=>!e.isPaused).slice(0,7);if(n.filter(e=>e.gender===t.gender).length<=1){let l=e.indexOf(n[n.length-1]),s=e.slice(l+1).findIndex(e=>e.gender===t.gender&&!e.isPaused);if(-1!==s){let[t]=e.splice(l+1+s,1),n=Math.min(a+1+7,e.length);e.splice(n,0,t)}}}}function n0(){let e=document.getElementById("court-grid"),t=e.querySelector(".court-card, .summary-card"),a=window.getComputedStyle(e).gridTemplateColumns.split(" ").length;if(!t||a<2){eG.style.height="auto";return}let n=e.offsetHeight;eG.style.height=`${n}px`}function n1(){let e=l.courts.flatMap(e=>e.players),t=Array.from(new Map([...l.clubMembers,...l.availablePlayers,...e].map(e=>[e.name,e])).values());return l.gameHistory.forEach(e=>{[...e.teams.team1,...e.teams.team2].forEach(e=>{t.some(t=>t.name===e)||t.push({name:e,gender:"?",guest:!0})})}),t}function n2(e){let a=l.availablePlayers.find(t=>t.name===e);if(a||(a=t.find(t=>t.name===e)))return a;for(let t of l.courts)if(a=t.players.find(t=>t.name===e))return a;return{name:e,gender:"?",guest:!0,isPaused:!1}}function n3(e){return e.map(e=>e.name)}function n5(){let e=l.availablePlayers.length;return l.courts.forEach(t=>{t.players&&(e+=t.players.length)}),e}function n8(){return l.availablePlayers.filter(e=>!e.isPaused).length}async function n4(){if(!l._isReceivingUpdate)try{await API.saveState(l),console.log("State saved to server")}catch(e){console.error("Failed to save state:",e)}}function n7(e,t){let a=document.getElementById("undo-toast"),n=document.getElementById("undo-toast-message"),l=document.getElementById("undo-toast-btn"),s=document.getElementById("undo-toast-timer");n6(),n.textContent=e,m=t,a.classList.remove("hidden"),s.style.transition="none",s.style.width="100%",setTimeout(()=>{s.style.transition="width 10s linear",s.style.width="0"},50),u=setTimeout(()=>{n6()},1e4),l.onclick=()=>{m&&"function"==typeof m&&(m(),n6())}}function n6(){let e=document.getElementById("undo-toast");u&&(clearTimeout(u),u=null),e.classList.add("hidden"),m=null}function n9(e,t,a){let n={type:e,data:t,timestamp:Date.now(),undo:a};l.undoHistory.actions.unshift(n),l.undoHistory.actions.length>l.undoHistory.maxHistory&&(l.undoHistory.actions=l.undoHistory.actions.slice(0,l.undoHistory.maxHistory)),n4()}function le(e,t,a){let n=e.teams.team1.findIndex(e=>e.name===t),l=e.teams.team2.findIndex(e=>e.name===t),s=e.players.find(e=>e.name===a);-1!==n?e.teams.team1[n]=s:-1!==l&&(e.teams.team2[l]=s)}function lt(e){let t=e.target.closest('.player-spot[draggable="true"]');if(t){if(!t.classList.contains("drag-enabled"))return void e.preventDefault();if(s={name:t.dataset.playerName,courtId:t.dataset.courtId,position:t.dataset.playerPos,team:t.dataset.team||null},t.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",s.name),e.dataTransfer.setDragImage){let a=t.cloneNode(!0);a.style.opacity="0.7",document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),setTimeout(()=>document.body.removeChild(a),0)}}}function la(e){let t=e.target.closest('.player-spot[draggable="true"]');if(t){if(document.querySelectorAll(".player-spot.drag-enabled").forEach(e=>{e.classList.remove("drag-enabled")}),i===t){i=null;return}t.classList.add("drag-enabled"),i=t,setTimeout(()=>{t.classList.contains("drag-enabled")&&(t.classList.remove("drag-enabled"),i===t&&(i=null))},1e4)}}function ln(e){let t=e.target.closest('.player-spot[draggable="true"]');t&&(t.classList.remove("dragging"),t.classList.remove("drag-enabled")),document.querySelectorAll(".drag-over, .drag-over-invalid").forEach(e=>{e.classList.remove("drag-over","drag-over-invalid")}),s=null,i=null}function ll(e){e.preventDefault();let t=e.target.closest('.player-spot[draggable="true"]'),a=e.target.closest("#availablePlayersList li");if(s){if(t&&t.dataset.playerName){let a=t.dataset.courtId;if(t.dataset.playerName===s.name){e.dataTransfer.dropEffect="none";return}if(a===s.courtId)t.classList.add("drag-over"),t.classList.remove("drag-over-invalid"),e.dataTransfer.dropEffect="move";else{let n=l.courts.find(e=>e.id===a),i=l.courts.find(e=>e.id===s.courtId);n?.status==="in_progress"&&i?.status==="in_progress"?(t.classList.add("drag-over"),t.classList.remove("drag-over-invalid"),e.dataTransfer.dropEffect="move"):(t.classList.add("drag-over-invalid"),t.classList.remove("drag-over"),e.dataTransfer.dropEffect="none")}}else if(a&&!a.classList.contains("waiting-message")){if(a.dataset.playerName,!s.courtId){a.classList.add("drag-over-invalid"),e.dataTransfer.dropEffect="none";return}let t=l.courts.find(e=>e.id===s.courtId);t?.status==="in_progress"?(a.classList.add("drag-over"),a.classList.remove("drag-over-invalid"),e.dataTransfer.dropEffect="move"):(a.classList.add("drag-over-invalid"),a.classList.remove("drag-over"),e.dataTransfer.dropEffect="none")}}}function ls(e){let t=e.target.closest('.player-spot[draggable="true"]'),a=e.target.closest("#availablePlayersList li");t&&t.classList.remove("drag-over","drag-over-invalid"),a&&a.classList.remove("drag-over","drag-over-invalid")}function li(e){if(e.preventDefault(),e.stopPropagation(),!s)return;let t=e.target.closest('.player-spot[draggable="true"]'),a=e.target.closest("#availablePlayersList li");if(document.querySelectorAll(".drag-over, .drag-over-invalid").forEach(e=>{e.classList.remove("drag-over","drag-over-invalid")}),t&&t.dataset.playerName){let e=t.dataset.courtId,a=t.dataset.playerName,n=e===s.courtId;if(a===s.name)return;if(n)!function(e,t,a){let n=l.courts.find(t=>t.id===e);if(!n)return;let s=JSON.parse(JSON.stringify(n.players)),i=JSON.parse(JSON.stringify(n.teams)),r=n.players.findIndex(e=>e.name===t),o=n.players.findIndex(e=>e.name===a);if(-1===r||-1===o)return;let d=n.players[r];if(n.players[r]=n.players[o],n.players[o]=d,n.teamsSet){let e=null,l=-1,s=null,i=-1;if(n.teams.team1.forEach((n,r)=>{n.name===t&&(e="team1",l=r),n.name===a&&(s="team1",i=r)}),n.teams.team2.forEach((n,r)=>{n.name===t&&(e="team2",l=r),n.name===a&&(s="team2",i=r)}),e&&s){let t=n.teams[e][l],a=n.teams[s][i];n.teams[e][l]=a,n.teams[s][i]=t}}let c=()=>{console.log("=== EXECUTING UNDO ==="),g=!0;let t=l.courts.find(t=>t.id===e);if(!t){console.error("Court not found for undo!"),g=!1;return}console.log("Before restore:",JSON.parse(JSON.stringify(t))),console.log("Restoring to:",s,i),t.players=JSON.parse(JSON.stringify(s)),t.teams=JSON.parse(JSON.stringify(i)),console.log("After restore:",JSON.parse(JSON.stringify(t))),l9(),n4(),setTimeout(()=>{g=!1,console.log("Undo complete - flag cleared")},500)};n9("team_reselection",{courtId:e,player1Name:t,player2Name:a},c),n7(`Swapped ${t.split(" ")[0]} \u{2194} ${a.split(" ")[0]} on Court ${e}`,c),l9(),n4()}(s.courtId,s.name,a);else{let t=l.courts.find(t=>t.id===e),n=l.courts.find(e=>e.id===s.courtId);t?.status==="in_progress"&&n?.status==="in_progress"&&function(e,t,a,n){let s=l.courts.find(t=>t.id===e),i=l.courts.find(e=>e.id===a);if(!s||!i)return;let r=JSON.parse(JSON.stringify(s.players)),o=JSON.parse(JSON.stringify(i.players)),d=JSON.parse(JSON.stringify(s.teams)),c=JSON.parse(JSON.stringify(i.teams)),m=s.players.findIndex(e=>e.name===t),u=i.players.findIndex(e=>e.name===n);if(-1===m||-1===u)return;let p=s.players[m];s.players[m]=i.players[u],i.players[u]=p,s.teamsSet&&le(s,t,n),i.teamsSet&&le(i,n,t);let y=()=>{console.log("=== EXECUTING UNDO - Court Swap ==="),g=!0;let t=l.courts.find(t=>t.id===e),n=l.courts.find(e=>e.id===a);if(!t||!n){console.error("Courts not found for undo!"),g=!1;return}console.log("Restoring source court:",e),console.log("Restoring target court:",a),t.players=JSON.parse(JSON.stringify(r)),n.players=JSON.parse(JSON.stringify(o)),t.teams=JSON.parse(JSON.stringify(d)),n.teams=JSON.parse(JSON.stringify(c)),l9(),n4(),setTimeout(()=>{g=!1,console.log("Undo complete - flag cleared")},500)};n9("court_swap",{sourceCourtId:e,sourcePlayerName:t,targetCourtId:a,targetPlayerName:n},y),n7(`Swapped ${t.split(" ")[0]} (Court ${e}) \u{2194} ${n.split(" ")[0]} (Court ${a})`,y),l9(),n4()}(s.courtId,s.name,e,a)}}else if(a&&!a.classList.contains("waiting-message")){let e=a.dataset.playerName,t=l.courts.find(e=>e.id===s.courtId);t?.status==="in_progress"&&function(e,t,a){let n=l.courts.find(t=>t.id===e);if(!n||"in_progress"!==n.status)return;let s=n.players.findIndex(e=>e.name===t),i=l.availablePlayers.find(e=>e.name===a),r=n.players[s];if(-1===s||!i)return;let o=JSON.parse(JSON.stringify(n.players)),d=JSON.parse(JSON.stringify(n.teams)),c=JSON.parse(JSON.stringify(l.availablePlayers));n.players[s]=i,n.teamsSet&&le(n,t,a),l.availablePlayers=l.availablePlayers.filter(e=>e.name!==a),l.availablePlayers.push(r);let m=()=>{console.log("=== EXECUTING UNDO - Substitution ==="),g=!0;let t=l.courts.find(t=>t.id===e);if(!t){console.error("Court not found for undo!"),g=!1;return}console.log("Restoring court:",e),t.players=JSON.parse(JSON.stringify(o)),t.teams=JSON.parse(JSON.stringify(d)),l.availablePlayers=JSON.parse(JSON.stringify(c)),l9(),n4(),setTimeout(()=>{g=!1,console.log("Undo complete - flag cleared")},500)};n9("substitution",{courtId:e,courtPlayerName:t,availablePlayerName:a},m),n7(`Substituted ${t.split(" ")[0]} \u{2192} ${a.split(" ")[0]} on Court ${e}`,m),l9(),n4()}(s.courtId,s.name,e)}s=null}function lr(e){switch(e.type){case"team_reselection":return`Team Reselection: ${e.data.player1Name.split(" ")[0]} \u{2194} ${e.data.player2Name.split(" ")[0]} (Court ${e.data.courtId})`;case"court_swap":return`Court Swap: ${e.data.sourcePlayerName.split(" ")[0]} (Court ${e.data.sourceCourtId}) \u{2194} ${e.data.targetPlayerName.split(" ")[0]} (Court ${e.data.targetCourtId})`;case"substitution":return`Substitution: ${e.data.courtPlayerName.split(" ")[0]} \u{2192} ${e.data.availablePlayerName.split(" ")[0]} (Court ${e.data.courtId})`;case"player_swap":return`Player Swap: ${e.data.sourcePlayer.name.split(" ")[0]} (Court ${e.data.sourceCourt}) \u{2194} ${e.data.targetPlayer.name.split(" ")[0]} (Court ${e.data.targetCourt})`;default:return"Unknown action"}}async function lo(e){try{let t=await API.loadState();if(t){t.customAnnouncementState&&(t.customAnnouncementState={...l.customAnnouncementState,...t.customAnnouncementState}),(l={...l,...t}).courts&&0!==l.courts.length||(console.log("Empty courts array detected, reinitializing courts..."),l.courts=[{id:"A",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"B",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"C",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"D",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"},{id:"E",status:"available",players:[],teams:{team1:[],team2:[]},autoStartTimer:null,gameMode:null,gameStartTime:null,autoStartTimeTarget:null,becameAvailableAt:Date.now(),isCollapsed:!1,isModeOverlayActive:!1,courtMode:"doubles"}]),"object"==typeof l.adminChecklist&&Array.isArray(l.adminChecklist.arrival)||(console.warn("Outdated adminChecklist structure found. Resetting to default."),l.adminChecklist={arrival:[{id:"arrUnlockTuckshop",text:"Unlock Tuckshop & Setup POS",checked:!1},{id:"arrUnlockCloakrooms",text:"Unlock Cloakrooms",checked:!1},{id:"arrMainTv",text:"Main TV: On & Sport Channel",checked:!1},{id:"arrTuckshopTv",text:"Tuckshop TV: On & Music Videos",checked:!1},{id:"arrAmpAux",text:"Amp: Aux Analog",checked:!1},{id:"arrAmpOptical",text:"Amp: Optical/Main TV",checked:!1},{id:"arrOpenCurtains",text:"Open Curtains & Sliding Door",checked:!1},{id:"arrPutCushions",text:"Put Out Bench Cushions",checked:!1},{id:"arrSignOutBalls",text:"Sign Out Social Balls (via Ball Mgmt)",checked:!1},{id:"arrEmptyDishwasher",text:"Empty Dishwasher & Check Dishes",checked:!1},{id:"arrCheckFridge",text:"Check Fridge for Expired Products",checked:!1},{id:"arrEmptyBins",text:"Empty Full Bins & Replace Liners",checked:!1},{id:"arrManStation",text:"Man Duty Station (Busy Times)",checked:!1},{id:"arrAssistApp",text:"Assist Members with App",checked:!1},{id:"arrRemindAccounts",text:"Remind Members re: Tuck Shop Accounts",checked:!1}],departure:[{id:"depReturnBalls",text:"Return Social Balls & Sign In (via Ball Mgmt)",checked:!1},{id:"depCheckOutApp",text:"Ensure All Players Checked Out on App",checked:!1},{id:"depLoadDishes",text:"Load/Wash Dishes",checked:!1},{id:"depReturnCushions",text:"Return Bench Cushions",checked:!1},{id:"depTurnOffTvAmp",text:"Turn Off TVs & Amp",checked:!1},{id:"depWipeBar",text:"Wipe Down Bar Counter",checked:!1},{id:"depEmptyIceBucket",text:"Empty & Wash Ice Bucket",checked:!1},{id:"depWipeKitchen",text:"Wipe Down Kitchen Counter",checked:!1},{id:"depTrashOut",text:"Take Inside Trash to Outside Bins",checked:!1},{id:"depLockBarStore",text:"Lock Bar & Storeroom",checked:!1},{id:"depCloseCurtains",text:"Close Sliding Door & Curtains",checked:!1},{id:"depLockClubhouseAlarm",text:"Lock Clubhouse & Set Alarm",checked:!1},{id:"depLockCloakrooms",text:"Lock Cloakrooms",checked:!1},{id:"depLockGates",text:"Check & Lock Pedestrian Gates",checked:!1}]}),l.uiSettings?(void 0===l.uiSettings.displaySizeMultiplier&&(l.uiSettings.displaySizeMultiplier=1),void 0===l.uiSettings.fontSizeMultiplier&&(l.uiSettings.fontSizeMultiplier=1)):l.uiSettings={fontSizeMultiplier:1,displaySizeMultiplier:1},l.courtSettings?(void 0===l.courtSettings.autoAssignModes&&(l.courtSettings.autoAssignModes=!0),void 0===l.courtSettings.showGameModeSelector&&(l.courtSettings.showGameModeSelector=!1),Array.isArray(l.courtSettings.visibleCourts)||(l.courtSettings.visibleCourts=["A","B","C","D","E"])):l.courtSettings={visibleCourts:["A","B","C","D","E"],autoAssignModes:!0,showGameModeSelector:!1},l.matchSettings?(void 0===l.matchSettings.autoMatchModes&&(l.matchSettings.autoMatchModes=!0),void 0===l.matchSettings.matchMode&&(l.matchSettings.matchMode="1set"),void 0===l.matchSettings.fastPlayGames&&(l.matchSettings.fastPlayGames=4)):l.matchSettings={matchMode:"1set",fastPlayGames:4,autoMatchModes:!0},l.juniorClub?(l.juniorClub.checkInFilter||(l.juniorClub.checkInFilter={displayMode:"parent"}),l.juniorClub.rosterFilter||(l.juniorClub.rosterFilter={sortKey:"name",sortOrder:"asc",type:"all"}),l.juniorClub.registrationFlow||(l.juniorClub.registrationFlow={parentCollapsed:!1,childrenExpanded:!1}),l.juniorClub.statsFilter?void 0===l.juniorClub.statsFilter.paid&&(l.juniorClub.statsFilter.paid="all"):l.juniorClub.statsFilter={parent:"all",paid:"all"}):l.juniorClub={parents:[],activeChildren:[],history:[],statsFilter:{parent:"all",paid:"all"},rosterFilter:{sortKey:"name",sortOrder:"asc",type:"all"},checkInFilter:{displayMode:"parent"},registrationFlow:{parentCollapsed:!1,childrenExpanded:!1}},l.gameHistory=l.gameHistory||[],l.reorderHistory=l.reorderHistory||[],l.guestHistory=l.guestHistory||[],l.statsFilter=l.statsFilter||{gender:"all",teamGender:"all",sortKey:"totalDurationMs",sortOrder:"desc"},void 0===l.statsFilter.teamGender&&(l.statsFilter.teamGender="all"),l.selectedAlertSound=l.selectedAlertSound||"Alert1.mp3",l.mobileControls||(l.mobileControls={isSummaryExpanded:!0,isPlayersExpanded:!0}),l.notificationControls?void 0===l.notificationControls.autoMinimize&&(l.notificationControls.autoMinimize=!0):l.notificationControls={isMuted:!1,isMinimized:!1,isTTSDisabled:!1,autoMinimize:!0},l.adminCourtManagement||(l.adminCourtManagement={mode:"card1_select_court",courtId:null,currentCourtPlayers:[],removedPlayers:[],addedPlayers:[]}),l.ballManagement?(void 0===l.ballManagement.usedStock&&(l.ballManagement.usedStock=0),l.ballManagement.historyFilter||(l.ballManagement.historyFilter="all"),l.ballManagement.tempSale?void 0===l.ballManagement.tempSale.purchaserType&&(l.ballManagement.tempSale.purchaserType=null):l.ballManagement.tempSale={stockType:null,memberSignOut:null,purchaserName:null,purchaserType:null}):l.ballManagement={stock:0,usedStock:0,history:[],historyFilter:"all",tempSale:{stockType:null,memberSignOut:null,purchaserName:null,purchaserType:null}},l.lightSettings&&"object"==typeof l.lightSettings||(l.lightSettings={shellyBaseUrl:"",shellyAuthKey:"",courts:{},general:{}}),void 0===l.lightSettings.shellyBaseUrl&&(l.lightSettings.shellyBaseUrl=""),void 0===l.lightSettings.shellyAuthKey&&(l.lightSettings.shellyAuthKey=""),l.lightSettings.courts&&"object"==typeof l.lightSettings.courts||(l.lightSettings.courts={}),l.lightSettings.general&&"object"==typeof l.lightSettings.general||(l.lightSettings.general={}),["A","B","C","D","E"].forEach(e=>{l.lightSettings.courts[e]?(l.lightSettings.courts[e].id=l.lightSettings.courts[e].id||e,l.lightSettings.courts[e].label=l.lightSettings.courts[e].label||`Court ${e} Lights`,l.lightSettings.courts[e].isManaged=void 0!==l.lightSettings.courts[e].isManaged&&l.lightSettings.courts[e].isManaged,l.lightSettings.courts[e].isActive=l.lightSettings.courts[e].isActive||!1,l.lightSettings.courts[e].shellyDeviceId=l.lightSettings.courts[e].shellyDeviceId||"",l.lightSettings.courts[e].shellyCloudId=l.lightSettings.courts[e].shellyCloudId||""):l.lightSettings.courts[e]={id:e,label:`Court ${e} Lights`,isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""}}),l.lightSettings.general.clubhouse||(l.lightSettings.general.clubhouse={id:"clubhouse",label:"Clubhouse Lights",isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""}),l.suggestionSettings?(void 0===l.suggestionSettings.topPlayerPercent&&(l.suggestionSettings.topPlayerPercent=35),void 0===l.suggestionSettings.frequentOpponentPercent&&(l.suggestionSettings.frequentOpponentPercent=35),void 0===l.suggestionSettings.weakPlayerPercent&&(l.suggestionSettings.weakPlayerPercent=35),void 0===l.suggestionSettings.weakPlayerThreshold&&(l.suggestionSettings.weakPlayerThreshold=-.1)):l.suggestionSettings={femaleRatioPercent:50,maleRatioPercent:70,prioritizeLeastPlaytime:!0,powerScoreOnly:!1,topPlayerPercent:35,frequentOpponentPercent:35,weakPlayerPercent:35,weakPlayerThreshold:-.1},l.checklistHistory=l.checklistHistory||[],l.selectedChecklistHistoryDate=l.selectedChecklistHistoryDate||null,l.undoHistory=l.undoHistory||{actions:[],maxHistory:10};let a=(e,t)=>Array.isArray(e)?e.map(e=>"string"==typeof e?t.find(t=>t.name===e)||{name:e,gender:"?",guest:!0,type:"Adult",isPaused:!1,onLeaderboard:!0}:(e.isPaused=e.isPaused||!1,e.onLeaderboard=void 0===e.onLeaderboard||e.onLeaderboard,e.type=e.type||"Adult",e)):[],n=new Set;Array.isArray(l.availablePlayers)&&l.availablePlayers.forEach(e=>n.add(e.name)),l.courts.forEach(e=>{Array.isArray(e.players)&&e.players.forEach(e=>n.add(e.name))}),l.clubMembers=e.filter(e=>!n.has(e.name)),l.clubMembers.sort((e,t)=>e.name.localeCompare(t.name)),l.availablePlayers=a(l.availablePlayers,e),l.courts.forEach(t=>{if("available"===t.status&&void 0===t.becameAvailableAt&&(t.becameAvailableAt=Date.now()),t.isCollapsed=void 0!==t.isCollapsed&&t.isCollapsed,t.isModeOverlayActive=void 0!==t.isModeOverlayActive&&t.isModeOverlayActive,t.courtMode=t.courtMode||"doubles",t.teamsSet=void 0===t.teamsSet?null:t.teamsSet,t.players=a(t.players,e),t.teams?(t.teams.team1=a(t.teams.team1,e),t.teams.team2=a(t.teams.team2,e)):t.teams={team1:[],team2:[]},"game_pending"===t.status&&t.autoStartTimeTarget){let e=t.autoStartTimeTarget-Date.now();e>0?(t.autoStartTimer&&clearTimeout(t.autoStartTimer),t.autoStartTimer=setTimeout(()=>sf(t.id),e)):sf(t.id)}else t.autoStartTimer&&(clearTimeout(t.autoStartTimer),t.autoStartTimer=null)}),console.log("State loaded from server successfully")}else console.log("No saved state found on server, using initial state."),l.lightSettings||(l.lightSettings={shellyBaseUrl:"",shellyAuthKey:"",courts:{},general:{}},["A","B","C","D","E"].forEach(e=>{l.lightSettings.courts[e]={id:e,label:`Court ${e} Lights`,isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""}}),l.lightSettings.general.clubhouse={id:"clubhouse",label:"Clubhouse Lights",isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""})}catch(e){console.error("Error loading state:",e),console.log("Using initial state due to error."),l.lightSettings||(l.lightSettings={shellyBaseUrl:"",shellyAuthKey:"",courts:{},general:{}},["A","B","C","D","E"].forEach(e=>{l.lightSettings.courts[e]={id:e,label:`Court ${e} Lights`,isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""}}),l.lightSettings.general.clubhouse={id:"clubhouse",label:"Clubhouse Lights",isManaged:!1,isActive:!1,shellyDeviceId:"",shellyCloudId:""})}}function ld(){!function(){let e=new Date,t=e.toLocaleDateString("en-ZA",{weekday:"long"}),a=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0"),i=e.getHours()>=12?"pm":"am",r=`${n}:${l}:${s} ${i}`;e_.textContent=`${t} ${a}, ${r}`}(),l.courts.forEach(e=>{let t=document.getElementById(`timer-${e.id}`);if(t)if("in_progress"===e.status&&e.gameStartTime){let a=Date.now()-e.gameStartTime,n=Math.floor(a/36e5),l=Math.floor(a%36e5/6e4);t.textContent=`${String(n).padStart(2,"0")}h${String(l).padStart(2,"0")}m`}else if("game_pending"===e.status&&e.autoStartTimeTarget){let a=e.autoStartTimeTarget-Date.now();if(a<0){t.textContent="00:00";return}let n=Math.floor(a/6e4),l=Math.floor(a%6e4/1e3);t.textContent=`${String(n).padStart(2,"0")}:${String(l).padStart(2,"0")}`}else t.textContent=""}),document.querySelectorAll(".player-pause-cooldown").forEach(e=>{let t=parseInt(e.dataset.pauseTime,10);if(t){let a=Math.max(0,6e5-(Date.now()-t));if(0===a)e.textContent="00m00s",e.classList.remove("player-pause-cooldown");else{let t=Math.floor(a/6e4),n=Math.floor(a%6e4/1e3);e.textContent=`${String(t).padStart(2,"0")}m${String(n).padStart(2,"0")}s`}}}),function(){if(!e)return;let t=n8()>=4,a=se();if(e.classList.remove("hidden"),!t){e.innerHTML=`<span class="timer-value">(${n8()}/4)</span><span class="timer-label">Waiting for players</span>`;return}if(!a){e.innerHTML='<span class="timer-value">Waiting</span><span class="timer-label">for courts...</span>';return}if(0===k){e.innerHTML='<span class="timer-value">Initializing</span><span class="timer-label">timer...</span>';return}let n=k-Date.now();if(n<=0){e.innerHTML='<span class="timer-value">Alert Due!</span><span class="timer-label">Next game ready</span>';return}let l=Math.floor(n/1e3),s=Math.floor(l/60);e.innerHTML=`<span class="timer-value">${String(s).padStart(2,"0")}:${String(l%60).padStart(2,"0")}</span><span class="timer-label">Next alert in</span>`}()}function lc(e,t="LetterPad",a=""){console.log("showGlobalKeyboard called for:",e.id,"Parent modal visible:",!document.getElementById("new-parent-modal").classList.contains("hidden")),t_=e,tG.currentPage=t,"date"===e.type||"time"===e.type?tH.value=e.dataset.partialValue||"":tH.value=a||t_.value,tH.scrollTop=tH.scrollHeight,tx.classList.add("hidden"),tb.classList.add("hidden"),tO.classList.remove("hidden"),lu(),tH.focus(),tH.selectionStart=tH.selectionEnd=tH.value.length}function lm(e){return"upper"===tG.case||"shift"===tG.case?e.toUpperCase():e.toLowerCase()}function lu(e=""){let t=tG.currentPage,a=tR[t];if(tq.innerHTML="",tq.classList.remove("emoji-grid"),"EmojiPage"===t?(tj.classList.add("active-page"),tj.classList.remove("hidden")):(tj.classList.remove("active-page"),tj.classList.add("hidden")),"EmojiPage"===t){tq.classList.add("emoji-grid"),function(e){tq.style.gridTemplateColumns="repeat(7, 1fr)";let t=tz.filter(t=>!e||t.toLowerCase().includes(e.toLowerCase())),a=document.createElement("div");a.className="keyboard-row row-nav",a.style.gridTemplateColumns="1.5fr 1fr 1fr 1.5fr";let n=document.createElement("button");n.className="global-keypad-btn key-special",n.textContent="ABC",n.dataset.key="ABC",n.addEventListener("click",lg),a.appendChild(n);let l=document.createElement("button");l.className="global-keypad-btn key-special",l.textContent="\uD83C\uDF10",l.dataset.key="GLOBE",a.appendChild(l);let s=document.createElement("button");s.className="global-keypad-btn key-special",s.textContent="\uD83C\uDF99️",s.dataset.key="MIC",a.appendChild(s);let i=document.createElement("button");i.className="global-keypad-btn key-special",i.textContent="!@#",i.dataset.key="!@#",i.addEventListener("click",lg),a.appendChild(i),tq.appendChild(a),t.forEach(e=>{let t=document.createElement("button");t.className="global-keypad-btn key-emoji",t.dataset.key=e,t.textContent=e,t.addEventListener("click",lg),tq.appendChild(t)})}(e);return}let n=tq.closest(".keyboard-content");n&&n.setAttribute("data-page",t),a.forEach((e,n)=>{let l=document.createElement("div");l.className=`keyboard-row row-${n}`,"NumberPad"!==t?"LetterPad"===t&&1===n?(l.style.gridTemplateColumns="repeat(9, 1fr)",l.style.width="90%",l.style.margin="0 auto"):"LetterPad"===t&&2===n?l.style.gridTemplateColumns="1.5fr repeat(7, 1fr) 1.5fr":n===a.length-1?l.style.gridTemplateColumns="1.5fr 1fr 5fr 1fr 1.5fr":l.style.gridTemplateColumns="repeat(10, 1fr)":n<3?(l.style.gridTemplateColumns="repeat(5, 1fr)",l.style.width="100%"):3===n&&(l.style.gridTemplateColumns="repeat(7, 1fr)",l.style.width="100%"),e.forEach(e=>{let a=document.createElement("button");a.className="global-keypad-btn",a.dataset.key=e;let n=lm(e);"NumberPad"===t&&("ENTER"===e?(n="⏎",a.classList.add("key-action")):"BACK"===e?(n="⌫",a.classList.add("key-action")):"DOT"===e?n=".":"PERCENT"===e?n="%":"COMMA"===e?n=",":["+","-","*","="].includes(e)?a.classList.add("key-special"):"SPACE"===e?(n="space",a.classList.add("key-special")):"?123"===e?(n="?123",a.classList.add("key-special")):"ABC"===e&&(n="ABC",a.classList.add("key-special"))),"SHIFT"===e?(n="upper"===tG.case||"shift"===tG.case?"⇧":"Caps",a.classList.add("key-special"),"upper"===tG.case&&a.classList.add("active")):"BACK"===e&&"NumberPad"!==t?(n="⌫",a.classList.add("key-action")):"ENTER"===e?(n="⏎",a.classList.add("key-action")):"SPACE"===e&&"NumberPad"!==t?n="space":"GLOBE"===e||"MIC"===e?(n="GLOBE"===e?"\uD83C\uDF10":"\uD83C\uDF99️",a.classList.add("key-special")):["?123","ABC","1234","!@#"].includes(e)&&"NumberPad"!==t&&(n=e,a.classList.add("key-special")),", / \uD83D\uDE00"===e&&(n="LetterPad"===t?", / \uD83D\uDE00":",",a.classList.remove("key-special")),a.textContent=n,a.addEventListener("click",lg),l.appendChild(a)}),tq.appendChild(l)})}function lg(e){e.preventDefault();let t=e.target.dataset.key,a=tH.value,n=t_&&"date"===t_.type,l=t_&&"time"===t_.type,s=n||l,i=tH.selectionStart,r=tH.selectionEnd;if(clearTimeout(tG.longPressTimer),"BACK"===t)s||(i===r&&i>0?(tH.value=a=a.substring(0,i-1)+a.substring(r),tH.selectionStart=tH.selectionEnd=i-1):i!==r&&(tH.value=a=a.substring(0,i)+a.substring(r),tH.selectionStart=tH.selectionEnd=i));else if("ENTER"===t||"RETURN_KEY"===t)s||(tH.value=a=a.substring(0,i)+"\n"+a.substring(r),tH.selectionStart=tH.selectionEnd=i+1);else if("SHIFT"===t){"lower"===tG.case?tG.case="shift":"shift"===tG.case?tG.case="upper":tG.case="lower",lu();return}else if("SPACE"===t)tH.value=a=a.substring(0,i)+" "+a.substring(r),tH.selectionStart=tH.selectionEnd=i+1;else if(", / \uD83D\uDE00"===t||"COMMA"===t){let e=("LetterPad"===tG.currentPage&&tG.case,",");tH.value=a=a.substring(0,i)+e+a.substring(r),tH.selectionStart=tH.selectionEnd=i+e.length}else if("GLOBE"===t||"MIC"===t)return;else if("DOT"===t||"."===t)tH.value=a=a.substring(0,i)+"."+a.substring(r),tH.selectionStart=tH.selectionEnd=i+1;else if(t>="0"&&t<="9")n||l||(tH.value=a=a.substring(0,i)+t+a.substring(r),tH.selectionStart=tH.selectionEnd=i+1);else{if(s)return;let e=lm(t);tH.value=a=a.substring(0,i)+e+a.substring(r),tH.selectionStart=tH.selectionEnd=i+e.length,"shift"===tG.case&&(tG.case="lower",lu())}!s&&t_&&(t_.value=tH.value,t_.dispatchEvent(new Event("input"))),tH.scrollTop=tH.scrollHeight,tH.focus()}function lp(){document.body.style.setProperty("--font-size-multiplier",l.uiSettings.fontSizeMultiplier)}function ly(){document.body.style.setProperty("--display-size-multiplier",l.uiSettings.displaySizeMultiplier)}function lh(e,t=!0){switch(e){case 0:return t?"☀️":"\uD83C\uDF19";case 1:return"\uD83C\uDF24️";case 2:return"⛅️";case 3:return"☁️";case 45:case 48:return"\uD83C\uDF2B️";case 51:case 53:case 55:return"\uD83C\uDF26️";case 56:case 57:case 66:case 67:return"\uD83E\uDD76";case 61:case 63:case 65:return"\uD83C\uDF27️";case 71:case 73:case 75:case 85:case 86:return"\uD83C\uDF28️";case 77:return"❄️";case 80:case 81:case 82:return"⛈️";case 95:case 96:case 99:return"\uD83C\uDF29️";default:return"\uD83E\uDD37"}}async function lv(){let e=document.getElementById("weather-display");if(e)try{let t=await fetch("https://api.open-meteo.com/v1/forecast?latitude=-25.8417&longitude=28.1593&daily=weathercode,temperature_2m_max,temperature_2m_min&hourly=weathercode,dewpoint_2m&timezone=auto");if(!t.ok){e.textContent="Weather unavailable";return}let a=await t.json(),n=new Date().getHours(),l=Math.round(a.daily.temperature_2m_max[0]),s=Math.round(a.daily.temperature_2m_min[0]),i=a.hourly.weathercode[9],r=a.hourly.weathercode[15],o=Math.round(a.hourly.dewpoint_2m[n]),d=lh(i),c=lh(r);e.innerHTML=`
                <div id="icon-fader">
                    <span class="weather-icon icon-max is-visible">${c}</span>
                    <span class="weather-icon icon-min">${d}</span>
                    <span class="weather-icon icon-dew">\uD83D\uDCA7</span>
                </div>
                <div id="temp-fader">
                    <span class="temp-max is-visible">${l}\xb0C</span>
                    <span class="temp-min">${s}\xb0C</span>
                    <span class="temp-dew">${o}\xb0C</span>
                </div>
            `;let m={icons:[e.querySelector(".icon-max"),e.querySelector(".icon-min"),e.querySelector(".icon-dew")],temps:[e.querySelector(".temp-max"),e.querySelector(".temp-min"),e.querySelector(".temp-dew")]},u=0;window.weatherAnimationInterval&&clearInterval(window.weatherAnimationInterval),window.weatherAnimationInterval=setInterval(()=>{let e=(u+1)%3;m.icons[u].classList.remove("is-visible"),m.temps[u].classList.remove("is-visible"),m.icons[e].classList.add("is-visible"),m.temps[e].classList.add("is-visible"),u=e},5e3)}catch(a){console.error("Failed to fetch weather:",a),e.innerHTML=`
                <div id="temp-fader">
                    <span class="temp-min is-visible">12\xb0C</span>
                    <span class="temp-max">25\xb0C</span>
                </div>`,window.weatherAnimationInterval&&clearInterval(window.weatherAnimationInterval);let t=!0;window.weatherAnimationInterval=setInterval(()=>{let a=e.querySelector(".temp-min"),n=e.querySelector(".temp-max");a&&n&&(a.classList.toggle("is-visible",!t),n.classList.toggle("is-visible",t),t=!t)},5e3)}}function lf(){let e=document.getElementById("light-management-btn");if(e){let t=function(){let e=l.lightSettings.courts;for(let t in e)if(e[t].isActive)return{class:"mdi-lightbulb-on",icon:"mdi mdi-lightbulb-on"};return{class:"mdi-lightbulb-outline",icon:"mdi mdi-lightbulb-outline"}}(),a=e.querySelector("i");a||(e.innerHTML=`<i class="${t.icon}"></i>`,a=e.querySelector("i")),a&&(a.classList.remove("mdi-lightbulb-on","mdi-lightbulb-outline"),a.classList.add(t.class))}}async function lb(e,t){let a=API_ENDPOINTS.controlLight,n=e.toggleAfter||0,s=l.lightSettings?.shellyBaseUrl||"",i=l.lightSettings?.shellyAuthKey||"",r=e.shellyCloudId||"",o=e.shellyDeviceId||"",d={shellyCloudUrl:s,authKey:i,deviceId:r,toggleAfter:n,shellyIp:o,state:t,method:"cloud-first"},c=!!(s&&s.trim()&&i&&i.trim()&&r&&r.trim()),m=!!(o&&o.trim());if(console.log(`[Frontend] Sending ${0===n?"toggle":"pulse"} command for ${e.label}:`,{method:d.method,state:t,toggleAfter:n,hasCloudConfig:c,hasLocalConfig:m}),!c&&!m)return console.error("[Frontend] ❌ No control method configured!"),{success:!1,message:"No control method configured. Check Admin > Gate/Light Settings."};try{let e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(15e3)});if(!e.ok){let t=`Server error: ${e.status}`;try{let a=await e.json();t=a.message||a.error||t,console.error("[Frontend] Server error details:",a)}catch(e){}throw console.error(`[Frontend] Error response from proxy: ${e.status}`),Error(t)}let t=await e.json();if(console.log("[Frontend] Response from proxy:",t),t.success)return t.method&&console.log(`[Frontend] \u{2705} Control via: ${t.method.toUpperCase()}`),{success:!0,data:t.data,method:t.method};return{success:!1,message:t.message||t.error||"Failed to control device."}}catch(e){if(console.error("[Frontend] Error calling proxy API:",e),"AbortError"===e.name)return{success:!1,message:"Request timed out."};if(e.message.includes("Failed to fetch"))return{success:!1,message:"Network error."};return{success:!1,message:e.message}}}async function lE(e){let t=l.gateSettings?.[e],a=document.getElementById(`${e}-gate-btn`);if(!t){console.error(`Gate settings for ${e} not found!`),sx("Gate not configured.");return}if(!t.isManaged)return void sx(`${t.label} control is disabled. Long-press to configure.`);console.log(`[Gate] Activating ${t.label}...`),a.disabled=!0,a.classList.add("pulsing");let n=await lb(t,!0);setTimeout(()=>{a.classList.remove("pulsing"),a.disabled=!1},1e3),n.success?(console.log(`[Gate] ${t.label} activated successfully via ${n.method}`),sx(`${t.label} activated.`)):(console.error(`[Gate] Failed to activate ${t.label}:`,n.message),sx(`Error: Failed to activate ${t.label}.`))}function lL(e){let t=document.getElementById(`${e}-gate-btn`);t&&(t.addEventListener("pointerdown",a=>{o=!1,r=setTimeout(()=>{o=!0,console.log(`[Gate] Long press detected on ${e}`),t.style.transform="scale(0.95)",function(e){let t=document.getElementById(`${e}-gate-settings-modal`),a=l.gateSettings?.[e]||{shellyCloudId:"",shellyDeviceId:"",isManaged:!1};document.getElementById(`${e}-gate-managed`).checked=a.isManaged,document.getElementById(`${e}-gate-cloud-id`).value=a.shellyCloudId||"",document.getElementById(`${e}-gate-local-ip`).value=a.shellyDeviceId||"",t.classList.remove("hidden")}(e)},800)}),t.addEventListener("pointerup",a=>{r&&clearTimeout(r),t.style.transform="",o||lE(e),o=!1}),t.addEventListener("pointerleave",e=>{r&&clearTimeout(r),t.style.transform="",o=!1}))}function lk(e){l.gateSettings||(l.gateSettings={pedestrian:{label:"Pedestrian Gate",toggleAfter:1},parking:{label:"Parking Lot Gate",toggleAfter:1}}),l.gateSettings[e]||(l.gateSettings[e]={label:"pedestrian"===e?"Pedestrian Gate":"Parking Lot Gate",toggleAfter:1}),l.gateSettings[e].isManaged=document.getElementById(`${e}-gate-managed`).checked,l.gateSettings[e].shellyCloudId=document.getElementById(`${e}-gate-cloud-id`).value.trim(),l.gateSettings[e].shellyDeviceId=document.getElementById(`${e}-gate-local-ip`).value.trim(),l.gateSettings[e].toggleAfter=1,l.gateSettings[e].isManaged||(l.gateSettings[e].shellyCloudId="",l.gateSettings[e].shellyDeviceId=""),console.log(`[Gate Settings] Saved ${e}:`,l.gateSettings[e]),n4(),document.getElementById(`${e}-gate-settings-modal`).classList.add("hidden"),sx(`${l.gateSettings[e].label} settings saved.`)}async function lC(e){let t=e.target.closest(".light-toggle-btn");if(!t)return;let a=t.dataset.courtId,n=l.lightSettings.courts[a];if(n){let e=!n.isActive;n.isActive=e;let a=t.querySelector("i");a.className=`mdi ${e?"mdi-lightbulb-on":"mdi-lightbulb-outline"}`;let l=await lb(n,e);l.success?sx(`${n.label} turned ${e?"on":"off"}.`):(n.isActive=!e,a.className=`mdi ${!e?"mdi-lightbulb-on":"mdi-lightbulb-outline"}`,sx(`Error: Failed to turn light ${e?"on":"off"}. ${l.message}`)),n4()}}function lS(){if(aD){aD.textContent=l.ballManagement.stock;let e=l.ballManagement.stock<1;aT.querySelectorAll(".sign-out-btn").forEach(t=>{t.disabled=e,t.style.opacity=e?.5:1})}}function lI(){aM&&(aM.textContent=l.ballManagement.usedStock)}function lw(e){l.ballManagement.historyFilter=e.target.value,n4(),lx()}function l$(e){return"cans"===e&&0===l.ballManagement.stock?void sx("Cannot sell cans. Stock is empty."):"singles"===e&&0===l.ballManagement.usedStock?void sx("Cannot sell old balls. Used stock is empty."):void(l.ballManagement.tempSale.stockType=e,aZ.classList.add("hidden"),lB("signout","Sale"))}function lD(e,t){let a=l.ballManagement.tempSale,n=a.memberSignOut;a.purchaserName=e,a.purchaserType=t,tw.classList.add("hidden"),document.getElementById("returning-guest-modal").classList.add("hidden"),a1.classList.add("hidden"),tb.dataset.member=n,tb.dataset.action="signout",tb.dataset.purchaserName=e,tb.dataset.category="Sale",il(null,{mode:"signOut",maxLength:2,title:`Quantity for ${e}`})}function lM(e){let t=e.target.closest(".sign-out-btn");if(!t||t.disabled)return;let a=t.dataset.category;if("Sale"===a){l.ballManagement.tempSale={stockType:null,memberSignOut:null,purchaserName:null,purchaserType:null},aw.classList.add("hidden"),aZ.classList.remove("hidden");return}lB("signout",a)}function lB(e,a=null){aA.innerHTML="";let n=document.getElementById("sign-out-member-abc-index"),l=t.filter(e=>e.committee).sort((e,t)=>e.name.localeCompare(t.name));if(0===l.length){aA.innerHTML='<li style="justify-content: center; color: var(--cancel-color);">No committee members found.</li>',n.innerHTML="";return}aP.disabled=!0,l.forEach(e=>{let t=document.createElement("li");t.className="committee-member",t.dataset.player=e.name,t.dataset.playerName=e.name,t.innerHTML=`<label><input type="radio" name="signoutMember" value="${e.name}"><div class="member-details"><span class="member-name">${e.name}</span><span class="member-designation">${e.committee||"Member"}</span></div></label>`,aA.appendChild(t)}),aA.querySelectorAll('input[name="signoutMember"]').forEach(e=>{e.removeEventListener("change",lT),e.addEventListener("change",lT)}),lN(l,aA,n),tW.classList.add("hidden"),aw.classList.add("hidden"),ax.classList.remove("hidden")}function lT(){aP.disabled=!1}function lx(){a5.innerHTML="";let e=l.ballManagement.historyFilter,t=`
            <div class="gender-selector" style="justify-content: center; margin-bottom: 1rem;">
                <div class="radio-group">
                    <label> <input type="radio" name="ball-history-filter" value="all" ${"all"===e?"checked":""}> All </label>
                    <label> <input type="radio" name="ball-history-filter" value="new" ${"new"===e?"checked":""}> New </label>
                    <label> <input type="radio" name="ball-history-filter" value="used" ${"used"===e?"checked":""}> Used </label>
                </div>
            </div>
        `,a=l.ballManagement.history.filter(t=>{if("all"===e)return!0;let a="singles"===t.stockType||"return_used"===t.category;return"used"===e?a:"new"!==e||!a});0===a.length?a5.innerHTML=t+'<p style="text-align: center; color: #6c757d;">No transactions match the selected filter.</p>':a5.innerHTML=t+`
                <div class="history-item" style="border-bottom: 2px solid var(--primary-blue); font-weight: bold; background-color: #f8f9fa; cursor: default;">
                    <div class="ball-history-details">
                        <span>Date & Time</span>
                        <span class="numeric">Before</span>
                        <span class="numeric">Change</span>
                        <span class="numeric">After</span>
                    </div>
                </div>
            `+[...a].reverse().map(e=>{let t=new Date(e.timestamp).toLocaleString("en-ZA"),a="in"===e.action?`+${e.count}`:`-${e.count}`,n="in"===e.action?"stock-in":"stock-out",l="singles"===e.stockType||"return_used"===e.category?"stock-used":"stock-new";return`
                    <div class="history-item" data-entry-id="${e.timestamp}">
                        <div class="ball-history-details">
                            <span class="timestamp">${t}</span>
                            <span class="numeric ${l}" data-label="Before">${e.stockBefore}</span>
                            <span class="numeric ${n}" data-label="Change">${a}</span>
                            <span class="numeric ${l}" data-label="After">${e.stockAfter}</span>
                        </div>
                    </div>
                `}).join(""),a5.querySelectorAll('input[name="ball-history-filter"]').forEach(e=>{e.addEventListener("change",lw)}),a5.removeEventListener("click",lA),a5.addEventListener("click",lA)}function lA(e){let t=e.target.closest(".history-item[data-entry-id]");if(t){let e=parseInt(t.dataset.entryId,10),a=l.ballManagement.history.find(t=>t.timestamp===e);a&&function(e){a_.textContent="singles"===e.stockType||"return_used"===e.category?"Used Balls (Singles)":"New Balls (Cans)";let t=e.category||"N/A";"purchase"===t?t="Stock Added":"return"===t?t="Stock Returned":"return_used"===t?t="Used Balls Returned":"ClubChamps"===t&&(t="Club Champs"),aG.textContent=t=t.charAt(0).toUpperCase()+t.slice(1),aR.textContent=new Date(e.timestamp).toLocaleString("en-ZA");let a="in"===e.action?`+${e.count}`:`-${e.count}`;az.textContent=a,az.style.color="in"===e.action?"var(--confirm-color)":"var(--cancel-color)",aJ.textContent=a,aJ.style.color="in"===e.action?"var(--confirm-color)":"var(--cancel-color)";let n=document.getElementById("detail-committee-label");n&&(n.textContent="in"===e.action?"Committee Member (Sign In)":"Committee Member (Sign Out)"),aW.textContent=e.member||"N/A";let l="N/A",s=["Social","League","ClubChamps"];"out"===e.action&&s.includes(e.category)?l=t:e.purchaserName&&(l=e.purchaserName),aU.textContent=l;let i=aU.closest(".stat-item");i&&(i.style.display="out"===e.action&&s.includes(e.category)||e.purchaserName?"flex":"none"),aV.textContent=e.stockBefore,aK.textContent=e.stockAfter,aF.classList.add("hidden"),aj.classList.remove("hidden")}(a)}}function lP(e,t){if(!e||!t)return;let a=e.getBoundingClientRect().top,n=Array.from(e.querySelectorAll("li[data-player-name]")),l="",s=n.find(e=>e.getBoundingClientRect().top>=a);s?l=s.dataset.playerName[0].toUpperCase():n.length>0&&(l=n[n.length-1].dataset.playerName[0].toUpperCase()),t.querySelectorAll("div").forEach(e=>{e.classList.toggle("active",e.textContent===l)});let i=t.querySelector("div.active");i&&i.scrollIntoView({behavior:"smooth",block:"nearest"})}function lN(e,t,a){let n=[...new Set(e.map(e=>e.name[0].toUpperCase()))].sort();a.innerHTML="";let l=()=>{lP(t,a)};t._scrollHandler&&t.removeEventListener("scroll",t._scrollHandler),t.addEventListener("scroll",l),t._scrollHandler=l,n.forEach(e=>{let n=document.createElement("div");n.textContent=e,n.addEventListener("click",()=>{t.removeEventListener("scroll",t._scrollHandler),a.querySelectorAll("div").forEach(e=>e.classList.remove("active")),n.classList.add("active");let l=t.querySelector(`[data-player-name^="${e}"], [data-player-name^="${e.toLowerCase()}"]`);l&&l.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{t.addEventListener("scroll",t._scrollHandler)},500)}),a.appendChild(n)}),t._scrollHandler&&t.removeEventListener("scroll",t._scrollHandler),t._scrollHandler=()=>lP(t,a),t.addEventListener("scroll",t._scrollHandler),setTimeout(()=>lP(t,a),50)}function lO(){let e=ss(l.gameHistory);return Date.now(),l.courts.forEach(t=>{if("in_progress"===t.status&&t.gameStartTime){let a=Date.now()-t.gameStartTime;t.players.forEach(t=>{let n=t.name;e[n]=e[n]||{played:0,won:0,totalDurationMs:0},e[n].totalDurationMs+=a})}}),e}function lH(e,t,a=!1){let n,l={};t.forEach(e=>{if([...e.teams.team1,...e.teams.team2].forEach(e=>{l[e]||(l[e]={played:0,won:0})}),"skipped"!==e.winner&&e.score){let t="team1"===e.winner?e.teams.team1:e.teams.team2,a="team1"===e.winner?e.teams.team2:e.teams.team1;t.forEach(e=>{l[e].played++,l[e].won++}),a.forEach(e=>{l[e].played++})}});let s={};for(let e in l)s[e]=l[e].played>0?l[e].won/l[e].played:0;let i=Object.values(s).reduce((e,t)=>e+t,0)/Object.values(s).length||.5,r=0,o=0,d=new Date;d.setDate(d.getDate()-30);let c=t.filter(t=>new Date(t.endTime)>d&&(t.teams.team1.includes(e.name)||t.teams.team2.includes(e.name)));c.forEach(t=>{if("skipped"===t.winner||!t.score)return;let a=t.teams.team1.includes(e.name),n=a?t.teams.team1:t.teams.team2,l=a?t.teams.team2:t.teams.team1,d=a&&"team1"===t.winner||!a&&"team2"===t.winner,c=n.reduce((e,t)=>e+(s[t]||i),0)/n.length,m=1/(1+Math.exp(-5*(c-l.reduce((e,t)=>e+(s[t]||i),0)/l.length)));r+=d?m<.5?(1-m)*2:(1-m)*.5:m>.5?-(2*m):-(.5*m),o++});let m=o>0?r/o:0,u=new Date().toISOString().split("T")[0],g=c.filter(e=>new Date(e.endTime).toISOString().split("T")[0]===u),p=0;g.forEach(t=>{(t.teams.team1.includes(e.name)&&"team1"===t.winner||t.teams.team2.includes(e.name)&&"team2"===t.winner)&&p++});let y=g.length>0?p/g.length-.5:0,h=t.length,v=1-(n=h>=20?.7:h>=15?.525:h>=10?.35:.175*(h>=5)),f=m*n+y*v;return(e.guest&&0===o&&(f=0),a)?{historicalScore:m,todayForm:y,finalScore:f}:f}function lq(){ns.innerHTML="";let e=l.courts.flatMap(e=>e.players),t=Array.from(new Map([...l.availablePlayers,...e].map(e=>[e.name,e])).values());if(0===t.length){ns.innerHTML='<p style="text-align: center; color: #6c757d;">No players are currently checked in.</p>';return}let a=t.map(e=>{let t=lH(e,l.gameHistory,!0);return{name:e.name,...t}}),{key:n,order:s}=l.powerScoreSort;a.sort((e,t)=>{let a=e[n],l=t[n];return"name"===n?"asc"===s?a.localeCompare(l):l.localeCompare(a):"asc"===s?a-l:l-a});let i=e=>l.powerScoreSort.key!==e?" ":"asc"===l.powerScoreSort.order?" \uD83D\uDD3C":" \uD83D\uDD3D";ns.innerHTML=`
            <div class="history-item" style="font-weight: bold; background-color: #f8f9fa;">
                <div class="power-score-grid-row">
                    <button class="sort-btn" data-sort-key="name">Player ${i("name")}</button>
                    <button class="sort-btn" data-sort-key="historicalScore">Historical ${i("historicalScore")}</button>
                    <button class="sort-btn" data-sort-key="todayForm">Today ${i("todayForm")}</button>
                    <button class="sort-btn" data-sort-key="finalScore">Score ${i("finalScore")}</button>
                </div>
            </div>
        `+a.map(e=>`
            <div class="history-item">
                <div class="power-score-grid-row">
                    <span>${e.name}</span>
                    <span>${e.historicalScore.toFixed(2)}</span>
                    <span>${e.todayForm.toFixed(2)}</span>
                    <span style="font-weight: bold;">${e.finalScore.toFixed(2)}</span>
                </div>
            </div>
        `).join(""),ns.querySelectorAll(".sort-btn").forEach(e=>{e.addEventListener("click",lG)})}function lF(e=l.adminChecklist,t=nM,a=!1){t.innerHTML="";let n=(e,t)=>e&&0!==e.length?e.map(e=>{let n=`check-${t}-${e.id}`;return`
                    <li class="checklist-item">
                        <label for="${n}">
                            <input type="checkbox" id="${n}" data-checklist-id="${e.id}" data-list-type="${t}" ${e.checked?"checked":""} ${a?"disabled":""}>
                            <span>${e.text}</span>
                        </label>
                    </li>
                `}).join(""):"",s=n(e.arrival,"arrival"),i=n(e.departure,"departure");s&&(t.innerHTML+=`<h2 class="checklist-section-header">On Arrival</h2><ul>${s}</ul>`),i&&(t.innerHTML+=`<h2 class="checklist-section-header">On Departure</h2><ul>${i}</ul>`),s||i||(t.innerHTML='<p style="text-align: center; color: var(--neutral-color); padding: 1rem;">No checklist items defined.</p>'),t.querySelectorAll("ul").forEach(e=>{e.style.listStyle="none",e.style.padding="0",e.style.margin="0"})}function lj(){let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),s=`${t}-${a}-${n}`,i=l.gameHistory.some(e=>new Date(e.endTime).toLocaleDateString("en-CA")===s),r="None"!==l.onDuty,o=l.checklistHistory.findIndex(e=>e.date===s);if(o>-1)try{l.checklistHistory[o].checklist=JSON.parse(JSON.stringify(l.adminChecklist)),n4()}catch(e){console.error("Error updating checklist history:",e)}else if(i&&r)try{let e=JSON.parse(JSON.stringify(l.adminChecklist));l.checklistHistory.push({date:s,checklist:e}),n4()}catch(e){console.error("Error creating checklist history:",e)}}function l_(e=!1){let t=new Date,a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),i=`${a}-${n}-${s}`,r=localStorage.getItem("checklistLastResetDate");(e||r!==i)&&(console.log(`Resetting checklist for new day: ${i}`),Object.keys(l.adminChecklist).forEach(e=>{Array.isArray(l.adminChecklist[e])&&l.adminChecklist[e].forEach(e=>{e.checked=!1})}),localStorage.setItem("checklistLastResetDate",i),n4())}function lG(e){let t=e.target.dataset.sortKey;t&&(l.powerScoreSort.key===t?l.powerScoreSort.order="asc"===l.powerScoreSort.order?"desc":"asc":(l.powerScoreSort.key=t,l.powerScoreSort.order="desc"),lq())}function lR(e,t,a,n,l=!1,s="mixed",i=null,r=null){let o=[],d=1/0,c=1/0,m=function e(t,a){if(a<0||a>t.length)return[];if(0===a)return[[]];if(a===t.length)return[t];if(1===a)return t.map(e=>[e]);let n=[];for(let l=0;l<t.length-a+1;l++){let s=t.slice(l,l+1),i=e(t.slice(l+1),a-1);for(let e=0;e<i.length;e++)n.push(s.concat(i[e]))}return n}(t,a);if(m.forEach(t=>{let a=[...e,...t];if(4!==a.length)return;let i=a.map(e=>e.name);if(l){let e=a.filter(e=>"M"===e.gender).length,l=a.filter(e=>"F"===e.gender).length;if(3===e&&1===l||1===e&&3===l)return;let s=n.filter(e=>i.includes(e.player.name));if(4!==s.length)return;let r=lz(s);if(!r)return;let d=Math.abs(r.team1.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0)-r.team2.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0));d<c&&(c=d,o=t)}else{let e=a.filter(e=>"M"===e.gender).length,l=a.filter(e=>"F"===e.gender).length;if(3===e&&1===l||1===e&&3===l)return;let r=!1;if("female"===s?4===l&&(r=!0):"male"===s?4===e&&(r=!0):2===e&&2===l?r=!0:"mixed"===s&&(4===e||4===l)&&(r=!0),r){let e=n.filter(e=>i.includes(e.player.name));if(4!==e.length)return;let a=lz(e);if(!a)return;let l=Math.abs(a.team1.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0)-a.team2.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0));l<d&&(d=l,o=t)}}}),0===o.length&&m.length>0){console.warn("Suggestion fallback: No combination met the primary goal, selecting most balanced valid foursome overall.");let t=1/0;m.forEach(a=>{let l=[...e,...a];if(4!==l.length)return;let s=l.filter(e=>"M"===e.gender).length,i=l.filter(e=>"F"===e.gender).length;if(3===s&&1===i||1===s&&3===i)return;let r=l.map(e=>e.name),d=n.filter(e=>r.includes(e.player.name));if(4!==d.length)return;let c=lz(d);if(!c)return;let m=Math.abs(c.team1.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0)-c.team2.reduce((e,t)=>e+n.find(e=>e.player.name===t.name).score,0));m<t&&(t=m,o=a)}),0===o.length&&console.error("Suggestion Error: Could not find any valid foursome combination in fallback.")}return o}function lz(e){let t=null,a=1/0;return[[[0,1],[2,3]],[[0,2],[1,3]],[[0,3],[1,2]]].forEach(n=>{let l=n[0].map(t=>e[t]),s=n[1].map(t=>e[t]),i=Math.abs(l.reduce((e,t)=>e+t.score,0)-s.reduce((e,t)=>e+t.score,0));i<a&&(a=i,t={team1:l.map(e=>e.player),team2:s.map(e=>e.player)})}),t}function lW(){delete l.activeSuggestion,l.selection.players=[],l9(),sh()}function lU(){let e=function(e){let t={};return e.forEach(e=>{if("skipped"===e.winner||!e.score||[...e.teams.team1,...e.teams.team2].map(e=>n2(e)).some(e=>!1===e.onLeaderboard))return;let[a,n]=e.duration.split("h").map(e=>e.replace("m","")),l=36e5*parseInt(a,10)+6e4*parseInt(n,10),s=(e,a)=>{if(2!==e.length)return;let n=[...e].sort().join(" & "),s=e.map(e=>n2(e)).map(e=>e.gender),i="Mixed";s.every(e=>"M"===e)&&(i="Men"),s.every(e=>"F"===e)&&(i="Women"),t[n]||(t[n]={players:e,type:i,played:0,won:0,totalDurationMs:0}),t[n].played+=1,t[n].totalDurationMs+=l,a&&(t[n].won+=1)},i="team1"===e.winner;s(e.teams.team1,i),s(e.teams.team2,!i)}),t}(l.gameHistory),t=document.getElementById("team-history-list");t.innerHTML="";let a=Object.values(e).filter(e=>"all"===l.statsFilter.teamGender||e.type.toLowerCase()===l.statsFilter.teamGender);if(l.comparison.active&&1===l.comparison.items.length){let e=l.comparison.items[0];a=a.filter(t=>{let a=[...t.players].sort().join(" & ");return a===e||l.comparison.opponents.has(a)})}a.sort((e,t)=>{let a=0;return a="name"===l.statsFilter.sortKey?e.players.join(",").localeCompare(t.players.join(",")):(t[l.statsFilter.sortKey]||0)-(e[l.statsFilter.sortKey]||0),"asc"===l.statsFilter.sortOrder?-a:a});let n=`
            <div class="gender-selector" style="justify-content: center; margin-bottom: 1rem;">
                <div class="radio-group">
                    <label> <input type="radio" name="team-gender-filter" value="all" ${"all"===l.statsFilter.teamGender?"checked":""}> All </label>
                    <label> <input type="radio" name="team-gender-filter" value="men" ${"men"===l.statsFilter.teamGender?"checked":""}> Men </label>
                    <label> <input type="radio" name="team-gender-filter" value="women" ${"women"===l.statsFilter.teamGender?"checked":""}> Women </label>
                    <label> <input type="radio" name="team-gender-filter" value="mixed" ${"mixed"===l.statsFilter.teamGender?"checked":""}> Mixed </label>
                </div>
            </div>`;if(0===a.length)t.innerHTML=n+'<p style="text-align: center; color: #6c757d;">No team stats available for the selected filter.</p>';else{let e=e=>l.statsFilter.sortKey!==e?" ":"asc"===l.statsFilter.sortOrder?" \uD83D\uDD3C":" \uD83D\uDD3D";t.innerHTML=n+`
                <div class="history-item" style="font-weight: bold; background-color: #f8f9fa;">
                    <div class="stats-grid-row">
                        <button class="sort-btn" data-sort-key="name" style="text-align: left; background: none; border: none; font-weight: bold; cursor: pointer;">Team${e("name")}</button>
                        <button class="sort-btn" data-sort-key="played" style="background: none; border: none; font-weight: bold; cursor: pointer;">Played${e("played")}</button>
                        <button class="sort-btn" data-sort-key="won" style="background: none; border: none; font-weight: bold; cursor: pointer;">Won %${e("won")}</button>
                        <button class="sort-btn" data-sort-key="totalDurationMs" style="background: none; border: none; font-weight: bold; cursor: pointer;">Time${e("totalDurationMs")}</button>
                    </div>
                </div>`+a.map(e=>{let t=si(e.played,e.won),a=e.players.map(e=>`<span>${e}</span>`).join(""),n=[...e.players].sort().join(" & "),s="";return l.comparison.items.includes(n)&&(s="selected-for-comparison"),`
                    <div class="history-item ${s}" data-name="${n}" data-type="team">
                        <div class="stats-grid-row">
                            <span class="team-name-stacked">${a}</span>
                            <span>${e.played}</span>
                            <span>${t}</span>
                            <span>${sl(e.totalDurationMs)}</span>
                        </div>
                    </div>`}).join("")}t.querySelectorAll('input[name="team-gender-filter"]').forEach(e=>e.addEventListener("change",lV)),t.querySelectorAll(".sort-btn").forEach(e=>e.addEventListener("click",sp)),l.comparison.active&&"team"===l.comparison.type&&t.querySelectorAll('.history-item[data-type="team"]').forEach(e=>{let t=e.dataset.name;l.comparison.items.includes(t)&&e.classList.add("selected-for-comparison")})}function lV(e){l.statsFilter.teamGender=e.target.value,n4(),lU()}function lJ(){l.comparison={active:!1,type:null,items:[],timeFrame:"Total",opponents:new Set},document.querySelectorAll(".selected-for-comparison").forEach(e=>e.classList.remove("selected-for-comparison")),document.querySelectorAll(".not-a-match").forEach(e=>e.classList.remove("not-a-match")),n4()}function lK(){l.statsFilter={gender:"all",teamGender:"all",sortKey:"totalDurationMs",sortOrder:"desc"},l.gameHistoryFilter={timeFrame:"Total",gameType:"all"},l.historySort={key:"endTime",order:"desc"},n4()}function lY(e,t){let a=new Date(e.endTime),n=new Date,l=a.getFullYear(),s=n.getFullYear();switch(t){case"Today":return a.toISOString().split("T")[0]===n.toISOString().split("T")[0];case"Month":return l===s&&a.getMonth()===n.getMonth();case"Year":return l===s;default:return!0}}function lZ(e){l.gameHistoryFilter.timeFrame=e.target.value,n4(),sd()}function lQ(e){l.gameHistoryFilter.gameType=e.target.value,n4(),sd()}function lX(e){let t=e.target.dataset.sortKey;t&&(l.historySort.key===t?l.historySort.order="asc"===l.historySort.order?"desc":"asc":(l.historySort.key=t,l.historySort.order="desc"),sd(),n4())}function l0(){let e=new Date().toISOString().split("T")[0],t=ss(l.gameHistory.filter(t=>new Date(t.endTime).toISOString().split("T")[0]===e)),a=n1(),n={name:null,wp:-1,duration:-1},s={name:null,wp:-1,duration:-1};for(let e in t){let l=t[e],i=a.find(t=>t.name===e);if(!i||0===l.played||!1===i.onLeaderboard||!i.gender)continue;let r=l.won/l.played;"M"===i.gender?r>n.wp?n={name:e,wp:r,duration:l.totalDurationMs}:r===n.wp&&l.totalDurationMs>n.duration&&(n={name:e,wp:r,duration:l.totalDurationMs}):"F"===i.gender&&(r>s.wp?s={name:e,wp:r,duration:l.totalDurationMs}:r===s.wp&&l.totalDurationMs>s.duration&&(s={name:e,wp:r,duration:l.totalDurationMs}))}return{kingOfTheCourt:n.name,queenOfTheCourt:s.name}}function l1(){let e=n8(),t=l.selection.gameMode,a=!1;e<4?t="singles":e>=4&&(t="doubles"),t!==l.selection.gameMode&&(l.selection.gameMode=t,a=!0);let n="doubles"===t?4:2;(a||l.selection.players.length>n)&&(l.selection.players=[],l.selection.courtId=null)}function l2(e){let t=0;return l.juniorClub.history.forEach(a=>{a.childNames&&a.childNames.includes(e)&&a.id>t&&(t=a.id)}),t}function l2(e){let t=0;return l.juniorClub.history.forEach(a=>{a.childNames&&a.childNames.includes(e.trim())&&a.id>t&&(t=a.id)}),t}function l3(e,t,a,n,s,i,r,o,d=!1,c=8,m=-1,u=!1,g=!1){let p,y,h,v=document.createElement("li"),f=e.name;p=e.guest?e.type?`${e.type} Guest`:"Guest":e.committee?`Committee ${e.committee}`:e.type?`${e.type} Member`:"Member";let b="",E="player-status";f===l.onDuty&&(b="Low Priority",E="player-priority");let L="",k=f===i.kingOfTheCourt,C=f===i.queenOfTheCourt,S=f===o,I=r[f]||0,w=[p];(k||C)&&(L+='<span style="color: gold; margin-left: 5px;">\uD83D\uDC51</span>',w.push(k?"King of the Court":"Queen of the Court")),I>=3&&(L+=`<span title="${I} wins in a row!" style="margin-left: 5px;">\u{1F3B2}</span>`,w.push("On a roll!")),S&&(L+=`<span title="Heartbreaker!" style="margin-left: 5px;">\u{1F494}</span>`,w.push("So Close!")),w.length>1?(y=`<div class="player-status-fader"><span class="status-text is-visible ${E}">${b||p}</span>`,w.slice(1).forEach(e=>{y+=`<span class="status-text">${e}</span>`}),y+="</div>"):y=`<span class="${E}">${b||p}</span>`;let $=e.isPaused;if($&&e.pauseTime){let t=Math.max(0,6e5-(Date.now()-e.pauseTime)),a=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),l=`${String(a).padStart(2,"0")}m${String(n).padStart(2,"0")}s`;h=`<span class="player-playtime player-pause-cooldown" data-pause-time="${e.pauseTime}">${l}</span>`}else{let e=s[f]?sl(s[f].totalDurationMs):"00h00m";h=`<span class="player-playtime">${e}</span>`}let D='<div class="suggestion-icon-wrapper"></div>';if(u&&n8()>=5&&(D=`<div class="suggestion-icon-wrapper"><button class="suggestion-btn" title="Suggest a balanced game">\u{1F4A1}</button></div>`),v.innerHTML=`
            <div class="player-details">
                <div class="player-name-container">
                    <span class="player-name">${f}</span>
                    ${L}
                </div>
                ${y}
            </div>
            <div class="player-stats">
                ${D}
                <button class="pause-toggle-btn" data-player-name="${f}" data-action="${$?"resume":"pause"}" title="${$?"Resume Game Play":"Pause Game Play"}">
                    <i class="mdi ${$?"mdi-play":"mdi-pause"}"></i>
                </button>
                <div class="gender-container gender-${e.gender}">
                    <span class="player-gender">${e.gender}</span>
                </div>
                ${h}
            </div>
        `,v.dataset.playerName=f,l.activeSuggestion){let{team1:e,team2:t}=l.activeSuggestion;e.some(e=>e.name===f)?v.classList.add("suggested-partner"):t.some(e=>e.name===f)&&v.classList.add("suggested-opponent")}if(e.isPaused&&v.classList.add("paused-player"),a.includes(f))v.classList.add("selected");else{let n=a.length>=4,l=!1;t>=c&&(l=!0),e.isPaused&&(l=!0),t===m&&(l=!1),(n||l)&&v.classList.add("disabled")}return u&&v.classList.add("first-player"),u||t!==l.availablePlayers.findIndex(e=>!e.isPaused)||v.classList.add("first-player"),v}function l5(e){l.onDuty=e.target.value,n4(),nX(),l9()}function l8(e){let t=Number(l.customAnnouncementState.ttsIntervalMins)||30;"increase"===e?t+=15:"decrease"===e&&(t-=15),l.customAnnouncementState.ttsIntervalMins=Math.max(15,t),document.getElementById("tts-interval-display").textContent=`${l.customAnnouncementState.ttsIntervalMins} min`}function l4(){aL.innerHTML="";let e=Number(l.customAnnouncementState.ttsIntervalMins)||30;document.getElementById("tts-interval-display").textContent=`${e} min`;let t=(e={text:"",tts:!1},t,a=!1)=>{let n=document.createElement("li"),l=`tts-${Date.now()}-${Math.random()}`;n.innerHTML=`
                <input type="text" value="${e.text}" placeholder="Enter announcement text...">
                <label for="${l}" class="tts-checkbox-label">
                    <input type="checkbox" id="${l}" ${e.tts?"checked":""}> TTS
                </label>
                ${a?'<span class="add-announcement-btn" title="Add another message">+</span>':""}
                <span class="action-icon remove" data-index="${t}" title="Remove message">&times;</span>
            `,aL.appendChild(n)};0===l.announcements.length?t(void 0,0,!0):l.announcements.forEach((e,a)=>{t(e,a,a===l.announcements.length-1)}),tW.classList.add("hidden"),aE.classList.remove("hidden")}function l7(){window.headerAnimationInterval&&clearTimeout(window.headerAnimationInterval);let e=document.getElementById("announcement-container");e&&(e.innerHTML="");let t=document.getElementById("header-clock");if(t&&(t.style.opacity=1),!t||!e||0===l.announcements.length)return;let a=0,n=()=>{let s=l.announcements[a];if(!s){t.style.opacity=1,window.headerAnimationInterval=setTimeout(n,1e4);return}t.style.opacity=0,setTimeout(()=>{let i=document.createElement("h1");i.className="scrolling-announcement",i.innerHTML=`
                    <span class="scrolling-ball"><span>\u{1F94E}</span></span>
                    <span class="scrolling-flame">\u{1F525}</span>
                    ${s.text}

                `,e.appendChild(i);let r=e.offsetWidth;requestAnimationFrame(()=>{requestAnimationFrame(()=>{let e=i.offsetWidth;i.querySelectorAll(".scrolling-ball > span").forEach(e=>{e.style.animationDuration="1s"}),i.style.transform=`translateX(${r}px)`,i.classList.add("is-visible"),i.getBoundingClientRect(),i.style.transition=`transform ${(r+e)/100}s linear`,i.style.transform=`translateX(-${e}px)`,i.addEventListener("transitionend",()=>{i.remove(),t.style.opacity=1,a=(a+1)%l.announcements.length,window.headerAnimationInterval=setTimeout(n,1e4)},{once:!0})})})},500)};window.headerAnimationInterval=setTimeout(n,1e3)}function l6(){let e=6e4*l.customAnnouncementState.ttsIntervalMins;l.customAnnouncementState.scheduler&&clearInterval(l.customAnnouncementState.scheduler);let t=l.announcements.filter(e=>e.tts);if(0===t.length)return;let a=k>0?k-Date.now():e;l.customAnnouncementState.nextAnnouncementTime=Date.now()+a/2,l.customAnnouncementState.scheduler=setInterval(()=>{let a=Date.now();if(!l.courts.some(e=>"game_pending"===e.status)&&!l.customAnnouncementState.isPaused&&a>=l.customAnnouncementState.nextAnnouncementTime){let n=t[l.customAnnouncementState.currentIndex];n&&sx(n.text),l.customAnnouncementState.currentIndex=(l.customAnnouncementState.currentIndex+1)%t.length;let s=0===l.customAnnouncementState.currentIndex?e:3e5;l.customAnnouncementState.nextAnnouncementTime=a+s}},5e3)}function l9(){iS();let t=document.getElementById("game-mode-container"),a=document.getElementById("availablePlayersSection");if(t&&a){let e=l.courtSettings.showGameModeSelector;t.style.display=e?"block":"none",a.classList.toggle("mode-selector-hidden",!e)}let{gameMode:s,players:i,courtId:r}=l.selection,o="doubles"===s?4:2,m=lO(),u=l0(),g=function(){let e={},t={};[...l.gameHistory].sort((e,t)=>e.endTime-t.endTime).forEach(a=>{if("skipped"===a.winner)return void[...a.teams.team1,...a.teams.team2].forEach(e=>{t[e]="loss"});let n="team1"===a.winner?a.teams.team1:a.teams.team2,l="team1"===a.winner?a.teams.team2:a.teams.team1;n.forEach(a=>{"win"===t[a]?e[a]=(e[a]||1)+1:e[a]=1,t[a]="win"}),l.forEach(a=>{e[a]=0,t[a]="loss"})});let a={};for(let t in e)e[t]>0&&(a[t]=e[t]);return a}(),p=function(){let e={},t=new Date().toISOString().split("T")[0];l.gameHistory.filter(e=>new Date(e.endTime).toISOString().split("T")[0]===t&&"skipped"!==e.winner&&e.score).forEach(t=>{let a=Math.max(t.score.team1,t.score.team2),n=Math.min(t.score.team1,t.score.team2);7===a&&(5===n||6===n)&&(t.score.team1<t.score.team2?t.teams.team1:t.teams.team2).forEach(t=>{e[t]=(e[t]||0)+1})});let a=null,n=0;for(let t in e)e[t]>n&&(n=e[t],a=t);return n>0?a:null}();iC(),sj(),eR.innerHTML="";let y=0,h=l.availablePlayers[0];if(h&&h.isPaused){let e=l.availablePlayers.findIndex(e=>!e.isPaused);-1!==e?(y=e,h=l.availablePlayers[e]):h=null}let v=l.availablePlayers;if(0===v.length&&0===i.length){let e=document.createElement("li");e.className="waiting-message",e.textContent=n5()>0?"All players are on court.":"Waiting For Players To Check In...",eR.appendChild(e)}else{let e=!1,t=-1,a=v.length;if(h&&v.length-y-1>=7){let n=h.gender,l=v.slice(y+1).filter(e=>!e.isPaused).slice(0,7);if(l.length>0){let s=l.filter(e=>e.gender===n).length,i=l[l.length-1],r=v.findIndex(e=>e.name===i.name);if(0===s){e=!0,a=r;let l=v.slice(r).findIndex(e=>e.gender===n&&!e.isPaused);-1!==l?t=r+l:(e=!1,a=r+1)}else e=!1,t=-1,a=r+1}}if(v.length>0){if(v.slice(0,y).forEach((n,l)=>{let s=l3(n,l,i,o,m,u,g,p,e,a,t,!1,!1);eR.appendChild(s)}),h){let n=l3(h,y,i,o,m,u,g,p,e,a,t,!0,!1);eR.appendChild(n)}let n=v.slice(y+1,a);if(n.length>0){let l=document.createElement("div");l.className="next-players-group",n.forEach((n,s)=>{let r=l3(n,y+1+s,i,o,m,u,g,p,e,a,t,!1,!0);l.appendChild(r)}),eR.appendChild(l)}v.slice(a).forEach((n,l)=>{let s=a+l,r=l3(n,s,i,o,m,u,g,p,e,a,t,!1,!1);if(s===t){let e=document.createElement("div");e.className="next-players-group",e.appendChild(r),eR.appendChild(e)}else eR.appendChild(r)})}}if(v.length>0&&v.length<4){let e=document.createElement("li");e.textContent="Waiting For More Players...",e.className="waiting-message",eR.appendChild(e)}let f=document.querySelector("#players-toggle-btn i");if(f){let e=l.mobileControls.isPlayersExpanded;f.className=`mdi ${e?"mdi-chevron-up":"mdi-chevron-down"}`}eG.classList.toggle("is-collapsed",!l.mobileControls.isPlayersExpanded),ez.innerHTML="",ez.insertAdjacentHTML("afterbegin",function(){let e=n5(),t=n8(),a=l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)&&"available"===e.status).length,n=l.courtSettings.visibleCourts.length,s="None"===l.onDuty?"Nobody":l.onDuty,i="None"===l.onDuty?"Call Any Committee Member!":"Is On Duty. Call Me!",{kingOfTheCourt:r,queenOfTheCourt:o}=l0(),d="";d="1set"===l.matchSettings.matchMode?"1 Set Game Mode":"3set"===l.matchSettings.matchMode?"3 Set Game Mode":`Fast Play ${l.matchSettings.fastPlayGames} Game Mode`;let c=l.courts.filter(e=>"available"===e.status&&l.courtSettings.visibleCourts.includes(e.id)),m=c.filter(e=>"doubles"===e.courtMode).length,u=c.filter(e=>"singles"===e.courtMode).length,g=c.filter(e=>"rookie"===e.courtMode).length,p=l.mobileControls.isSummaryExpanded;return`
            <div class="summary-card ${p?"":"is-collapsed"}" data-card-type="summary">
                <div class="card-header">
                    <h3>Information</h3>
                    <div class="header-controls">
                        <button class="settings-btn summary-toggle-btn" data-card-type="summary" title="Toggle Details">
                            <i class="mdi ${p?"mdi-chevron-up":"mdi-chevron-down"}"></i>
                        </button>
                        <button class="settings-btn" id="notify-now-btn" title="Force Notification Now">\u{1F4E2}</button>
                        <button class="settings-btn" id="settings-btn" title="Admin Settings">\u{2699}\u{FE0F}</button>
                    </div>
                </div>
                <div class="card-body summary-body">
                    <div class="on-duty-section">
                        <div class="duty-info-container">
                            <button id="call-duty-btn" class="duty-image-placeholder" title="Call On-Duty Member">
                                <i class="mdi mdi-phone duty-icon"></i>
                                <span class="duty-text">PRESS</span>
                            </button>
                            <div class="duty-info">
                                <p class="duty-name">${s}</p>
                                <p class="duty-label">${i}</p>
                            </div>
                        </div>
                        <span id="alert-status-display"></span>
                    </div>

                    <div class="summary-match-mode">
                        <p>
                            <span class="match-mode-label">Match Mode:</span>
                            <span class="match-mode-value">${d}</span>
                        </p>
                    </div>

                    <div class="summary-stats">
                        <div class="summary-stats-grid">
                            <div class="stats-column">
                                <div><span>Players:</span> <strong>${e}</strong></div>
                                <div><span>Queueing:</span> <strong class="available-value">${t}</strong></div>
                                <div><span>On Court:</span> <strong class="on-court-value">${e-t}</strong></div>
                            </div>
                            <div class="stats-column">
                                <div><span>Courts:</span> <strong>${a} / ${n}</strong></div>
                                <div><span>Availability:</span> <strong>D:${m} S:${u} R:${g}</strong></div>
                            </div>
                        </div>
                    </div>

                    <div class="summary-extra-stats">
                        <div>
                            <span class="stat-label">King of the Court!</span>
                            <strong class="stat-value">\u{1F451} ${r||"N/A"}</strong>
                        </div>
                        <div>
                            <span class="stat-label">Queen of the Court!</span>
                            <strong class="stat-value">\u{1F451} ${o||"N/A"}</strong>
                        </div>
                    </div>

                    <div class="quote-section">
                        <p id="quote-text" class="quote-text"></p>
                    </div>
                </div>
            </div>
        `}()),e=document.getElementById("alert-status-display"),l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)).forEach(e=>{let t=function(e){let t,a="doubles"===l.selection.gameMode?4:2,s=l.selection.players.length,i=s===a,r=e.isCollapsed,o=!0===e.isModeOverlayActive,d=e.courtMode||"doubles",c=!1,m=!1;"available"===e.status&&s>=2&&("league"===d&&i||"singles"===d&&4===s?c=!0:2===a&&("doubles"===d||"league"===d||"rookie"===d)&&(c=!0),!c&&i&&(2===a?"singles"===d&&(m=!0):4===a&&("doubles"===d||"rookie"===d)&&(m=!0)));let u=m||c,g=s>=2&&u,p=c&&!m?"is-reserved-only":"",y=e.id===l.selection.courtId,h=!1,v="rookie"===d;y?t="SELECTED":"available"===e.status&&"league"===d?(t="League",h=!0):t="available"===e.status&&v?"Rookie":e.status.replace(/_/g," ");let f=document.createElement("div"),b="";"available"===e.status&&(h?b="is-league-reserved":v&&(b="is-rookie-mode")),f.className=`court-card status-${e.status} ${y?"selected":""} ${g?"selectable":""} ${r?"is-collapsed":""} ${p} ${b}`,f.dataset.courtId=e.id,o&&(f.dataset.modeOverlayActive="true");let E="",L="";"available"===e.status||y||(E='<button class="cancel-game-btn on-court" title="Cancel Game" data-action="cancel-game-setup">X</button>'),"in_progress"===e.status?L='<button class="edit-game-btn on-court" title="Manage Players" data-action="edit-game"><i class="mdi mdi-pencil"></i></button>':"game_pending"===e.status&&!1===e.teamsSet&&(L='<button class="edit-game-btn on-court" title="Set Teams" data-action="choose-teams"><i class="mdi mdi-account-group-outline"></i></button>');let k=`
            <button class="more-options-btn on-court" title="More Options" data-action="more-options" data-court-id="${e.id}">
                <i class="mdi mdi-dots-horizontal"></i>
            </button>
        `,C=`
            <div class="mode-selection-overlay" data-court-id="${e.id}">
                <button class="mode-btn-overlay doubles-mode" data-action="set-court-mode" data-mode="doubles">Doubles</button>
                <button class="mode-btn-overlay singles-mode" data-action="set-court-mode" data-mode="singles">Singles</button>
                <button class="mode-btn-overlay beginner-mode" data-action="set-court-mode" data-mode="rookie">Rookie</button>
                <button class="mode-btn-overlay league-mode" data-action="set-court-mode" data-mode="league">League</button>
            </div>
        `,S=n.indexOf(e.id),I=4e3;"rookie"===d&&(I=8e3);let w=(Date.now()-l.pongAnimationOffset+(S>=0?500*S:0))%I,$=`animation-delay: -${(w/1e3).toFixed(3)}s;`,D=`
            <div class="pong-animation-container" data-mode="singles">
                <div class="pong-paddle top-paddle" style="animation-name: pong-top-move; ${$}"></div>
                <div class="pong-paddle bottom-paddle" style="animation-name: pong-bottom-move; ${$}"></div>
                <div class="pong-ball" style="${$}"></div>
            </div>
        `,M=`
            <div class="pong-animation-container" data-mode="doubles">
                <div class="pong-paddle double dl top-paddle" style="animation-name: pong-move-tl; ${$}"></div>
                <div class="pong-paddle double dr top-paddle" style="animation-name: pong-move-tr; ${$}"></div>
                <div class="pong-paddle double dl bottom-paddle" style="animation-name: pong-move-bl; ${$}"></div>
                <div class="pong-paddle double dr bottom-paddle" style="animation-name: pong-move-br; ${$}"></div>
                <div class="pong-ball" style="${$}"></div>
            </div>
        `,B=`
            <div class="pong-animation-container" data-mode="in_progress">
                <div class="pong-ball red-ball-in-progress" style="${$}"></div>
            </div>
        `,T="";("in_progress"===e.status||"game_pending"===e.status)&&(T=`<div class="court-body-timer status-${e.status}" id="timer-${e.id}"></div>`);let x=e=>e?e.name.split(" ")[0]:"",A="",P="",N="";if(("in_progress"===e.status||"game_pending"===e.status)&&e.matchMode){let t="";"fast"===e.matchMode?t=`Fast Play (${e.fastPlayGames} games)`:"1set"===e.matchMode?t="1 Set Match":"3set"===e.matchMode&&(t="3 Set Match"),t&&(N=`<div class="match-mode-display">${t}</div>`)}let O="in_progress"===e.status||"game_pending"===e.status,H=O?'draggable="true"':"",q=O?"draggable-player":"";"available"!==e.status&&(A="singles"===e.gameMode?`
                    <div class="player-spot single-player top-row" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team1[0]?.name||""}" data-player-pos="top">
                        <span class="${q}">${x(e.teams.team1[0])}</span>
                    </div>
                    <div class="player-spot single-player bottom-row" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team2[0]?.name||""}" data-player-pos="bottom">
                        <span class="${q}">${x(e.teams.team2[0])}</span>
                    </div>
                `:!1===e.teamsSet?`
                        <div class="player-spot top-row" data-player-pos="top-left" ${H} data-court-id="${e.id}" data-player-name="${e.players[0]?.name||""}" data-team="unset">
                            <span class="${q}">${x(e.players[0])}</span>
                        </div>
                        <div class="player-spot top-row" data-player-pos="top-right" ${H} data-court-id="${e.id}" data-player-name="${e.players[1]?.name||""}" data-team="unset">
                            <span class="${q}">${x(e.players[1])}</span>
                        </div>
                        <div class="player-spot bottom-row" data-player-pos="bottom-left" ${H} data-court-id="${e.id}" data-player-name="${e.players[2]?.name||""}" data-team="unset">
                            <span class="${q}">${x(e.players[2])}</span>
                        </div>
                        <div class="player-spot bottom-row" data-player-pos="bottom-right" ${H} data-court-id="${e.id}" data-player-name="${e.players[3]?.name||""}" data-team="unset">
                            <span class="${q}">${x(e.players[3])}</span>
                        </div>
                    `:`
                        <div class="player-spot top-row" data-player-pos="top-left" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team1[0]?.name||""}" data-team="team1">
                            <span class="${q}">${x(e.teams.team1[0])}</span>
                        </div>
                        <div class="player-spot top-row" data-player-pos="top-right" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team1[1]?.name||""}" data-team="team1">
                            <span class="${q}">${x(e.teams.team1[1])}</span>
                        </div>
                        <div class="player-spot bottom-row" data-player-pos="bottom-left" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team2[0]?.name||""}" data-team="team2">
                            <span class="${q}">${x(e.teams.team2[0])}</span>
                        </div>
                        <div class="player-spot bottom-row" data-player-pos="bottom-right" ${H} data-court-id="${e.id}" data-player-name="${e.teams.team2[1]?.name||""}" data-team="team2">
                            <span class="${q}">${x(e.teams.team2[1])}</span>
                        </div>
                    `,"in_progress"===e.status&&(P=B));let F="";if(y)F=`
                <div class="confirmation-overlay">
                    <button class="court-confirm-btn cancel" data-action="cancel-selection">Cancel</button>
                    <button class="court-confirm-btn confirm ${i?"is-ready":""}" data-action="confirm-selection">Confirm</button>
                </div>
            `;else if(g){let t=c?"reserved-ball":"",a=m?"":'data-reserved-only="true"',n=c||h?"disabled":"",l=c||h?"":`SELECT<br>COURT ${e.id}`;F=`
                <div class="court-selection-overlay">
                    <button class="court-confirm-btn select-court ${t}" data-action="select-court-action" ${a} ${n}>${l}</button>
                </div>
            `}else if("selecting_teams"===e.status)F=`
                <div class="team-selection-overlay">
                    <button class="court-confirm-btn randomize" data-action="randomize-teams">Randomize Teams</button>
                    <button class="court-confirm-btn choose" data-action="choose-teams">Choose Teams</button>
                    <button class="court-confirm-btn choose-later" data-action="choose-later">Choose Later</button>
                </div>
            `;else if("game_pending"===e.status)F=`
                <div class="game-action-overlay">
                    <button class="court-confirm-btn select-court" data-action="start-game">START MATCH</button>
                </div>
            `;else if("in_progress"===e.status){let t=e.isNewGame?"animate-in":"visible";F=`
                <div class="game-action-overlay">
                    <button class="court-confirm-btn end-game-ball ${t}" data-action="end-game">END<br>MATCH</button>
                </div>
            `}let j="";"available"===e.status&&(j="",A="league"===d?'<div class="league-reserved-icon-container"></div>':"singles"===d?D:"doubles"===d||"rookie"===d?M:"");let _=l.lightSettings.courts[e.id],G=_&&_.isManaged,R=G&&_.isActive?"mdi-lightbulb-on":"mdi-lightbulb-outline",z=`
            <button class="light-toggle-btn on-court" title="Toggle Lights" data-action="toggle-light" data-court-id="${e.id}" ${G?"":"disabled"}>
                <i class="mdi ${R}"></i>
            </button>
        `;return f.innerHTML=`
            <div class="card-header header-status-${e.status}">
                <h3>Court ${e.id}</h3>
                <div class="header-controls">
                    <span class="status-tag">${t}</span>
                    <button class="settings-btn summary-toggle-btn" data-court-id="${e.id}" data-card-type="court" title="Toggle Details">
                        <i class="mdi ${r?"mdi-chevron-down":"mdi-chevron-up"}"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="court-inner">
                    ${T}
                    <div class="center-service-line"></div>
                    ${A}
                    ${P}
                    ${F}
                    ${j}
                    ${N}
                    ${C}
                </div>
                ${E}
                ${L}
                ${k}
                ${z}
            </div>`,f}(e);ez.appendChild(t)}),document.querySelectorAll(".light-toggle-btn").forEach(e=>{let t=e.dataset.courtId;e.addEventListener("pointerdown",a=>{c=!1,d=setTimeout(()=>{c=!0,console.log(`[Light] Long press detected on Court ${t}`),e.style.transform="scale(0.9)",function(e){let t=document.getElementById("light-settings-court-modal"),a=l.lightSettings?.courts?.[e];if(!a){console.error(`No light settings for court ${e}`),sx("Court light settings not found.");return}document.getElementById("light-settings-court-title").textContent=`Court ${e} Light Settings`,t.dataset.editingCourtId=e,document.getElementById("light-setting-base-url").value=l.lightSettings.shellyBaseUrl||"",document.getElementById("light-setting-auth-key").value=l.lightSettings.shellyAuthKey||"",document.getElementById("light-setting-label").value=a.label||`Court ${e} Lights`,document.getElementById("light-setting-cloud-id").value=a.shellyCloudId||"",document.getElementById("light-setting-local-ip").value=a.shellyDeviceId||"",document.getElementById("light-setting-managed").checked=a.isManaged||!1,t.classList.remove("hidden"),ic(document.getElementById("light-setting-base-url")),ic(document.getElementById("light-setting-auth-key")),ic(document.getElementById("light-setting-label")),ic(document.getElementById("light-setting-cloud-id")),ic(document.getElementById("light-setting-local-ip"))}(t)},800)}),e.addEventListener("pointerup",t=>{d&&clearTimeout(d),e.style.transform="",c&&(t.stopPropagation(),t.preventDefault()),c=!1}),e.addEventListener("pointerleave",t=>{d&&clearTimeout(d),e.style.transform="",c=!1})}),document.querySelectorAll('.player-spot[draggable="true"]').forEach(e=>{e.addEventListener("dragstart",lt),e.addEventListener("dragend",ln),e.addEventListener("dragover",ll),e.addEventListener("dragleave",ls),e.addEventListener("drop",li),e.addEventListener("dblclick",la)});let b=document.getElementById("availablePlayersList");b&&(b.removeEventListener("dragover",ll),b.removeEventListener("dragleave",ls),b.removeEventListener("drop",li),b.addEventListener("dragover",ll),b.addEventListener("dragleave",ls),b.addEventListener("drop",li));let E=l.courts.find(e=>"selecting_teams"===e.status||"game_pending"===e.status),L=h?h.name:null,k=o-i.length,C=l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)).every(e=>"available"!==e.status);eW.classList.remove("blue-theme","green-theme","yellow-theme","red-theme","hidden"),E?(eW.classList.remove("hidden"),eW.classList.add("yellow-theme"),eU.textContent=`Court ${E.id}: Choose how to form teams on the court card.`):0===v.length&&n5()>0?(eW.classList.remove("hidden"),eW.classList.add("blue-theme"),eU.textContent="All Players are on Court..."):0===i.length&&2>n5()?(eW.classList.remove("hidden"),eW.classList.add("red-theme"),eU.textContent="Waiting For Players To Check In..."):0===i.length&&C?(eW.classList.remove("hidden"),eW.classList.add("red-theme"),eU.textContent="Please wait for a court to become available."):0===i.length&&L?(eW.classList.remove("hidden"),eW.classList.add("green-theme"),eU.textContent=`${L.split(" ")[0]}, please select players for a game.`):i.length>0&&i.length<o?(eW.classList.remove("hidden"),eW.classList.add("green-theme"),eU.textContent=`Please select ${k} more player(s).`):i.length!==o||r?i.length===o&&r?(eW.classList.remove("hidden"),eW.classList.add("yellow-theme"),eU.textContent=`Court ${r} selected. Confirm on the court card below.`):eW.classList.add("hidden"):(eW.classList.remove("hidden"),eW.classList.add("green-theme"),eU.textContent="Please select an available court."),eV.classList.toggle("active","doubles"===s),eJ.classList.toggle("active","singles"===s),eV.disabled=v.length<4,eG.classList.toggle("locked",!!E||0===i.length&&C),ld(),function(){let e=document.getElementById("settings-btn");e&&(e.removeEventListener("click",sq),e.addEventListener("click",sq));let t=document.getElementById("notify-now-btn");t&&(t.removeEventListener("click",s_),t.addEventListener("click",s_));let a=document.getElementById("call-duty-btn");a&&(a.removeEventListener("click",ib),a.addEventListener("click",ib));let n=document.getElementById("quote-text");n&&"true"!==n.dataset.initialized&&(n.textContent=`"${l.tennisQuotes[l.currentQuoteIndex]}"`,window.quoteInterval||(window.quoteInterval=setInterval(()=>{n.classList.add("fading"),setTimeout(()=>{l.currentQuoteIndex=(l.currentQuoteIndex+1)%l.tennisQuotes.length;let e=document.getElementById("quote-text");e&&(e.textContent=`"${l.tennisQuotes[l.currentQuoteIndex]}"`,e.classList.remove("fading"))},1e3)},12e3)),n.dataset.initialized="true")}(),setTimeout(n0,0),requestAnimationFrame(nQ)}function se(){for(let e of n){let t=l.courts.find(t=>t.id===e);if(t&&l.courtSettings.visibleCourts.includes(e)&&"available"===t.status)return e}return null}function st(e){let t=e.target.value;l.matchSettings.matchMode=t,n4();let a=document.querySelector(".fast-play-games-selector");a&&(a.style.display="fast"===t?"":"none"),l9()}function sa(e){l.matchSettings.fastPlayGames=parseInt(e.target.value,10),n4(),l9()}function sn(e,t,a){let n=l.courts.find(e=>e.id===t);if(n.queueSnapshot=JSON.parse(JSON.stringify(l.availablePlayers)),l.activeSuggestion)n.players=[...l.activeSuggestion.team1,...l.activeSuggestion.team2],n.teams.team1=l.activeSuggestion.team1,n.teams.team2=l.activeSuggestion.team2,n.teamsSet=!0,n.gameMode="doubles",l.availablePlayers=l.availablePlayers.filter(e=>!n.players.some(t=>t.name===e.name)),lW();else{let t=e.map(e=>n2(e));n.players=[...t],n.gameMode=a,"doubles"===a?(n.status="selecting_teams",n.teams.team1=[],n.teams.team2=[]):(n.teams.team1=[t[0]],n.teams.team2=[t[1]]),l.availablePlayers=l.availablePlayers.filter(t=>!e.includes(t.name))}n.status="selecting_teams"===n.status?"selecting_teams":"game_pending","game_pending"===n.status&&(n.autoStartTimeTarget=Date.now()+6e4,n.autoStartTimer=setTimeout(()=>sf(t),6e4)),l.currentSuggestionOutcome=null,l.currentSuggestionType=null,l.selection={gameMode:l.selection.gameMode,players:[],courtId:null},l1(),iE(),l9(),n4()}function sl(e){if(0===e)return"00h00m";let t=Math.floor(e/6e4),a=Math.floor(t/60);return`${String(a).padStart(2,"0")}h${String(t%60).padStart(2,"0")}m`}function ss(e){let t={};return e.forEach(e=>{if([...e.teams.team1,...e.teams.team2].map(e=>n2(e)).some(e=>!1===e.onLeaderboard))return;let a=[...e.teams.team1,...e.teams.team2],[n,l]=e.duration.split("h").map(e=>e.replace("m","")),s=36e5*parseInt(n,10)+6e4*parseInt(l,10);if(a.forEach(e=>{t[e]=t[e]||{played:0,won:0,totalDurationMs:0},t[e].totalDurationMs+=s}),"skipped"!==e.winner){let n="team1"===e.winner?e.teams.team1:e.teams.team2;if(e.score){let l="team1"===e.winner?e.teams.team2:e.teams.team1,s=e.score.team1>e.score.team2?e.score.team1:e.score.team2,i=e.score.team1>e.score.team2?e.score.team2:e.score.team1;a.forEach(e=>{n.includes(e)?(t[e].played+=s+i,t[e].won+=s):l.includes(e)&&(t[e].played+=s+i,t[e].won+=i)})}else a.forEach(e=>{t[e].played+=1,n.includes(e)&&(t[e].won+=1)})}}),t}function si(e,t){return 0===e?"N/A":`${Math.round(t/e*100)}%`}function sr(){let e=document.getElementById("history-list"),t=document.getElementById("team-history-list"),a=document.querySelector("#history-page h3"),n=document.getElementById("history-toggle-view"),s=document.getElementById("history-toggle-teams-btn");e.style.display="none",t.style.display="none",nY("mobile-history-btn"),"stats"===l.historyViewMode?(a.textContent="Player Stats",n.textContent="Game History",s.textContent="Team Stats",e.style.display="",so()):"teams"===l.historyViewMode?(a.textContent="Team Stats",n.textContent="Player Stats",s.textContent="Game History",t.style.display="",l.statsFilter.teamGender="all",lU()):(a.textContent="Game History",n.textContent="Player Stats",s.textContent="Team Stats",e.style.display="",sd())}function so(){let e=ss(l.gameHistory),t=n1(),a=document.getElementById("history-list");a.innerHTML="";let n=Object.keys(e).filter(e=>{let a=t.find(t=>t.name===e);return!!a&&!1!==a.onLeaderboard&&("all"===l.statsFilter.gender||a.gender===l.statsFilter.gender)});if(l.comparison.active&&1===l.comparison.items.length){let e=l.comparison.items[0];n=n.filter(t=>t===e||l.comparison.opponents.has(t))}n.sort((t,a)=>{let n=e[t],s=e[a],i=0;return i="name"===l.statsFilter.sortKey?t.localeCompare(a):(s[l.statsFilter.sortKey]||0)-(n[l.statsFilter.sortKey]||0),"asc"===l.statsFilter.sortOrder?-i:i});let s=`
            <div class="gender-selector" style="justify-content: center; margin-bottom: 1rem;">
                <div class="radio-group">
                    <label> <input type="radio" name="stats-gender-filter" value="all" ${"all"===l.statsFilter.gender?"checked":""}> All </label>
                    <label> <input type="radio" name="stats-gender-filter" value="M" ${"M"===l.statsFilter.gender?"checked":""}> Men </label>
                    <label> <input type="radio" name="stats-gender-filter" value="F" ${"F"===l.statsFilter.gender?"checked":""}> Women </label>
                </div>
            </div>`;if(0===n.length)a.innerHTML=s+'<p style="text-align: center; color: #6c757d;">No stats available for the selected filter.</p>';else{let t=e=>l.statsFilter.sortKey!==e?" ":"asc"===l.statsFilter.sortOrder?" \uD83D\uDD3C":" \uD83D\uDD3D";a.innerHTML=s+`
                <div class="history-item" style="font-weight: bold; background-color: #f8f9fa;">
                    <div class="stats-grid-row">
                        <button class="sort-btn" data-sort-key="name" style="text-align: left; background: none; border: none; font-weight: bold; cursor: pointer;">Player${t("name")}</button>
                        <button class="sort-btn" data-sort-key="played" style="background: none; border: none; font-weight: bold; cursor: pointer;">Played${t("played")}</button>
                        <button class="sort-btn" data-sort-key="won" style="background: none; border: none; font-weight: bold; cursor: pointer;">Won %${t("won")}</button>
                        <button class="sort-btn" data-sort-key="totalDurationMs" style="background: none; border: none; font-weight: bold; cursor: pointer;">Time${t("totalDurationMs")}</button>
                    </div>
                </div>`+n.map(t=>{let a=e[t],n=si(a.played,a.won),s="";return l.comparison.items.includes(t)&&(s="selected-for-comparison"),`
                    <div class="history-item ${s}" data-name="${t}" data-type="player">
                        <div class="stats-grid-row">
                            <span>${t}</span>
                            <span>${a.played}</span>
                            <span>${n}</span>
                            <span>${sl(a.totalDurationMs)}</span>
                        </div>
                    </div>`}).join("")}a.querySelectorAll('input[name="stats-gender-filter"]').forEach(e=>e.addEventListener("change",sg)),a.querySelectorAll(".sort-btn").forEach(e=>e.addEventListener("click",sp))}function sd(){let e=document.getElementById("history-list");if(e.innerHTML="",0===l.gameHistory.length){e.innerHTML=sc()+'<p style="text-align: center; color: #6c757d;">No games have been completed yet.</p>',sm();return}let t=[...l.gameHistory.filter(e=>lY(e,l.gameHistoryFilter.timeFrame)).filter(e=>"all"===l.gameHistoryFilter.gameType||e.teams.team1.length===("doubles"===l.gameHistoryFilter.gameType?2:1))].sort((e,t)=>{let a,n,{key:s,order:i}=l.historySort;"score"===s?(a=e.score?Math.max(e.score.team1,e.score.team2):0,n=t.score?Math.max(t.score.team1,t.score.team2):0):"court"===s?(a=e.court||"",n=t.court||""):(a=e.endTime||0,n=t.endTime||0);let r=i||("score"===s||"endTime"===s?"desc":"asc");return a<n?"asc"===r?-1:1:a>n?"asc"===r?1:-1:0}),a=e=>l.historySort.key!==e?" ":"asc"===l.historySort.order?" \uD83D\uDD3C":" \uD83D\uDD3D",n=`
            <div class="history-item" style="font-weight: bold; background-color: #f8f9fa;">
                <div class="game-history-grid">
                    <button class="sort-btn game-time-cell" data-sort-key="endTime">Time${a("endTime")}</button>
                    <button class="sort-btn game-duration-cell" data-sort-key="court">Game Info${a("court")}</button>
                    <div class="teams-header game-teams-cell">Teams</div>
                    <button class="sort-btn game-score-cell" data-sort-key="score">Score${a("score")}</button>
                </div>
            </div>
        `,s=t.map(e=>{let t,a=new Date(e.endTime),n=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hourCycle:"h23"}),l=a.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"}),s="skipped"===e.winner,i=s?"":"team1"===e.winner?"winner":"loser",r=s?"":"team1"===e.winner?"loser":"winner",o=e.teams.team1.map(e=>`<p class="${i}">${e}</p>`).join(""),d=e.teams.team2.map(e=>`<p class="${r}">${e}</p>`).join("");if(s)t="<p>Skipped</p>";else if(e.score){let a="team1"===e.winner?e.score.team1:e.score.team2,n="team1"===e.winner?e.score.team2:e.score.team1;if(t=`<p><span class="winner">${a}</span> - <span class="loser">${n}</span></p>`,null!==e.score.tiebreak1&&null!==e.score.tiebreak2){let a="team1"===e.winner?e.score.tiebreak1:e.score.tiebreak2,n="team1"===e.winner?e.score.tiebreak2:e.score.tiebreak1,l=`(<span class="winner">${a}</span> - <span class="loser">${n}</span>)`;t+=`<p style="font-size: 0.9em; color: var(--neutral-color);">${l}</p>`}}else t="N/A";let c="Manual"===e.court?`${2===e.teams.team1.length?"Doubles":"Singles"}`:`Court ${e.court}`;return`
                <div class="history-item" data-game-id="${e.id}"> 
                    <div class="game-history-grid">
                        <div class="game-time-cell" style="display: flex; flex-direction: column; line-height: 1.2;">
                            <span>${n}</span>
                            <span style="font-size: 0.9em; color: var(--neutral-color);">${l}</span>
                        </div>
                        <div class="game-duration-cell" style="display: flex; flex-direction: column; line-height: 1.2;">
                            <span>${c}</span>
                            <span style="font-size: 0.9em; color: var(--neutral-color);">${e.duration}</span>
                        </div>
                        <div class="game-teams-cell">
                            ${o}
                            ${d}
                        </div>
                        <div class="game-score-cell">
                            ${t}
                        </div>
                    </div>
                </div>
            `}).join("");e.innerHTML=sc()+n+s,e.querySelectorAll(".sort-btn").forEach(e=>{e.addEventListener("click",lX)}),sm()}function sc(){let{timeFrame:e,gameType:t}=l.gameHistoryFilter;return`
            <div class="game-history-filter-container">
                <div class="gender-selector" style="justify-content: center;">
                    <div class="radio-group">
                        <label> <input type="radio" name="game-time-filter" value="Today" ${"Today"===e?"checked":""}> Today </label>
                        <label> <input type="radio" name="game-time-filter" value="Month" ${"Month"===e?"checked":""}> Month </label>
                        <label> <input type="radio" name="game-time-filter" value="Year" ${"Year"===e?"checked":""}> Year </label>
                        <label> <input type="radio" name="game-time-filter" value="Total" ${"Total"===e?"checked":""}> Total </label>
                    </div>
                </div>
            </div>
        `}function sm(){document.querySelectorAll('input[name="game-time-filter"]').forEach(e=>{e.removeEventListener("change",lZ),e.addEventListener("change",lZ)}),document.querySelectorAll('input[name="game-type-filter"]').forEach(e=>{e.removeEventListener("change",lQ),e.addEventListener("change",lQ)})}function su(){if(t1.innerHTML="",0===l.reorderHistory.length){t1.innerHTML='<p style="text-align: center; color: #6c757d; padding: 2rem;">No queue reorder actions have been logged.</p>';return}[...l.reorderHistory].reverse().forEach(e=>{let t=new Date(e.endTime).toLocaleString(),a="";for(let[t,n]of Object.entries(e.players))n.startPosition!==n.currentPosition&&(a+=`
                        <p style="margin: 0.25rem 0; font-size: 0.95rem; display: flex; justify-content: space-between;">
                            <span style="font-weight: 500;">${t}</span>
                            <span style="color: var(--primary-blue);">Moved from #${n.startPosition+1} to #${n.currentPosition+1}</span>
                        </p>
                    `);if(a){let n=document.createElement("div");n.className="history-item",n.style.textAlign="left",n.innerHTML=`
                    <div class="history-details" style="margin-bottom: 0.75rem;">
                        <span style="color: var(--primary-blue);">${e.adminAction} (${t})</span>
                    </div>
                    <div style="padding-left: 1rem;">
                        ${a}
                    </div>
                `,t1.appendChild(n)}})}function sg(e){l.statsFilter.gender=e.target.value,n4(),sr()}function sp(e){let t=e.target.dataset.sortKey;t&&(l.statsFilter.sortKey===t?l.statsFilter.sortOrder="asc"===l.statsFilter.sortOrder?"desc":"asc":(l.statsFilter.sortKey=t,l.statsFilter.sortOrder="name"===t?"asc":"desc"),sr(),n4())}function sy(e){let t=[...l.selection.players];l.selection.gameMode=e,l.selection.courtId=null,2==("doubles"===e?4:2)&&t.length>2?l.selection.players=[]:l.selection.players=t,l9(),requestAnimationFrame(()=>{requestAnimationFrame(sh)}),n4()}function sh(){let{players:e,gameMode:t}=l.selection;e.length===("doubles"===t?4:2)?document.querySelectorAll(".court-card.selectable .court-confirm-btn.select-court").forEach(e=>{e.classList.add("serve-in")}):document.querySelectorAll(".court-confirm-btn.select-court").forEach(e=>{e.classList.remove("serve-in")})}function sv(e,t="setup",a=null){eK.classList.remove("hidden"),eK.dataset.openedFrom=t,eY.innerHTML="",eY.classList.remove("two-row-grid"),document.getElementById("modal-confirm-teams-btn").textContent="Confirm",document.getElementById("modal-cancel-btn").textContent="Close";let n=e?l.courts.find(t=>t.id===e):null,s=a||(n?n.players:[]);s.length>0&&(4===s.length&&eY.classList.add("two-row-grid"),s.forEach(e=>{let t=document.createElement("div");t.className="modal-player",t.textContent=e.name,t.dataset.player=e.name,eY.appendChild(t)}),eK.dataset.playerNames=JSON.stringify(s.map(e=>e.name)),e&&(eK.dataset.courtId=e)),eZ.disabled=!0,eZ.classList.remove("modal-confirm-ready"),eY.addEventListener("click",()=>{2===eY.querySelectorAll(".selected").length?(eZ.disabled=!1,eZ.classList.add("modal-confirm-ready")):(eZ.disabled=!0,eZ.classList.remove("modal-confirm-ready"))})}function sf(e){let t=l.courts.find(t=>t.id===e);if(!t)return;let n=document.querySelector(`.court-card[data-court-id="${e}"]`),s=n?n.querySelector('[data-action="start-game"]'):null;s&&s.classList.add("start-game-hop"),setTimeout(()=>{let e;t.autoStartTimer&&(clearTimeout(t.autoStartTimer),t.autoStartTimer=null),t.status="in_progress",t.gameStartTime=Date.now(),t.autoStartTimeTarget=null,t.isNewGame=!0;let n=n3(t.teams.team1),s=n3(t.teams.team2),i=e=>{let t=e.map(a);return 1===t.length?t[0]:2===t.length?`${t[0]} and ${t[1]}`:t.slice(0,-1).join(", ")+` and ${t.slice(-1)[0]}`},r=sB(t.id),o="";if("fast"===t.matchMode?o=`... a Fast Play match, first to ${t.fastPlayGames} games`:"3set"===t.matchMode&&(o="... a 3 set match"),"singles"===t.gameMode)e=`${a(n[0])}, and ${a(s[0])} ...are on Court ${r}${o}... Lekker Speel!`;else if(!1===t.teamsSet){let a=i(n3(t.players));e=`It's ${a}, on Court ${r}${o}... Lekker Speel!`}else{let t=i(n),a=i(s);e=`It's team ${t}, versus team ${a} ...on Court ${r}${o}... Lekker Speel!`}if(sP(e,null),window.innerWidth<900){let e=document.querySelector(".summary-card");e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}if(window.innerWidth<900&&!l.mobileControls.isPlayersExpanded){l.mobileControls.isPlayersExpanded=!0;let e=document.getElementById("availablePlayersSection"),t=document.querySelector("#players-toggle-btn i");e&&e.classList.remove("is-collapsed"),t&&(t.className="mdi mdi-chevron-up"),n4()}l9(),t.isNewGame=!1,n4(),sQ(),sO(!1)},2e3)}function sb(e){e.innerHTML="";let{players:t}=l.manualEntry;0===t.length?e.innerHTML='<p style="color: var(--neutral-color); margin: 0; text-align: center; width: 100%;">No players selected yet.</p>':t.forEach(t=>{let a=document.createElement("div");a.className="selected-player-chip",a.textContent=t.split(" ")[0],a.dataset.playerName=t,a.title="Click to remove",e.appendChild(a)})}function sE(e){l.manualEntry.players=l.manualEntry.players.filter(t=>t!==e),ew.classList.contains("hidden")?eT.classList.contains("hidden")||sk():sL()}function sL(){tt.classList.add("hidden"),ew.classList.remove("hidden"),sb(eP);let e=l.courts.flatMap(e=>e.players),t=Array.from(new Map([...l.availablePlayers,...e].map(e=>[e.name,e])).values()).filter(e=>!l.manualEntry.players.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));e$.innerHTML="",0===t.length?e$.innerHTML='<li class="waiting-message">All checked-in players have been selected.</li>':t.forEach(e=>{let t=document.createElement("li");t.innerHTML=`
                    <span style="flex-grow: 1;">${e.name}</span>
                    <span class="action-icon add" data-player-name="${e.name}">+</span>
                `,t.dataset.playerName=e.name,e$.appendChild(t)}),lN(t,e$,document.getElementById("manual-player-abc-index"));let a=l.manualEntry.players.length,n=2===a||4===a;eD.disabled=!n,eD.style.backgroundColor=n?"var(--confirm-color)":"var(--inactive-color)"}function sk(){ew.classList.add("hidden"),eT.classList.remove("hidden"),sb(eN);let e=new Set([...l.courts.flatMap(e=>e.players.map(e=>e.name)),...l.availablePlayers.map(e=>e.name)]),a=[...t.filter(t=>!e.has(t.name)),...l.guestHistory.filter(t=>!e.has(t.name))].filter(e=>!l.manualEntry.players.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));ex.innerHTML="",0===a.length?ex.innerHTML='<li class="waiting-message">All other players have been selected.</li>':a.forEach(e=>{let t=document.createElement("li");t.innerHTML=`
                    <span style="flex-grow: 1;">${e.name}</span>
                    <span class="action-icon add" data-player-name="${e.name}">+</span>
                `,t.dataset.playerName=e.name,ex.appendChild(t)}),lN(a,ex,document.getElementById("outside-player-abc-index"));let n=l.manualEntry.players.length,s=2===n||4===n;eO.disabled=!s,eO.style.backgroundColor=s?"var(--confirm-color)":"var(--inactive-color)"}function sC(){let{players:e}=l.manualEntry;if(2!==e.length&&4!==e.length)return;let t=e.map(e=>n2(e)),a=2===e.length?"singles":"doubles",n={players:t,gameMode:a,teamsSet:!1,teams:{team1:[],team2:[]}};"singles"===a&&(n.teamsSet=!0,n.teams.team1=[t[0]],n.teams.team2=[t[1]]),ew.classList.add("hidden"),eT.classList.add("hidden"),sS(null,null,n)}function sS(e,t=null,a=null){sw();let n={matchMode:"1set",fastPlayGames:4};if(a)if(!a.teamsSet)return void sv(null,"manual",a.players);else{ts.dataset.manualEntry=JSON.stringify(a.players.map(e=>e.name)),ty.textContent=`Manual Entry - ${new Date().toLocaleString("en-ZA")}`;let e=n3(a.teams.team1).join(" & "),t=n3(a.teams.team2).join(" & ");ti.innerHTML=`
                    <div class="team-selection" data-team="team1"><div><strong>Team 1:</strong> <span>${e}</span></div></div>
                    <div class="team-selection" data-team="team2"><div><strong>Team 2:</strong> <span>${t}</span></div></div>
                `}else if(t){let e=l.gameHistory.find(e=>e.id==t);if(!e)return;ts.dataset.editGameId=t,ty.textContent=`Editing Game from: ${new Date(e.endTime).toLocaleString()}`;let a=e.teams.team1.join(" & "),n=e.teams.team2.join(" & ");ti.innerHTML=`
                <div class="team-selection" data-team="team1"><div><strong>Team 1:</strong> <span>${a}</span></div></div>
                <div class="team-selection" data-team="team2"><div><strong>Team 2:</strong> <span>${n}</span></div></div>
            `}else if(e){let t=l.courts.find(t=>t.id===e);if(!t)return;if(!1===t.teamsSet)return void sv(e,"endgame");ts.dataset.courtId=e,n={matchMode:t.matchMode,fastPlayGames:t.fastPlayGames};let a=new Date;ty.textContent=`Completed: ${a.toLocaleDateString("en-ZA",{day:"numeric",month:"short"})} at ${a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`;let s=n3(t.teams.team1).join(" & "),i=n3(t.teams.team2).join(" & ");ti.innerHTML=`
                <div class="team-selection" data-team="team1"><div><strong>Team 1:</strong> <span>${s}</span></div></div>
                <div class="team-selection" data-team="team2"><div><strong>Team 2:</strong> <span>${i}</span></div></div>
            `}ts.dataset.matchMode=n.matchMode,ts.dataset.fastPlayGames=n.fastPlayGames;let s=document.getElementById("end-game-skip-btn");ti.querySelectorAll(".team-selection").forEach(e=>e.addEventListener("click",e=>{let t=e.currentTarget.dataset.team;ts.dataset.winner=t,ti.querySelectorAll(".team-selection").forEach(e=>{e.classList.toggle("winner",e.dataset.team===t),e.classList.toggle("loser",e.dataset.team!==t)}),tc.classList.remove("hidden"),s.textContent="Skip Scores",s.dataset.action="skip-scores",sM()}));let i={},r={};"fast"===n.matchMode?(i={maxLength:2,maxValue:n.fastPlayGames},r={maxLength:2,maxValue:n.fastPlayGames-1}):(i={maxLength:1,maxValue:7},r={maxLength:1,maxValue:7}),ii(tm,i),ii(tu,r),ts.classList.remove("hidden")}function sI(e){l.availablePlayers.some(t=>t.name===e.name)||(l.availablePlayers.push(e),l.clubMembers=l.clubMembers.filter(t=>t.name!==e.name)),N.classList.add("hidden"),tw.classList.add("hidden"),iy(),e2.classList.remove("hidden"),t$.value="",tD.value="",tB.disabled=!0,document.querySelector('input[name="player-type"][value="guest"]').checked=!0,l1(),iS(),l9(),n4(),sO(!1)}function sw(){ts.classList.add("hidden"),delete ts.dataset.courtId,delete ts.dataset.editGameId,delete ts.dataset.winner,ti.innerHTML="",tc.classList.add("hidden"),td.classList.add("hidden"),tm.value="",tu.value="",tg.value="",tp.value="",tr.disabled=!0,tr.style.backgroundColor="var(--inactive-color)",tr.style.borderColor="var(--inactive-color)";let e=document.getElementById("end-game-skip-btn");e.textContent="Skip Result",e.dataset.action="skip-result"}function s$(){let e=ts.dataset.courtId,t=l.courts.find(t=>t.id===e);if(!t)return;let n=Date.now(),s=n3(t.teams.team1),i=n3(t.teams.team2),r={id:n,court:t.id,startTime:t.gameStartTime,endTime:n,duration:document.getElementById(`timer-${t.id}`).textContent,teams:{team1:s,team2:i},score:null,winner:"skipped"};l.gameHistory.push(r);let o=[...t.players].filter(e=>!e.guest);if(l.availablePlayers.push(...o),(k>0?k-n:1/0)>3e4){let e=se(),t=a(sN());t&&sP(e?`Attention, ${t}. Please come and select your match. Court ${sB(e)} is available.`:`Attention, ${t}. Please come and select your match. A court is now available.`)}else console.log("Skipped skip result announcement due to grace period.");iI(t.id),ts.classList.add("hidden")}function sD(){let e=ts.dataset.courtId,t=l.courts.find(t=>t.id===e),n=ts.dataset.winner;if(!t||!n)return;let s=Date.now(),i=n3(t.teams.team1),r=n3(t.teams.team2),o={id:s,court:t.id,startTime:t.gameStartTime,endTime:s,duration:document.getElementById(`timer-${t.id}`).textContent,teams:{team1:i,team2:r},score:null,winner:n};l.gameHistory.push(o);let d=[..."team1"===n?t.teams.team1:t.teams.team2,..."team1"===n?t.teams.team2:t.teams.team1].filter(e=>!e.guest);if(l.availablePlayers.push(...d),(k>0?k-s:1/0)>3e4){let e=se(),t=a(sN());t&&sP(e?`Attention, ${t}. Please come and select your match. Court ${sB(e)} is available.`:`Attention, ${t}. Please come and select your match. A court is now available.`)}else console.log("Skipped skip scores announcement due to grace period.");iI(t.id),ts.classList.add("hidden")}function sM(){let e=!!ts.dataset.winner;if(!e){tr.disabled=!0;return}let t=ts.dataset.matchMode||"1set",a=parseInt(ts.dataset.fastPlayGames,10)||4,n=tm.value,l=tu.value,s=parseInt(n,10),i=parseInt(l,10),r=!1;if(""!==n&&""!==l&&("fast"===t?s===a&&i<a&&(r=!0):(6===s&&i>=0&&i<=4&&(r=!0),7===s&&5===i&&(r=!0),7===s&&6===i&&(r=!0))),!r){tr.disabled=!0,tr.style.backgroundColor="var(--inactive-color)",tr.style.borderColor="var(--inactive-color)";return}let o=!0;if(!td.classList.contains("hidden")){let e=tg.value,t=tp.value;if(""===e||""===t)o=!1;else{let a=parseInt(e,10),n=parseInt(t,10);o=a>=7&&a-n>=2||n>=7&&n-a>=2}}let d=e&&r&&o;tr.disabled=!d,tr.style.backgroundColor=d?"var(--confirm-color)":"var(--inactive-color)",tr.style.borderColor=d?"var(--confirm-color)":"var(--inactive-color)"}function sB(e){if(!e)return"";switch(e.toUpperCase()){case"A":return"AYY";case"B":return"Bee";case"C":return"See";case"D":return"Dee";case"E":return"EE";default:return e}}function sT(e){if(!("speechSynthesis"in window))return null;let t=new SpeechSynthesisUtterance(e),a=window.speechSynthesis.getVoices(),n=a.find(e=>"en-ZA"===e.lang);return n||(n=a.find(e=>e.lang.startsWith("en-")&&e.name.includes("Google"))),n&&(t.voice=n),t.rate=.85,t.pitch=.95,t}function sx(e){if(l.notificationControls.isMuted||l.notificationControls.isTTSDisabled)return;let t=sT(e);t&&(window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(t))}function sA(e){if(!e)return null;let t=new Date,a=new Date(e);if(isNaN(a))return null;let n=t.getFullYear()-a.getFullYear(),l=t.getMonth()-a.getMonth();return(l<0||0===l&&t.getDate()<a.getDate())&&n--,n}function sP(e=null,t=null,a=null){!l.notificationControls.isMuted&&(I.push({msg1:e,msg2:t,soundFile:a||null}),w||function e(){if(w&&0===I.length){w=!1;return}0!==I.length&&(!w&&(w=!0,I[0].soundFile||I.unshift({msg1:null,msg2:null,soundFile:l.selectedAlertSound})),function(e,t){w=!0;let{msg1:a,msg2:n,soundFile:s}=e,i=(e,t,a)=>{if(l.notificationControls.isTTSDisabled||!e&&!t)return a();let n=sT(e||t);if(!n)return a();n.onend=()=>{if(e&&t){let e=sT(t);e?(e.onend=a,window.speechSynthesis.speak(e)):a()}else a()},window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)};if(l.notificationControls.isTTSDisabled&&!s)return t();if(C&&(C.pause(),C.currentTime=0),window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),!s)return i(a,n,t);I.forEach(e=>{e.soundFile=null});let r=`source/${s}`;(C=new Audio(r)).addEventListener("playing",function e(){C.removeEventListener("playing",e),C.addEventListener("ended",function e(){C.removeEventListener("ended",e),i(a,n,t)})}),C.play().catch(e=>{console.error(`Error playing alert sound ${r}: `,e),i(a,n,t)})}(I.shift(),e))}())}function sx(e){l.notificationControls.isMuted||l.notificationControls.isTTSDisabled||sT(e)&&sP(e,null,null)}function sN(){let e=l.availablePlayers.find(e=>!e.isPaused);return e?e.name:null}function sO(e=!1){let t=l.availablePlayers.length,n=Date.now(),s=se(),i=t>=4&&s,r=sN();if(!i||!r)return void sQ();let o=a(r),d=sB(s),c=`Attention, ${o}. Please come and select your match. Court ${d} is available.`;if(e)return void sP(c);if("initial_check"===S){k=n+(l.notificationControls.isMinimized?12e4:3e5),S="2_min_countdown",l.currentAlertCount=1;return}if(n>=k){if(l.currentAlertCount>=2){let e=l.availablePlayers.findIndex(e=>!e.isPaused);if(-1!==e&&l.availablePlayers.length>1){let[t]=l.availablePlayers.splice(e,1),n=Math.min(8+l.availablePlayers.slice(0,8).filter(e=>e.isPaused).length,l.availablePlayers.length);l.availablePlayers.splice(n,0,t),nX(),l.currentSuggestionOutcome=null,l.currentSuggestionType=null,l.activeSuggestion&&lW();let s=sN(),i=a(t.name),r=a(s);sP(`${i} has been moved down. ${r}, please select your match on court ${d}.`),l9(),n4(),sQ();return}}1===l.currentAlertCount&&(c+=" This is your last call."),sP(c),l.currentAlertCount++,k=n+(l.notificationControls.isMinimized?12e4:3e5),S="5_min_repeat"}}function sH(){let e=String(new Date().getDate()).padStart(2,"0");return`0308${e}`}function sq(){if($){D&&(clearTimeout(D),D=null),sR();return}il(null,{mode:"admin",maxLength:6,title:"Enter Admin Passcode"})}function sF(){as.classList.add("hidden"),ac=null}function sj(){if(!l.notificationControls.autoMinimize)return;let e=l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)&&"league"!==e.courtMode).length;n5()>=4*e+4?l.notificationControls.isMinimized||(l.notificationControls.isMinimized=!0,l.matchSettings.autoMatchModes||sx("Switching to 2-minute alerts."),sG(),n4()):l.notificationControls.isMinimized&&(l.notificationControls.isMinimized=!1,l.matchSettings.autoMatchModes||sx("Switching to 5-minute alerts."),sG(),n4())}function s_(){let e=l.availablePlayers.length,t=se();if(eX.querySelector("h3").textContent="Confirm Announcement",e0.textContent="Confirm",e1.textContent="Close",!(e>=4)){eX.querySelector("p").textContent="There are not enough players for a doubles match. Announce to waiting players?",eX.dataset.mode="forceAnnouncementNotEnoughPlayers",eX.classList.remove("hidden");return}if(!t)return void alert("Notification cannot be sent: No courts are available.");eX.querySelector("p").textContent="Are you sure you want to force a player announcement now?",eX.dataset.mode="forceAnnouncement",eX.classList.remove("hidden")}function sG(){if(!aa||!an||!al)return;let e=aa.querySelector("i"),t=an.querySelector("i"),a=al.querySelector("i");e&&(e.className=l.notificationControls.isMuted?"mdi mdi-volume-off":"mdi mdi-volume-high"),t&&(t.className=l.notificationControls.isMinimized?"mdi mdi-arrow-collapse-vertical":"mdi mdi-arrow-expand-vertical"),a&&(a.className=l.notificationControls.isTTSDisabled?"mdi mdi-microphone-off":"mdi mdi-microphone-message")}function sR(){tU.innerHTML="";let e=t.filter(e=>e.committee),a=document.createElement("li");a.innerHTML=`
            <label>
                <input type="radio" name="onDutyMember" value="None" ${"None"===l.onDuty?"checked":""}>
                <div class="member-details">
                    <span class="member-name">None</span>
                    <span class="member-designation">No assigned member</span>
                </div>
            </label>
        `,tU.appendChild(a),e.sort((e,t)=>e.name.localeCompare(t.name)).forEach(e=>{let t=document.createElement("li");t.className="committee-member",t.innerHTML=`
                <label>
                    <input type="radio" name="onDutyMember" value="${e.name}" ${l.onDuty===e.name?"checked":""}>
                    <div class="member-details">
                        <span class="member-name">${e.name}</span>
                        <span class="member-designation">${e.committee}</span>
                    </div>
                </label>
            `,tU.appendChild(t)}),tU.querySelectorAll('input[name="onDutyMember"]').forEach(e=>{e.removeEventListener("change",l5),e.addEventListener("change",l5)}),tV.innerHTML="";let n=document.createElement("li");n.className="court-availability-item",n.innerHTML=`
            <label style="flex-grow: 1;">Auto Court Modes</label>
            <label class="switch">
                <input type="checkbox" id="auto-assign-toggle" ${l.courtSettings.autoAssignModes?"checked":""}>
                <span class="slider"></span>
            </label>
            <label style="flex-grow: 1; margin-left: 1rem;">Show Mode Selector</label>
            <label class="switch">
                <input type="checkbox" id="show-mode-selector-toggle" ${l.courtSettings.showGameModeSelector?"checked":""}>
                <span class="slider"></span>
            </label>
        `,tV.appendChild(n);let s=`
            <li class="court-availability-item" style="border-top: 1px dashed var(--border-color); padding-top: 1rem; margin-top: 0.5rem; flex-direction: column; align-items: stretch;">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 0.5rem;">
                     <label style="flex-grow: 1;">Auto Match Modes</label>
                     <label class="switch">
                         <input type="checkbox" id="auto-match-mode-toggle" ${l.matchSettings.autoMatchModes?"checked":""}>
                         <span class="slider"></span>
                     </label>
                </div>
                <div id="match-mode-selector-admin" class="match-mode-selector" style="${l.matchSettings.autoMatchModes?"display: none;":""}">
                    <label>
                        <input type="radio" name="match-mode" value="1set" ${"1set"===l.matchSettings.matchMode?"checked":""}> 1 Set
                    </label>
                    <label>
                        <input type="radio" name="match-mode" value="3set" ${"3set"===l.matchSettings.matchMode?"checked":""}> 3 Sets
                    </label>
                    <label>
                        <input type="radio" name="match-mode" value="fast" ${"fast"===l.matchSettings.matchMode?"checked":""}> Fast Play
                    </label>
                </div>
                <div class="fast-play-games-selector" style="${"fast"!==l.matchSettings.matchMode||l.matchSettings.autoMatchModes?"display: none;":""}">
                    <label>Fast Play Games (First to):</label>
                    <div class="radio-group">
                        <label> <input type="radio" name="fast-play-games" value="3" ${3===l.matchSettings.fastPlayGames?"checked":""}> 3 </label>
                        <label> <input type="radio" name="fast-play-games" value="4" ${4===l.matchSettings.fastPlayGames?"checked":""}> 4 </label>
                        <label> <input type="radio" name="fast-play-games" value="5" ${5===l.matchSettings.fastPlayGames?"checked":""}> 5 </label>
                    </div>
                </div>
            </li>
        `;tV.insertAdjacentHTML("beforeend",s),l.courts.forEach(e=>{let t=document.createElement("li");t.className="court-availability-item",t.dataset.courtId=e.id;let a=l.courtSettings.visibleCourts.includes(e.id),n=l.lightSettings.courts?l.lightSettings.courts[e.id]:null,s=n&&n.isManaged,i=s&&n.isActive;t.innerHTML=`
                    <span style="font-weight: 500; margin-right: auto;">${e.id}</span> <button class="light-toggle-btn" data-court-id="${e.id}" title="Toggle Court ${e.id} Lights" ${s?"":"disabled"} style="flex-shrink: 0;"> <i class="mdi ${i?"mdi-lightbulb-on":"mdi-lightbulb-outline"}"></i>
                    </button>
                    <label class="switch" style="flex-shrink: 0; width: 50px"> <input type="checkbox" data-court-id="${e.id}" ${a?"checked":""}>
                        <span class="slider"></span>
                    </label>
                `,tV.appendChild(t)}),tV.removeEventListener("click",sz),tV.addEventListener("click",sz),document.getElementById("auto-assign-toggle")?.addEventListener("change",e=>{l.courtSettings.autoAssignModes=e.target.checked,n4(),iS(),l9()}),document.getElementById("show-mode-selector-toggle")?.addEventListener("change",e=>{l.courtSettings.showGameModeSelector=e.target.checked,n4(),l9()}),document.getElementById("auto-match-mode-toggle")?.addEventListener("change",e=>{l.matchSettings.autoMatchModes=e.target.checked,document.getElementById("match-mode-selector-admin").style.display=e.target.checked?"none":"",document.querySelector(".fast-play-games-selector").style.display=e.target.checked||"fast"!==l.matchSettings.matchMode?"none":"",n4(),iC(),l9()}),document.querySelectorAll('input[name="match-mode"]').forEach(e=>e.addEventListener("change",st)),document.querySelectorAll('input[name="fast-play-games"]').forEach(e=>e.addEventListener("change",sa)),lf(),tW.classList.remove("hidden")}function sz(e){let t=e.target.closest(".light-toggle-btn"),a=e.target.closest('.switch input[type="checkbox"]');e.target.closest(".court-label-button"),t?lC(e):a&&function(e){let t=e.target.dataset.courtId;e.target.checked?l.courtSettings.visibleCourts.includes(t)||(l.courtSettings.visibleCourts.push(t),l.courtSettings.visibleCourts.sort()):l.courtSettings.visibleCourts=l.courtSettings.visibleCourts.filter(e=>e!==t),n4(),l9(),sO(!1)}({target:a})}function sW(){let e=nm.value;nu.textContent=`${e}% All Female`}function sU(){let e=ng.value;np.textContent=`${e}% All Male`}function sV(e){nj.classList.toggle("disabled",e),n_.classList.toggle("disabled",e),nG.classList.toggle("disabled",e),ny.disabled=e,nm.disabled=e,ng.disabled=e,nC.classList.toggle("disabled",e),nS.classList.toggle("disabled",e),nI.classList.toggle("disabled",e),nv.disabled=e,nb.disabled=e,nL.disabled=e}function sJ(){let e=nv.value;nf.textContent=`${e}% Top Player H2H`}function sK(){let e=nb.value;nE.textContent=`${e}% Frequent Opponent`}function sY(){let e=nL.value;nk.textContent=`${e}% Weak Player Group`}function sZ(){tY.innerHTML="",t5.forEach((e,t)=>{let a=document.createElement("li"),n=0===t,l=t===t5.length-1;a.innerHTML=`
                <span class="reorder-position" data-player-name="${e.name}" data-current-index="${t}">${t+1}</span>
                <span>${e.name}</span>
                <div class="reorder-controls">
                    <button class="reorder-btn" data-player-name="${e.name}" data-direction="up" ${n?"disabled":""}>\u{2191}</button>
                    <button class="reorder-btn" data-player-name="${e.name}" data-direction="down" ${l?"disabled":""}>\u{2193}</button>
                </div>
            `,tY.appendChild(a)})}function sQ(){k=0,S="initial_check",l.currentAlertCount=0}function sQ(){k=0,S="initial_check",l.currentAlertCount=0}function sX(){if(!A.classList.contains("hidden")||window.innerWidth<=900)return;console.log("Starting screensaver..."),A.classList.remove("hidden"),x=!0,T=0,B&&(clearInterval(B),B=null);let e=()=>{let e=l.events.filter(e=>e.isActive);P.classList.remove("visible"),A.classList.remove("show-main-app");let t=document.getElementById("screensaver-interested-btn-overlay");t&&t.remove(),setTimeout(()=>{if(x&&e.length>0){let t=T%e.length,a=e[t],n=a.eventDate?new Date(a.eventDate+"T00:00:00").toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Date TBC",l="Time TBC";if(a.startTime)try{let[e,t]=a.startTime.split(":"),n=parseInt(e,10),s=parseInt(t,10);l=`${n%12||12}:${String(s).padStart(2,"0")} ${n>=12?"PM":"AM"}`}catch(e){console.error("Error formatting event time:",e),l=a.startTime}let s=a.rsvpDate?new Date(a.rsvpDate+"T00:00:00").toLocaleDateString("en-ZA",{day:"numeric",month:"short",year:"numeric"}):"N/A",i="";a.image1Filename&&"None"!==a.image1Filename&&(i+=`<img src="source/screensaver/${a.image1Filename}" alt="Event Image 1" class="screensaver-event-image">`),a.image2Filename&&"None"!==a.image2Filename&&(i+=`<img src="source/screensaver/${a.image2Filename}" alt="Event Image 2" class="screensaver-event-image">`);let r="";if(a.costAdult>0||a.costChild>0){let e=a.costAdult>0?`Adult: R${a.costAdult}`:"",t=a.costChild>0?`Child: R${a.costChild}`:"";r=`<p class="screensaver-cost">${e}${e&&t?" | ":""}${t}</p>`,a.participationDiscount>0&&(r+=`<p class="screensaver-discount">Club Champ Participants get R${a.participationDiscount} off</p>`)}let o="";if(s&&"N/A"!==s){let e=`RSVP BY ${s.toUpperCase()}`;a.volunteersNeeded&&(e+=" - VOLUNTEER COOKS NEEDED"),o=`<p class="screensaver-rsvp"><strong>${e}</strong></p>`}else a.volunteersNeeded&&(o='<p class="screensaver-rsvp"><strong>VOLUNTEER COOKS NEEDED</strong></p>');let d="";(a.phone||a.email||a.website)&&(d='<div class="screensaver-contact-bar">',a.phone&&(d+=`<div class="screensaver-contact-item"><span class="contact-icon">\u{1F4DE}</span><span class="contact-text">${a.phone}</span></div>`),a.email&&(d+=`<div class="screensaver-contact-item"><span class="contact-icon">\u{2709}</span><span class="contact-text">${a.email}</span></div>`),a.website&&(d+=`<div class="screensaver-contact-item"><span class="contact-icon">\u{1F310}</span><span class="contact-text">${a.website}</span></div>`),d+="</div>");let c=a.openTo||"All Members";a.isOpenToGuests&&(c+=" and Invited Guests");let m=`<div class="screensaver-open-banner">EVENT OPEN TO ${c.toUpperCase()}</div>`;P.innerHTML=`
                    <div class="screensaver-event-layout">
                        <div class="screensaver-left-column">
                            ${i||'<div class="screensaver-placeholder-image"></div>'}
                        </div>

                        <div class="screensaver-right-column">
                            <div class="screensaver-right-column-main-content">
                                <img src="source/mzansi-court-q-logo.png" alt="Eldoraigne Tennis" class="screensaver-club-logo">

                                <h1 class="screensaver-event-heading">${a.heading||"Club Event"}</h1>

                                <div class="screensaver-datetime-row">
                                    <div class="screensaver-date">
                                        <div class="date-value">${n}</div>
                                    </div>
                                    ${l&&"Time TBC"!==l?`
                                    <div class="screensaver-trophy"><img src="source/tennis-ball.png" alt="Tennis Ball"></div>
                                    <div class="screensaver-time">
                                        <div class="time-value">${l} TO CLOSING</div>
                                    </div>
                                    `:""}
                                </div>

                                <div class="screensaver-body-text">
                                    ${a.body1?`<p>${a.body1}</p>`:""}
                                    ${a.body2?`<p>${a.body2}</p>`:""}
                                </div>

                                ${r}

                                <button id="screensaver-interested-btn" data-event-id="${a.id}">I am interested</button>
                            </div>

                            ${o}
                            ${d}
                            ${m}
                        </div>
                    </div>
                `,P.style.backgroundImage="none",P.style.display="flex",P.classList.add("visible"),x=!1}else P.style.display="none",P.classList.remove("visible"),A.classList.add("show-main-app"),x=!0,e.length>0&&T++},1e3)};e(),B=setInterval(e,15e3)}function s0(){A.classList.contains("hidden")||(console.log("Stopping screensaver..."),A.classList.add("hidden"),P.classList.remove("visible"),A.classList.remove("show-main-app"),P.style.display="flex",P.style.backgroundImage="none",B&&(clearInterval(B),B=null),s4())}function s1(){let e=document.getElementById("event-list"),t=document.getElementById("event-list-modal");e&&t&&(e.innerHTML="",0===l.events.length?e.innerHTML='<li style="text-align: center; color: var(--neutral-color); padding: 1rem;">No events created yet.</li>':[...l.events].sort((e,t)=>(t.eventDate||"").localeCompare(e.eventDate||"")||t.id-e.id).forEach(t=>{let a=document.createElement("li");a.className="event-list-item",a.dataset.eventId=t.id;let n=t.eventDate?new Date(t.eventDate+"T00:00:00").toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"Date TBC";a.innerHTML=`
                    <div class="event-summary">
                        <span class="event-heading">${t.heading||"Untitled Event"}</span>
                        <span class="event-date">${n}</span>
                    </div>
                    <div class="event-controls">
                        <button class="action-btn edit-event-btn" data-action="edit">Edit</button>
                        <span class="action-icon remove delete-event-btn" data-action="delete" title="Delete Event">&times;</span>
                        <label class="switch" title="Show in Screensaver">
                            <input type="checkbox" class="event-active-toggle" ${t.isActive?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                `,e.appendChild(a)}),tW.classList.add("hidden"),t.classList.remove("hidden"))}async function s2(){try{let e=await fetch("source/screensaver/images.json");if(e.ok){let t=await e.json();if(t.images&&Array.isArray(t.images)&&t.images.length>0)return console.log("Loaded images from images.json:",t.images),["None",...t.images]}}catch(e){console.log("images.json not found, trying directory listing...")}try{let e=await fetch("source/screensaver/");if(e.ok){let t=[...(await e.text()).matchAll(/<a href="([^"]+\.(?:jpg|jpeg|png|gif|webp))"/gi)].map(e=>e[1]);if(t.length>0)return console.log("Loaded images from directory listing:",t),["None",...t]}}catch(e){console.log("Directory listing not available")}return console.warn("Using default image list - please create source/screensaver/images.json"),["None","Trophy.jpg","Potjiekos.jpg","Tennis.jpg","Braai.jpg","Rugby.jpg","F1.jpg","ClubChamps.jpg"]}async function s3(){let e=await s2(),t=document.getElementById("event-image1"),a=document.getElementById("event-image2");if(t&&a){let n=t.value,l=a.value;t.innerHTML="",a.innerHTML="",e.forEach(e=>{let n=document.createElement("option");n.value=e,n.textContent="None"===e?"None":e.replace(/\.[^.]+$/,""),t.appendChild(n);let l=document.createElement("option");l.value=e,l.textContent="None"===e?"None":e.replace(/\.[^.]+$/,""),a.appendChild(l)}),[...t.options].some(e=>e.value===n)&&(t.value=n),[...a.options].some(e=>e.value===l)&&(a.value=l)}}async function s5(e=null){let t=document.getElementById("event-create-edit-modal");await s3();let a=document.getElementById("event-modal-title"),n=t.querySelector(".event-form-grid"),s=document.getElementById("interested-players-section"),i=document.getElementById("interested-players-list");if(n.querySelectorAll("input, select").forEach(e=>{"checkbox"===e.type||"radio"===e.type?e.checked=!1:"range"===e.type?e.value=e.min||0:e.value=""}),document.getElementById("event-type").value="Social",document.querySelector('input[name="event-open-to"][value="All Members"]').checked=!0,document.getElementById("event-image1").value="None",document.getElementById("event-image2").value="None",i.innerHTML="",s.style.display="none",e){let r=l.events.find(t=>t.id==e);if(!r){console.error("Event not found for editing:",e),s1();return}t.dataset.editingEventId=e,a.textContent="Edit Event",document.getElementById("event-type").value=r.eventType||"Social",document.getElementById("event-heading").value=r.heading||"",document.getElementById("event-date").value=r.eventDate||"",document.getElementById("event-rsvp-date").value=r.rsvpDate||"",document.getElementById("event-start-time").value=r.startTime||"",document.getElementById("event-body1").value=r.body1||"",document.getElementById("event-body2").value=r.body2||"",document.getElementById("event-cost-adult").value=r.costAdult||0,document.getElementById("event-cost-child").value=r.costChild||0,document.getElementById("event-participation-discount").value=r.participationDiscount||r.participationDiscountPercent||0,document.getElementById("event-volunteers").checked=r.volunteersNeeded||!1,document.getElementById("event-phone").value=r.phone||"",document.getElementById("event-email").value=r.email||"",document.getElementById("event-website").value=r.website||"";let o=n.querySelector(`input[name="event-open-to"][value="${r.openTo||"All Members"}"]`);o&&(o.checked=!0),document.getElementById("event-open-guests").checked=r.isOpenToGuests||!1,document.getElementById("event-image1").value=r.image1Filename||"None",document.getElementById("event-image2").value=r.image2Filename||"None",r.interestedPlayers=r.interestedPlayers||[],r.interestedPlayers.length>0?r.interestedPlayers.forEach(e=>{let t=document.createElement("li");t.innerHTML=`
                        <span>${e}</span>
                        <span class="action-icon remove" data-player-name="${e}" title="Remove player">&times;</span>
                    `,i.appendChild(t)}):i.innerHTML='<li style="color: var(--neutral-color); justify-content: center;">No players currently interested.</li>',s.style.display="block"}else delete t.dataset.editingEventId,a.textContent="Create New Event",s.style.display="none";s8("event-cost-adult"),s8("event-cost-child"),s8("event-participation-discount"),t.classList.remove("hidden")}function s8(e){let t=document.getElementById(e),a=t.previousElementSibling?.querySelector(".slider-value");if(!t||!a)return;let n="",l="";e.includes("cost")&&(n="R"),e.includes("discount")&&(l="%"),a.textContent=`${n}${t.value}${l}`}function s4(){clearTimeout(M),M=null,l.events.some(e=>e.isActive)&&window.innerWidth>900?M=setTimeout(sX,3e5):s0()}function su(){if(t1.innerHTML="",0===l.reorderHistory.length){t1.innerHTML='<p style="text-align: center; color: #6c757d; padding: 2rem;">No queue reorder actions have been logged.</p>';return}[...l.reorderHistory].reverse().forEach(e=>{let t=new Date(e.endTime).toLocaleString(),a="";for(let[t,n]of Object.entries(e.players))n.startPosition!==n.currentPosition&&(a+=`
                        <p style="margin: 0.25rem 0; font-size: 0.95rem; display: flex; justify-content: space-between;">
                            <span style="font-weight: 500;">${t}</span>
                            <span style="color: var(--primary-blue);">Moved from #${n.startPosition+1} to #${n.currentPosition+1}</span>
                        </p>
                    `);if(a){let n=document.createElement("div");n.className="history-item",n.style.textAlign="left",n.innerHTML=`
                    <div class="history-details" style="margin-bottom: 0.75rem;">
                        <span style="color: var(--primary-blue);">${e.adminAction} (${t})</span>
                    </div>
                    <div style="padding-left: 1rem;">
                        ${a}
                    </div>
                `,t1.appendChild(n)}})}function s7(){let{adminCourtManagement:e}=l;e.mode="card1_select_court",e.courtId=null,e.currentCourtPlayers=[],e.removedPlayers=[],e.addedPlayers=[],document.getElementById("manage-court-players-instructions").textContent="Select a court with an active game.",ab.dataset.cardMode="card1",au.classList.remove("hidden"),ag.classList.add("hidden"),ap.classList.add("hidden"),ah.classList.add("hidden"),av.classList.add("hidden"),af.classList.add("hidden"),ay.textContent="Close",au.innerHTML="";let t=l.courts.filter(e=>"in_progress"===e.status&&l.courtSettings.visibleCourts.includes(e.id));0===t.length?au.innerHTML='<li style="justify-content: center; color: #6c757d;">No games are currently in progress on visible courts.</li>':t.forEach(e=>{let t=document.createElement("li");t.className="court-select-item";let a=n3(e.players).map(e=>e.split(" ")[0]).join(" / ");t.innerHTML=`
                    <span style="flex-grow: 1;">Court ${e.id}</span>
                    <span style="margin-right: 1rem; color: #6c757d; font-size: 0.9em;">(${a})</span>
                    <span class="action-icon add" data-court-id="${e.id}" data-action="select-court" style="font-size: 1.2rem;">&gt;</span>
                `,au.appendChild(t)}),tW.classList.add("hidden"),am.classList.remove("hidden")}function s6(e){let{addedPlayers:t}=l.adminCourtManagement;t.length>0&&(l.availablePlayers=[...t,...l.availablePlayers],l.adminCourtManagement.addedPlayers=[]),l.adminCourtManagement={mode:"card1_select_court",courtId:null,currentCourtPlayers:[],removedPlayers:[],addedPlayers:[]},s9(e),am.classList.remove("hidden")}function s9(e){let t=l.courts.find(t=>t.id===e);if(!t||"in_progress"!==t.status)return s7();let{adminCourtManagement:a}=l;a.mode="card2_remove_players",a.courtId=e,0===a.currentCourtPlayers.length&&(a.currentCourtPlayers=JSON.parse(JSON.stringify(t.players)));let n="doubles"===t.gameMode?`Court ${e}: Manage Players`:`Court ${e}: Remove players from the game.`;document.getElementById("manage-court-players-instructions").textContent=n;let s=am.querySelector(".modal-header-with-actions h3");if(s){let a=am.querySelector(".header-swap-player-btn"),n=am.querySelector(".header-team-select-btn");a&&a.remove(),n&&n.remove();let i=document.createElement("div");i.className="modal-header-actions";let r=document.createElement("button");if(r.className="header-swap-player-btn",r.title="Swap with Player on Another Court",r.innerHTML='<i class="mdi mdi-account-switch"></i>',r.onclick=()=>{!function(e){let t=l.courts.find(t=>t.id===e);if(!t||"in_progress"!==t.status)return;let a=document.getElementById("swap-player-modal"),n=document.getElementById("swap-source-player");document.getElementById("swap-target-list");let s=document.getElementById("swap-player-instructions");a.dataset.sourceCourt=e,s.textContent=`Select a player from Court ${e} to swap:`,n.innerHTML="",t.players.forEach(t=>{let a=document.createElement("div");a.className="swap-player-option",a.innerHTML=`
                <div class="player-info">${t.name}</div>
                <div class="court-info">Court ${e} \u{2022} ${t.gender}</div>
            `,a.onclick=()=>(function(e,t){let a=document.getElementById("swap-player-modal"),n=document.getElementById("swap-source-player"),s=document.getElementById("swap-target-list");document.getElementById("swap-player-instructions").textContent=`Swap ${t.name} with:`,n.innerHTML=`
            <div class="player-info">${t.name}</div>
            <div class="court-info">Court ${e} \u{2022} ${t.gender}</div>
        `,a.dataset.sourcePlayer=JSON.stringify(t),s.innerHTML="";let i=l.courts.filter(t=>t.id!==e&&"in_progress"===t.status&&t.players.length>0);if(0===i.length){s.innerHTML='<li style="justify-content: center; color: var(--neutral-color);">No other courts in progress</li>';return}i.forEach(a=>{a.players.forEach(n=>{let l=document.createElement("li");l.innerHTML=`
                    <span class="player-name">${n.name}</span>
                    <span class="gender-label">${n.gender}</span>
                    <span class="court-label">Court ${a.id}</span>
                `,l.onclick=()=>(function(e,t,a,n){let l=document.getElementById("swap-confirm-modal"),s=document.getElementById("swap-confirm-details");l.dataset.swapData=JSON.stringify({sourceCourt:e,sourcePlayer:t,targetCourt:a,targetPlayer:n}),s.innerHTML=`
            <div class="swap-row">
                <div class="player-card">
                    <div class="name">${t.name}</div>
                    <div class="court">Court ${e}</div>
                </div>
                <div class="swap-arrow">\u{21C4}</div>
                <div class="player-card">
                    <div class="name">${n.name}</div>
                    <div class="court">Court ${a}</div>
                </div>
            </div>
        `,document.getElementById("swap-player-modal").classList.add("hidden"),l.classList.remove("hidden")})(e,t,a.id,n),s.appendChild(l)})})})(e,t),a.style.cursor="pointer",a.style.padding="0.75rem",a.style.margin="0.5rem 0",a.style.borderRadius="6px",a.style.transition="background-color 0.2s",a.onmouseenter=()=>a.style.backgroundColor="#d0e7ff",a.onmouseleave=()=>a.style.backgroundColor="transparent",n.appendChild(a)}),am.classList.add("hidden"),a.classList.remove("hidden")}(e)},i.appendChild(r),"doubles"===t.gameMode){let a=document.createElement("button");a.className="header-team-select-btn",a.title=t.teamsSet?"Reselect Teams":"Set Teams",a.innerHTML='<i class="mdi mdi-account-group-outline"></i>',a.onclick=()=>{am.classList.add("hidden"),sv(e,"in_progress")},i.appendChild(a)}s.parentElement.appendChild(i)}ab.dataset.cardMode="card2",au.classList.add("hidden"),ag.classList.remove("hidden"),ap.classList.add("hidden"),ah.classList.remove("hidden"),av.classList.remove("hidden"),af.classList.add("hidden"),ay.textContent="Close";let i=a.removedPlayers.length>0||a.addedPlayers.length>0;av.disabled=!i,av.style.backgroundColor=i?"var(--confirm-color)":"var(--neutral-color)",function(e){let{currentCourtPlayers:t,removedPlayers:a}=l.adminCourtManagement;ag.innerHTML="";let n=t.filter(e=>!a.some(t=>t.name===e.name));0===n.length&&0===a.length?ag.innerHTML='<li style="justify-content: center; color: var(--cancel-color);">No players remaining. Must add players or go back.</li>':n.forEach(t=>{let a=document.createElement("li"),n=t.guest?`${t.name} (Guest)`:t.name;a.innerHTML=`
                    <span style="flex-grow: 1;">${n}</span>
                    <span style="margin-right: 1rem; color: #6c757d;">${t.gender}</span>
                    <span class="action-icon remove" data-player="${t.name}" data-court-id="${e}" data-action="remove-player-temp" title="Remove Player">&times;</span>
                `,ag.appendChild(a)}),a.length>0&&(ag.innerHTML+='<li style="justify-content: center; background-color: #f0f0f0; margin-top: 1rem; color: var(--dark-text); font-weight: 500;">Removed Players (Click  to return to court):</li>',a.forEach(t=>{let a=document.createElement("li");a.style.backgroundColor="#fbe9eb";let n=t.guest?`${t.name} (Guest)`:t.name;a.innerHTML=`
                    <span style="flex-grow: 1; color: var(--cancel-color); font-weight: 500;">${n}</span>
                    <span class="action-icon add" data-player="${t.name}" data-court-id="${e}" data-action="return-player-temp" title="Keep on Court">+</span>
                `,ag.appendChild(a)}))}(e)}function ie(e){let{addedPlayers:t,removedPlayers:a}=l.adminCourtManagement;ap.innerHTML="";let n=l.availablePlayers.slice(0,7);0===n.length?ap.innerHTML='<li style="justify-content: center; color: #6c757d;">No players are currently available to add.</li>':n.forEach(a=>{let n=t.some(e=>e.name===a.name),l=document.createElement("li"),s=a.guest?`${a.name} (Guest)`:a.name;n?(l.style.backgroundColor="var(--light-blue)",l.innerHTML=`
                        <span style="flex-grow: 1; color: var(--primary-blue); font-weight: 500;">${s}</span>
                        <span class="action-icon remove" data-player="${a.name}" data-court-id="${e}" data-action="undo-add-player-temp" title="Undo Add">&times;</span>
                    `):l.innerHTML=`
                        <span style="flex-grow: 1;">${s}</span>
                        <span style="margin-right: 1rem; color: #6c757d;">${a.gender}</span>
                        <span class="action-icon add" data-player="${a.name}" data-court-id="${e}" data-action="add-player-temp" title="Add Player">+</span>
                    `,ap.appendChild(l)});let s=t.length>0||a.length>0;af.disabled=!s,af.style.backgroundColor=s?"var(--confirm-color)":"var(--inactive-color)",af.style.borderColor=s?"var(--confirm-color)":"var(--inactive-color)"}function it(){l.adminCourtManagement={mode:"card1_select_court",courtId:null,currentCourtPlayers:[],removedPlayers:[],addedPlayers:[]},am.classList.add("hidden"),l1(),l9(),n4(),sO(!1)}function ia(e){let t=e.target.dataset.key,{mode:a,maxLength:n,maxValue:s}=tI,i="admin"===a||"reset"===a||"undo"===a?tE.dataset.hiddenValue||"":tE.textContent;if("keypad-confirm-btn"===e.target.id){if(e.target.disabled)return;switch(a){case"admin":if(tE.dataset.hiddenValue===sH())is(),$=!0,D&&clearTimeout(D),D=setTimeout(()=>{$=!1,D=null,l.courts.forEach(e=>e.isModeOverlayActive=!1),l9(),sP(null,null,"Alert7.mp3"),requestAnimationFrame(sh)},6e4),sR();else{let e=tb.querySelector(".keypad-content");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake"),tE.textContent="",tE.dataset.hiddenValue&&(tE.dataset.hiddenValue=""),tS&&(tS.value=""),tk.disabled=!0},820)}break;case"reset":if("30221"===tE.dataset.hiddenValue)is(),eX.querySelector("h3").textContent="Final Confirmation",eX.querySelector("p").textContent="WARNING: This will erase all game history and check out all players. Are you absolutely sure?",e0.textContent="Yes, Reset",e1.textContent="Cancel",eX.dataset.mode="executeReset",eX.classList.remove("hidden");else{let e=tb.querySelector(".keypad-content");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake"),tE.textContent="",tE.dataset.hiddenValue&&(tE.dataset.hiddenValue=""),tk.disabled=!0},820)}break;case"undo":!function(){let e=tE.dataset.hiddenValue||"",t=parseInt(tb.dataset.undoActionIndex),a=sH();if(console.log("=== UNDO PIN CHECK ==="),console.log("Entered PIN:",e),console.log("Correct PIN:",a),console.log("Match:",e===a),e===a){is();let e=l.undoHistory.actions[t];e&&(g=!0,e.undo&&e.undo(),l.undoHistory.actions.splice(t,1),n4(),delete tb.dataset.context,delete tb.dataset.actionIndex,delete tb.dataset.actionDescription,setTimeout(()=>{g=!1},500),n7("Action undone successfully",null)),delete tb.dataset.undoActionIndex,delete tb.dataset.undoActionDescription}else{let e=tb.querySelector(".keypad-content");e.classList.add("shake"),tE.textContent="",delete tE.dataset.hiddenValue,tk.disabled=!0,setTimeout(()=>{e.classList.remove("shake")},820)}}();break;case"addStock":let t=parseInt(tE.textContent,10),n=tb.dataset.member;is(),isNaN(t)||t<=0||(eX.querySelector("h3").textContent="Confirm Purchase",eX.querySelector("p").textContent=`Confirm adding ${t} new cans, signed in by ${n}?`,e0.textContent="Confirm Add",e1.textContent="Cancel",eX.dataset.mode="addBallStock",eX.dataset.count=t,eX.dataset.member=n,eX.classList.remove("hidden"));break;case"returnStock":let s=parseInt(tE.textContent,10),i=tb.dataset.member;is(),isNaN(s)||s<=0||(eX.querySelector("h3").textContent="Confirm Return",eX.querySelector("p").textContent=`Confirm returning ${s} can(s), signed in by ${i}?`,e0.textContent="Confirm Return",e1.textContent="Cancel",eX.dataset.mode="returnBallStock",eX.dataset.count=s,eX.dataset.member=i,eX.classList.remove("hidden"));break;case"returnUsed":let r=parseInt(tE.textContent,10),o=tb.dataset.member;is(),isNaN(r)||r<=0||(eX.querySelector("h3").textContent="Confirm Used Ball Return",eX.querySelector("p").textContent=`Confirm returning ${r} used ball(s), signed in by ${o}?`,e0.textContent="Confirm Return",e1.textContent="Cancel",eX.dataset.mode="returnUsedBalls",eX.dataset.count=r,eX.dataset.member=o,eX.classList.remove("hidden"));break;case"signOut":!function(){let e,t=parseInt(tE.textContent,10),a=tb.dataset.category,n=tb.dataset.member,s=l.ballManagement.tempSale,i="Sale"===a,r=i?s.stockType:"cans",o=i?s.purchaserName:n,d="cans"===r?l.ballManagement.stock:l.ballManagement.usedStock;if(is(),isNaN(t)||t<=0||t>d)return;let c=i?`Confirm Sign Out: ${"cans"===r?"New Balls":"Old Balls"}`:`Confirm Sign Out: ${a}`;eX.querySelector("h3").textContent=c,e=i?`Confirm signing out ${t} ${r} to ${o}, by ${n}?`:`Confirm signing out ${t} can(s) for ${a}, by ${n}?`,eX.querySelector("p").textContent=e,e0.textContent="Confirm Sign Out",e1.textContent="Cancel",eX.dataset.mode="signOutBalls",eX.dataset.category=a,eX.dataset.count=t,eX.dataset.member=n,eX.dataset.stockType=r,eX.dataset.purchaserName=o,eX.classList.remove("hidden")}();break;default:tS&&tS.classList.contains("reorder-position")?function(e){if(!tS||!tS.dataset.playerName)return;let t=tS.dataset.playerName,a=parseInt(tS.dataset.currentIndex,10),n=parseInt(e,10)-1;if(isNaN(n)||n<0||n>=t5.length)return alert(`Invalid position. Please enter a number between 1 and ${t5.length}.`);let[l]=t5.splice(a,1);t5.splice(n,0,l),function(e,t,a){if(t===a)return;t5.sessionLog=t5.sessionLog||{};let n=t5.sessionLog,l=n[e]||{startPosition:t,currentPosition:t,movements:[]};l.movements.push({from:t,to:a,timestamp:Date.now()}),l.currentPosition=a,n[e]=l,t5.sessionLog=n}(t,a,n),sZ()}(tE.textContent):tS&&tS.dispatchEvent(new Event("input")),is()}return}if("backspace"===t)i=i.slice(0,-1);else if("clear"===t)i="";else if(/[0-9]/.test(t)){if(n&&i.length>=n)return;let e=i+t;if(void 0!==s&&parseInt(e,10)>s)return;i+=t}"admin"===a||"reset"===a||"undo"===a?(tE.dataset.hiddenValue=i,tE.textContent="*".repeat(i.length)):(tE.textContent=i,tS&&!tS.classList.contains("reorder-position")&&(tS.value=i,tS.dispatchEvent(new Event("input")))),tk.disabled=0===i.length}function il(e,t={}){tS=e,tI=t;let{mode:a,title:n}=t;tE.textContent="",delete tE.dataset.hiddenValue,"admin"===a||"reset"===a||"undo"===a?(tE.setAttribute("data-mode",a),"undo"===a?tE.removeAttribute("data-placeholder"):tE.setAttribute("data-placeholder",n||"Enter PIN"),tC.classList.remove("hidden"),tk.classList.remove("wide-full"),tk.classList.add("wide-half")):(tE.removeAttribute("data-mode"),n?tE.setAttribute("data-placeholder",n):tE.removeAttribute("data-placeholder"),tC.classList.add("hidden"),tk.classList.remove("wide-half"),tk.classList.add("wide-full")),tb.classList.remove("hidden"),tk.disabled=0===tE.textContent.length}function is(){tb.classList.add("hidden"),tI={},tS=null}function ii(e,t={}){e.readOnly=!0,e._keypadListener&&e.removeEventListener("click",e._keypadListener);let a=e=>{e.preventDefault(),il(e.target,t)};e.addEventListener("click",a),e._keypadListener=a}tF?.addEventListener("input",e=>{lu(e.target.value)}),document.getElementById("pedestrian-gate-btn")?.addEventListener("click",()=>{lE("pedestrian")}),document.getElementById("parking-gate-btn")?.addEventListener("click",()=>{lE("parking")}),setInterval(lj,36e5),ni.addEventListener("click",function(){lq(),tW.classList.add("hidden"),nl.classList.remove("hidden")}),nr.addEventListener("click",()=>{nl.classList.add("hidden"),tW.classList.remove("hidden")}),aS.addEventListener("click",l4),ak.addEventListener("click",function(){let e=[];aL.querySelectorAll("li").forEach(t=>{let a=t.querySelector('input[type="text"]'),n=t.querySelector('input[type="checkbox"]');a&&""!==a.value.trim()&&e.push({text:a.value.trim(),tts:n.checked})}),l.announcements=e,n4(),aE.classList.add("hidden"),tW.classList.remove("hidden"),l7(),l6()}),aC.addEventListener("click",()=>{aE.classList.add("hidden"),tW.classList.remove("hidden")}),aL.addEventListener("click",e=>{if(e.target.classList.contains("add-announcement-btn")){e.target.closest("li")&&e.target.remove();let t=document.createElement("li"),a=`tts-${Date.now()}-${Math.random()}`;t.innerHTML=`
                <input type="text" value="" placeholder="Enter announcement text...">
                <label for="${a}" class="tts-checkbox-label">
                    <input type="checkbox" id="${a}"> TTS
                </label>
                <span class="add-announcement-btn" title="Add another message">+</span>
                <span class="action-icon remove" title="Remove message">&times;</span>
            `,aL.appendChild(t)}else if(e.target.classList.contains("remove")){let t=e.target.closest("li");t&&t.remove();let a=[];aL.querySelectorAll("li").forEach(e=>{let t=e.querySelector('input[type="text"]'),n=e.querySelector('input[type="checkbox"]');a.push({text:t.value,tts:n.checked})}),l.announcements=a,l4()}}),document.addEventListener("click",s4),document.addEventListener("touchstart",s4),document.addEventListener("mousemove",s4),document.addEventListener("keydown",s4),s4();let ir=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"]];function io(){let e=tA.textContent;tP.innerHTML="",ir.forEach((t,a)=>{let n=document.createElement("div");n.className=`key-row-${a+1}`,t.forEach(t=>{let a=document.createElement("button");a.className="keypad-btn",a.dataset.key=t;a.textContent=0===e.length||" "===e.slice(-1)?t.toUpperCase():t.toLowerCase(),n.appendChild(a)}),tP.appendChild(n)});let t=document.createElement("div");t.className="key-row-4";let a=document.createElement("button");a.className="keypad-btn wide-control control",a.dataset.key="space",a.textContent="Space",t.appendChild(a);let n=document.createElement("button");n.className="keypad-btn control",n.dataset.key="backspace",n.textContent="⌫",t.appendChild(n);let l=document.createElement("button");l.className="keypad-btn wide-control confirm",l.id="alpha-keypad-confirm-btn",l.textContent="Done",t.appendChild(l),tP.appendChild(t),document.querySelectorAll("#custom-alpha-keypad-modal .keypad-btn").forEach(e=>{e.removeEventListener("click",id),e.addEventListener("click",id)})}function id(e){let t=e.target.dataset.key,a=tA.textContent;if(tN){if("backspace"===t)a=a.slice(0,-1);else if("space"===t)a.length>0&&" "!==a.slice(-1)&&(a+=" ");else{if("alpha-keypad-confirm-btn"===e.target.id)return void(tx.classList.add("hidden"),tN&&tN.closest("#new-parent-modal")?(document.getElementById("new-parent-modal").classList.remove("hidden"),tN.dispatchEvent(new Event("input"))):tw.classList.remove("hidden"),tN=null,im());let n=t;n=0===a.length||" "===a.slice(-1)?t.toUpperCase():t.toLowerCase(),a+=n}tA.textContent=a,tN.value=a,io(),tN.closest("#new-parent-modal")&&tN.dispatchEvent(new Event("input")),im()}}function ic(e,t=null){if(!e)return;e.readOnly=!0;let a=t=>{e._clickTimeoutId&&clearTimeout(e._clickTimeoutId),e._clickTimeoutId=setTimeout(()=>{let t=e.closest(".modal-overlay");t&&!t.classList.contains("hidden")&&lc(e),e._clickTimeoutId=null},150)};e._globalKeypadClickListener&&e.removeEventListener("click",e._globalKeypadClickListener),e.addEventListener("click",a),e._globalKeypadClickListener=a,t&&"function"==typeof t&&(e._globalKeypadInputListener&&e.removeEventListener("input",e._globalKeypadInputListener),e.addEventListener("input",t),e._globalKeypadInputListener=t)}function im(){let e=t$.value.trim(),t=tD.value.trim(),a=!!document.querySelector('input[name="guest-gender"]:checked'),n=!!document.querySelector('input[name="age-type"]:checked'),l=e.length>0&&t.length>0&&a&&n;tB.disabled=!l,tB.style.backgroundColor=l?"var(--confirm-color)":"var(--inactive-color)",tB.style.borderColor=l?"var(--confirm-color)":"var(--inactive-color)"}function iu(e,t){let a=l.guestHistory.findIndex(t=>t.name===e),n=new Date().toISOString().split("T")[0];a>-1?(l.guestHistory[a].gender=t,l.guestHistory[a].lastCheckIn!==n&&(l.guestHistory[a].daysVisited=(l.guestHistory[a].daysVisited||0)+1,l.guestHistory[a].lastCheckIn=n)):l.guestHistory.push({name:e,gender:t,daysVisited:1,lastCheckIn:n})}function ig(){t$.value="",tD.value="",tB.disabled=!0,document.querySelector('input[name="guest-gender"][value="M"]').checked=!0,document.querySelector('input[name="player-type"][value="guest"]').checked=!0,document.querySelector('input[name="age-type"][value="Adult"]').checked=!0;let e=document.querySelector('input[name="player-type"][value="member"]');e&&(e.disabled=!1)}function ip(){setTimeout(()=>{eX.querySelector("h3").textContent="Confirm Action",eX.querySelector("p").textContent="Are you sure?",e0.textContent="Confirm",e1.textContent="Close"},300)}function iy(){e3.innerHTML="";let e=new Set([...l.availablePlayers.map(e=>e.name),...l.courts.flatMap(e=>e.players).map(e=>e.name)]),t=l.clubMembers.filter(t=>!e.has(t.name));if(t.sort((e,t)=>e.name.localeCompare(t.name)),0===t.length){let e=document.createElement("li");e.textContent="All club members are currently checked in.",e.style.justifyContent="center",e3.appendChild(e)}else t.forEach(e=>{let t=document.createElement("li"),a=e.guest?`${e.name} (Guest)`:e.name;t.innerHTML=` <span style="flex-grow: 1;">${a}</span> <span style="margin-right: 1rem; color: #6c757d;">${e.gender}</span> <span class="action-icon add" data-player="${e.name}">+</span> `,t.dataset.playerName=e.name,e3.appendChild(t)});lN(t,e3,document.getElementById("check-in-abc-index"))}function ih(){if(e7.innerHTML="",0===l.availablePlayers.length){let e=document.createElement("li");e.textContent="There are no players currently checked in.",e.style.justifyContent="center",e7.appendChild(e)}else{let e=[...l.availablePlayers].sort((e,t)=>e.name.localeCompare(t.name));e.forEach(e=>{let t=document.createElement("li"),a=e.guest?`${e.name} (Guest)`:e.name;t.innerHTML=` <span style="flex-grow: 1;">${a}</span> <span style="margin-right: 1rem; color: #6c757d;">${e.gender}</span> <span class="action-icon remove" data-player="${e.name}">&times;</span> `,t.dataset.playerName=e.name,e7.appendChild(t)}),lN(e,e7,document.getElementById("check-out-abc-index"))}}function iv(e){if(!e)return;l.availablePlayers.length>0&&l.availablePlayers[0].name===e&&sQ();let t=l.availablePlayers.find(t=>t.name===e);t&&(t.isJunior&&(l.juniorClub.activeChildren=l.juniorClub.activeChildren.filter(t=>t.name!==e)),t.guest||(l.clubMembers.push(t),l.clubMembers.sort((e,t)=>e.name.localeCompare(t.name)))),l.availablePlayers=l.availablePlayers.filter(t=>t.name!==e),document.getElementById("checkout-thanks-modal").classList.add("hidden"),document.getElementById("checkout-thanks-no-stats-modal").classList.add("hidden"),ih(),e4.classList.remove("hidden"),l1(),iS(),l9(),n4()}function ib(){eX.querySelector("h3").textContent="Confirm Call",eX.querySelector("p").textContent="Are you sure you want to call the committee member on duty?",e0.textContent="Confirm",e1.textContent="Close",eX.dataset.mode="callDuty",eX.classList.remove("hidden")}function iE(){if(l.availablePlayers.length<2||"None"===l.onDuty)return;let e=l.availablePlayers,t=e.findIndex(e=>!e.isPaused);if(-1===t||e[t].name!==l.onDuty)return;let a=e.findIndex((e,a)=>a>t&&!e.isPaused&&e.name!==l.onDuty);if(-1!==a){let n=e[t],l=e[a];[e[t],e[a]]=[l,n]}}let iL=0,ik=0;function iC(){if(!l.matchSettings.autoMatchModes)return;let e=l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)&&"league"!==e.courtMode).length;if(n5()>=4*e+4){if("fast"!==l.matchSettings.matchMode){l.matchSettings.matchMode="fast",l.matchSettings.fastPlayGames=4;let e=Date.now();e-iL>5e3&&(sx("There is currently a high demand. Switching to Fast Play mode and 2-minute alerts."),iL=e);let t=k-Date.now();"initial_check"!==S&&t>12e4&&(k=Date.now()+12e4,sx("Alert timer accelerated."))}}else if("1set"!==l.matchSettings.matchMode){l.matchSettings.matchMode="1set";let e=Date.now();e-ik>5e3&&(sx("Player queue is reduced. Switching to standard 1 Set matches and 5-minute alerts."),ik=e)}}function iS(){if(!l.courtSettings.autoAssignModes)return;let e=l.courts.filter(e=>l.courtSettings.visibleCourts.includes(e.id)&&"league"!==e.courtMode).length,t=l.courts.filter(e=>"league"===e.courtMode&&"in_progress"===e.status).length,a=l.courts.filter(e=>"league"!==e.courtMode).reduce((e,t)=>e+t.players.length,0),n=l.availablePlayers.length+a,s=l.courts.filter(e=>"available"===e.status&&l.courtSettings.visibleCourts.includes(e.id)&&"league"!==e.courtMode);t>=2?s.forEach(e=>{"doubles"!==e.courtMode&&(e.courtMode="doubles")}):n>=4*e?s.forEach(e=>{"doubles"!==e.courtMode&&(e.courtMode="doubles")}):n>=(e-1)*4?s.forEach(e=>{"A"===e.id&&"doubles"!==e.courtMode?e.courtMode="doubles":"E"===e.id&&"rookie"!==e.courtMode&&(e.courtMode="rookie")}):s.forEach(e=>{"A"===e.id&&"singles"!==e.courtMode?e.courtMode="singles":"E"===e.id&&"rookie"!==e.courtMode&&(e.courtMode="rookie")}),n4()}function sD(){let e=ts.dataset.courtId,t=l.courts.find(t=>t.id===e),a=ts.dataset.winner;if(!t||!a)return;let n=n3(t.teams.team1),s=n3(t.teams.team2),i={id:Date.now(),court:t.id,startTime:t.gameStartTime,endTime:Date.now(),duration:document.getElementById(`timer-${t.id}`).textContent,teams:{team1:n,team2:s},score:null,winner:a};l.gameHistory.push(i);let r=[..."team1"===a?t.teams.team1:t.teams.team2,..."team1"===a?t.teams.team2:t.teams.team1].filter(e=>!e.guest);l.availablePlayers.push(...r),iI(t.id),ts.classList.add("hidden"),sO(!1)}function iI(e){let t=l.courts.find(t=>t.id===e);t&&(t.status="available",t.players=[],t.teams={team1:[],team2:[]},t.gameMode=null,t.gameStartTime=null,t.queueSnapshot=null,t.becameAvailableAt=Date.now(),l.tempDutyHandover&&l.tempDutyHandover.originalMember&&!l.courts.some(e=>"in_progress"===e.status&&e.players.some(e=>e.name===l.tempDutyHandover.originalMember))&&l.tempDutyHandover&&l.tempDutyHandover.originalMember&&(l.onDuty=l.tempDutyHandover.originalMember,l.tempDutyHandover=null,n4(),l9()),l1(),iE(),iS(),l9(),n4(),sO(!1))}function s$(){let e=ts.dataset.courtId,t=l.courts.find(t=>t.id===e);if(!t)return;let a=n3(t.teams.team1),n=n3(t.teams.team2),s={id:Date.now(),court:t.id,startTime:t.gameStartTime,endTime:Date.now(),duration:document.getElementById(`timer-${t.id}`).textContent,teams:{team1:a,team2:n},score:null,winner:"skipped"};l.gameHistory.push(s);let i=[...t.players].filter(e=>!e.guest);l.availablePlayers.push(...i),iI(t.id),ts.classList.add("hidden"),sO(!1)}function iw(e){return e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}function i$(){iD()}function iD(){console.log("--- generateChildField START ---");let e=Date.now(),t=document.createElement("div");t.className="child-field-group",t.dataset.groupId=e,t.dataset.complete="false",console.log("generateChildField: Created fieldGroup element:",t);let a=V.value.trim();t.innerHTML=`
            <div class="child-collapsed-display collapsed-area hidden"></div>
            <div class="child-expanded-fields">
                <div style="display: block;">
                    <div class="child-name-input score-input-area" style="flex-direction: column; align-items: stretch; width: 100%;">
                        <label for="child-name-${e}">Child First Name:</label>
                        <input type="text" id="child-name-${e}" name="childName" readonly placeholder="Tap to enter name" style="width: 100%;">
                    </div>
                    <div class="child-surname-container score-input-area" style="flex-direction: column; align-items: stretch; width: 100%;">
                        <label for="child-surname-${e}">Child Surname:</label>
                        <input type="text" id="child-surname-${e}" name="childSurname" readonly placeholder="Tap to enter surname" style="width: 100%;" data-autofill-surname="${a}">
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem; margin-top: 0.5rem; width: 100%;">
                    <div class="child-dob-input score-input-area" style="flex-direction: column; align-items: stretch; flex: 1; min-width: 0; position: relative;">
                        <label for="child-dob-${e}">Birth Date:</label>
                        <div class="date-time-input-wrapper">
                            <input type="date" id="child-dob-${e}" name="childBirthDate">
                            <div class="date-time-overlay" id="child-dob-${e}-overlay">
                                <span class="part empty" data-part="YYYY">yyyy</span><span class="separator">/</span><span class="part empty" data-part="MM">mm</span><span class="separator">/</span><span class="part empty" data-part="DD">dd</span>
                            </div>
                        </div>
                    </div>
                    <div class="gender-selector score-input-area" style="flex-direction: column; align-items: stretch; flex: 1; min-width: 0;">
                        <label>Gender:</label>
                        <div class="radio-group" style="background-color: transparent; border: 1px solid var(--border-color); border-radius: 5px; height: 100%; box-sizing: border-box; display: flex; align-items: center; justify-content: space-around; padding: 0.25rem 0.5rem;">
                            <label><input type="radio" name="child-gender-${e}" value="M"> Male</label>
                            <label><input type="radio" name="child-gender-${e}" value="F"> Female</label>
                        </div>
                    </div>
                </div>
            </div>
        `;let n=t.querySelector('[name="childName"]'),l=t.querySelector('[name="childSurname"]'),s=t.querySelector('[name="childBirthDate"]');n.addEventListener("click",e=>lc(e.target,"LetterPad","")),l.addEventListener("click",e=>lc(e.target,"LetterPad","")),s.addEventListener("change",function(a){let n=t.querySelector(`#child-dob-${e}-overlay`);if(!n)return;let l=a.target.value;if(l){let[e,t,a]=l.split("-"),s=n.querySelectorAll(".part");s[0].textContent=e,s[0].classList.remove("empty"),s[0].classList.add("filled"),s[1].textContent=t,s[1].classList.remove("empty"),s[1].classList.add("filled"),s[2].textContent=a,s[2].classList.remove("empty"),s[2].classList.add("filled")}});let i=()=>{iN(t),ij(!1),iW()};n.addEventListener("input",i),l.addEventListener("input",i),s.addEventListener("change",i),t.querySelectorAll('input[name^="child-gender"]').forEach(e=>{e.addEventListener("change",i)}),n.addEventListener("input",()=>{let e=l.dataset.autofillSurname;e&&n.value.trim().length>0&&0===l.value.trim().length?(l.value=e,l.dispatchEvent(new Event("input",{bubbles:!0}))):0===n.value.trim().length&&(l.value="",l.dispatchEvent(new Event("input",{bubbles:!0})))});let r=t.querySelector(".child-collapsed-display");r.addEventListener("click",e=>{(e.target.closest(".collapsed-area")||e.target.closest(".edit-icon"))&&(t.dataset.complete="false",iW())}),r.dataset.listenerBound="true";let o=document.getElementById("children-container");o?(console.log("generateChildField: Appending fieldGroup to #children-container:",o),o.appendChild(t)):console.error("generateChildField: #children-container NOT FOUND!"),console.log("--- generateChildField END ---"),i()}function iM(e){R.querySelector("h3").textContent="Edit Parent Profile",R.dataset.mode="edit",R.dataset.originalParentId=e.id,W.textContent="Save Changes",U.value=e.name,V.value=e.surname,Y.value=e.phone||"",J.innerHTML="",e.registeredChildren.forEach(e=>{iD();let t=J.lastElementChild;if(t){t.querySelector('[name="childName"]').value=e.name,t.querySelector('[name="childSurname"]').value=e.surname,t.querySelector('[name="childBirthDate"]').value=e.birthDate;let a=t.querySelector(`input[name^="child-gender"][value="${e.gender}"]`);a&&(a.checked=!0),iN(t)}}),l.juniorClub.registrationFlow={parentCollapsed:!0,childrenExpanded:!0},F.classList.add("hidden"),R.classList.remove("hidden"),iz()}function iB(){iT(),F.classList.add("hidden"),ev.classList.remove("hidden")}function iT(){ef.innerHTML="";let{sortKey:e,sortOrder:t,type:a}=l.juniorClub.rosterFilter,n=[];"parents"===a?l.juniorClub.parents.forEach(e=>{let t=0;e.registeredChildren.forEach(e=>{let a=`${e.name} ${e.surname}`.trim(),n=l2(a);n>t&&(t=n)}),n.push({isParentOnlyView:!0,id:e.id,name:`${e.name} ${e.surname}`,phone:e.phone||"N/A",email:e.email||"N/A",lastCheckInMs:t})}):"all"===a?l.juniorClub.parents.forEach(e=>{e.registeredChildren.forEach(t=>{let a=`${t.name} ${t.surname}`.trim(),l=sA(t.birthDate);n.push({isAllView:!0,id:a,parentName:`${e.name} ${e.surname}`,childData:{name:a,age:l,ageDisplay:null!==l?`${l}y`:"N/A",gender:t.gender||"?"},lastCheckInMs:l2(a)})})}):l.juniorClub.parents.forEach(e=>{e.registeredChildren.forEach(e=>{let t=`${e.name} ${e.surname}`.trim(),a=sA(e.birthDate);n.push({isChildrenView:!0,id:t,name:`${e.name} ${e.surname}`,age:a,ageDisplay:null!==a?`${a}y`:"N/A",gender:e.gender||"?",lastCheckInMs:l2(t)})})}),n.sort((a,n)=>{let l=0,s=a.isParentOnlyView?a.name:a.isAllView?a.childData.name:a.name,i=n.isParentOnlyView?n.name:n.isAllView?n.childData.name:n.name;return"name"===e?l=s.localeCompare(i):"last_checkin"===e&&(l=a.lastCheckInMs-n.lastCheckInMs),"asc"===t?l:-l});let s=`
            <div class="list-filter-header" style="text-align: center;">
                <div class="radio-group" id="roster-type-filter-group" style="display: flex; gap: 2rem; justify-content: center; background-color: transparent;">
                    <label> <input type="radio" name="roster-type-filter" value="all" ${"all"===a?"checked":""}> All</label>
                    <label> <input type="radio" name="roster-type-filter" value="parents" ${"parents"===a?"checked":""}> Parents Only</label>
                    <label> <input type="radio" name="roster-type-filter" value="children" ${"children"===a?"checked":""}> Children Only</label>
                </div>
            </div>
        `;ef.insertAdjacentHTML("afterbegin",s),ef.querySelector("#roster-type-filter-group").addEventListener("change",ix);let i=n.map(e=>({name:e.isParentOnlyView?e.name:e.isAllView?e.childData.name:e.name}));if(0===n.length){document.getElementById("junior-club-roster-abc-index").innerHTML="",ef.insertAdjacentHTML("beforeend",'<li class="waiting-message">No members match the current filters.</li>');return}ef.rosterData=n;let r=e=>l.juniorClub.rosterFilter.sortKey!==e?" ":"asc"===t?" \uD83D\uDD3C":" \uD83D\uDD3D",o="background: none; color: var(--dark-text); border: none; padding: 0.5rem; min-width: 0; line-height: 1.2; font-weight: bold; font-size: calc(0.8rem * var(--font-size-multiplier));",d="";d="parents"===a?`<div class="history-item roster-header" style="padding: 0.5rem 1rem;">
                <div class="roster-row">
                    <button class="action-btn roster-sort-btn roster-col-name" data-sort-key="name" style="${o} flex: 2.5; text-align: left;">Parent Name${r("name")}</button>
                    <span class="roster-col-contact" style="color: var(--dark-text); font-weight: bold; flex: 1; text-align: center; font-size: calc(0.8rem * var(--font-size-multiplier));">Contact</span>
                    <span class="roster-col-email" style="color: var(--dark-text); font-weight: bold; flex: 1.5; text-align: center; font-size: calc(0.8rem * var(--font-size-multiplier));">Email</span>
                    <button class="action-btn roster-sort-btn roster-col-checkin" data-sort-key="last_checkin" style="${o} flex: 1; text-align: center;">Last<br>Check-In${r("last_checkin")}</button>
                </div></div>`:`<div class="history-item roster-header" style="padding: 0.5rem 1rem;">
                <div class="roster-row">
                    <button class="action-btn roster-sort-btn roster-col-name" data-sort-key="name" style="${o} flex: 2.5; text-align: left;">${"all"===a?"Parent / Child":"Name"}${r("name")}</button>
                    <button class="action-btn roster-sort-btn roster-col-gender" data-sort-key="gender" style="${o} flex: 1; text-align: center;">Gender${r("gender")}</button>
                    <button class="action-btn roster-sort-btn roster-col-age" data-sort-key="age" style="${o} flex: 1; text-align: center;">Age${r("age")}</button>
                    <button class="action-btn roster-sort-btn roster-col-checkin" data-sort-key="last_checkin" style="${o} flex: 1; text-align: center;">Last<br>Check-In${r("last_checkin")}</button>
                </div></div>`,ef.insertAdjacentHTML("beforeend",d),n.forEach((e,t)=>{let a=document.createElement("li");a.className="roster-item",a.dataset.rosterIndex=t;let n=e.isParentOnlyView?e.name:e.isAllView?e.childData.name:e.name;a.dataset.playerName=n;let l=e.lastCheckInMs>0?new Date(e.lastCheckInMs).toLocaleDateString("en-ZA"):"N/A",s="min-width: 0; text-align: center;";e.isParentOnlyView?a.innerHTML=`<div class="roster-row">
                        <span class="roster-col-name" style="font-weight: 700; color: var(--primary-blue); flex: 2.5; text-align: left;">${e.name}</span>
                        <span class="roster-col-contact" style="color: var(--neutral-color); ${s} flex: 1;">${e.phone}</span>
                        <span class="roster-col-email" style="color: var(--neutral-color); ${s} flex: 1.5; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${e.email}</span>
                        <span class="roster-col-checkin" style="font-size: 0.85em; color: var(--neutral-color); font-weight: 500; ${s} flex: 1;">${l}</span>
                    </div>`:e.isAllView?a.innerHTML=`<div class="roster-row">
                        <div class="roster-col-name" style="display: flex; flex-direction: column; flex: 2.5; text-align: left;">
                            <span style="font-weight: 700; color: var(--primary-blue);">${e.parentName}</span>
                            <span style="font-size: 0.9em; color: var(--dark-text); padding-left: 1rem;">${e.childData.name}</span>
                        </div>
                        <span class="roster-col-gender" style="color: var(--neutral-color); ${s} flex: 1;">${e.childData.gender}</span>
                        <span class="roster-col-age" style="color: var(--neutral-color); ${s} flex: 1;">${e.childData.ageDisplay}</span>
                        <span class="roster-col-checkin" style="font-size: 0.85em; color: var(--neutral-color); font-weight: 500; ${s} flex: 1;">${l}</span>
                    </div>`:(a.style.padding="0.8rem 1rem",a.innerHTML=`<div class="roster-row">
                        <span class="roster-col-name" style="font-weight: 700; color: var(--dark-text); flex: 2.5; text-align: left;">${e.name}</span>
                        <span class="roster-col-gender" style="color: var(--neutral-color); ${s} flex: 1;">${e.gender}</span>
                        <span class="roster-col-age" style="color: var(--neutral-color); ${s} flex: 1;">${e.ageDisplay}</span>
                        <span class="roster-col-checkin" style="font-size: 0.85em; color: var(--neutral-color); font-weight: 500; ${s} flex: 1;">${l}</span>
                    </div>`),ef.appendChild(a)}),ef.querySelectorAll(".roster-sort-btn").forEach(e=>{e.removeEventListener("click",iA),e.addEventListener("click",iA)}),lN(i,ef,document.getElementById("junior-club-roster-abc-index"))}function ix(e){l.juniorClub.rosterFilter.type=e.target.value,n4(),iT()}function iA(e){let t=e.target.closest("[data-sort-key]");if(!t)return;let a=t.dataset.sortKey;a&&(l.juniorClub.rosterFilter.sortKey===a?l.juniorClub.rosterFilter.sortOrder="asc"===l.juniorClub.rosterFilter.sortOrder?"desc":"asc":(l.juniorClub.rosterFilter.sortKey=a,l.juniorClub.rosterFilter.sortOrder="name"===a?"asc":"desc"),n4(),iT())}function iP(e){let t=e.querySelector('[name="childName"]').value.trim(),a=e.querySelector('[name="childSurname"]').value.trim(),n=e.querySelector('[name="childBirthDate"]').value,l=e.querySelector('input[name^="child-gender"]:checked');return t.length>0&&a.length>0&&!!n&&!!l}function iN(e){let t=iP(e);e.dataset.complete=t?"true":"false"}function iO(e){es.innerHTML="",ea.dataset.parentId=e.id,ea.querySelector("h3").textContent=`${e.name} ${e.surname}'s Children`,[...l.availablePlayers.filter(e=>e.isJunior).map(e=>e.name),...l.courts.flatMap(e=>e.players).filter(e=>e.isJunior).map(e=>e.name),...l.juniorClub.activeChildren.map(e=>e.name)],e.registeredChildren.forEach(e=>{let t=document.createElement("li"),a=`${e.name} ${e.surname}`.trim();t.innerHTML=`
                <label style="flex-grow: 1; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="attendingChild" value="${a}" data-child-name="${e.name}" style="margin-right: 1rem;">
                    <div style="flex-grow: 1;">
                        <span style="font-weight: 500;">${e.name} ${e.surname}</span>
                    </div>
                </label>
            `,es.appendChild(t)}),en.disabled=!0,en.textContent="Check In (0 Children)",F.classList.add("hidden"),ea.classList.remove("hidden")}function iH(){j.innerHTML="";let e=l.juniorClub.checkInFilter.displayMode,t=`
            <div class="list-filter-header" style="text-align: center;">
                <div class="radio-group" id="junior-club-name-filter-group" style="display: flex; gap: 2rem; justify-content: center; background-color: transparent;">
                    <label> <input type="radio" name="junior-club-name-filter" value="parent" ${"parent"===e?"checked":""}> Parent Name</label>
                    <label> <input type="radio" name="junior-club-name-filter" value="child" ${"child"===e?"checked":""}> Child Name</label>
                </div>
            </div>
        `;j.insertAdjacentHTML("afterbegin",t),j.querySelector("#junior-club-name-filter-group").addEventListener("change",iF);let a=new Set(l.juniorClub.activeChildren.map(e=>e.name)),n=[];l.juniorClub.parents.forEach(t=>{t.registeredChildren.forEach(l=>{let s=`${l.name} ${l.surname}`.trim(),i=a.has(s),r=sA(l.birthDate),o=l.gender||"?",d=null!==r?`${r}y`:"N/A",c={parent:t,childFullName:s,childName:l.name,childSurname:l.surname,childDisplay:`${l.name.split(" ")[0]} (${d} ${o})`,canCheckIn:!i,sortKey:"parent"===e?t.name:l.name};n.push(c)})});let s=[];if(0===(s="parent"===e?l.juniorClub.parents.filter(e=>e.registeredChildren.some(e=>!a.has(`${e.name} ${e.surname}`.trim()))).sort((e,t)=>e.name.localeCompare(t.name)).map(e=>{let t=e.registeredChildren.find(e=>!a.has(`${e.name} ${e.surname}`.trim()))||e.registeredChildren[0],n=sA(t.birthDate),l=t.gender||"?",s=null!==n?`${n}y`:"N/A",i=e.registeredChildren.filter(e=>!a.has(`${e.name} ${e.surname}`.trim())).length;return{parent:e,primaryDisplay:`${e.name} ${e.surname}`,secondaryDisplay:`${t.name.split(" ")[0]} (${s} ${l})`,childCount:i,sortKey:e.name,canCheckIn:!0}}):n.filter(e=>e.canCheckIn).sort((e,t)=>e.sortKey.localeCompare(t.sortKey)).map(e=>({parent:e.parent,primaryDisplay:`${e.childName} ${e.childSurname}`,secondaryDisplay:`Parent: ${e.parent.name} ${e.parent.surname}`,sortKey:e.sortKey,canCheckIn:!0}))).length){let e=document.createElement("li");e.style.justifyContent="center",e.style.textAlign="center",e.style.color="#6c757d",e.textContent="All junior players are currently checked in.",j.appendChild(e)}else s.forEach(t=>{let n=t.parent,l=document.createElement("li"),s=n.registeredChildren.some(e=>!a.has(`${e.name} ${e.surname}`.trim())),i="parent"===e&&t.childCount>0?`${t.childCount} Child${1===t.childCount?"":"ren"}`:"",r=s?`<span class="action-icon add" data-parent-id="${n.id}">+</span>`:`<span class="action-icon" data-parent-id="${n.id}" style="color: var(--neutral-color); opacity: 0.5;">+</span>`;l.innerHTML=`
                    <span style="flex-grow: 1; font-weight: 500; display: flex; flex-direction: column;">
                        <span style="font-weight: 500;">${t.primaryDisplay}</span>
                        <span style="font-size: 0.9em; color: #6c757d;">${t.secondaryDisplay}</span>
                    </span>
                    <span style="margin-right: 1rem; color: #6c757d; min-width: 70px; text-align: right;">${i}</span>
                    <span class="action-icon edit" data-parent-id="${n.id}" title="Edit Parent"><i class="mdi mdi-pencil"></i></span>
                    ${r}
                `,l.dataset.parentId=n.id,l.dataset.playerName=t.primaryDisplay,j.appendChild(l)});lN(s.map(e=>({name:e.primaryDisplay})),j,document.getElementById("junior-club-abc-index"))}function iq(){iH(),nY("mobile-junior-club-btn"),F.classList.remove("hidden")}function iF(e){l.juniorClub.checkInFilter.displayMode=e.target.value,n4(),iH()}function iO(e){es.innerHTML="",ea.dataset.parentId=e.id,ea.querySelector("h3").textContent=`${e.name} ${e.surname}'s Children`,[...l.availablePlayers.filter(e=>e.isJunior).map(e=>e.name),...l.courts.flatMap(e=>e.players).filter(e=>e.isJunior).map(e=>e.name),...l.juniorClub.activeChildren.map(e=>e.name)],e.registeredChildren.forEach(e=>{let t=document.createElement("li"),a=`${e.name} ${e.surname}`.trim();t.innerHTML=`
                <label style="flex-grow: 1; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="attendingChild" value="${a}" data-child-name="${e.name}" style="margin-right: 1rem;">
                    <div style="flex-grow: 1;">
                        <span style="font-weight: 500;">${e.name} ${e.surname}</span>
                    </div>
                </label>
            `,es.appendChild(t)}),en.disabled=!0,en.textContent="Check In (0 Children)",F.classList.add("hidden"),ea.classList.remove("hidden")}function ij(e=!0){let t=U.value.trim(),a=V.value.trim(),n=Z.value.trim(),s=Y.value.trim(),i=n.includes("@")&&n.indexOf("@")>0&&n.indexOf("@")<n.length-1,r=t.length>0&&a.length>0&&i&&s.length>=8,o=J.querySelectorAll(".child-field-group"),d=o.length>0,c=document.getElementById("add-child-btn"),m=document.getElementById("remove-child-btn-main"),u=o.length>0?o[o.length-1]:null;o.forEach(e=>{iP(e)||(d=!1)}),l.juniorClub.registrationFlow.parentCollapsed=r,l.juniorClub.registrationFlow.childrenExpanded=r;let g=r&&(!u||iP(u)),p=o.length>1;c&&(c.style.display=r?"block":"none",c.disabled=!g),m&&(m.style.display=r&&o.length>0?"block":"none",m.disabled=!p);let y=r&&d;W.disabled=!y,y?(W.style.setProperty("background-color","var(--confirm-color)","important"),W.style.setProperty("border-color","var(--confirm-color)","important")):(W.style.setProperty("background-color","var(--inactive-color)","important"),W.style.setProperty("border-color","var(--inactive-color)","important")),e&&iz()}function i_(){let e=ea.dataset.parentId,t=l.juniorClub.parents.find(t=>t.id===e);if(!t)return;let a=Array.from(es.querySelectorAll('input[name="attendingChild"]:checked')).map(e=>e.value);if(0===a.length)return;let n=t.registeredChildren.filter(e=>a.includes(`${e.name} ${e.surname}`.trim())).map(e=>({name:`${e.name} ${e.surname}`.trim(),gender:e.gender,guest:!0,isJunior:!0,parentName:t.name+" "+t.surname})),s=new Set([...l.availablePlayers.map(e=>e.name),...l.courts.flatMap(e=>e.players).map(e=>e.name),...l.juniorClub.activeChildren.map(e=>e.name)]),i=n.filter(e=>!s.has(e.name));if(0===i.length){ea.classList.add("hidden"),iq();return}l.juniorClub.activeChildren.push(...i);let r={id:Date.now(),parentId:t.id,parentName:`${t.name} ${t.surname}`,childNames:i.map(e=>e.name),date:new Date().toISOString().split("T")[0],isPaid:!1};l.juniorClub.history.push(r),ea.classList.add("hidden"),i.length,iq(),n4()}function iG(){F.classList.add("hidden"),er.classList.remove("hidden"),ec.disabled=!0,ec.style.backgroundColor="var(--inactive-color)",iR()}function iR(){eo.innerHTML="";let e=l.juniorClub.statsFilter.paid,t=`
            <div class="list-filter-header" style="text-align: center;">
                <div class="radio-group" id="payment-filter-group" style="display: flex; gap: 2rem; justify-content: center; background-color: transparent;">
                    <label> <input type="radio" name="payment-filter" value="all" ${"all"===e?"checked":""}> All</label>
                    <label> <input type="radio" name="payment-filter" value="paid" ${"paid"===e?"checked":""}> Paid</label>
                    <label> <input type="radio" name="payment-filter" value="unpaid" ${"unpaid"===e?"checked":""}> Unpaid</label>
                </div>
            </div>
        `;eo.insertAdjacentHTML("afterbegin",t),eo.querySelector("#payment-filter-group").addEventListener("change",iU);let a=l.juniorClub.history.filter(t=>"all"===e||("paid"===e?!0===t.isPaid:"unpaid"!==e||!1===t.isPaid)).sort((e,t)=>t.id-e.id),n=a.map(e=>({name:e.parentName}));if(0===a.length){document.getElementById("junior-club-history-abc-index").innerHTML="",eo.insertAdjacentHTML("beforeend",'<li class="waiting-message">No history matches the current filter.</li>');return}a.forEach(e=>{let t=document.createElement("li");t.className="history-item",t.dataset.entryId=e.id,t.dataset.playerName=e.parentName;let a=e.isPaid?"Paid":"Unpaid",n=e.isPaid?"paid":"unpaid",l=e.childNames.join(", "),s=new Date(e.id).toLocaleDateString("en-ZA");t.innerHTML=`
                <div class="name-col">
                    <span style="font-weight: 500; color: var(--dark-text);">${e.parentName}</span>
                    <span style="font-weight: 400; color: var(--dark-text); font-size: 0.95em; padding-left: 1rem;">${l}</span>
                </div>
                <div class="status-col">
                    <span class="payment-status ${n}">${a}</span>
                    <span class="payment-date-text" style="font-size: 0.85em; color: var(--neutral-color); display: block;">${s}</span>
                </div>
            `,eo.appendChild(t)}),lN(n,eo,document.getElementById("junior-club-history-abc-index"))}function iz(){let{parentCollapsed:e,childrenExpanded:t}=l.juniorClub.registrationFlow;console.log("Rendering Form - State Read:",{parentCollapsed:e,childrenExpanded:t});let a=document.getElementById("parent-fields"),n=document.getElementById("parent-collapsed-display"),s=R.querySelector("h4"),i=document.getElementById("children-container-wrapper"),r=document.getElementById("children-container");if(n){let t=!e;console.log(`Parent Summary (#parent-collapsed-display): Setting hidden=${t}`),n.classList.toggle("hidden",t),requestAnimationFrame(()=>console.log(`Parent Summary computed display: ${window.getComputedStyle(n).display}`))}else console.error("ELEMENT NOT FOUND: #parent-collapsed-display");if(a){let t=e?"none":"block";console.log(`Parent Fields (#parent-fields): Setting display=${t}`),a.style.display=t,requestAnimationFrame(()=>console.log(`Parent Fields computed display: ${window.getComputedStyle(a).display}`))}else console.error("ELEMENT NOT FOUND: #parent-fields");if(e&&n){console.log("Populating parent summary...");let e=document.getElementById("parent-name-input")?.value.trim(),t=document.getElementById("parent-surname-input")?.value.trim(),a=document.getElementById("parent-email-input")?.value.trim(),s=document.getElementById("parent-phone-input")?.value.trim();n.innerHTML=`
                <div class="collapsed-summary">
                    <span>${e||"?"} ${t||"?"}</span>
                    <span>${a||"?"} | ${s||"?"}</span>
                </div>
                <i class="mdi mdi-pencil edit-icon"></i>
            `,n.dataset.listenerBound||(n.addEventListener("click",e=>{(e.target.closest(".collapsed-summary")||e.target.closest(".edit-icon"))&&(l.juniorClub.registrationFlow.parentCollapsed=!1,iz())}),n.dataset.listenerBound="true")}if(s){let e=!t;console.log(`Children Header (h4): Setting hidden=${e}`),s.classList.toggle("hidden",e)}else console.warn("Children header (h4) not found within newParentModal.");if(i){let e=t?"block":"none";console.log(`Children Wrapper (#children-container-wrapper): Setting display=${e}`),i.style.display=e,requestAnimationFrame(()=>console.log(`Children Wrapper computed display: ${window.getComputedStyle(i).display}`))}else console.error("ELEMENT NOT FOUND: #children-container-wrapper");if(t)if(r){let a=r.querySelectorAll(".child-field-group").length;console.log(`Checking if first child needed. childrenExpanded=${t}, childGroupCount=${a}, parentCollapsed=${e}`),0===a&&e?(console.log("Condition met: Generating first child field..."),iD()):0!==a||e?console.log("Skipping child generation: Child fields already exist."):console.log("Skipping child generation: Parent not collapsed yet."),iW()}else console.error("ELEMENT NOT FOUND: #children-container. Cannot add child fields.");else console.log("Skipping child generation/rendering: childrenExpanded is false.")}function iW(){let e=document.getElementById("children-container");if(!e)return void console.error("renderChildFields: #children-container not found!");let t=e.querySelectorAll(".child-field-group");console.log(`--- renderChildFields START --- Found ${t.length} child groups.`),t.forEach((e,t)=>{let a="true"===e.dataset.complete,n=e.querySelector(".child-collapsed-display"),l=e.querySelector(".child-expanded-fields");if(console.log(`Group ${t+1}: isComplete=${a}`),n||console.error(`Group ${t+1}: '.child-collapsed-display' element NOT FOUND!`),l||console.error(`Group ${t+1}: '.child-expanded-fields' element NOT FOUND!`),n&&n.classList.toggle("hidden",!a),l&&(a?(console.log(`Group ${t+1}: Hiding expanded fields.`),l.style.display="none"):(console.log(`Group ${t+1}: Setting expanded fields display to 'block'.`),l.style.display="block",requestAnimationFrame(()=>{let e=window.getComputedStyle(l).display;console.log(`Group ${t+1} expanded computed display: ${e}`),"block"!==e&&console.warn(`CSS might be overriding display for Group ${t+1}`)}))),a&&n){let t=e.querySelector('[name="childName"]')?.value.trim(),a=e.querySelector('[name="childSurname"]')?.value.trim(),l=e.querySelector('[name="childBirthDate"]')?.value,s=e.querySelector('input[name^="child-gender"]:checked'),i=s?s.value:"?",r=sA(l),o=null!==r?`${r}y`:"N/A";n.innerHTML=`
                    <span class="collapsed-title">${t||"?"} ${a||"?"}</span>
                    <span class="collapsed-detail">${o} (${"M"===i?"Male":"F"===i?"Female":"N/A"})</span>
                    <i class="mdi mdi-pencil edit-icon"></i>
                `,n.dataset.listenerBound||(n.addEventListener("click",t=>{(t.target.closest(".collapsed-area")||t.target.closest(".edit-icon"))&&(e.dataset.complete="false",iW())}),n.dataset.listenerBound="true")}}),console.log("--- renderChildFields END ---"),ij(!1)}function iU(e){l.juniorClub.statsFilter.paid=e.target.value,iR(),n4()}function iV(e){let t=e.isPaid;eg.textContent=t?"Mark as Unpaid":"Mark as Paid",eg.style.backgroundColor=t?"var(--cancel-color)":"var(--confirm-color)"}eS.addEventListener("click",()=>{eL.classList.add("hidden"),eL.callback=null}),eI.addEventListener("click",function(){let e=ek.querySelector('input[name="tempDutyMember"]:checked');if(!e)return;let t=e.value,n=l.onDuty;l.tempDutyHandover||(l.tempDutyHandover={originalMember:n,tempMember:t,timestamp:Date.now()}),l.onDuty=t;let s=a(n);if("None"===t)sP(`There will be nobody on duty while ${s} is in a match.`);else{let e=a(t);sP(`${e} is temporarily on duty while ${s} is in a match.`)}eL.classList.add("hidden"),eL.callback&&(eL.callback(),eL.callback=null),n4(),l9()}),document.getElementById("remove-child-btn-main").addEventListener("click",()=>{let e=J.querySelectorAll(".child-field-group");if(e.length>1)!function(){let e=J.querySelectorAll(".child-field-group");e.length<=1||(X.innerHTML="",Q.dataset.selectedGroups="",e.forEach((e,t)=>{let a=e.dataset.groupId,n=e.querySelector('[name="childName"]').value.trim(),l=e.querySelector('[name="childSurname"]').value.trim(),s=n||l?`${n} ${l}`.trim():`Child ${t+1} (Empty)`,i=document.createElement("li");i.innerHTML=`
                <label style="flex-grow: 1; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="childToRemove" value="${a}" style="margin-right: 1rem;">
                    <div style="flex-grow: 1;">
                        <span style="font-weight: 500;">${s}</span>
                    </div>
                </label>
            `,X.appendChild(i)}),et.disabled=!0,et.textContent="Remove Selected (0 Children)",R.classList.add("hidden"),Q.classList.remove("hidden"))}();else if(1===e.length){let t=e[0],a=t.querySelector('[name="childName"]').value.trim()||"this child";eX.querySelector("h3").textContent="Confirm Removal",eX.querySelector("p").textContent=`Are you sure you want to remove ${a}?`,e0.textContent="Confirm",e1.textContent="Close",eX.dataset.mode="removeSingleChild",eX.dataset.childGroupId=t.dataset.groupId,R.classList.add("hidden"),eX.classList.remove("hidden")}}),ee.addEventListener("click",()=>{Q.classList.add("hidden"),R.classList.remove("hidden")}),et.addEventListener("click",function(){let e=Array.from(X.querySelectorAll('input[name="childToRemove"]:checked')).map(e=>e.value);0!==e.length&&(e.forEach(e=>{let t=document.querySelector(`.child-field-group[data-group-id="${e}"]`);t&&t.remove()}),0===J.querySelectorAll(".child-field-group").length&&iD(),Q.classList.add("hidden"),R.classList.remove("hidden"),ij())}),X.addEventListener("change",()=>{let e=X.querySelectorAll('input[name="childToRemove"]:checked').length,t=e>0;et.disabled=!t,et.textContent=`Remove Selected (${e} Child${1===e?"":"ren"})`,t?(et.style.setProperty("background-color","white","important"),et.style.setProperty("color","var(--primary-blue)","important"),et.style.setProperty("border","2px solid var(--primary-blue)","important")):(et.style.setProperty("background-color","var(--neutral-color)","important"),et.style.setProperty("color","white","important"),et.style.setProperty("border","2px solid var(--neutral-color)","important"))}),document.addEventListener("click",s4),document.addEventListener("touchstart",s4),document.addEventListener("mousemove",s4),document.addEventListener("keydown",s4),A.addEventListener("click",e=>{if(e.target.closest("#screensaver-interested-btn")){let t=e.target.closest("#screensaver-interested-btn"),a=t?t.dataset.eventId:null;a&&(iy(),e2.style.zIndex=1e4,e2.classList.remove("hidden"),e2.dataset.screensaverEventId=a)}else s0()}),document.getElementById("manage-events-btn")?.addEventListener("click",s1),document.getElementById("close-event-list-btn")?.addEventListener("click",()=>{document.getElementById("event-list-modal")?.classList.add("hidden"),tW.classList.remove("hidden")}),document.getElementById("create-new-event-btn")?.addEventListener("click",()=>{document.getElementById("event-list-modal")?.classList.add("hidden"),s5()}),document.getElementById("event-list")?.addEventListener("click",e=>{let t=e.target.closest(".edit-event-btn"),a=e.target.closest(".delete-event-btn"),n=e.target.closest(".event-active-toggle"),s=e.target.closest(".event-list-item"),i=s?s.dataset.eventId:null;if(t&&i)document.getElementById("event-list-modal")?.classList.add("hidden"),s5(i);else if(a&&i)!function(e){let t=l.events.find(t=>t.id==e);if(!t)return;let a=t.heading||"this event";confirm(`Are you sure you want to delete "${a}"?

This action cannot be undone.`)&&(l.events=l.events.filter(t=>t.id!=e),n4(),s1(),document.getElementById("screensaver-overlay").classList.contains("hidden")||(s0(),s4()))}(i);else if(n&&i){let e=l.events.find(e=>e.id==i);e&&(e.isActive=n.checked,n4(),A.classList.contains("hidden")||(s0(),s4()))}});let iJ=document.getElementById("header-logo");function iK(){let e=document.getElementById("returning-guest-list");e.innerHTML="";let t=new Set([...l.availablePlayers.map(e=>e.name),...l.courts.flatMap(e=>e.players).map(e=>e.name)]),a=l.guestHistory.filter(e=>!t.has(e.name));if(0===a.length){let t=document.createElement("li");t.textContent="All previous guests are checked in or there is no guest history.",t.style.justifyContent="center",e.appendChild(t)}else a.sort((e,t)=>e.name.localeCompare(t.name)),a.forEach(t=>{let a=document.createElement("li"),n=t.daysVisited||1;a.innerHTML=`
                    <div style="display: flex; flex-direction: column; flex-grow: 1;">
                        <span>${t.name}</span>
                        <span style="font-size: 0.8em; color: #6c757d;">${n} visit${1===n?"":"s"}</span>
                    </div>
                    <span style="margin-right: 1rem; color: #6c757d;">${t.gender}</span>
                    <span class="action-icon add" data-player="${t.name}">+</span>
                `,a.dataset.playerName=t.name,e.appendChild(a)});lN(a,e,document.getElementById("returning-guest-abc-index"))}iJ&&iJ.addEventListener("click",()=>{clearTimeout(M),M=null,sX()}),async function(){try{let e=await fetch("source/members.csv");if(!e.ok)throw Error("Could not load member list from members.csv.");let a=await e.text();t=function(e){let t=e.trim().split("\n");if(!t[0])return[];let a=t[0].split(",").map(e=>e.trim().toLowerCase()),n=[];for(let e=1;e<t.length;e++){if(!t[e])continue;let l=t[e].split(",").map(e=>e.trim());if(l.length<3)continue;let s={};a.forEach((e,t)=>{if(t>=l.length)return;let a=l[t];a&&("gender"===e?s[e]=a.charAt(0).toUpperCase():"phonetic spelling"===e?s.phoneticName=a:"guest"===e||"isPaused"===e?s[e]="true"===a.toLowerCase():s[e]=a)}),s.name&&(s.guest=s.guest||!1,s.isPaused=s.isPaused||!1,n.push(s))}return n}(a),await lo(t),l_(),l.clubMembers=[...t].sort((e,t)=>e.name.localeCompare(t.name)),l1(),iS(),l9(),API.onStateUpdate(e=>{if(console.log("\uD83D\uDD04 Real-time update received!"),g)return void console.log("⏸️ Ignoring update - local change in progress");l._isReceivingUpdate=!0;let a={mobileControls:l.mobileControls,notificationControls:l.notificationControls,uiSettings:l.uiSettings};(l={...l,...e}).mobileControls=a.mobileControls,l.notificationControls=a.notificationControls,l.uiSettings=a.uiSettings,l._isReceivingUpdate=!0;let n=new Set;Array.isArray(l.availablePlayers)&&l.availablePlayers.forEach(e=>n.add(e.name)),l.courts.forEach(e=>{Array.isArray(e.players)&&e.players.forEach(e=>n.add(e.name))}),l.clubMembers=t.filter(e=>!n.has(e.name)),l.clubMembers.sort((e,t)=>e.name.localeCompare(t.name)),l9(),setTimeout(()=>{l._isReceivingUpdate=!1},100),console.log("✅ UI updated")}),s4(),setTimeout(sh,50),sG(),lp(),ly(),lv(),lf(),l.pongAnimationOffset||(l.pongAnimationOffset=Date.now()),setInterval(()=>{ld()},1e3),sO(!1),setInterval(sO,1e4),window.statusFaderInterval||(window.statusFaderInterval=setInterval(()=>{document.querySelectorAll(".player-status-fader").forEach(e=>{let t=Array.from(e.querySelectorAll(".status-text")),a=t.findIndex(e=>e.classList.contains("is-visible"));if(-1!==a){t[a].classList.remove("is-visible");let e=(a+1)%t.length;t[e].classList.add("is-visible")}})},3e3));let n=window.innerWidth<=900;window.addEventListener("resize",()=>{let e=window.innerWidth<=900;e!==n&&location.reload(),n=e}),function(){let e=document.querySelectorAll(".long-press-paste"),t=null,a=!1;function n(e){let n=e.target;a=!1,n._clickTimeoutId&&(clearTimeout(n._clickTimeoutId),n._clickTimeoutId=null),t=setTimeout(async()=>{a=!0,console.log("Long press detected on:",n.id),n.style.backgroundColor="#a8d5ff";try{let e=await navigator.permissions.query({name:"clipboard-read"});if("granted"===e.state||"prompt"===e.state){let e=await navigator.clipboard.readText();e?(n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0})),console.log("Pasted successfully!"),sx("Pasted from clipboard.")):(console.log("Clipboard is empty."),sx("Clipboard is empty."))}else console.error("Clipboard read permission denied."),sx("Could not paste. Please allow clipboard permissions."),alert("Clipboard access denied. Please allow clipboard permissions in your browser settings for this site.")}catch(e){console.error("Failed to read clipboard contents:",e),sx("Could not paste."),alert("Failed to paste from clipboard. Error: "+e.message)}finally{setTimeout(()=>{n.style.backgroundColor=""},300),t=null}},750)}function l(e){t&&(clearTimeout(t),t=null),a||(e.target.style.backgroundColor="")}function s(e){t&&(clearTimeout(t),t=null,a=!1,e.target.style.backgroundColor="")}function i(e){e.preventDefault()}e.forEach(e=>{e.removeEventListener("pointerdown",n),e.removeEventListener("pointerup",l),e.removeEventListener("pointerleave",s),e.removeEventListener("contextmenu",i),e.addEventListener("pointerdown",n),e.addEventListener("pointerup",l),e.addEventListener("pointerleave",s),e.addEventListener("contextmenu",i)})}(),l7(),l6(),lj()}catch(e){console.error("Failed to initialize application:",e),alert('Error: Could not load master member list. Please ensure "public/source/members.csv" exists and is formatted correctly. The application cannot start.')}}(),document.getElementById("undo-history-btn")?.addEventListener("click",function(){let e=document.getElementById("undo-history-modal"),t=document.getElementById("undo-history-list");if(t.innerHTML="",0===l.undoHistory.actions.length){let e=document.createElement("li");e.className="empty-history",e.textContent="No recent actions to undo",t.appendChild(e)}else l.undoHistory.actions.forEach((e,a)=>{let n=document.createElement("li"),s=document.createElement("div");s.className="undo-history-action",s.textContent=lr(e);let i=document.createElement("div");i.className="undo-history-timestamp",i.textContent=function(e){let t=Math.floor((Date.now()-e)/1e3);if(t<60)return`${t} second${1!==t?"s":""} ago`;let a=Math.floor(t/60);if(a<60)return`${a} minute${1!==a?"s":""} ago`;let n=Math.floor(a/60);return`${n} hour${1!==n?"s":""} ago`}(e.timestamp),n.appendChild(s),n.appendChild(i),n.onclick=()=>(function(e,t){let a=function(e){let{type:t,data:a}=e;switch(t){case"team_reselection":{let{courtId:e,player1Name:t,player2Name:n}=a,s=l.courts.find(t=>t.id===e);if(!s)return{isValid:!1,reason:"Court no longer exists"};if("in_progress"!==s.status)return{isValid:!1,reason:`Court ${e} game has ended`};let i=s.players.some(e=>e.name===t),r=s.players.some(e=>e.name===n);if(!i||!r)return{isValid:!1,reason:"One or both players have left this court"};return{isValid:!0}}case"court_swap":{let{sourceCourtId:e,sourcePlayerName:t,targetCourtId:n,targetPlayerName:s}=a,i=l.courts.find(t=>t.id===e),r=l.courts.find(e=>e.id===n);if(!i||"in_progress"!==i.status)return{isValid:!1,reason:`Court ${e} game has ended`};if(!r||"in_progress"!==r.status)return{isValid:!1,reason:`Court ${n} game has ended`};let o=i.players.some(e=>e.name===t),d=r.players.some(e=>e.name===s);if(!o)return{isValid:!1,reason:`${t.split(" ")[0]} is no longer on Court ${e}`};if(!d)return{isValid:!1,reason:`${s.split(" ")[0]} is no longer on Court ${n}`};return{isValid:!0}}case"substitution":{let{courtId:e,courtPlayerName:t,availablePlayerName:n}=a,s=l.courts.find(t=>t.id===e);if(!s||"in_progress"!==s.status)return{isValid:!1,reason:`Court ${e} game has ended`};if(!s.players.some(e=>e.name===n))return{isValid:!1,reason:`${n.split(" ")[0]} is no longer on Court ${e}`};let i=l.availablePlayers.some(e=>e.name===t),r=l.courts.some(a=>a.id!==e&&a.players.some(e=>e.name===t));if(!i&&!r)return{isValid:!1,reason:`${t.split(" ")[0]} has checked out`};return{isValid:!0}}case"player_swap":{let{sourceCourt:e,sourcePlayer:t,targetCourt:n,targetPlayer:s}=a,i=l.courts.find(t=>t.id===e),r=l.courts.find(e=>e.id===n);if(!i||"in_progress"!==i.status)return{isValid:!1,reason:`Court ${e} game has ended`};if(!r||"in_progress"!==r.status)return{isValid:!1,reason:`Court ${n} game has ended`};let o=i.players.some(e=>e.name===t.name),d=r.players.some(e=>e.name===s.name);if(!o||!d)return{isValid:!1,reason:"One or both players have moved to different courts"};return{isValid:!0}}default:return{isValid:!1,reason:"Unknown action type"}}}(e);if(!a.isValid)return void alert(`Cannot undo this action:

${a.reason}

The game state has changed too much since this action occurred.`);document.getElementById("undo-history-modal").classList.add("hidden"),tb.dataset.undoActionIndex=t,tb.dataset.undoActionDescription=lr(e),il(null,{mode:"undo",title:"Enter Admin PIN to Undo"})})(e,a),t.appendChild(n)});tW.classList.add("hidden"),e.classList.remove("hidden")}),document.getElementById("undo-history-close-btn").addEventListener("click",()=>{document.getElementById("undo-history-modal").classList.add("hidden"),tW.classList.remove("hidden")}),document.getElementById("mobile-menu-bar")&&(document.getElementById("mobile-junior-club-btn").addEventListener("click",()=>{e2.classList.add("hidden"),e4.classList.add("hidden"),iq()}),document.getElementById("mobile-history-btn").addEventListener("click",()=>{l.historyViewMode="games",sr(),tt.classList.remove("hidden")}),document.getElementById("mobile-notify-btn").addEventListener("click",s_),document.getElementById("mobile-settings-btn").addEventListener("click",sq)),window.addEventListener("scroll",function(){nU||(window.requestAnimationFrame(()=>{let e=window.pageYOffset||document.documentElement.scrollTop;e<E?nW():e>E&&e>100&&(clearTimeout(p),p=setTimeout(nR,1e3)),E=e,nU=!1}),nU=!0)},{passive:!0}),document.addEventListener("touchstart",function(e){f=e.touches[0].clientY,b=!0},{passive:!0}),document.addEventListener("touchmove",function(e){b&&e.touches[0].clientY-f>50&&f<50&&(nW(),b=!1)},{passive:!0}),document.addEventListener("touchend",function(){b=!1},{passive:!0}),document.addEventListener("mousedown",function(e){nV=e.clientY,nJ=!0}),document.addEventListener("mousemove",function(e){nJ&&e.clientY-nV>50&&nV<50&&(nW(),nJ=!1)}),document.addEventListener("mouseup",function(){nJ=!1}),nz(),function(){let e=document.getElementById("header-logo"),t=document.getElementById("left-spacer"),a=document.getElementById("right-spacer");if(!e||!t||!a)return;let n=e.offsetWidth;t.style.width=`${n}px`,a.style.width=`${n}px`}(),window.addEventListener("resize",n0),eV.addEventListener("click",()=>sy("doubles")),eJ.addEventListener("click",()=>sy("singles")),eR.addEventListener("click",function(e){if(e.target.closest(".suggestion-btn")){if(l.activeSuggestion)lW();else{let e,t=l.availablePlayers.find(e=>!e.isPaused);if(!t)return;let a=l.availablePlayers.filter(e=>e.name!==t.name);l.currentSuggestionOutcome?(console.log("Using stored suggestion type:",l.currentSuggestionType),e=l.currentSuggestionOutcome):(console.log("Generating new suggestion outcome..."),e=function(e,t){let a=l.suggestionSettings,n=100*Math.random(),s=[e,...t.slice(0,4)],i=lO(),r=s.map(e=>({player:e,score:lH(e,l.gameHistory)})),o=r.find(t=>t.player.name===e.name);if(!a.powerScoreOnly&&n<a.topPlayerPercent){console.log(`Attempting Top Player H2H suggestion... (Roll: ${n.toFixed(1)} < ${a.topPlayerPercent}%)`);let t=[...r].sort((e,t)=>t.score-e.score).slice(0,4);if(4===t.length&&t.some(t=>t.player.name===e.name)){let e=t.filter(e=>"M"===e.player.gender).length,a=t.filter(e=>"F"===e.player.gender).length;if((3!==e||1!==a)&&(1!==e||3!==a))return console.log("Top Player H2H applied."),{suggestion:lz(t),type:"topPlayer"};console.log("Top Player H2H skipped due to 3:1 gender split.")}else console.log("Top Player H2H skipped: Selector not in top 4 or not enough players.")}else a.powerScoreOnly||console.log(`Top Player H2H skipped (Roll: ${n.toFixed(1)} >= ${a.topPlayerPercent}%)`);if(!a.powerScoreOnly&&n>=a.topPlayerPercent&&n<a.topPlayerPercent+a.frequentOpponentPercent){console.log(`Attempting Frequent Opponent suggestion... (Roll: ${n.toFixed(1)} in range)`);let t=function(e,t){let a={},n=0,l=null;return t.forEach(t=>{if("skipped"===t.winner||!t.teams.team1||!t.teams.team2)return;let s=t.teams.team1,i=t.teams.team2,r=[];s.includes(e)?r=i:i.includes(e)&&(r=s),r.forEach(e=>{a[e]=(a[e]||0)+1,a[e]>n&&(n=a[e],l=e)})}),n>=2?l:null}(e.name,l.gameHistory),a=r.find(e=>e.player.name===t);if(a){console.log(`Frequent Opponent (${t}) found in pool. Applying.`);let n=[e,a.player],l=r.filter(t=>t.player.name!==e.name&&t.player.name!==a.player.name).map(e=>e.player);if(l.length>=2){let t=lR(n,l,2,r,!1,"mixed",e.gender,a.player.gender);if(t&&2===t.length){if(n.push(...t),4===n.length)return{suggestion:lz(r.filter(e=>n.some(t=>t.name===e.player.name))),type:"frequentOpponent"}}else console.log("Frequent Opponent skipped: Could not find 2 balanced players to complete the team.")}else console.log("Frequent Opponent skipped: Not enough remaining players.")}else console.log("Frequent Opponent skipped: Opponent not found or not frequent enough.")}else a.powerScoreOnly||console.log(`Frequent Opponent skipped (Roll: ${n.toFixed(1)} not in range or Top Player triggered)`);let d=a.topPlayerPercent+a.frequentOpponentPercent+a.weakPlayerPercent;if(!a.powerScoreOnly&&n>=a.topPlayerPercent+a.frequentOpponentPercent&&n<d)if(console.log(`Attempting Weak Player Grouping suggestion... (Roll: ${n.toFixed(1)} in range)`),o)if(o.score<a.weakPlayerThreshold){let t=r.filter(t=>t.player.name!==e.name&&t.score<a.weakPlayerThreshold);if(t.length>=3){t.sort((e,t)=>e.score-t.score);let e=[o,...t.slice(0,3)],a=e.filter(e=>"M"===e.player.gender).length,n=e.filter(e=>"F"===e.player.gender).length;if((3!==a||1!==n)&&(1!==a||3!==n))return console.log("Weak Player Grouping applied."),{suggestion:lz(e),type:"weakPlayer"};console.log("Weak Player Grouping skipped due to 3:1 gender split.")}else console.log("Weak Player Grouping skipped: Not enough other weak players available.")}else console.log("Weak Player Grouping skipped: Selector is not weak.");else console.log("Weak Player Grouping skipped: Selector score data missing.");else a.powerScoreOnly||console.log(`Weak Player Grouping skipped (Roll: ${n.toFixed(1)} not in range or previous triggered)`);console.log("Falling back to Standard Balancing Logic.");let c=[e],m=[...r.filter(t=>t.player.name!==e.name)];if(a.prioritizeLeastPlaytime&&!a.powerScoreOnly&&m.length>0){let t=null,n="F"===e.gender,l=m.filter(e=>"F"===e.player.gender).length,s=m.filter(e=>"M"===e.player.gender).length;n&&100===a.femaleRatioPercent&&l>=3?t="F":!n&&100===a.maleRatioPercent&&s>=3&&(t="M");let r=m;if(t){let e=m.filter(e=>e.player.gender===t);e.length>0?r=e:console.warn(`Standard Balance: 100% ${"F"===t?"Female":"Male"} preference set, but no matching players in pool.`)}let o=1/0,d=null;r.forEach(e=>{let t=i[e.player.name]?.totalDurationMs||0;t<o?(o=t,d=e):t===o&&d&&m.findIndex(t=>t.player.name===e.player.name)<m.findIndex(e=>e.player.name===d.player.name)&&(d=e)}),d&&(c.push(d.player),m=m.filter(e=>e.player.name!==d.player.name))}let u=4-c.length;if(m.length<u){console.warn("Standard Balance: Not enough players remaining after least playtime selection.");let e=[...c,...m.map(e=>e.player)],t=r.filter(t=>e.some(e=>e.name===t.player.name));return t.length>=2?{suggestion:lz(t),type:"standard"}:{suggestion:null,type:null}}let g=[];if(a.powerScoreOnly)g=lR(c,m.map(e=>e.player),u,r,!0);else{let t="mixed",n="F"===e.gender,l=100*Math.random(),s=m.filter(e=>"F"===e.player.gender).length,i=m.filter(e=>"M"===e.player.gender).length;n&&s>=u?l<a.femaleRatioPercent&&(t="female"):!n&&i>=u&&l<a.maleRatioPercent&&(t="male");let o=c.length>1?c[1].gender:null;g=lR(c,m.map(e=>e.player),u,r,!1,t,e.gender,o)}if(g&&g.length===u?c.push(...g):(console.warn("Standard Balance: findBestBalancingPlayers did not return enough players."),c.push(...m.slice(0,u).map(e=>e.player))),4===c.length)return{suggestion:lz(r.filter(e=>c.some(t=>t.name===e.player.name))),type:"standard"};{console.error("Standard balance failed definitively to select 4 players.");let e=r.filter(e=>c.some(t=>t.name===e.player.name));return e.length>=2?{suggestion:lz(e),type:"standard"}:{suggestion:null,type:null}}}(t,a),l.currentSuggestionOutcome=e,l.currentSuggestionType=e.type);let n=e.suggestion;n&&n.team1&&n.team2?(l.selection.players=[...n.team1.map(e=>e.name),...n.team2.map(e=>e.name)],l.activeSuggestion=n,l9(),requestAnimationFrame(()=>{requestAnimationFrame(sh)})):(console.error("Suggestion logic failed to return a valid suggestion."),sx("Could not find a balanced game with the current players."))}return}let t=e.target.closest(".pause-toggle-btn");if(t)return void function(e){let t=e.dataset.playerName,a=e.dataset.action,n=l.availablePlayers.find(e=>e.name===t);if(!n)return;if("resume"===a&&n.pauseTime&&Date.now()-n.pauseTime<6e5){var s=6e5-(Date.now()-n.pauseTime);L&&clearInterval(L);let e=Date.now()+s;function i(){let t=e-Date.now();if(t<=0){clearInterval(L),a4.classList.add("hidden");return}let a=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3);a7.textContent=`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`}i(),L=setInterval(i,1e3),a4.classList.remove("hidden");return}let r="pause"===a?"pause":"resume",o="pause"===a?`Are you sure you want to pause your game play? You will be paused for a minimum of 10 minutes and will remain in position #${l.availablePlayers.indexOf(n)+1} until you resume.`:`Are you sure you want to resume your game play? You will be immediately restored to position #${l.availablePlayers.indexOf(n)+1}.`;eX.querySelector("h3").textContent=`Confirm ${a.charAt(0).toUpperCase()+a.slice(1)}`,eX.querySelector("p").textContent=o,e0.textContent=r.charAt(0).toUpperCase()+r.slice(1),e1.textContent="Close",eX.dataset.mode="pauseToggle",eX.dataset.player=t,eX.dataset.verb=a,eX.classList.remove("hidden")}(t);l.activeSuggestion&&lW();let a=e.target.closest("li"),n=l.availablePlayers[0]?l.availablePlayers[0].name:null;if(l.availablePlayers[0]&&l.availablePlayers[0].isPaused){let e=l.availablePlayers.find(e=>!e.isPaused);n=e?e.name:null}if(a&&a.dataset.playerName===n||!a||a.classList.contains("disabled")||a.classList.contains("waiting-message")||0===l.availablePlayers.length)return;let s=a.dataset.playerName,{players:i}=l.selection;0===i.length?s!==n?i.push(n,s):i.push(s):i.includes(s)?(i.splice(i.indexOf(s),1),1===i.length&&(l.selection.players=[])):i.length<4&&i.push(s);let{players:r}=l.selection,o=l.courts.some(e=>"available"===e.status&&"singles"===e.courtMode&&l.courtSettings.visibleCourts.includes(e.id));2===r.length&&o?"singles"!==l.selection.gameMode&&(l.selection.gameMode="singles"):"doubles"!==l.selection.gameMode&&(l.selection.gameMode="doubles"),l9(),n4();let d="doubles"===l.selection.gameMode?4:2;if(l.selection.players.length===d&&(!function(){if(window.innerWidth>=900)return;let e=se();if(e){let t=document.querySelector(`.court-card[data-court-id="${e}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}}(),window.innerWidth<900&&l.mobileControls.isPlayersExpanded)){l.mobileControls.isPlayersExpanded=!1;let e=document.getElementById("availablePlayersSection"),t=document.querySelector("#players-toggle-btn i");e&&e.classList.add("is-collapsed"),t&&(t.className="mdi mdi-chevron-down"),n4()}requestAnimationFrame(()=>{requestAnimationFrame(sh)})}),ez.addEventListener("click",function(e){let t=e.target.closest(".court-card");if(!t)return;let a=e.target.closest("[data-action]"),n=a?a.dataset.action:null,s=t.dataset.courtId,i=e.target.closest(".teams-not-set");if(i&&"default"!==i.style.cursor)return void sv(s);if("more-options"===n)return void function(e){if($){let t=l.courts.find(t=>t.id===e);t&&(t.isModeOverlayActive=!t.isModeOverlayActive,t.isModeOverlayActive&&l.courts.forEach(t=>{t.id!==e&&(t.isModeOverlayActive=!1)}),l9(),n4());return}ac=()=>{let t=l.courts.find(t=>t.id===e);t&&(t.isModeOverlayActive=!t.isModeOverlayActive,t.isModeOverlayActive&&l.courts.forEach(t=>{t.id!==e&&(t.isModeOverlayActive=!1)}),l9(),n4())},ai.textContent="",delete ai.dataset.hiddenValue,ao.disabled=!0,as.classList.remove("hidden")}(s);if("set-court-mode"===n)return void function(e,t){let a=l.courts.find(t=>t.id===e);a&&(a.courtMode=t,a.isModeOverlayActive=!1,l9(),n4(),requestAnimationFrame(sh))}(s,a.dataset.mode);if("edit-game"===n)return void s6(s);if("toggle-light"===n)return void lC(e);if("randomize-teams"===n)return void function(e){let t=l.courts.find(t=>t.id===e);if(!t||4!==t.players.length)return;let a=t.players.filter(e=>"M"===e.gender),n=t.players.filter(e=>"F"===e.gender);if(2===a.length&&2===n.length){let e=a.sort(()=>.5-Math.random()),l=n.sort(()=>.5-Math.random());t.teams.team1=[e[0],l[0]],t.teams.team2=[e[1],l[1]]}else{let e=[...t.players].sort(()=>.5-Math.random());t.teams.team1=[e[0],e[1]],t.teams.team2=[e[2],e[3]]}t.status="game_pending",t.matchMode=l.matchSettings.matchMode,t.fastPlayGames=l.matchSettings.fastPlayGames,t.teamsSet=!0,t.autoStartTimeTarget=Date.now()+6e4,t.autoStartTimer=setTimeout(()=>sf(e),6e4),l9(),n4()}(s);if("choose-later"===n)return void function(e){let t=l.courts.find(t=>t.id===e);t.status="game_pending",t.teamsSet=!1,t.matchMode=l.matchSettings.matchMode,t.fastPlayGames=l.matchSettings.fastPlayGames,t.autoStartTimeTarget=Date.now()+6e4,t.autoStartTimer=setTimeout(()=>sf(e),6e4),l9(),n4()}(s);if("choose-teams"===n){let e=l.courts.find(e=>e.id===s);e&&"in_progress"===e.status?sv(s,"in_progress"):sv(s);return}if("cancel-game-setup"===n){var r;return void(r=s,eX.querySelector("h3").textContent="Confirm Cancellation",eX.querySelector("p").textContent="Are you sure you want to cancel this game? Players will be returned to their original queue positions.",e0.textContent="Confirm",e1.textContent="Close",eX.dataset.mode="cancelGame",eX.dataset.courtId=r,eX.classList.remove("hidden"))}if("start-game"===n)return void sf(s);if("end-game"===n){let t=e.target.closest(".end-game-ball");t?(t.classList.remove("animate-in"),t.classList.add("hide-anim"),setTimeout(()=>{sS(s)},1500)):sS(s);return}if("select-court-action"===n){let t=e.target.closest(".court-confirm-btn");if(!t)return;if("true"===t.dataset.reservedOnly)return void sx("This court is reserved for a different type of match.");let a=document.querySelectorAll(".court-card.selectable .court-confirm-btn.select-court");t.classList.remove("serve-in"),t.classList.add("hide-anim");let n=0;return a.forEach(e=>{e!==t&&(setTimeout(()=>{e.classList.remove("serve-in"),e.classList.add("serve-out")},n),n+=200)}),void setTimeout(()=>{let{players:e,gameMode:t}=l.selection,a="doubles"===t?4:2;if(e.length===a&&s){if("None"!==l.onDuty&&e.includes(l.onDuty))return void function(e){ek.innerHTML="",eC.textContent=l.onDuty,[...l.availablePlayers.filter(e=>e.committee),...l.courts.flatMap(e=>e.players).filter(e=>e.committee)];let t=new Set(l.selection.players),a=l.availablePlayers.filter(e=>e.committee&&e.name!==l.onDuty&&!t.has(e.name)).sort((e,t)=>e.name.localeCompare(t.name)),n=document.createElement("li");if(n.className="committee-member",n.innerHTML=`
            <label>
                <input type="radio" name="tempDutyMember" value="None">
                <div class="member-details">
                    <span class="member-name">None</span>
                    <span class="member-designation">No temporary replacement</span>
                </div>
            </label>
        `,ek.appendChild(n),0===a.length){let e=document.createElement("li");e.style.justifyContent="center",e.style.color="var(--neutral-color)",e.textContent="No other committee members available",ek.appendChild(e)}else a.forEach(e=>{let t=document.createElement("li");t.className="committee-member",t.innerHTML=`
                    <label>
                        <input type="radio" name="tempDutyMember" value="${e.name}">
                        <div class="member-details">
                            <span class="member-name">${e.name}</span>
                            <span class="member-designation">${e.committee}</span>
                        </div>
                    </label>
                `,ek.appendChild(t)});eL.dataset.callback="pending",eL.callback=e,eI.disabled=!0,ek.querySelectorAll('input[name="tempDutyMember"]').forEach(e=>{e.addEventListener("change",()=>{eI.disabled=!1})}),eL.classList.remove("hidden")}(()=>{sn(e,s,t)});sn(e,s,t)}},2e3)}}),eZ.addEventListener("click",function(){let e=eK.dataset.courtId,t=eK.dataset.openedFrom,a=Array.from(eY.querySelectorAll(".selected")).map(e=>e.dataset.player);if(2!==a.length)return void alert("Please select exactly 2 players for Team 1.");let n=JSON.parse(eK.dataset.playerNames||"[]").map(e=>n2(e)),s=a.map(e=>n2(e)),i=n.filter(e=>!a.includes(e.name));if(eK.classList.add("hidden"),delete eK.dataset.openedFrom,delete eK.dataset.playerNames,delete eK.dataset.courtId,"manual"===t)sS(null,null,{players:n,gameMode:"doubles",teamsSet:!0,teams:{team1:s,team2:i}});else{let a=l.courts.find(t=>t.id===e);if(a){if(a.teams.team1=s,a.teams.team2=i,a.teamsSet=!0,a.matchMode=l.matchSettings.matchMode,a.fastPlayGames=l.matchSettings.fastPlayGames,"in_progress"===t){l9(),n4(),s6(e);return}"endgame"===t?sS(e):(a.status="game_pending",a.autoStartTimeTarget=Date.now()+6e4,a.autoStartTimer=setTimeout(()=>sf(e),6e4),l9()),n4()}}}),eQ.addEventListener("click",()=>{let e=eK.dataset.openedFrom,t=eK.dataset.courtId;if(eK.classList.add("hidden"),delete eK.dataset.openedFrom,"endgame"===e&&t){let e=document.querySelector(`.court-card[data-court-id="${t}"]`),a=e?e.querySelector(".end-game-ball"):null;a&&(a.classList.remove("hide-anim","animate-in"),setTimeout(()=>{a.classList.add("animate-in")},50))}}),eY.addEventListener("click",function(e){if(e.target.classList.contains("modal-player")){let t=eY.querySelectorAll(".selected").length;e.target.classList.contains("selected")?e.target.classList.remove("selected"):t<2&&e.target.classList.add("selected")}}),te.addEventListener("click",()=>{l.historyViewMode="games",sr(),tt.classList.remove("hidden")}),tl.addEventListener("click",()=>{tt.classList.add("hidden")}),tn.addEventListener("click",()=>{lJ(),lK(),"stats"===l.historyViewMode?l.historyViewMode="games":l.historyViewMode="stats",sr(),n4()}),document.getElementById("history-toggle-teams-btn").addEventListener("click",()=>{lJ(),lK(),"teams"===l.historyViewMode?l.historyViewMode="games":l.historyViewMode="teams",sr(),n4()}),e8.addEventListener("click",()=>{iy(),e2.classList.remove("hidden")}),e5.addEventListener("click",()=>{e2.classList.add("hidden"),e2.style.zIndex="",delete e2.dataset.screensaverEventId}),document.getElementById("cancel-event-edit-btn")?.addEventListener("click",()=>{document.getElementById("event-create-edit-modal")?.classList.add("hidden"),s1()}),document.getElementById("save-event-btn")?.addEventListener("click",function(){let e=document.getElementById("event-create-edit-modal"),t=e.dataset.editingEventId,a=document.getElementById("event-type").value,n=document.getElementById("event-heading").value.trim(),s=document.getElementById("event-date").value,i=document.getElementById("event-rsvp-date").value,r=document.getElementById("event-start-time").value,o=document.getElementById("event-body1").value.trim(),d=document.getElementById("event-body2").value.trim(),c=parseInt(document.getElementById("event-cost-adult").value,10)||0,m=parseInt(document.getElementById("event-cost-child").value,10)||0,u=0;("Club Champs"===a||"League"===a)&&(u=parseInt(document.getElementById("event-participation-discount").value,10)||0);let g=document.getElementById("event-volunteers").checked,p=document.getElementById("event-phone").value.trim(),y=document.getElementById("event-email").value.trim(),h=document.getElementById("event-website").value.trim(),v=e.querySelector('input[name="event-open-to"]:checked'),f=v?v.value:"All Members",b=document.getElementById("event-open-guests").checked,E=document.getElementById("event-image1").value,L=document.getElementById("event-image2").value;if(!n)return void alert("Please enter an Event Heading.");if(!s)return void alert("Please select an Event Date.");let k={eventType:a,heading:n,eventDate:s,rsvpDate:i,startTime:r,body1:o,body2:d,costAdult:c,costChild:m,participationDiscountPercent:u,participationDiscount:parseInt(document.getElementById("event-participation-discount").value,10)||0,volunteersNeeded:g,phone:p,email:y,website:h,openTo:f,isOpenToGuests:b,image1Filename:E,image2Filename:L};if(t){let e=l.events.findIndex(e=>e.id==t);if(!(e>-1))return void console.error("Failed to find event to update:",t);l.events[e]={...l.events[e],...k},console.log("Event updated:",t)}else k.id=Date.now(),k.isActive=!1,k.interestedPlayers=[],l.events.push(k),console.log("New event created:",k.id);n4(),e.classList.add("hidden"),s1(),A.classList.contains("hidden")||(s0(),s4())}),ic(document.getElementById("event-heading")),ic(document.getElementById("event-body1")),ic(document.getElementById("event-body2")),document.getElementById("event-body1")?.addEventListener("click",e=>lc(e.target)),document.getElementById("event-body2")?.addEventListener("click",e=>lc(e.target)),document.getElementById("event-phone")?.addEventListener("click",function(){lc(this,"NumberPad")}),document.getElementById("event-email")?.addEventListener("click",function(){lc(this,"LetterPad")}),document.getElementById("event-website")?.addEventListener("click",function(){lc(this,"LetterPad")}),document.getElementById("event-cost-adult")?.addEventListener("input",()=>s8("event-cost-adult")),document.getElementById("event-cost-child")?.addEventListener("input",()=>s8("event-cost-child")),document.getElementById("event-participation-discount")?.addEventListener("input",()=>s8("event-participation-discount")),document.getElementById("interested-players-list")?.addEventListener("click",e=>{let t=e.target.closest(".action-icon.remove"),a=t?.dataset.playerName,n=document.getElementById("event-create-edit-modal"),s=n?.dataset.editingEventId;a&&s&&function(e,t){if(!e||!t)return;let a=l.events.find(e=>e.id==t);if(a&&a.interestedPlayers){let n=a.interestedPlayers.length;if(a.interestedPlayers=a.interestedPlayers.filter(t=>t!==e),a.interestedPlayers.length<n){n4();let n=document.getElementById("interested-players-list");n.innerHTML="",a.interestedPlayers.length>0?a.interestedPlayers.forEach(e=>{let t=document.createElement("li");t.innerHTML=`
                            <span>${e}</span>
                            <span class="action-icon remove" data-player-name="${e}" title="Remove player">&times;</span>
                         `,n.appendChild(t)}):n.innerHTML='<li style="color: var(--neutral-color); justify-content: center;">No players currently interested.</li>',console.log(`${e} removed from interest list for event ID ${t}`)}}}(a,s)}),document.getElementById("end-game-skip-btn").addEventListener("click",function(){"skip-scores"===document.getElementById("end-game-skip-btn").dataset.action?sD():s$()}),document.getElementById("reset-app-btn").addEventListener("click",function(){il(null,{mode:"reset",maxLength:5,title:"Enter Reset PIN"})}),document.addEventListener("click",e=>{let t=e.target.closest(".summary-toggle-btn");if(!t)return;let a=t.dataset.cardType,n=t.dataset.courtId,s=!1,i=t.closest(".court-card, .summary-card, #availablePlayersSection");if(!i)return;let r=t.querySelector("i");if(i.classList.toggle("is-collapsed"),r&&(r.classList.toggle("mdi-chevron-up"),r.classList.toggle("mdi-chevron-down")),"summary"===a)l.mobileControls.isSummaryExpanded=!l.mobileControls.isSummaryExpanded,s=!0;else if("players"===a)l.mobileControls.isPlayersExpanded=!l.mobileControls.isPlayersExpanded,s=!0;else if("court"===a&&n){let e=l.courts.find(e=>e.id===n);e&&(e.isCollapsed=!e.isCollapsed,s=!0)}s&&n4()}),ep.addEventListener("click",()=>{e2.classList.add("hidden"),e4.classList.add("hidden"),iq()}),_.addEventListener("click",()=>{J.innerHTML="",U.value="",V.value="",Y.value="",document.getElementById("parent-collapsed-display").innerHTML="",l.juniorClub.registrationFlow={parentCollapsed:!1,childrenExpanded:!1},F.classList.add("hidden")}),G.addEventListener("click",()=>{F.classList.add("hidden"),R.querySelector("h3").textContent="New Parent Registration",R.dataset.mode="new",W.textContent="Confirm Registration",R.classList.remove("hidden"),l.juniorClub.registrationFlow={parentCollapsed:!1,childrenExpanded:!1},J.innerHTML="",U.value="",V.value="",Z.value="",Y.value="",document.getElementById("parent-collapsed-display").innerHTML="",document.getElementById("parent-fields").style.display="block",document.getElementById("children-container-wrapper").style.display="none",ij(),iz()}),z.addEventListener("click",()=>{J.innerHTML="",U.value="",V.value="",Y.value="",document.getElementById("parent-collapsed-display").innerHTML="",l.juniorClub.registrationFlow={parentCollapsed:!1,childrenExpanded:!1},R.classList.add("hidden"),F.classList.remove("hidden")}),W.addEventListener("click",function(){let e=iw(U.value.trim()),t=iw(V.value.trim()),a=Z.value.trim().toLowerCase(),n=Y.value.trim(),s=(document.getElementById("parent-country-code")?.value||"+27")+n,i=R.dataset.mode||"new",r=e+t,o=[];if(J.querySelectorAll(".child-field-group").forEach(e=>{let t=iw(e.querySelector('[name="childName"]').value.trim()),a=iw(e.querySelector('[name="childSurname"]').value.trim()),n=e.querySelector('[name="childBirthDate"]').value,l=e.querySelector('input[type="radio"]:checked'),s=l?l.value:"?";t&&a&&n&&"?"!==s&&o.push({name:t,surname:a,gender:s,birthDate:n})}),!(e.length>0&&t.length>0&&a.includes("@")&&n.length>=8)||0===o.length)return void sx("Please complete all parent and child details before confirming.");if("edit"!==i&&l.juniorClub.parents.some(e=>e.id===r))return void sx("A parent with this name is already registered.");let d=null;if("edit"===i){let e=R.dataset.originalParentId;if(!(d=l.juniorClub.parents.find(t=>t.id===e))){console.error("Error editing parent: Original parent not found with ID",e),sx("Error finding parent profile to update.");return}}d?(d.name=e,d.surname=t,d.phone=s,d.email=a,d.id=r,d.registeredChildren=o,sx(`${e}'s profile has been successfully updated.`)):(d={id:r,name:e,surname:t,phone:s,email:a,registeredChildren:o},l.juniorClub.parents.push(d),sx(`${e} successfully registered.`)),l.juniorClub.parents.sort((e,t)=>e.name.localeCompare(t.name)),R.classList.add("hidden"),R.querySelector("h3").textContent="New Parent Registration",R.dataset.mode="",delete R.dataset.originalParentId,W.textContent="Confirm Registration",U.value="",V.value="",Y.value="",Z.value="",J.innerHTML="",document.getElementById("parent-collapsed-display").innerHTML="",l.juniorClub.registrationFlow={parentCollapsed:!1,childrenExpanded:!1},"edit"===i?iq():iO(d),n4()}),ej.addEventListener("click",()=>{eH.classList.add("hidden"),ev.classList.remove("hidden")}),ef.addEventListener("click",e=>{let t=e.target.closest(".roster-item");if(e.target.closest(".roster-sort-btn")||!t)return;let a=parseInt(t.dataset.rosterIndex,10),n=ef.rosterData;n&&n[a]&&function(e){if(eF.innerHTML="",eH.classList.add("hidden"),e.isParent)if(eq.textContent=`${e.name} ${e.surname}'s Registered Children`,eq.style.marginTop="0",eq.style.marginBottom="0.5rem",e.children&&e.children.length>0){let t=document.createElement("ul");t.style.listStyleType="none",t.style.padding="0",t.style.margin="0.5rem 0",e.children.forEach(e=>{let a=l2(e),n=a>0?new Date(a).toLocaleDateString("en-ZA"):"Never Checked In",l=document.createElement("li");l.innerHTML=`
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px dashed #eee;">
                            <span style="font-weight: 500; color: var(--dark-text);">${e}</span>
                            <span style="font-size: 0.9em; color: var(--neutral-color);">${n}</span>
                        </div>
                    `,t.appendChild(l)}),eF.appendChild(t)}else eF.innerHTML='<p style="text-align: center; color: var(--neutral-color); margin-top: 1rem; margin-bottom: 0;">No children currently registered under this parent.</p>';else{eq.textContent=`${e.name} ${e.surname}'s Parent`,eq.style.marginTop="0",eq.style.marginBottom="0.5rem";let t=document.createElement("ul");t.style.listStyleType="none",t.style.padding="0",t.style.margin="0.5rem 0";let a=l.juniorClub.parents.find(t=>`${t.name} ${t.surname}`===e.parentName),n="Never Checked In";if(a){let e=0;a.registeredChildren.forEach(t=>{let a=`${t.name} ${t.surname}`,n=l2(a);n>e&&(e=n)}),e>0&&(n=new Date(e).toLocaleDateString("en-ZA"))}let s=document.createElement("li");s.innerHTML=`
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px dashed #eee;">
                    <span style="font-weight: 500; color: var(--dark-text);">Parent: ${e.parentName}</span>
                    <span style="font-size: 0.9em; color: var(--neutral-color);">${n}</span>
                </div>
            `,t.appendChild(s),eF.appendChild(t)}ev.classList.add("hidden"),eH.classList.remove("hidden")}(n[a])}),ey&&ey.addEventListener("change",iF),K.addEventListener("click",i$),R.addEventListener("click",e=>{e.target.closest('[data-action="match-surname"]')?handleMatchSurname(e):e.target.closest('[data-action="remove-child"]')&&removeChild(e)}),F.addEventListener("click",e=>{if(e.target.closest("#junior-club-roster-btn"))return void iB();if(e.target.closest("#junior-club-history-btn"))return void iG();let t=e.target.closest(".action-icon.add"),a=e.target.closest(".action-icon.edit"),n=e.target.closest("#junior-club-list li");if(n){if(t){let e=t.dataset.parentId,a=l.juniorClub.parents.find(t=>t.id===e);if(a&&"0.5"!==t.style.opacity){if("child"===l.juniorClub.checkInFilter.displayMode){let e=n.querySelector("span:first-child span:first-child").textContent.trim(),t=a.registeredChildren.filter(t=>`${t.name} ${t.surname}`.trim()===e).map(e=>({name:`${e.name} ${e.surname}`.trim(),gender:e.gender,guest:!0,isJunior:!0,parentName:a.name+" "+a.surname}));if(t.length>0){l.juniorClub.activeChildren.push(...t);let e={id:Date.now(),parentId:a.id,parentName:`${a.name} ${a.surname}`,childNames:t.map(e=>e.name),date:new Date().toISOString().split("T")[0],isPaid:!1};l.juniorClub.history.push(e),n4(),iH();return}}iO(a)}}else if(a){let e=a.dataset.parentId,t=l.juniorClub.parents.find(t=>t.id===e);t&&iM(t)}}}),el.addEventListener("click",()=>{ea.classList.add("hidden"),F.classList.remove("hidden")}),en.addEventListener("click",i_),K.addEventListener("click",i$),R.addEventListener("click",e=>{e.target.closest('[data-action="match-surname"]')?handleMatchSurname(e):e.target.closest('[data-action="remove-child"]')&&removeChild(e)}),F.addEventListener("click",e=>{if(e.target.closest("#junior-club-roster-btn"))return void iB();if(e.target.closest("#junior-club-history-btn"))return void iG();let t=e.target.closest(".action-icon.add"),a=e.target.closest(".action-icon.edit"),n=e.target.closest("#junior-club-list li");if(n){if(t){let e=t.dataset.parentId,a=l.juniorClub.parents.find(t=>t.id===e);if(a&&"0.5"!==t.style.opacity){if("child"===l.juniorClub.checkInFilter.displayMode){let e=n.querySelector("span:first-child span:first-child").textContent.trim(),t=a.registeredChildren.filter(t=>`${t.name} ${t.surname}`.trim()===e).map(e=>({name:`${e.name} ${e.surname}`.trim(),gender:e.gender,guest:!0,isJunior:!0,parentName:a.name+" "+a.surname}));if(t.length>0){l.juniorClub.activeChildren.push(...t);let e={id:Date.now(),parentId:a.id,parentName:`${a.name} ${a.surname}`,childNames:t.map(e=>e.name),date:new Date().toISOString().split("T")[0],isPaid:!1};l.juniorClub.history.push(e),sx(`${t.length} child checked in for ${a.name}.`),n4(),iH();return}}iO(a)}}else if(a){let e=a.dataset.parentId,t=l.juniorClub.parents.find(t=>t.id===e);t&&iM(t)}}}),el.addEventListener("click",()=>{ea.classList.add("hidden"),F.classList.remove("hidden")}),en.addEventListener("click",i_),es.addEventListener("change",()=>{let e=es.querySelectorAll('input[name="attendingChild"]:checked').length,t=e>0;en.disabled=!t,en.textContent=`Check In (${e} ${1===e?"child":"children"})`,en.style.backgroundColor=t?"var(--confirm-color)":"var(--inactive-color)",en.style.borderColor=t?"var(--confirm-color)":"var(--inactive-color)"}),ei.addEventListener("click",iG),ed.addEventListener("click",()=>{er.classList.add("hidden"),iq()}),eo.addEventListener("click",function(e){let t=e.target.closest(".history-item");t&&(eo.querySelectorAll(".history-item").forEach(e=>{e.style.backgroundColor="transparent"}),t.style.backgroundColor="#f1f1f1",er.dataset.selectedEntryId=t.dataset.entryId,ec.disabled=!1,ec.style.backgroundColor="var(--confirm-color)",ec.style.borderColor="var(--confirm-color)")}),ec.addEventListener("click",function(){let e=er.dataset.selectedEntryId,t=l.juniorClub.history.find(t=>t.id==e);t&&(document.getElementById("detail-parent-name").textContent=t.parentName,document.getElementById("detail-date").textContent=new Date(t.id).toLocaleString("en-ZA"),document.getElementById("detail-children-list").innerHTML=t.childNames.map(e=>`<li><span>${e}</span></li>`).join(""),iV(t),er.classList.add("hidden"),em.classList.remove("hidden"))}),eu.addEventListener("click",()=>{em.classList.add("hidden"),iG()}),eg.addEventListener("click",function(){let e=er.dataset.selectedEntryId,t=l.juniorClub.history.find(t=>t.id==e);if(!t)return;t.isPaid=!t.isPaid;let a=t.isPaid,n=t.childNames,s=l.juniorClub.parents.find(e=>e.id===t.parentId);if(a){l.juniorClub.activeChildren=l.juniorClub.activeChildren.filter(e=>!n.includes(e.name));let e=l.availablePlayers.filter(e=>n.includes(e.name));l.availablePlayers=l.availablePlayers.filter(e=>!n.includes(e.name)),e.length}else if(s){let e=new Set([...l.availablePlayers.map(e=>e.name),...l.courts.flatMap(e=>e.players).map(e=>e.name)]),a=[];t.childNames.forEach(t=>{if(!e.has(t)){let e=s.registeredChildren.find(e=>`${e.name} ${e.surname}`===t);e?a.push({name:t,gender:e.gender||"?",guest:!0,isJunior:!0,isPaused:!1}):a.push({name:t,gender:"?",guest:!0,isJunior:!0,isPaused:!1})}}),l.availablePlayers.push(...a),a.length>0&&a.map(e=>e.name).join(" and ")}iV(t),n4(),iR(),l1(),iE(),l9(),sO(!1)}),a6.addEventListener("click",()=>{L&&clearInterval(L),a4.classList.add("hidden")}),window.addEventListener("resize",function(){if(window.innerWidth>900){let e=!1;l.mobileControls.isSummaryExpanded||(l.mobileControls.isSummaryExpanded=!0,e=!0),l.mobileControls.isPlayersExpanded||(l.mobileControls.isPlayersExpanded=!0,e=!0),l.courts.forEach(t=>{t.isCollapsed&&(t.isCollapsed=!1,e=!0)}),e&&(n4(),l9())}}),e3.addEventListener("click",e=>{if(e.target.classList.contains("add")){let t=e.target.dataset.player,a=e2.dataset.screensaverEventId;if(a)!function(e,t){if(!e||!t)return;let a=l.events.find(e=>e.id==t);a?(a.interestedPlayers=a.interestedPlayers||[],a.interestedPlayers.includes(e)?console.log(`${e} is already on the interest list for event ID ${t}`):(a.interestedPlayers.push(e),n4(),console.log(`${e} added to interest list for event ID ${t}`))):console.error("Could not find event with ID:",t),e2.classList.add("hidden"),e2.style.zIndex="",delete e2.dataset.screensaverEventId}(t,a);else{let e=l.clubMembers.find(e=>e.name===t);e&&(N.dataset.player=JSON.stringify(e),N.classList.remove("hidden"),e2.classList.add("hidden"))}}}),e6.addEventListener("click",()=>{ih(),e4.classList.remove("hidden")}),e9.addEventListener("click",()=>e4.classList.add("hidden")),e7.addEventListener("click",e=>{if(e.target.classList.contains("remove")){let t=e.target.dataset.player,a=l.availablePlayers.find(e=>e.name===t);a&&function(e){!0===e.onLeaderboard?function(e){let t,a;if(!e)return;let n=e.name,s=n.split(" ")[0];document.getElementById("checkout-thanks-title").textContent=`Thanks for joining us, ${s}!`;let i=document.getElementById("checkout-player-stats");if(i.classList.add("hidden"),!0===e.onLeaderboard){let t=ss(l.gameHistory.filter(e=>new Date(e.endTime).toISOString().split("T")[0]===new Date().toISOString().split("T")[0]))[n];if(t){let a=function(e,t){let a=ss(l.gameHistory.filter(e=>new Date(e.endTime).toISOString().split("T")[0]===new Date().toISOString().split("T")[0])),n=n1(),s=Object.keys(a).map(e=>{let t=n.find(t=>t.name===e);return{name:e,...a[e],gender:t?t.gender:"?",onLeaderboard:!!t&&t.onLeaderboard}}).filter(e=>e.onLeaderboard&&e.gender===t).sort((e,t)=>{let a=e.played>0?e.won/e.played:0,n=t.played>0?t.won/t.played:0;return n!==a?n-a:t.totalDurationMs-e.totalDurationMs}).findIndex(t=>t.name===e)+1;return s>0?s:null}(n,e.gender),s=si(t.played,t.won),{best:r,worst:o}=function(e){let t=l.gameHistory.filter(e=>new Date(e.endTime).toISOString().split("T")[0]===new Date().toISOString().split("T")[0]).filter(t=>(t.teams.team1.includes(e)||t.teams.team2.includes(e))&&t.score);if(0===t.length)return{best:null,worst:null};let a={scoreDiff:-1/0,text:""},n={scoreDiff:1/0,text:""};return t.forEach(t=>{let l=t.teams.team1.includes(e),s=l?t.score.team1:t.score.team2,i=l?t.score.team2:t.score.team1,r=s-i,o=`${r>0?"Won":"Lost"} ${s}-${i}`;r>a.scoreDiff&&(a={scoreDiff:r,text:o}),r<n.scoreDiff&&(n={scoreDiff:r,text:o})}),{best:a.text,worst:n.text}}(n),d=ss(l.gameHistory),c=d[n]?d[n].totalDurationMs:0;document.getElementById("stat-rank").textContent=a?`#${a}`:"N/A",document.getElementById("stat-win-percentage").textContent=s,document.getElementById("stat-games-played").textContent=t.played,document.getElementById("stat-games-won").textContent=t.won,document.getElementById("stat-time-today").textContent=sl(t.totalDurationMs),document.getElementById("stat-total-time").textContent=sl(c),document.getElementById("best-match-highlight").innerHTML=`<strong>Best Match:</strong> ${r||"N/A"}`,document.getElementById("worst-match-highlight").innerHTML=`<strong>Toughest Match:</strong> ${o||"N/A"}`,i.classList.remove("hidden")}}let r=new Date,o=r.getDay();o<3||3===o&&17>r.getHours()?(t="this coming Wednesday",a="17h30"):o<6||6===o&&13>r.getHours()?(t="this coming Saturday",a="13h00"):(t="next Wednesday",a="17h30");let d=`We hope you had a great day on the courts. Please join us for our next social on ${t}, starting at ${a}.`;document.getElementById("checkout-thanks-message").textContent=d;let c=document.getElementById("checkout-thanks-modal");c.dataset.player=n,e4.classList.add("hidden"),c.classList.remove("hidden")}(e):function(e){let t,a;if(!e)return;let n=e.name,l=n.split(" ")[0];document.getElementById("checkout-thanks-no-stats-title").textContent=`Thanks for joining us, ${l}!`;let s=new Date,i=s.getDay();i<3||3===i&&17>s.getHours()?(t="this coming Wednesday",a="17h30"):i<6||6===i&&13>s.getHours()?(t="this coming Saturday",a="13h00"):(t="next Wednesday",a="17h30");let r=`We hope you had a great day on the courts. Please join us for our next social on ${t}, starting at ${a}.`;document.getElementById("checkout-thanks-no-stats-message").textContent=r;let o=document.getElementById("checkout-thanks-no-stats-modal");o.dataset.player=n,e4.classList.add("hidden"),o.classList.remove("hidden")}(e)}(a)}}),document.getElementById("checkout-thanks-confirm-btn").addEventListener("click",()=>{iv(document.getElementById("checkout-thanks-modal").dataset.player)}),document.getElementById("checkout-thanks-no-stats-confirm-btn").addEventListener("click",()=>{iv(document.getElementById("checkout-thanks-no-stats-modal").dataset.player)}),document.getElementById("checkout-thanks-back-btn").addEventListener("click",()=>{document.getElementById("checkout-thanks-modal").classList.add("hidden"),e4.classList.remove("hidden")}),document.getElementById("checkout-thanks-no-stats-back-btn").addEventListener("click",()=>{document.getElementById("checkout-thanks-no-stats-modal").classList.add("hidden"),e4.classList.remove("hidden")}),document.getElementById("checkout-thanks-confirm-btn").addEventListener("click",()=>{let e=document.getElementById("checkout-thanks-modal"),t=e.dataset.player;if(t){l.availablePlayers.length>0&&l.availablePlayers[0].name===t&&sQ();let a=l.availablePlayers.find(e=>e.name===t);a&&(a.isJunior&&(l.juniorClub.activeChildren=l.juniorClub.activeChildren.filter(e=>e.name!==t)),a.guest||(l.clubMembers.push(a),l.clubMembers.sort((e,t)=>e.name.localeCompare(t.name)))),l.availablePlayers=l.availablePlayers.filter(e=>e.name!==t),e.classList.add("hidden"),ih(),e4.classList.remove("hidden"),l1(),iS(),l9(),n4()}}),to.addEventListener("click",()=>{let e=ts.dataset.courtId;if(ts.dataset.editGameId){delete ts.dataset.editGameId,ts.classList.add("hidden"),tt.classList.remove("hidden");return}if(e){let t=document.querySelector(`.court-card[data-court-id="${e}"]`),a=t?t.querySelector(".end-game-ball"):null;a&&(a.classList.remove("hide-anim","animate-in"),setTimeout(()=>{a.classList.add("animate-in")},50))}ts.classList.add("hidden")}),tr.addEventListener("click",function(){let e=ts.dataset.editGameId,t=ts.dataset.manualEntry,s=Date.now(),i=ts.dataset.winner,r=null,o=null,d=null,c=null,m=parseInt(tm.value,10),u=parseInt(tu.value,10);if(!isNaN(m)&&!isNaN(u)&&("team1"===i?(r=m,o=u):(r=u,o=m),!td.classList.contains("hidden"))){let e=parseInt(tg.value,10),t=parseInt(tp.value,10);isNaN(e)||isNaN(t)||("team1"===i?(d=e,c=t):(d=t,c=e))}if(t){JSON.parse(t);let e=ti.querySelector('.team-selection[data-team="team1"] span').textContent,a=ti.querySelector('.team-selection[data-team="team2"] span').textContent,n={id:s,court:"Manual",startTime:s-36e5,endTime:s,duration:"01h00m",teams:{team1:e.split(" & "),team2:a.split(" & ")},score:null!==r&&null!==o?{team1:r,team2:o,tiebreak1:d,tiebreak2:c}:null,winner:i};l.gameHistory.push(n),l.manualEntry.players=[],delete ts.dataset.manualEntry,ts.classList.add("hidden"),tt.classList.remove("hidden"),sd(),n4(),sw();return}if(e){let t=l.gameHistory.findIndex(t=>t.id==e);t>-1&&(l.gameHistory[t].winner=i,null!==r&&null!==o?l.gameHistory[t].score={team1:r,team2:o,tiebreak1:d,tiebreak2:c}:l.gameHistory[t].score=null),delete ts.dataset.editGameId,ts.classList.add("hidden"),tt.classList.remove("hidden"),sd(),n4(),sw();return}{let e=ts.dataset.courtId,t=l.courts.find(t=>t.id===e);if(!t)return;let m=n3(t.teams.team1),u=n3(t.teams.team2),g={id:s,court:t.id,startTime:t.gameStartTime,endTime:s,duration:document.getElementById(`timer-${t.id}`).textContent,teams:{team1:m,team2:u},score:null!==r&&null!==o?{team1:r,team2:o,tiebreak1:d,tiebreak2:c}:null,winner:i};l.gameHistory.push(g);let p=[..."team1"===i?t.teams.team1:t.teams.team2,..."team1"===i?t.teams.team2:t.teams.team1].filter(e=>!e.guest);if(l.availablePlayers.push(...p),t.becameAvailableAt=s,(k>0?k-s:1/0)>3e4){let t=function(e){for(let t of n){let a=l.courts.find(e=>e.id===t);if(a&&l.courtSettings.visibleCourts.includes(t)&&(t===e||"available"===a.status))return t}return null}(e),s=a(function(e){let t=[...l.availablePlayers,...e].find(e=>!e.isPaused);return t?t.name:null}(p));s&&sP(t?`Attention, ${s}. Please come and select your match. Court ${sB(t)} is available.`:`Attention, ${s}. Please come and select your match. A court is now available.`)}else console.log("Skipped game end announcement due to grace period.");iI(e),sw()}}),e1.addEventListener("click",()=>{let e=eX.dataset.mode;eX.classList.add("hidden"),"checkInPlayer"===e?e2.classList.remove("hidden"):"checkOutPlayer"===e?e4.classList.remove("hidden"):"addBallStock"===e||"returnBallStock"===e||"signOutBalls"===e?aw.classList.remove("hidden"):"removeSingleChild"===e&&R.classList.remove("hidden"),ip()}),e0.addEventListener("click",()=>{let e=eX.dataset.mode;if("removeSingleChild"===e)!function(){let e=eX.dataset.childGroupId,t=document.querySelector(`.child-field-group[data-group-id="${e}"]`);t&&t.remove(),0===J.querySelectorAll(".child-field-group").length&&iD(),eX.classList.add("hidden"),R.classList.remove("hidden"),ij(),ip()}();else if("confirmEditGame"===e){let e=eX.dataset.gameId;eX.classList.add("hidden"),ip(),sS(null,e)}else if("checkOutPlayer"===e)!function(){let e=eX.dataset.player;if(e){l.availablePlayers.length>0&&l.availablePlayers[0].name===e&&sQ();let t=l.availablePlayers.find(t=>t.name===e);t&&(t.isJunior&&(l.juniorClub.activeChildren=l.juniorClub.active-children.filter(t=>t.name!==e)),t.guest||(l.clubMembers.push(t),l.clubMembers.sort((e,t)=>e.name.localeCompare(t.name)))),l.availablePlayers=l.availablePlayers.filter(t=>t.name!==e),eX.classList.add("hidden"),ih(),e4.classList.remove("hidden"),l1(),iS(),l9(),n4()}}();else if("checkInPlayer"===e)!function(){let e=eX.dataset.player;if(e){let t=l.clubMembers.find(t=>t.name===e);t&&(N.dataset.player=JSON.stringify(t),N.classList.remove("hidden"),eX.classList.add("hidden"),e2.classList.add("hidden"))}}();else if("cancelGame"===e)!function(){let e=eX.dataset.courtId;if(!e)return;let t=l.courts.find(t=>t.id===e);if(t){if(t.autoStartTimer&&clearTimeout(t.autoStartTimer),l.selection.players=[],l.selection.courtId=null,t.queueSnapshot)l.availablePlayers=t.queueSnapshot;else{let e=t.players.filter(e=>!e.guest);l.availablePlayers=[...e,...l.availablePlayers]}t.becameAvailableAt=Date.now(),t.status="available",t.players=[],t.teams={team1:[],team2:[]},t.gameMode=null,t.autoStartTimer=null,t.gameStartTime=null,t.queueSnapshot=null,t.teamsSet=null,eX.classList.add("hidden"),l1(),iE(),iS(),l9(),n4(),sO(!1),requestAnimationFrame(()=>{requestAnimationFrame(sh)})}}();else if("callDuty"===e)!function(){let e,t=l.onDuty,n=!1;if("None"!==t&&(n=l.courts.some(e=>e.players.some(e=>e.name===t))),"None"===t||n)e="Committee member required. Please report to your station for assistance.";else{let n=a(t);e=`${n}, please report to your station for assistance.`}sP(e,null,"CommitteeCall.mp3"),eX.classList.add("hidden")}();else if("executeReset"===e)lj(),l_(!0),l.clubMembers=[...t].sort((e,t)=>e.name.localeCompare(t.name)),l.availablePlayers=[],l.gameHistory=[],l.reorderHistory=[],tW.classList.add("hidden"),eX.classList.add("hidden"),n4(),iS(),l9(),alert("Application has been reset. Checklist state for the previous session (if applicable) has been archived.");else if("pauseToggle"===e)!function(){let e=eX.dataset.player,t=eX.dataset.verb,n=l.availablePlayers.find(t=>t.name===e);if(n){let e=sN(),s=n.isHoldingDutySwap,i="pause"===t;if("resume"===t&&s){let e=l.availablePlayers.findIndex(e=>e.name===l.onDuty);if(e>1){let t=l.availablePlayers[1];l.availablePlayers[1]=l.availablePlayers[e],l.availablePlayers[e]=t}n.isHoldingDutySwap=!1}n.isPaused=i,i?n.pauseTime=Date.now():delete n.pauseTime,"pause"===t&&(l.availablePlayers.findIndex(e=>!e.isPaused)===l.availablePlayers.indexOf(n)?n.isHoldingDutySwap=!0:n.isHoldingDutySwap=!1),nX();let r=n.name,o=a(r),d="",c=null;if(n.isPaused){if(d=`${o} is now taking a well-deserved break.`,r===e){let e=sN();if(e){let t=a(e);c=`${t}, please select players for a game.`}}}else d=`${o} is back on court and ready to play.`;sP(d,c),eX.classList.add("hidden"),l1(),l9(),n4(),sO(!1)}}();else if("addBallStock"===e)!function(){let e=parseInt(eX.dataset.count,10),t=eX.dataset.member;if(isNaN(e)||e<=0)return;let a=l.ballManagement.stock;l.ballManagement.stock+=e;let n=l.ballManagement.stock;l.ballManagement.history.push({timestamp:Date.now(),action:"in",category:"purchase",count:e,member:t,stockBefore:a,stockAfter:n}),lS(),n4(),eX.classList.add("hidden"),aw.classList.remove("hidden"),ip()}();else if("returnBallStock"===e)!function(){let e=parseInt(eX.dataset.count,10),t=eX.dataset.member;if(isNaN(e)||e<=0)return;let a=l.ballManagement.stock;l.ballManagement.stock+=e;let n=l.ballManagement.stock;l.ballManagement.history.push({timestamp:Date.now(),action:"in",category:"return",count:e,member:t,stockBefore:a,stockAfter:n}),lS(),n4(),eX.classList.add("hidden"),aw.classList.remove("hidden"),ip()}();else if("returnUsedBalls"===e)!function(){let e=parseInt(eX.dataset.count,10),t=eX.dataset.member;if(isNaN(e)||e<=0)return;let a=l.ballManagement.usedStock;l.ballManagement.usedStock+=e;let n=l.ballManagement.usedStock;l.ballManagement.history.push({timestamp:Date.now(),action:"in",category:"return_used",count:e,member:t,stockBefore:a,stockAfter:n}),lI(),n4(),eX.classList.add("hidden"),aw.classList.remove("hidden"),ip()}();else if("signOutBalls"===e)!function(){let e=parseInt(eX.dataset.count,10),t=eX.dataset.category,a=eX.dataset.member,n=eX.dataset.stockType,s=eX.dataset.purchaserName,i="cans"===n?l.ballManagement.stock:l.ballManagement.usedStock;if(isNaN(e)||i<e)return sx("Sign out failed. Insufficient stock.");"cans"===n?l.ballManagement.stock-=e:l.ballManagement.usedStock-=e;let r="cans"===n?l.ballManagement.stock:l.ballManagement.usedStock;l.ballManagement.history.push({timestamp:Date.now(),action:"out",category:t,count:e,member:a,stockBefore:i,stockAfter:r}),l.ballManagement.history[l.ballManagement.history.length-1].stockType=n,l.ballManagement.history[l.ballManagement.history.length-1].purchaserName=s,l.ballManagement.tempSale={stockType:null,memberSignOut:null,purchaserName:null,purchaserType:null},sx(`Signed out ${e} ${n} to ${s}, by ${a}.`),lS(),lI(),n4(),eX.classList.add("hidden"),aw.classList.remove("hidden"),ip()}();else if("forceAnnouncement"===e)eX.classList.add("hidden"),sO(!0),ip();else if("forceAnnouncementNotEnoughPlayers"===e){let e=Date.now();l.notificationControls.isMinimized?(k=0,S="initial_check"):(k=e+3e5,S="5_min_repeat");let t=l.availablePlayers.length,a=l.availablePlayers.map(e=>e.name).join(" and "),n=4-t,s=`Attention ${a}, we are waiting for ${n} more player${n>1?"s":""} before we can start a match.`;t>=2&&(s+=" or start a singles game in the meantime."),sP(s),eX.classList.add("hidden"),ip()}}),document.getElementById("undo-toast-dismiss").addEventListener("click",n6),document.getElementById("undo-toast-btn").addEventListener("click",()=>{l.undoHistory.currentToast&&l.undoHistory.currentToast.undoAction&&(l.undoHistory.currentToast.undoAction(),n6())}),[tm,tu,tg,tp].forEach(e=>{e.addEventListener("input",()=>{!function(){if("fast"===(ts.dataset.matchMode||"1set")){td.classList.add("hidden"),tg.value="",tp.value="";return}let e=parseInt(tm.value,10),t=parseInt(tu.value,10);7===e&&6===t?td.classList.remove("hidden"):(td.classList.add("hidden"),tg.value="",tp.value="")}(),sM()})}),ii(tg),ii(tp),ar.forEach(e=>{e.addEventListener("click",e=>{let t=e.target.dataset.key,a=ai.dataset.hiddenValue||"";if("court-mode-keypad-confirm-btn"===e.target.id){if(e.target.disabled)return;!function(){if(ai.dataset.hiddenValue===sH())sF(),$=!0,D&&clearTimeout(D),D=setTimeout(()=>{$=!1,D=null,l.courts.forEach(e=>e.isModeOverlayActive=!1),l9(),sP(null,null,"Alert7.mp3"),requestAnimationFrame(sh)},6e4),ac&&ac();else{let e=as.querySelector(".keypad-content");e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake"),ai.textContent="",ai.dataset.hiddenValue&&(ai.dataset.hiddenValue=""),ao.disabled=!0},820)}}();return}if("backspace"===t)a=a.slice(0,-1);else if("clear"===t)a="";else if(/[0-9]/.test(t)){if(a.length>=6)return;a+=t}ai.dataset.hiddenValue=a,ai.textContent="*".repeat(a.length),ao.disabled=6!==a.length})}),ad.addEventListener("click",sF),tL.forEach(e=>{e.addEventListener("click",ia)}),tC.addEventListener("click",()=>{"undo"===tI.mode?(is(),delete tb.dataset.undoActionIndex,delete tb.dataset.undoActionDescription,document.getElementById("undo-history-modal").classList.remove("hidden")):is()}),document.getElementById("add-new-player-btn").addEventListener("click",()=>{e2.classList.add("hidden"),tw.classList.remove("hidden"),t$.value="",tD.value="",document.querySelector('input[name="guest-gender"][value="M"]').checked=!0,im()}),document.getElementById("returning-guest-btn").addEventListener("click",()=>{e2.classList.add("hidden"),iK(),document.getElementById("returning-guest-modal").classList.remove("hidden")}),document.getElementById("returning-guest-cancel-btn").addEventListener("click",()=>{document.getElementById("returning-guest-modal").classList.add("hidden"),e2.classList.remove("hidden")}),document.getElementById("returning-guest-list").addEventListener("click",e=>{e.target.classList.contains("add")&&function(e){let t=l.guestHistory.find(t=>t.name===e);if(!t)return;let a=document.getElementById("returning-guest-modal"),n=a.dataset.context,s=new Date().toISOString().split("T")[0];if(t.lastCheckIn!==s&&(t.daysVisited=(t.daysVisited||0)+1,t.lastCheckIn=s),"purchaser"===n){delete a.dataset.context,lD(e,"returning_guest");return}let i={...t,isPaused:!1};l.availablePlayers.push(i),a.classList.add("hidden"),iy(),e2.classList.remove("hidden"),l1(),iS(),l9(),n4(),sO(!1)}(e.target.dataset.player)}),tT.addEventListener("click",()=>{let e=tw.dataset.context;tw.classList.add("hidden"),delete tw.dataset.context,"manual-entry"===e?ew.classList.remove("hidden"):e2.classList.remove("hidden");let t=document.querySelector('input[name="player-type"][value="member"]');t&&(t.disabled=!1),ig()}),tB.addEventListener("click",function(){let e,a=t$.value.trim(),n=tD.value.trim(),s=document.querySelector('input[name="guest-gender"]:checked').value,i=document.querySelector('input[name="player-type"]:checked').value,r=document.querySelector('input[name="age-type"]:checked').value,o=tw.dataset.context,d=document.querySelector('input[name="player-type"][value="member"]');if(d&&(d.disabled=!1),!a||!n)return;let c=e=>e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),m=`${c(a)} ${c(n)}`;if("purchaser"===o){iu((e={name:m,gender:s,guest:!0,type:r,isPaused:!1}).name,e.gender),tw.classList.add("hidden"),delete tw.dataset.context,lD(m,"new_guest"),ig();return}if("manual-entry"===o){iu((e={name:m,gender:s,guest:!0,type:r,isPaused:!1}).name,e.gender),l.manualEntry.players.length<4&&!l.manualEntry.players.includes(e.name)&&l.manualEntry.players.push(e.name),tw.classList.add("hidden"),delete tw.dataset.context,sL(),ig(),n4();return}"guest"===i?iu((e={name:m,gender:s,guest:!0,type:r,isPaused:!1}).name,e.gender):(e=t.find(e=>e.name.toLowerCase()===m.toLowerCase()))?(e.type=r,l.clubMembers=l.clubMembers.filter(e=>e.name.toLowerCase()!==m.toLowerCase())):iu((e={name:m,gender:s,guest:!1,type:r,isPaused:!1}).name,e.gender),N.dataset.player=JSON.stringify(e),N.classList.remove("hidden"),tw.classList.add("hidden")}),tM.forEach(e=>e.addEventListener("change",im));let iY=e=>{e.readOnly=!0,e.addEventListener("click",e=>{!function(e){tA.textContent=(tN=e).value,io(),tx.classList.remove("hidden"),tw.classList.add("hidden"),e.closest("#new-parent-modal")&&document.getElementById("new-parent-modal").classList.add("hidden")}(e.target)})};function iZ(){ij(),iz()}iY(t$),iY(tD),tJ.addEventListener("click",()=>{tW.classList.add("hidden"),$&&(D&&clearTimeout(D),D=setTimeout(()=>{$=!1,D=null,l.courts.forEach(e=>e.isModeOverlayActive=!1),l9(),sP(null,null,"Alert7.mp3"),requestAnimationFrame(sh)},6e4))}),tZ.addEventListener("click",function(){if(l.availablePlayers.length<2)return void alert("At least two players must be available to reorder the queue.");t5=[...l.availablePlayers],sZ(),tW.classList.add("hidden"),tK.classList.remove("hidden")}),tY.addEventListener("click",function(e){let t=e.target.closest(".reorder-btn"),a=e.target.closest(".reorder-position");if(t){let e=t.dataset.playerName,a=t.dataset.direction,n=t5.findIndex(t=>t.name===e);if(-1===n)return;let l=n;if("up"===a&&n>0?l=n-1:"down"===a&&n<t5.length-1&&(l=n+1),l!==n){let[e]=t5.splice(n,1);t5.splice(l,0,e)}sZ()}else a&&il(a,{title:`Set new position for ${a.dataset.playerName}`,maxLength:2})}),tX.addEventListener("click",()=>{tK.classList.add("hidden"),tW.classList.remove("hidden"),t5=[]}),tQ.addEventListener("click",()=>{if(l.availablePlayers=t5,nX(),t5.sessionLog&&Object.keys(t5.sessionLog).length>0){let e=Object.fromEntries(Object.entries(t5.sessionLog).filter(([e,t])=>t.startPosition!==t.currentPosition));if(Object.keys(e).length>0){let t={id:Date.now(),adminAction:"Queue Reorder",players:e,endTime:Date.now()};l.reorderHistory.push(t)}}sP("Players have been re-ordered by the Admin.",null),iE(),tK.classList.add("hidden"),tW.classList.remove("hidden"),t5=[],l9(),n4()}),t2.addEventListener("click",()=>{su(),tW.classList.add("hidden"),t0.classList.remove("hidden")}),t3.addEventListener("click",()=>{t0.classList.add("hidden"),tW.classList.remove("hidden")}),U&&(U.removeEventListener("input",iZ),U.addEventListener("input",iZ)),V&&(V.removeEventListener("input",iZ),V.addEventListener("input",iZ)),Z&&(Z.removeEventListener("input",iZ),Z.addEventListener("input",iZ)),Y&&(Y.removeEventListener("input",iZ),Y.addEventListener("input",iZ)),eh&&eh.addEventListener("click",iB),eb&&eb.addEventListener("click",()=>{ev.classList.add("hidden"),F.classList.remove("hidden")}),eE&&eE.addEventListener("change",ix),document.getElementById("weather-display").addEventListener("click",()=>{H&&H.classList.remove("hidden")}),document.getElementById("cw-close-btn").addEventListener("click",()=>{H&&H.classList.add("hidden")}),document.getElementById("cw-more-details-btn").addEventListener("click",()=>{H&&H.classList.add("hidden"),q&&q.classList.remove("hidden")}),document.getElementById("dw-close-btn").addEventListener("click",()=>{q&&q.classList.add("hidden")}),q&&q.addEventListener("click",e=>{let t=e.target.closest(".tab");t&&(l.detailedWeatherView=t.dataset.view,function(){let e;if(!l.weatherData)return;let{current:t,day:a,morning:n,afternoon:s}=l.weatherData,i=l.detailedWeatherView;document.querySelectorAll(".weather-tabs .tab").forEach(e=>{e.classList.toggle("active",e.dataset.view===i)}),document.getElementById("dw-uv").textContent=`${t.uv} (Low)`,document.getElementById("dw-dewpoint").textContent=`${t.dewPoint}\xb0`,document.getElementById("dw-humidity").textContent=`${t.humidity}%`,document.getElementById("dw-pressure").textContent=`\u{2191} ${t.pressure} mb`,document.getElementById("dw-cloud-cover").textContent=`${t.cloudCover}%`,document.getElementById("dw-visibility").textContent=`${t.visibility} km`;let r="";switch(i){case"morning":e=n,r=`
                    <div class="weather-item"><span>Wind</span><strong>${e.windDir} ${e.windSpeed} km/h</strong></div>
                    <div class="weather-item"><span>Precipitation</span><strong>${e.precipitation} mm</strong></div>
                    <div class="weather-item"><span>Wind Gusts</span><strong>${e.windGusts} km/h</strong></div>
                    <div class="weather-item"><span>Prob. of Precip.</span><strong>${e.precipProb}%</strong></div>
                    <div class="weather-item"><span>Humidity</span><strong>${e.humidity}%</strong></div>
                    <div class="weather-item"><span>Cloud Cover</span><strong>${e.cloudCover}%</strong></div>`;break;case"afternoon":e=s,r=`
                    <div class="weather-item"><span>Wind</span><strong>${e.windDir} ${e.windSpeed} km/h</strong></div>
                    <div class="weather-item"><span>Precipitation</span><strong>${e.precipitation} mm</strong></div>
                    <div class="weather-item"><span>Wind Gusts</span><strong>${e.windGusts} km/h</strong></div>
                    <div class="weather-item"><span>Prob. of Precip.</span><strong>${e.precipProb}%</strong></div>
                    <div class="weather-item"><span>Humidity</span><strong>${e.humidity}%</strong></div>
                    <div class="weather-item"><span>Cloud Cover</span><strong>${e.cloudCover}%</strong></div>`;break;default:e=a,r=`
                    <div class="weather-item"><span>Max UV Index</span><strong>${e.uv} (Very High)</strong></div>
                    <div class="weather-item"><span>Precipitation</span><strong>${e.precipitation} mm</strong></div>
                    <div class="weather-item"><span>Max Wind</span><strong>${e.windSpeed} km/h</strong></div>
                    <div class="weather-item"><span>Max Wind Gusts</span><strong>${e.windGusts} km/h</strong></div>
                    <div class="weather-item"><span>Prob. of Precip.</span><strong>${e.precipProb}%</strong></div>
                    <div class="weather-item"><span>Cloud Cover</span><strong>${e.cloudCover}%</strong></div>`}document.getElementById("forecast-icon").textContent=lh(e.weatherCode),document.getElementById("forecast-temp").textContent=`${e.temp}\xb0`,document.getElementById("forecast-realfeel").textContent=`${e.realFeel}\xb0`,document.getElementById("forecast-realfeel-shade").textContent=`${e.realFeelShade}\xb0`,document.getElementById("forecast-description").textContent=function(e,t=!1){switch(e){case 0:return"Clear sky";case 1:return"Mainly clear";case 2:return"Partly cloudy";case 3:return"Overcast";case 45:case 48:return"Fog";case 51:case 53:case 55:return"Drizzle";case 56:case 57:return"Freezing Drizzle";case 61:return"Slight rain";case 63:return"Moderate rain";case 65:return"Heavy rain";case 66:case 67:return"Freezing Rain";case 71:case 73:case 75:return"Snow fall";case 77:return"Snow grains";case 80:case 81:case 82:return"Rain showers";case 85:case 86:return"Snow showers";case 95:return"Thunderstorm";case 96:case 99:return t?"Thunderstorm with hail":"A thunderstorm this morning; otherwise, clouds and sun";default:return"Unknown"}}(e.weatherCode,"day"!==i),document.getElementById("forecast-grid").innerHTML=r}())}),ta.addEventListener("click",e=>{if(e.target.closest(".sort-btn"))return;let t=e.target.closest(".history-item");if(!t||!t.dataset.gameId)return;let a=t.dataset.gameId;eX.querySelector("h3").textContent="Edit Game Results",eX.querySelector("p").textContent="Are you sure you want to edit the results for this game?",e0.textContent="Yes, Edit",e1.textContent="Cancel",eX.dataset.mode="confirmEditGame",eX.dataset.gameId=a,eX.classList.remove("hidden")}),document.getElementById("leaderboard-back-btn").addEventListener("click",()=>{N.classList.add("hidden"),e2.classList.remove("hidden")}),document.getElementById("leaderboard-btn-yes").addEventListener("click",()=>{let e=JSON.parse(N.dataset.player);e.onLeaderboard=!0,sI(e)}),document.getElementById("leaderboard-btn-no").addEventListener("click",()=>{let e=JSON.parse(N.dataset.player);e.onLeaderboard=!1,sI(e)}),document.getElementById("disclaimer-btn").addEventListener("click",()=>{O.classList.remove("hidden")}),document.getElementById("disclaimer-close-btn").addEventListener("click",()=>{O.classList.add("hidden")}),document.getElementById("auto-minimize-toggle").addEventListener("change",e=>{l.notificationControls.autoMinimize=e.target.checked,l.notificationControls.autoMinimize&&sj(),n4()}),sj(),sj(),sj(),sj(),sj(),t8.addEventListener("click",function(){at=l.selectedAlertSound,sG();let e=document.getElementById("auto-minimize-toggle");e&&(e.checked=l.notificationControls.autoMinimize),t7.innerHTML="",ae.forEach(e=>{let t=document.createElement("li");t.className="sound-selection-item";let a=e===at,n=e.replace(".mp3","").replace("Alert","Alert ");t.innerHTML=`
                <label class="sound-selection-label">
                    <input type="radio" name="alertSound" value="${e}" ${a?"checked":""}>
                    ${n}
                </label>
                <button class="sound-preview-btn" data-sound-file="${e}">\u{25B6}</button>
            `,t7.appendChild(t)}),t6.disabled=!at,t6.style.backgroundColor=at?"var(--confirm-color)":"var(--inactive-color)",t6.style.borderColor=at?"var(--confirm-color)":"var(--inactive-color)",tW.classList.add("hidden"),t4.classList.remove("hidden")}),t7.addEventListener("change",function(e){"radio"===e.target.type&&"alertSound"===e.target.name&&(at=e.target.value,t6.disabled=!1,t6.style.backgroundColor="var(--confirm-color)",t6.style.borderColor="var(--confirm-color)")}),t7.addEventListener("click",function(e){let t=e.target.closest(".sound-preview-btn");if(!t)return;let a=t.dataset.soundFile;C&&(C.pause(),C.currentTime=0),(C=new Audio(`source/${a}`)).play().catch(e=>{console.warn(`Could not play audio from source/${a}. Error: `,e)})}),t6.addEventListener("click",function(){l.selectedAlertSound=at,n4(),t4.classList.add("hidden"),tW.classList.remove("hidden")}),t9.addEventListener("click",function(){t4.classList.add("hidden"),tW.classList.remove("hidden")}),th.addEventListener("click",function(){let e=l.uiSettings.fontSizeMultiplier,t=document.getElementById("font-size-selector");t&&t.querySelectorAll("button").forEach(t=>{let a=parseFloat(t.dataset.size);t.classList.toggle("active",a===e)});let a=l.uiSettings.displaySizeMultiplier,n=document.getElementById("display-size-selector");n&&n.querySelectorAll("button").forEach(e=>{e.classList.toggle("active",parseFloat(e.dataset.size)===a)}),tW.classList.add("hidden"),tv.classList.remove("hidden")}),tf.addEventListener("click",()=>{tv.classList.add("hidden"),tW.classList.remove("hidden")}),document.getElementById("font-size-selector").addEventListener("click",e=>{"BUTTON"===e.target.tagName&&function(e){l.uiSettings.fontSizeMultiplier=e,lp(),n4();let t=document.getElementById("font-size-selector");t&&t.querySelectorAll("button").forEach(t=>{t.classList.remove("active"),parseFloat(t.dataset.size)===e&&t.classList.add("active")})}(parseFloat(e.target.dataset.size))}),document.getElementById("display-size-selector").addEventListener("click",e=>{"BUTTON"===e.target.tagName&&function(e){l.uiSettings.displaySizeMultiplier=e,ly(),n4();let t=document.getElementById("display-size-selector");t&&t.querySelectorAll("button").forEach(t=>{t.classList.remove("active"),parseFloat(t.dataset.size)===e&&t.classList.add("active")})}(parseFloat(e.target.dataset.size))}),aa.addEventListener("click",()=>{l.notificationControls.isMuted=!l.notificationControls.isMuted,l.notificationControls.isMuted&&(l.notificationControls.isTTSDisabled=!0),n4(),sG(),sO(!1)}),an.addEventListener("click",()=>{l.notificationControls.isMinimized=!l.notificationControls.isMinimized,l.notificationControls.isMinimized&&sQ(),n4(),sG(),sO(!1)}),al.addEventListener("click",()=>{l.notificationControls.isTTSDisabled=!l.notificationControls.isTTSDisabled,!l.notificationControls.isTTSDisabled&&l.notificationControls.isMuted&&(l.notificationControls.isMuted=!1),n4(),sG()}),aI.addEventListener("click",function(){lS(),lI(),tW.classList.add("hidden"),aw.classList.remove("hidden")}),a$.addEventListener("click",()=>{aw.classList.add("hidden"),tW.classList.remove("hidden")}),aB.addEventListener("click",function(){lB("add")}),aO.addEventListener("click",function(){lB("return")}),aH.addEventListener("click",function(){lB("return_used")}),aq.addEventListener("click",function(){lx(),aw.classList.add("hidden"),aF.classList.remove("hidden")}),a8.addEventListener("click",()=>{aF.classList.add("hidden"),aw.classList.remove("hidden")}),aY.addEventListener("click",()=>{aj.classList.add("hidden"),aF.classList.remove("hidden")}),aT.addEventListener("click",lM),aw.addEventListener("click",e=>{e.target.closest(".sign-out-btn")&&"Sale"===e.target.closest(".sign-out-btn").dataset.category&&lM(e)}),aQ.addEventListener("click",()=>l$("cans")),aX.addEventListener("click",()=>l$("singles")),a0.addEventListener("click",()=>{aZ.classList.add("hidden"),aw.classList.remove("hidden")}),a2.addEventListener("click",e=>{let t=e.target.closest("li");if(t&&t.querySelector('input[name="purchaserMember"]')){let e=t.querySelector('input[name="purchaserMember"]');e.checked=!0;let a=e.value,n=t.querySelector(".member-designation").textContent.toLowerCase().includes("guest")?"guest":"member";a1.classList.add("hidden"),lD(a,n)}}),document.getElementById("purchaser-new-guest-btn").addEventListener("click",()=>{tw.dataset.context="purchaser",a1.classList.add("hidden"),tw.classList.remove("hidden"),t$.value="",tD.value="",document.querySelector('input[name="player-type"][value="guest"]').checked=!0,document.querySelector('input[name="player-type"][value="member"]').disabled=!0,im()}),document.getElementById("purchaser-returning-guest-btn").addEventListener("click",()=>{document.getElementById("returning-guest-modal").dataset.context="purchaser",a1.classList.add("hidden"),iK(),document.getElementById("returning-guest-modal").classList.remove("hidden")}),document.getElementById("purchaser-cancel-btn").addEventListener("click",()=>{a1.classList.add("hidden"),l.ballManagement.tempSale={stockType:null,memberSignOut:null,purchaserName:null},lM({target:document.querySelector('.sign-out-btn[data-category="Sale"]')})}),document.getElementById("returning-guest-cancel-btn").addEventListener("click",e=>{let t=document.getElementById("returning-guest-modal");"purchaser"===t.dataset.context&&(e.preventDefault(),t.classList.add("hidden"),a1.classList.remove("hidden"),delete t.dataset.context)}),aP.addEventListener("click",function(){let e=ax.dataset.action,a=aA.querySelector('input[name="signoutMember"]:checked').value;if("signout"===e&&"Sale"===ax.dataset.category&&!l.ballManagement.tempSale.memberSignOut){ax.classList.add("hidden"),function(e){let a=l.ballManagement.tempSale,n=a.stockType;a.memberSignOut=e,a3.textContent=`Who is purchasing the ${"cans"===n?"can(s) of new balls":"old ball(s)"} signed out by ${e}?`,a2.innerHTML="";let s=n1().filter(t=>t.name!==e).sort((e,t)=>e.name.localeCompare(t.name));0===s.length?a2.innerHTML='<li style="justify-content: center; color: var(--cancel-color);">No other players found. Please add as a new guest.</li>':s.forEach(e=>{let a=document.createElement("li");a.className="committee-member";let n=e.guest||!t.some(t=>t.name===e.name),l=t.find(t=>t.name===e.name),s=n?"Guest":l&&l.committee?l.committee:"Member";a.innerHTML=`<label><input type="radio" name="purchaserMember" value="${e.name}"><div class="member-details"><span class="member-name">${e.name}</span><span class="member-designation">${s}</span></div></label>`,a2.appendChild(a)}),a1.classList.remove("hidden")}(a);return}if(tb.dataset.member=a,tb.dataset.action=e,ax.classList.add("hidden"),"add"===e)il(null,{mode:"addStock",maxLength:3,title:`Cans to add for ${a}`});else if("return"===e)il(null,{mode:"returnStock",maxLength:3,title:`Cans to return for ${a}`});else if("return_used"===e)il(null,{mode:"returnUsed",maxLength:3,title:`Used balls to return for ${a}`});else if("signout"===e){let e=ax.dataset.category;tb.dataset.category=e,tb.dataset.stockType="cans",tb.dataset.purchaserName=a,il(null,{mode:"signOut",maxLength:2,title:`Cans for ${a} (${e})`})}}),aN.addEventListener("click",()=>{ax.classList.add("hidden"),aw.classList.remove("hidden")}),document.getElementById("manual-entry-btn").addEventListener("click",function(){l.manualEntry.players=[],sL()}),e$.addEventListener("click",function(e){let t=e.target.closest(".action-icon.add");if(t){let e=t.dataset.playerName;l.manualEntry.players.length<4?(l.manualEntry.players.push(e),sL()):sx("You can select a maximum of 4 players.")}}),eM.addEventListener("click",()=>{ew.classList.add("hidden"),tt.classList.remove("hidden")}),eD.addEventListener("click",sC),eB.addEventListener("click",sk),ex.addEventListener("click",function(e){let t=e.target.closest(".action-icon.add");if(t){let e=t.dataset.playerName;l.manualEntry.players.length<4?(l.manualEntry.players.push(e),sk()):sx("You have already selected the maximum of 4 players.")}}),eO.addEventListener("click",sC),eA.addEventListener("click",()=>{eT.classList.add("hidden"),sL()}),document.getElementById("manual-add-guest-btn").addEventListener("click",()=>{tw.dataset.context="manual-entry",ew.classList.add("hidden"),t$.value="",tD.value="",document.querySelector('input[name="player-type"][value="guest"]').checked=!0,document.querySelector('input[name="player-type"][value="member"]').disabled=!0,im(),tw.classList.remove("hidden")}),eP.addEventListener("click",e=>{let t=e.target.closest(".selected-player-chip");t&&sE(t.dataset.playerName)}),eN.addEventListener("click",e=>{let t=e.target.closest(".selected-player-chip");t&&sE(t.dataset.playerName)}),ay.addEventListener("click",it),ah.addEventListener("click",function(){let{mode:e,courtId:t}=l.adminCourtManagement;"card2_remove_players"===e?s7():"card3_add_players"===e&&(l.adminCourtManagement.addedPlayers=[],s9(t)),l1(),l9(),n4(),sO(!1)}),af.addEventListener("click",function(){let{courtId:e,removedPlayers:t,addedPlayers:a}=l.adminCourtManagement,n=l.courts.find(t=>t.id===e);if(!n||"in_progress"!==n.status)return it();let s=[...n.players],i=new Set(t.map(e=>e.name)),r=[...a],o=[];s.forEach((e,t)=>{i.has(e.name)&&o.push(t)}),o.forEach(e=>{r.length>0?s[e]=r.shift():s[e]=null}),s=s.filter(e=>null!==e),r.length>0&&s.push(...r);let d=[...t],c=new Set(a.map(e=>e.name)),m=l.availablePlayers.map(e=>{if(c.has(e.name))if(d.length>0)return d.shift();else return null;return e});m=m.filter(e=>null!==e),d.length>0&&m.push(...d),l.availablePlayers=m;let u=2===s.length?"singles":"doubles",g=sB(e);if(s.length<2)n.autoStartTimer&&clearTimeout(n.autoStartTimer),l.availablePlayers.push(...n.players.filter(e=>!e.guest)),n.becameAvailableAt=Date.now(),n.status="available",n.players=[],n.teams={team1:[],team2:[]},n.gameMode=null,n.gameStartTime=null,sx(`Attention: Game on Court ${g} has been cancelled due to insufficient players.`);else{if(n.gameMode=u,n.players=s,"singles"===u)n.teams.team1=[s[0]],n.teams.team2=[s[1]];else{let e=Math.ceil(s.length/2);n.teams.team1=s.slice(0,e),n.teams.team2=s.slice(e)}let e=t.map(e=>e.name).join(" and "),l=a.map(e=>e.name).join(" and "),i=`Attention on Court ${g}. Player substitution complete.`,r=null;t.length>0&&a.length>0?r=`${l} will be filling in for ${e}.`:t.length>0?i=`Attention on Court ${g}: ${e} have left the game.`:a.length>0&&(i=`Attention on Court ${g}: ${l} have joined the game.`),sP(i,r)}l.adminCourtManagement={mode:"card1_select_court",courtId:null,currentCourtPlayers:[],removedPlayers:[],addedPlayers:[]},am.classList.add("hidden"),l1(),iE(),iS(),l9(),n4(),sQ(),sO(!1)}),av.addEventListener("click",()=>{let{removedPlayers:e,addedPlayers:t,courtId:a}=l.adminCourtManagement;(e.length>0||t.length>0)&&function(e){let{adminCourtManagement:t}=l;t.mode="card3_add_players",document.getElementById("manage-court-players-instructions").textContent=`Court ${e}: Select player(s) to add (Max 7 available).`,ab.dataset.cardMode="card3",au.classList.add("hidden"),ag.classList.add("hidden"),ap.classList.remove("hidden"),ah.classList.remove("hidden"),av.classList.add("hidden"),af.classList.remove("hidden"),ay.textContent="Close",ie(e)}(a)}),am.addEventListener("click",e=>{let t=e.target.closest(".action-icon");if(!t)return;let a=t.dataset.courtId,n=t.dataset.action,s=t.dataset.player,{adminCourtManagement:i}=l;if("select-court"===n)s9(a);else if("remove-player-temp"===n){let e=i.currentCourtPlayers.find(e=>e.name===s);e&&!i.removedPlayers.some(e=>e.name===s)&&(i.removedPlayers.push(e),s9(i.courtId))}else if("return-player-temp"===n)i.removedPlayers=i.removedPlayers.filter(e=>e.name!==s),s9(i.courtId);else if("add-player-temp"===n){let e=l.availablePlayers.find(e=>e.name===s);e&&!i.addedPlayers.some(e=>e.name===s)&&(i.addedPlayers.push(e),ie(i.courtId))}else"undo-add-player-temp"===n&&(i.addedPlayers=i.addedPlayers.filter(e=>e.name!==s),ie(i.courtId));l1(),n4()}),document.addEventListener("keydown",e=>{let t=!tb.classList.contains("hidden"),a=!tx.classList.contains("hidden"),n=!tO.classList.contains("hidden");if(t){let t;e.preventDefault();let a=e.key;a>="0"&&a<="9"?t=tb.querySelector(`.keypad-btn[data-key="${a}"]`):"Backspace"===a?t=tb.querySelector('.keypad-btn[data-key="backspace"]'):"Enter"===a?t=document.getElementById("keypad-confirm-btn"):"c"===a.toLowerCase()&&(t=tb.querySelector('.keypad-btn[data-key="clear"]')),t&&!t.disabled&&t.click()}else if(a){let t;e.preventDefault();let a=e.key;1===a.length&&a.match(/[a-zA-Z]/i)?t=tx.querySelector(`.keypad-btn[data-key="${a.toUpperCase()}"]`):" "===a?t=tx.querySelector('.keypad-btn[data-key="space"]'):"Backspace"===a?t=tx.querySelector('.keypad-btn[data-key="backspace"]'):"Enter"===a&&(t=document.getElementById("alpha-keypad-confirm-btn")),t&&!t.disabled&&t.click()}else if(n){e.preventDefault();let t=e.key,a=e.code,n=e.shiftKey,l=null,s=null;if(a.startsWith("Key")&&1===t.length&&t.match(/[a-zA-Z]/i))l=n?t.toUpperCase():t.toLowerCase();else if("Backspace"===a)s="BACK";else if("Enter"===a)s="ENTER";else if("Space"===a)s="SPACE";else if("ShiftLeft"===a||"ShiftRight"===a)s="SHIFT";else if(1===t.length&&!t.match(/[a-zA-Z]/i))if("!@#$%^&*()_+{}|:\"<>?~`-=[]\\;',./".includes(t))l=t;else if(t>="0"&&t<="9"&&!n)l=t;else if(n)switch(a){case"Digit1":l="!";break;case"Digit2":l="@";break;case"Digit3":l="#";break;case"Digit4":l="$";break;case"Digit5":l="%";break;case"Digit6":l="^";break;case"Digit7":l="&";break;case"Digit8":l="*";break;case"Digit9":l="(";break;case"Digit0":l=")";break;case"Minus":l="_";break;case"Equal":l="+"}else switch(a){case"Minus":l="-";break;case"Equal":l="=";break;case"BracketLeft":l="[";break;case"BracketRight":l="]";break;case"Backslash":l="\\";break;case"Semicolon":l=";";break;case"Quote":l="'";break;case"Comma":l=",";break;case"Period":l=".";break;case"Slash":l="/";break;case"Backquote":l="`"}let i={};(i[t]||i[a])&&(s=i[t]||i[a],l=null);let r=tH.textContent;if(null!==l)r+=l,"shift"===tG.case&&(tG.case="lower","LetterPad"===tG.currentPage&&lu());else if(s){let e;switch(s){case"SPACE":r+=" ";break;case"BACK":r=r.slice(0,-1);break;case"ENTER":r+="\n",e=tO.querySelector('.global-keypad-btn[data-key="ENTER"]');break;case"SHIFT":e=tO.querySelector('.global-keypad-btn[data-key="SHIFT"]');break;case"?123":case"ABC":case"1234":case"!@#":e=Array.from(tO.querySelectorAll(".global-keypad-btn.key-special")).find(e=>e.textContent.trim()===s)}e&&!e.disabled&&e.click()}(null!==l||["SPACE","BACK","ENTER"].includes(s))&&(tH.textContent=r,t_&&(t_.value=r,t_.dispatchEvent(new Event("input"))),tH.scrollTop=tH.scrollHeight)}}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&sh()}),tt.addEventListener("click",e=>{e.target.closest("#history-list .history-item, #team-history-list .history-item")&&(e.target.closest(".sort-btn")||e.target.closest(".radio-group")||function(e){let t=e.target.closest(".history-item");if(!t||e.target.closest(".sort-btn")||e.target.closest(".radio-group"))return;let a=t.dataset.type,n=t.dataset.name;if(!a){if("teams"===l.historyViewMode)a="team",n=function(e){let t=e.querySelector(".team-name-stacked");return t?Array.from(t.querySelectorAll("span")).map(e=>e.textContent.trim()).sort().join(" & "):e.dataset.name}(t);else if("stats"===l.historyViewMode){a="player";let e=t.querySelector(".stats-grid-row span:first-child");e&&(n=e.textContent.trim())}}if(!n||!a)return;l.comparison.active&&l.comparison.type!==a&&lJ(),l.comparison.active=!0,l.comparison.type=a;let s=l.comparison.items.indexOf(n);if(s>-1?l.comparison.items.splice(s,1):l.comparison.items.length<2&&l.comparison.items.push(n),1===l.comparison.items.length){let e=l.comparison.items[0],t=new Set;l.gameHistory.forEach(n=>{let l=n.teams.team1,s=n.teams.team2;if("player"===a){let a=l.includes(e),n=s.includes(e);a?s.forEach(e=>t.add(e)):n&&l.forEach(e=>t.add(e))}else{let a=[...l].sort().join(" & "),n=[...s].sort().join(" & ");a===e?t.add(n):n===e&&t.add(a)}}),l.comparison.opponents=t}else 0===l.comparison.items.length&&lJ();"player"===a?so():lU(),n4(),2===l.comparison.items.length&&function e(){let t=function(){let{type:e,items:t,timeFrame:a}=l.comparison;if(t.length<2)return null;let n=t[0],s=t[1],i=l.gameHistory.filter(e=>lY(e,a)),r=[],o=new Set((r="player"===e?i.filter(e=>{let t=e.teams.team1,a=e.teams.team2,l=t.includes(n),i=t.includes(s),r=a.includes(n),o=a.includes(s);return l&&o||r&&i}):i.filter(e=>{let t=[...e.teams.team1].sort().join(" & "),a=[...e.teams.team2].sort().join(" & ");return t===n&&a===s||t===s&&a===n})).map(e=>new Date(e.endTime).toISOString().split("T")[0])).size;if(0===r.length)return{totalSets:0,totalTimeMs:0,totalDaysPlayed:0,item1:{name:n,setsWon:0,gamesWon:0},item2:{name:s,setsWon:0,gamesWon:0}};let d=0,c=0,m=0,u=0,g=0;return r.forEach(t=>{let[a,l]=t.duration.split("h").map(e=>parseInt(e.replace("m",""),10));if((d+=36e5*a+6e4*l,"skipped"!==t.winner)&&("team1"===t.winner&&("player"===e?t.teams.team1.includes(n):[...t.teams.team1].sort().join(" & ")===n)||"team2"===t.winner&&("player"===e?t.teams.team2.includes(n):[...t.teams.team2].sort().join(" & ")===n)?c++:m++,t.score)){let a=t.score.team1||0,l=t.score.team2||0;("player"===e?t.teams.team1.includes(n):[...t.teams.team1].sort().join(" & ")===n)?(u+=a,g+=l):(u+=l,g+=a)}}),{totalSets:r.length,totalTimeMs:d,totalDaysPlayed:o,item1:{name:n,setsWon:c,gamesWon:u},item2:{name:s,setsWon:m,gamesWon:g}}}();if(!t){nt.innerHTML="<p>Error calculating stats.</p>";return}let{totalSets:a,totalTimeMs:n,totalDaysPlayed:s,item1:i,item2:r}=t,o=a>0?Math.round(i.setsWon/a*100):0,d=a>0?Math.round(r.setsWon/a*100):0,c=i.gamesWon+r.gamesWon,m=c>0?Math.round(i.gamesWon/c*100):0,u=c>0?Math.round(r.gamesWon/c*100):0,g="",p="";i.setsWon>r.setsWon?(g="h2h-winner-text",p="h2h-loser-text"):r.setsWon>i.setsWon&&(g="h2h-loser-text",p="h2h-winner-text");let y="",h="";i.setsWon>r.setsWon?(y="h2h-winner-bg",h="h2h-loser-bg"):r.setsWon>i.setsWon&&(y="h2h-loser-bg",h="h2h-winner-bg");let v="",f="";i.gamesWon>r.gamesWon?(v="h2h-winner-bg",f="h2h-loser-bg"):r.gamesWon>i.gamesWon&&(v="h2h-loser-bg",f="h2h-winner-bg"),ne.textContent=`Head-to-Head: ${"player"===l.comparison.type?"Players":"Teams"}`,na.innerHTML=sc(),na.querySelectorAll('input[name="game-time-filter"]').forEach(t=>{t.addEventListener("change",t=>{l.comparison.timeFrame=t.target.value,e()})});let b=na.querySelector(`input[value="${l.comparison.timeFrame}"]`);b&&(b.checked=!0),nt.innerHTML=`
            <div class="comparison-grid-content">
                <div class="comparison-column">
                    <div class="comparison-header ${g}">${i.name.replace(/ \& /g,"<br>")}</div>
                    <div class="comparison-stat-card ${y}">
                        <div class="label">Sets Won</div>
                        <div class="value">${i.setsWon}</div>
                        <div class="win-percentage">${o}% of sets</div>
                    </div>
                    <div class="comparison-stat-card ${v}">
                        <div class="label">Games Won</div>
                        <div class="value">${i.gamesWon}</div>
                        <div class="win-percentage">${m}% of games</div>
                    </div>
                </div>

                <div class="comparison-column">
                    <div class="comparison-header ${p}">${r.name.replace(/ \& /g,"<br>")}</div>
                    <div class="comparison-stat-card ${h}">
                        <div class="label">Sets Won</div>
                        <div class="value">${r.setsWon}</div>
                        <div class="win-percentage">${d}% of sets</div>
                    </div>
                    <div class="comparison-stat-card ${f}">
                        <div class="label">Games Won</div>
                        <div class="value">${r.gamesWon}</div>
                        <div class="win-percentage">${u}% of games</div>
                    </div>
                </div>

                <div class="comparison-summary-row">
                    <div class="comparison-summary-card">
                        <div class="label">Total Days Played</div>
                        <div class="value">${s}</div>
                    </div>
                    <div class="comparison-summary-card">
                        <div class="label">Total Time on Court</div>
                        <div class="value">${sl(n)}</div>
                    </div>
                </div>

                <div class="comparison-summary-row">
                    <div class="comparison-summary-card">
                        <div class="label">Total Sets Played</div>
                        <div class="value">${a}</div>
                    </div>
                    <div class="comparison-summary-card">
                        <div class="label">Total Games Played</div>
                        <div class="value">${c}</div>
                    </div>
                </div>
            </div>
        `,tt.classList.add("hidden"),a9.classList.remove("hidden")}()}(e))}),nn.addEventListener("click",()=>{a9.classList.add("hidden"),tt.classList.remove("hidden"),lJ(),lK(),sr(),n4()}),no.addEventListener("click",function(){nm.value=l.suggestionSettings.femaleRatioPercent,sW(),ng.value=l.suggestionSettings.maleRatioPercent,sU(),ny.checked=l.suggestionSettings.prioritizeLeastPlaytime,nh.checked=l.suggestionSettings.powerScoreOnly,nv.value=l.suggestionSettings.topPlayerPercent,sJ(),nb.value=l.suggestionSettings.frequentOpponentPercent,sK(),nL.value=l.suggestionSettings.weakPlayerPercent,sY(),sV(l.suggestionSettings.powerScoreOnly),tW.classList.add("hidden"),nd.classList.remove("hidden")}),nc.addEventListener("click",()=>{nd.classList.add("hidden"),tW.classList.remove("hidden")}),nm.addEventListener("input",function(){l.suggestionSettings.femaleRatioPercent=parseInt(nm.value,10),sW(),n4()}),ng.addEventListener("input",function(){l.suggestionSettings.maleRatioPercent=parseInt(ng.value,10),sU(),n4()}),ny.addEventListener("change",function(){l.suggestionSettings.prioritizeLeastPlaytime=ny.checked,n4()}),nh.addEventListener("change",function(){let e=nh.checked;l.suggestionSettings.powerScoreOnly=e,sV(e),n4()}),nv.addEventListener("input",function(){l.suggestionSettings.topPlayerPercent=parseInt(nv.value,10),sJ(),n4()}),nb.addEventListener("input",function(){l.suggestionSettings.frequentOpponentPercent=parseInt(nb.value,10),sK(),n4()}),nL.addEventListener("input",function(){l.suggestionSettings.weakPlayerPercent=parseInt(nL.value,10),sY(),n4()}),nw.addEventListener("click",function(){lF(),tW.classList.add("hidden"),n$.classList.remove("hidden")}),nD.addEventListener("click",()=>{n$.classList.add("hidden"),tW.classList.remove("hidden")}),nM.addEventListener("change",function(e){if("checkbox"===e.target.type&&e.target.dataset.checklistId){let t=e.target.dataset.checklistId,a=e.target.dataset.listType,n=e.target.checked;if(!a||!l.adminChecklist[a])return;let s=l.adminChecklist[a].find(e=>e.id===t);if(s){if(s.checked=n,"arrival"===a){if("arrAmpAux"===t&&n){let e=l.adminChecklist.arrival.find(e=>"arrAmpOptical"===e.id);e&&(e.checked=!1)}else if("arrAmpOptical"===t&&n){let e=l.adminChecklist.arrival.find(e=>"arrAmpAux"===e.id);e&&(e.checked=!1)}("arrAmpAux"===t||"arrAmpOptical"===t)&&lF()}n4(),lj()}}}),nB.addEventListener("click",function(){!function(){if(nP.innerHTML="",nO.textContent="Checklist History",0===l.checklistHistory.length){nP.innerHTML='<li style="text-align: center; color: var(--neutral-color); padding: 1rem;">No history recorded yet.</li>';return}[...l.checklistHistory].sort((e,t)=>t.date.localeCompare(e.date)).forEach(e=>{let t=document.createElement("li");t.textContent=new Date(e.date+"T00:00:00").toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),t.dataset.date=e.date,nP.appendChild(t)})}(),nx.classList.remove("hidden"),nA.classList.add("hidden"),nq.classList.add("hidden"),n$.classList.add("hidden"),nT.classList.remove("hidden")}),nF.addEventListener("click",()=>{nT.classList.add("hidden"),n$.classList.contains("hidden")&&tW.classList.remove("hidden"),l.selectedChecklistHistoryDate=null}),nP.addEventListener("click",e=>{let t=e.target.closest("li[data-date]");t&&function(e){let t=l.checklistHistory.find(t=>t.date===e);if(!t)return;l.selectedChecklistHistoryDate=e;let a=new Date(e+"T00:00:00").toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric",weekday:"long"});nO.textContent=`Checklist for ${a}`,nH.textContent=a,lF(t.checklist,nN,!0),nx.classList.add("hidden"),nA.classList.remove("hidden"),nq.classList.remove("hidden")}(t.dataset.date)}),nq.addEventListener("click",()=>{nA.classList.add("hidden"),nx.classList.remove("hidden"),nq.classList.add("hidden"),nO.textContent="Checklist History",l.selectedChecklistHistoryDate=null}),tO.addEventListener("click",e=>{e.target.closest(".global-keypad-btn")||e.target.closest(".keyboard-content")||(t_&&void 0!==t_.dataset.partialValue&&delete t_.dataset.partialValue,tO.classList.add("hidden"),t_=null,tG.currentPage="LetterPad",tG.case="lower",clearTimeout(tG.longPressTimer))});let iQ=document.getElementById("event-date"),iX=document.getElementById("event-rsvp-date"),i0=document.getElementById("event-start-time"),i1=e=>{let t=e.target,a=t.getBoundingClientRect();if(e.clientX>a.right-30)return;e.preventDefault(),t.classList.add("using-custom-keypad");let n=t.id+"-overlay";document.getElementById(n)&&(t.dataset.overlayId=n),"date"===t.type?(t.dataset.currentDatePart="YYYY",t.dataset.partialValue=""):"time"===t.type&&(t.dataset.currentDatePart="HH",t.dataset.partialValue=""),lc(t,"NumberPad","")};iQ&&iQ.addEventListener("click",i1),iX&&iX.addEventListener("click",i1),i0&&i0.addEventListener("click",i1),U&&U.addEventListener("click",e=>{lc(e.target,"LetterPad","")}),V&&V.addEventListener("click",e=>{lc(e.target,"LetterPad","")}),Y&&Y.addEventListener("click",e=>{lc(e.target,"NumberPad","")}),Z&&Z.addEventListener("click",e=>{lc(e.target,"LetterPad","")}),document.getElementById("swap-player-back-btn").addEventListener("click",()=>{document.getElementById("swap-player-modal").classList.add("hidden"),am.classList.remove("hidden")}),document.getElementById("swap-confirm-back-btn").addEventListener("click",()=>{document.getElementById("swap-confirm-modal").classList.add("hidden"),document.getElementById("swap-player-modal").classList.remove("hidden")}),document.getElementById("swap-confirm-execute-btn").addEventListener("click",()=>{!function(){let e=document.getElementById("swap-confirm-modal"),t=JSON.parse(e.dataset.swapData),{sourceCourt:a,sourcePlayer:n,targetCourt:s,targetPlayer:i}=t,r=l.courts.find(e=>e.id===a),o=l.courts.find(e=>e.id===s);if(!r||!o)return;let d=r.players.findIndex(e=>e.name===n.name),c=o.players.findIndex(e=>e.name===i.name);if(-1===d||-1===c)return;JSON.parse(JSON.stringify(r.players)),JSON.parse(JSON.stringify(o.players)),JSON.parse(JSON.stringify(r.teams)),JSON.parse(JSON.stringify(o.teams));let m=r.players[d];r.players[d]=o.players[c],o.players[c]=m,r.teamsSet&&le(r,n.name,i.name),o.teamsSet&&le(o,i.name,n.name);let u=()=>{console.log("=== EXECUTING UNDO ==="),g=!0;let e=l.courts.find(e=>e.id===courtId);if(!e){console.error("Court not found for undo!"),g=!1;return}console.log("Before restore:",JSON.parse(JSON.stringify(e))),console.log("Restoring to:",originalPlayers,originalTeams),e.players=JSON.parse(JSON.stringify(originalPlayers)),e.teams=JSON.parse(JSON.stringify(originalTeams)),console.log("After restore:",JSON.parse(JSON.stringify(e))),l9(),n4(),setTimeout(()=>{g=!1,console.log("Undo complete - flag cleared")},500)};n9("player_swap",t,u),n7(`Swapped ${n.name} (Court ${a}) \u{2194} ${i.name} (Court ${s})`,u),e.classList.add("hidden"),l9(),n4()}()}),document.getElementById("tts-interval-increase").addEventListener("click",()=>l8("increase")),document.getElementById("tts-interval-decrease").addEventListener("click",()=>l8("decrease")),document.getElementById("light-settings-court-cancel-btn")?.addEventListener("click",()=>{document.getElementById("light-settings-court-modal").classList.add("hidden"),sR()}),document.getElementById("light-settings-court-save-btn")?.addEventListener("click",function(){let e=document.getElementById("light-settings-court-modal"),t=e.dataset.editingCourtId;if(!t||!l.lightSettings?.courts?.[t])return void console.error(`Cannot save: Court ${t} not found!`);l.lightSettings.shellyBaseUrl=document.getElementById("light-setting-base-url").value.trim(),l.lightSettings.shellyAuthKey=document.getElementById("light-setting-auth-key").value.trim();let a=l.lightSettings.courts[t];a.label=document.getElementById("light-setting-label").value.trim()||`Court ${t} Lights`,a.shellyCloudId=document.getElementById("light-setting-cloud-id").value.trim(),a.shellyDeviceId=document.getElementById("light-setting-local-ip").value.trim(),a.isManaged=document.getElementById("light-setting-managed").checked,a.toggleAfter=0,a.isManaged||(a.shellyCloudId="",a.shellyDeviceId="",a.isActive=!1),console.log(`[Light Settings] Saved Court ${t}:`,a),n4(),e.classList.add("hidden"),l9(),sx(`Court ${t} light settings saved.`)}),lL("pedestrian"),lL("parking"),document.getElementById("pedestrian-gate-settings-save-btn")?.addEventListener("click",()=>{lk("pedestrian")}),document.getElementById("pedestrian-gate-settings-cancel-btn")?.addEventListener("click",()=>{document.getElementById("pedestrian-gate-settings-modal").classList.add("hidden")}),document.getElementById("parking-gate-settings-save-btn")?.addEventListener("click",()=>{lk("parking")}),document.getElementById("parking-gate-settings-cancel-btn")?.addEventListener("click",()=>{document.getElementById("parking-gate-settings-modal").classList.add("hidden")})});
//# sourceMappingURL=public.9f1db729.js.map
