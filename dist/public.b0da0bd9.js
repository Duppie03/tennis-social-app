console.log("--- api.js started ---");let API_BASE_URL=window.location.origin,WS_URL=window.location.origin.replace(/^http/,"ws"),API_ENDPOINTS={getState:`${API_BASE_URL}/api/state`,saveState:`${API_BASE_URL}/api/state`,health:`${API_BASE_URL}/api/health`,controlLight:`${API_BASE_URL}/api/lights/control`},ws=null,reconnectInterval=null,reconnectAttempts=0,MAX_RECONNECT_ATTEMPTS=5,RECONNECT_DELAY=3e3,onStateUpdateCallback=null;function initWebSocket(){ws&&ws.readyState===WebSocket.OPEN||(console.log("\uD83D\uDD0C Connecting to WebSocket..."),(ws=new WebSocket(WS_URL)).onopen=()=>{console.log("✅ WebSocket connected - Real-time sync enabled!"),reconnectAttempts=0,reconnectInterval&&(clearInterval(reconnectInterval),reconnectInterval=null)},ws.onmessage=e=>{try{let t=JSON.parse(e.data);("state_update"===t.type||"initial_state"===t.type)&&(console.log("\uD83D\uDCE8 Received state update from server"),onStateUpdateCallback&&"function"==typeof onStateUpdateCallback&&onStateUpdateCallback(t.state))}catch(e){console.error("Error parsing WebSocket message:",e)}},ws.onerror=e=>{console.error("❌ WebSocket error:",e)},ws.onclose=()=>{console.log("\uD83D\uDD0C WebSocket disconnected"),reconnectAttempts<5?(reconnectAttempts++,console.log(`\u{23F3} Reconnecting... (attempt ${reconnectAttempts}/5)`),reconnectInterval||(reconnectInterval=setTimeout(()=>{initWebSocket()},3e3))):console.log("⚠️ Max reconnection attempts reached. Please refresh the page.")})}let API={async loadState(){try{let e=await fetch(API_ENDPOINTS.getState);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();if(t.success)return t.state;throw Error(t.error||"Failed to load state")}catch(e){return console.error("Error loading state from API:",e),null}},async saveState(e){try{let t=await fetch(API_ENDPOINTS.saveState,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let o=await t.json();if(!o.success)throw Error(o.error||"Failed to save state");return!0}catch(e){return console.error("Error saving state to API:",e),!1}},async checkHealth(){try{let e=await fetch(API_ENDPOINTS.health);if(!e.ok)return!1;let t=await e.json();return"OK"===t.status}catch(e){return console.error("Health check failed:",e),!1}},onStateUpdate(e){onStateUpdateCallback=e},connect(){initWebSocket()},disconnect(){ws&&(ws.close(),ws=null),reconnectInterval&&(clearInterval(reconnectInterval),reconnectInterval=null)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{API.connect()}):API.connect(),window.API=API;
//# sourceMappingURL=public.b0da0bd9.js.map
